
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.1.4">
    
    
      
        <title>X5 Candy Ribbons - Data Science Foundations</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.bb3983ee.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../extra.css">
    
      <link rel="stylesheet" href="../../styles.css">
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  


  <script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-114664473-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){var e;this.value&&(e=document.location.pathname,ga("send","pageview",e+"?q="+this.value))}),"undefined"!=typeof location$&&location$.subscribe(function(e){ga("send","pageview",e.pathname)})})</script>
  <script async src="https://www.google-analytics.com/analytics.js"></script>


    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#causality-analysis" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Data Science Foundations" class="md-header__button md-logo" aria-label="Data Science Foundations" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Data Science Foundations
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              X5 Candy Ribbons
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Data Science Foundations" class="md-nav__button md-logo" aria-label="Data Science Foundations" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Data Science Foundations
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        About
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../introduction/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Sessions
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Sessions" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Sessions
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../S1_Regression_and_Analysis/" class="md-nav__link">
        Regression and Analysis
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../S2_Inferential_Statistics/" class="md-nav__link">
        Inferential Statistics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../S3_Model_Selection_and_Validation/" class="md-nav__link">
        Model Selection and Validation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../S4_Feature_Engineering/" class="md-nav__link">
        Feature Engineering
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../S5_Unsupervised_Learning/" class="md-nav__link">
        Unsupervised Learning
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../S6_Bagging/" class="md-nav__link">
        Bagging
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../S7_Boosting/" class="md-nav__link">
        Boosting
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Labs
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Labs" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Labs
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../labs/L1_Descriptive_Statistics_Data_Hunt/" class="md-nav__link">
        Descriptive Statistics Data Hunt
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../labs/L2_Inferential_Statistics_Data_Hunt/" class="md-nav__link">
        Inferential Statistics Data Hunt
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../labs/L3_Feature_Engineering/" class="md-nav__link">
        Practice with Feature Engineering
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../labs/L4_Supervised_Learners/" class="md-nav__link">
        Practice with Supervised Learners
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../labs/L5_Writing_Unit_Tests/" class="md-nav__link">
        Practice with Writing Unit Tests
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Project
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Project" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Project
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../project/P1_Statistical_Analysis_of_TicTacToe/" class="md-nav__link">
        Statistical Analysis of TicTacToe
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../project/P2_Heuristical_TicTacToe_Agents/" class="md-nav__link">
        Heuristical TicTacToe Agents
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../project/P3_1_Step_Look_Ahead_Agents/" class="md-nav__link">
        1-Step Look Ahead Agents
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../project/P4_N_Step_Look_Ahead_Agents/" class="md-nav__link">
        N-Step Look Ahead Agents
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Extras
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Extras" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Extras
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../X1_Bayesian_Probability/" class="md-nav__link">
        Probability
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../X2_Airbnb/" class="md-nav__link">
        Airbnb
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../X3_AB_Testing/" class="md-nav__link">
        AB Tests
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../X4_Spotify_Appendix/" class="md-nav__link">
        Spotify
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                

<p><a id='top'></a></p>
<h1 id="causality-analysis">Causality Analysis<a class="headerlink" href="#causality-analysis" title="Permanent link">&para;</a></h1>
<h1 id="todo">TODO<a class="headerlink" href="#todo" title="Permanent link">&para;</a></h1>
<ul>
<li>ols assumptions for univariate analyses<ul>
<li>residual plots</li>
</ul>
</li>
<li>forward selection<ul>
<li>lines up more or less with chi square tests </li>
<li>include some colinearity measure?</li>
</ul>
</li>
<li>logistic regression (binned seconds, binned total outs)<ul>
<li>random forest does little better than random guessing</li>
</ul>
</li>
<li>business impact</li>
<li>reorganize hypothesis tests section<ul>
<li>univariate vs multivariate</li>
<li>cat v vat, cat v quant, quant v quant, quant v cat</li>
</ul>
</li>
</ul>
<h2 id="10-imports">1.0 Imports<a class="headerlink" href="#10-imports" title="Permanent link">&para;</a></h2>
<h3 id="import-libraries">Import Libraries<a class="headerlink" href="#import-libraries" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># basic packages</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">copy</span>

<span class="c1"># visualization packages</span>
<span class="kn">from</span> <span class="nn">ipywidgets</span> <span class="kn">import</span> <span class="n">interact</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span><span class="p">;</span> <span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
<span class="kn">import</span> <span class="nn">graphviz</span> 

<span class="c1"># stats packages</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">stats</span>
<span class="kn">from</span> <span class="nn">scipy.spatial.distance</span> <span class="kn">import</span> <span class="n">cdist</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="kn">from</span> <span class="nn">statsmodels.formula.api</span> <span class="kn">import</span> <span class="n">ols</span>
<span class="kn">from</span> <span class="nn">statsmodels.stats.outliers_influence</span> <span class="kn">import</span> <span class="n">variance_inflation_factor</span>

<span class="c1"># sklearn preprocessing</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">OneHotEncoder</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">PolynomialFeatures</span><span class="p">,</span> <span class="n">MinMaxScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>
<span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">SimpleImputer</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">make_pipeline</span>

<span class="c1"># sklearn modeling</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span><span class="p">,</span> <span class="n">RandomForestRegressor</span><span class="p">,</span> <span class="n">AdaBoostClassifier</span><span class="p">,</span> <span class="n">GradientBoostingClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span><span class="p">,</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.mixture</span> <span class="kn">import</span> <span class="n">GaussianMixture</span>
<span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="kn">import</span> <span class="n">KMeans</span>

<span class="c1"># sklearn evaluation</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">r2_score</span><span class="p">,</span> <span class="n">accuracy_score</span><span class="p">,</span> <span class="n">silhouette_score</span><span class="p">,</span> <span class="n">calinski_harabasz_score</span><span class="p">,</span> <span class="n">classification_report</span><span class="p">,</span> <span class="n">confusion_matrix</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span><span class="p">,</span> <span class="n">cross_val_score</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">make_patch_spines_invisible</span><span class="p">(</span><span class="n">ax</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_frame_on</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">patch</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">sp</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="n">sp</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">colors</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">cycle</span>

<span class="k">def</span> <span class="nf">my_colors</span><span class="p">():</span>
    <span class="n">tab</span> <span class="o">=</span> <span class="n">cycle</span><span class="p">(</span><span class="n">colors</span><span class="o">.</span><span class="n">TABLEAU_COLORS</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tab</span>
</code></pre></div>

<h3 id="load-data">Load Data<a class="headerlink" href="#load-data" title="Permanent link">&para;</a></h3>
<p><a href="#pairwise">consider only feeds</a></p>
<p><a href="#pairwise">consider feeds and operating conditions</a></p>
<div class="codehilite"><pre><span></span><code><span class="n">feeds</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ADD ARGUS ARGUSTAT AT 31 HK&#39;</span><span class="p">,</span>
 <span class="s1">&#39;ADD ARGUS ARGUTHERM AO 77 PP&#39;</span><span class="p">,</span>
 <span class="s1">&#39;ADD POLYPLAST PPM AO 01 UV PP&#39;</span><span class="p">,</span>
 <span class="s1">&#39;ADD SCHULMAN DTY 20 AOUV&#39;</span><span class="p">,</span>
 <span class="s1">&#39;BEIGE SCHULMAN PZ 91738 1 5 ZA&#39;</span><span class="p">,</span>
 <span class="s1">&#39;BLACK SCHULMAN P7381&#39;</span><span class="p">,</span>
 <span class="s1">&#39;DEVAN 2SPIN PP 106&#39;</span><span class="p">,</span>
 <span class="s1">&#39;GREEN POLYPLAST COLOUR MB PP 6821&#39;</span><span class="p">,</span>
 <span class="s1">&#39;GREEN SCHULMAN PZ 302446 1 5 T&#39;</span><span class="p">,</span>
 <span class="s1">&#39;High MFR Black&#39;</span><span class="p">,</span>
 <span class="s1">&#39;GREEN SCHULMAN PZ 34198 1 5 T&#39;</span><span class="p">,</span>
 <span class="s1">&#39;MFR 4 Black&#39;</span><span class="p">,</span>
 <span class="s1">&#39;MFR 4 Black Brown&#39;</span><span class="p">,</span>
 <span class="s1">&#39;High MFR Grey&#39;</span><span class="p">,</span>
 <span class="s1">&#39;MFR 4 Green&#39;</span><span class="p">,</span>
 <span class="s1">&#39;PP BOREALIS HE465FB&#39;</span><span class="p">,</span>
 <span class="s1">&#39;MFR 4 Black Colour Blending&#39;</span><span class="p">,</span>
 <span class="s1">&#39;PP INEOS 100 GA02&#39;</span><span class="p">,</span>
 <span class="s1">&#39;PP INEOS 100 GA04&#39;</span><span class="p">,</span>
 <span class="s1">&#39;PP INEOS 100 GA09&#39;</span><span class="p">,</span>
 <span class="s1">&#39;MFR 4 Grey Colour Blending&#39;</span><span class="p">,</span>
 <span class="s1">&#39;PP INEOS GA012&#39;</span><span class="p">,</span>
 <span class="s1">&#39;PP POLYCHIM HB12XF&#39;</span><span class="p">,</span>
 <span class="s1">&#39;MFR 4 White&#39;</span><span class="p">,</span>
 <span class="s1">&#39;PP TOTAL 7089&#39;</span><span class="p">,</span>
 <span class="s1">&#39;PP TOTAL PPH 4065&#39;</span><span class="p">,</span>
 <span class="s1">&#39;MFR 4 White Colour Blending&#39;</span><span class="p">,</span>
 <span class="s1">&#39;PP BOREALIS HE370FB&#39;</span><span class="p">,</span>
 <span class="s1">&#39;PP UNIPETROL GB005&#39;</span><span class="p">,</span>
 <span class="s1">&#39;SILIKAT PBH ABPP 05&#39;</span><span class="p">,</span>
 <span class="s1">&#39;SILIKAT POLYPLUS AB 1001 PP&#39;</span><span class="p">,</span>
 <span class="s1">&#39;UV ARGUS ARGUVIN UV 361 PP&#39;</span><span class="p">,</span>
 <span class="s1">&#39;UV ARGUS ARX 904 11 PP&#39;</span><span class="p">,</span>
 <span class="s1">&#39;UV ARGUS ARX 904 11 PP.1&#39;</span><span class="p">,</span>
 <span class="s1">&#39;UV ARGUS ARX 904 11 PP.2&#39;</span><span class="p">,</span>
 <span class="s1">&#39;UV POLYPLAST 6005 PP&#39;</span><span class="p">,</span>
 <span class="s1">&#39;UV SCHULMAN FPPUV 38&#39;</span><span class="p">,</span>
 <span class="s1">&#39;MFR 4 Grey&#39;</span><span class="p">,</span>
 <span class="s1">&#39;PP POLYCHIM HL10XF&#39;</span><span class="p">,</span>
 <span class="s1">&#39;MFR 4 Grey Grey&#39;</span><span class="p">,</span>
 <span class="s1">&#39;PP POLYMER TEST MFI4&#39;</span><span class="p">,</span>
 <span class="s1">&#39;PP TOTAL 4069&#39;</span><span class="p">,</span>
 <span class="s1">&#39;RR MASTERBATCH TEST&#39;</span><span class="p">,</span>
 <span class="s1">&#39;UV ARGUS ARX V 16 706 UV PP&#39;</span><span class="p">]</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../../../../../Dropbox/work/mfganalytic/data/dupont/TyparMasterReportWithSampleDataImprovement2017-today.csv&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Product&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()]</span>
<span class="n">df</span><span class="p">[</span><span class="n">feeds</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">feeds</span><span class="p">]</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">feeds</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="c1">#normalize feed rates</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;Time Delta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Doff Time&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;Total Seconds Out&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="s1">&#39;Sec&#39;</span> <span class="ow">in</span> <span class="n">i</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># df.dropna(inplace=True)</span>
<span class="n">hangs</span> <span class="o">=</span> <span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="s1">&#39;Hang&#39;</span> <span class="ow">in</span> <span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="k">if</span> <span class="n">j</span><span class="p">]</span>
<span class="n">speeds</span> <span class="o">=</span> <span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="s1">&#39;speed&#39;</span> <span class="ow">in</span> <span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="k">if</span> <span class="n">j</span><span class="p">]</span>
<span class="n">outs</span> <span class="o">=</span> <span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="s1">&#39;Out&#39;</span> <span class="ow">in</span> <span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="k">if</span> <span class="n">j</span><span class="p">]</span>
<span class="n">prods</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Product&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
<span class="n">counts</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="s1">&#39;Count&#39;</span> <span class="ow">in</span> <span class="n">i</span><span class="p">]</span>

<span class="c1">#from LOEWEN</span>
<span class="n">virgin_polymer</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;PP INEOS 100 GA04&#39;</span><span class="p">,</span> <span class="s1">&#39;PP POLYCHIM HB12XF&#39;</span><span class="p">,</span> <span class="s1">&#39;PP TOTAL 7089&#39;</span><span class="p">,</span> <span class="c1">#INEOS 100 GA09 until 2018 (2k rolls)</span>
                  <span class="s1">&#39;PP TOTAL PPH 4065&#39;</span><span class="p">,</span> <span class="s1">&#39;PP UNIPETROL GB005&#39;</span><span class="p">,</span> <span class="s1">&#39;PP POLYCHIM HL10XF&#39;</span><span class="p">]</span> <span class="c1">#HL10XF not used after 2016, #BOREALIS </span>

<span class="n">virgin_polymer</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;PP INEOS&#39;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;PP TOTAL&#39;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;PP UNI&#39;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;PP BORE&#39;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;PP POLY&#39;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">):</span>
        <span class="n">virgin_polymer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>

<span class="n">pressures</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="k">if</span> <span class="s1">&#39;Press&#39;</span> <span class="ow">in</span> <span class="n">col</span> <span class="ow">or</span> <span class="s1">&#39;PRESS&#39;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">:</span>
        <span class="n">pressures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>

<span class="n">silicates</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="k">if</span> <span class="s1">&#39;SIL&#39;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">:</span>
        <span class="n">silicates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
<span class="n">uvs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="k">if</span> <span class="s1">&#39;UV &#39;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">:</span>
        <span class="n">uvs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>

<span class="n">recycle</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="k">if</span> <span class="s1">&#39;MFR&#39;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">:</span>
        <span class="n">recycle</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>

<span class="n">seconds</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="k">if</span> <span class="s1">&#39;Sec&#39;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">:</span>
        <span class="n">seconds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>

<span class="n">master_batch</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">feeds</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">recycle</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">virgin_polymer</span><span class="p">))</span>

<span class="n">operation</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">master_batch</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">virgin_polymer</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">recycle</span><span class="p">)</span> <span class="o">-</span><span class="nb">set</span><span class="p">(</span><span class="n">hangs</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">outs</span><span class="p">))</span>
<span class="n">operation</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
</code></pre></div>

<p>A summary of the columns</p>
<div class="codehilite"><pre><span></span><code><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;pressures: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">pressures</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span> 
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;silicates: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">silicates</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span> 
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;uvs: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">uvs</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span> 
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;feeds: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">feeds</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span> 
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;master_batch: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">master_batch</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span> 
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;virgin_polymer: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">virgin_polymer</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;recycle: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">recycle</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span> 
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;operation: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">operation</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span> 
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;hangs: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">hangs</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span> 
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;speeds: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">speeds</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span> 
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;outs: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">outs</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span> 
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;seconds: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">seconds</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span> 
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;summary target columns: TotalHangs, Total Position Out&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>pressures: 8
silicates: 2
uvs: 8
feeds: 44
master_batch: 20
virgin_polymer: 13
recycle: 11
operation: 180

hangs: 9
speeds: 9
outs: 10
seconds: 9

summary target columns: TotalHangs, Total Position Out

(17897, 243)
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">all_feats</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">feeds</span> <span class="o">+</span> <span class="n">operation</span><span class="p">)]</span><span class="o">.</span><span class="n">values</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">df</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Millroll ID</th>
      <th>Product</th>
      <th>Roll Width</th>
      <th>Sample Number</th>
      <th>Doff Time</th>
      <th>Block1Pos Out Seconds</th>
      <th>Block2Pos Out Seconds</th>
      <th>Block3Pos Out Seconds</th>
      <th>Block4Pos Out Seconds</th>
      <th>Block1Pos Out Count</th>
      <th>...</th>
      <th>TKW5 AVG - Tack - Tear West 5 Meter</th>
      <th>TPOP - NUMBER OF TPO PEEKS (TPOP)</th>
      <th>TTMD AVG - TRAP TEAR MD (TTMD)</th>
      <th>TTXD AVG - TRAP TEAR XD (TTXD)</th>
      <th>UPEX - UWU PLOT EXTREM (UPEX)</th>
      <th>UWG - UWU GRAVIMETRIC WITH SCALE (UWG)</th>
      <th>UWGP AVG - UWU PLOT GRAVIMETRIC WITH SCALE (UWGP)</th>
      <th>WATP - WATER PERMEABILITY (WATP)</th>
      <th>Time Delta</th>
      <th>Total Seconds Out</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>PM10022907</td>
      <td>136215.0</td>
      <td>5200.0</td>
      <td>NaN</td>
      <td>1/1/2017 12:43:57 AM</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaT</td>
      <td>9.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>PM10022908</td>
      <td>136215.0</td>
      <td>5200.0</td>
      <td>NaN</td>
      <td>1/1/2017 1:32:49 AM</td>
      <td>NaN</td>
      <td>164.0</td>
      <td>240.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>138.70</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0 days 00:48:52</td>
      <td>536.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>PM10022909</td>
      <td>136215.0</td>
      <td>5200.0</td>
      <td>NaN</td>
      <td>1/1/2017 2:21:40 AM</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0 days 00:48:51</td>
      <td>20.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>PM10022910</td>
      <td>136215.0</td>
      <td>5200.0</td>
      <td>NaN</td>
      <td>1/1/2017 3:10:34 AM</td>
      <td>NaN</td>
      <td>320.0</td>
      <td>264.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>36.96</td>
      <td>33.59</td>
      <td>NaN</td>
      <td>135.98</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0 days 00:48:54</td>
      <td>1001.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>PM10022911</td>
      <td>136215.0</td>
      <td>5200.0</td>
      <td>NaN</td>
      <td>1/1/2017 3:59:24 AM</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0 days 00:48:50</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>17892</th>
      <td>PM10040811</td>
      <td>90215.0</td>
      <td>4250.0</td>
      <td>P113099,P113100,P113101,P113102,P113103</td>
      <td>2/25/2019 7:56:16 PM</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>21.30</td>
      <td>22.10</td>
      <td>NaN</td>
      <td>89.60</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0 days 00:57:24</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>17893</th>
      <td>PM10040812</td>
      <td>90215.0</td>
      <td>4250.0</td>
      <td>P113104</td>
      <td>2/25/2019 8:53:41 PM</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0 days 00:57:25</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>17894</th>
      <td>PM10040813</td>
      <td>90215.0</td>
      <td>4250.0</td>
      <td>P113105,P113106,P113107</td>
      <td>2/25/2019 9:51:06 PM</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>89.30</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0 days 00:57:25</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>17895</th>
      <td>PM10040814</td>
      <td>90215.0</td>
      <td>4250.0</td>
      <td>P113108</td>
      <td>2/25/2019 10:48:32 PM</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>576.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0 days 00:57:26</td>
      <td>799.0</td>
    </tr>
    <tr>
      <th>17896</th>
      <td>PM10040815</td>
      <td>90215.0</td>
      <td>4250.0</td>
      <td>P113109,P113110,P113111,P113112</td>
      <td>2/25/2019 11:45:55 PM</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>429.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>23.20</td>
      <td>22.60</td>
      <td>NaN</td>
      <td>91.40</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0 days 00:57:23</td>
      <td>429.0</td>
    </tr>
  </tbody>
</table>
<p>17897 rows  243 columns</p>
</div>

<h2 id="20-understand-the-dependent-variable">2.0 Understand The Dependent Variable<a class="headerlink" href="#20-understand-the-dependent-variable" title="Permanent link">&para;</a></h2>
<h3 id="what-is-the-hit-rate-in-these-upset-columns">What is the hit rate in these upset columns?<a class="headerlink" href="#what-is-the-hit-rate-in-these-upset-columns" title="Permanent link">&para;</a></h3>
<p>Around 7500 cases with no problem; 10000 cases with a position out</p>
<div class="codehilite"><pre><span></span><code><span class="n">target</span> <span class="o">=</span> <span class="s2">&quot;Total Position Out&quot;</span>
<span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">target</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>True     10355
False     7542
Name: Total Position Out, dtype: int64
</code></pre></div>

<p>There are 30% higher incidence of hangs</p>
<div class="codehilite"><pre><span></span><code><span class="n">target</span> <span class="o">=</span> <span class="s2">&quot;TotalHangs&quot;</span>
<span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">target</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>True     13954
False     3943
Name: TotalHangs, dtype: int64
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">target1</span> <span class="o">=</span> <span class="s2">&quot;TotalHangs&quot;</span>
<span class="n">target2</span> <span class="o">=</span> <span class="s2">&quot;Total Position Out&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;both upsets: </span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="n">target1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">target2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;only hangs: </span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="n">target1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">target2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;only outs: </span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="n">target1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">target2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;neither upset: </span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="n">target1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">target2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>both upsets: 10161
only hangs: 3793
only outs: 194
neither upset: 3749
</code></pre></div>

<h3 id="what-is-the-magnitude-of-the-outages">What is the magnitude of the outages?<a class="headerlink" href="#what-is-the-magnitude-of-the-outages" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="n">target</span> <span class="o">=</span> <span class="s2">&quot;Total Position Out&quot;</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">][[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">outs</span> <span class="k">if</span> <span class="s1">&#39;Sec&#39;</span> <span class="ow">in</span> <span class="n">i</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">][</span><span class="n">target</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>[&lt;matplotlib.lines.Line2D at 0x7f0ad7207b80&gt;]
</code></pre></div>

<p><img alt="png" src="../X5_Candy_Ribbons_files/X5_Candy_Ribbons_18_1.png" /></p>
<div class="codehilite"><pre><span></span><code><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Total Position Out</th>
      <th>Unnamed 0</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Total Position Out</th>
      <td>1.00000</td>
      <td>0.62591</td>
    </tr>
    <tr>
      <th>Unnamed 0</th>
      <td>0.62591</td>
      <td>1.00000</td>
    </tr>
  </tbody>
</table>
</div>

<div class="codehilite"><pre><span></span><code><span class="n">target</span> <span class="o">=</span> <span class="s2">&quot;TotalHangs&quot;</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">][[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">outs</span> <span class="k">if</span> <span class="s1">&#39;Sec&#39;</span> <span class="ow">in</span> <span class="n">i</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">][</span><span class="n">target</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>[&lt;matplotlib.lines.Line2D at 0x7f0ad3eff460&gt;]
</code></pre></div>

<p><img alt="png" src="../X5_Candy_Ribbons_files/X5_Candy_Ribbons_20_1.png" /></p>
<div class="codehilite"><pre><span></span><code><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>TotalHangs</th>
      <th>Unnamed 0</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>TotalHangs</th>
      <td>1.000000</td>
      <td>0.390949</td>
    </tr>
    <tr>
      <th>Unnamed 0</th>
      <td>0.390949</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
</div>

<h3 id="distribution-around-the-target-variable-total-seconds">Distribution around the target variable, total seconds<a class="headerlink" href="#distribution-around-the-target-variable-total-seconds" title="Permanent link">&para;</a></h3>
<p>We will certainly encounter trouble in an OLS estimate with this shape of the target variable; extreme skewness, upper tail, perhaps outliers</p>
<div class="codehilite"><pre><span></span><code><span class="n">tot_seconds</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">seconds</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">tot_seconds</span><span class="o">.</span><span class="n">kurt</span><span class="p">()</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>923.6728632470827
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">tot_seconds</span><span class="o">.</span><span class="n">skew</span><span class="p">()</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>25.09323820232841
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">tot_seconds</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">kde</span><span class="p">()</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>&lt;AxesSubplot:ylabel=&#39;Density&#39;&gt;
</code></pre></div>

<p><img alt="png" src="../X5_Candy_Ribbons_files/X5_Candy_Ribbons_25_1.png" /></p>
<div class="codehilite"><pre><span></span><code><span class="n">tot_seconds</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>count     17897.000000
mean       2093.512879
std        8060.466090
min           0.000000
25%          20.000000
50%         666.000000
75%        1970.000000
max      396570.000000
dtype: float64
</code></pre></div>

<h3 id="do-block-positions-have-the-same-behavior">Do block positions have the same behavior?<a class="headerlink" href="#do-block-positions-have-the-same-behavior" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="n">target</span> <span class="o">=</span> <span class="s2">&quot;TotalHangs&quot;</span>
<span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">target</span><span class="p">)[</span><span class="n">hangs</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Block1Hangs Seconds</th>
      <th>Block2Hangs Seconds</th>
      <th>Block3Hangs Seconds</th>
      <th>Block4Hangs Seconds</th>
      <th>Block1Hangs Count</th>
      <th>Block2Hangs Count</th>
      <th>Block3Hangs Count</th>
      <th>Block4Hangs Count</th>
      <th>TotalHangs</th>
    </tr>
    <tr>
      <th>TotalHangs</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0.0</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>3943</td>
    </tr>
    <tr>
      <th>1.0</th>
      <td>510</td>
      <td>682</td>
      <td>745</td>
      <td>977</td>
      <td>510</td>
      <td>682</td>
      <td>745</td>
      <td>977</td>
      <td>2914</td>
    </tr>
    <tr>
      <th>2.0</th>
      <td>709</td>
      <td>761</td>
      <td>901</td>
      <td>1109</td>
      <td>709</td>
      <td>761</td>
      <td>901</td>
      <td>1109</td>
      <td>2424</td>
    </tr>
    <tr>
      <th>3.0</th>
      <td>721</td>
      <td>776</td>
      <td>930</td>
      <td>1103</td>
      <td>721</td>
      <td>776</td>
      <td>930</td>
      <td>1103</td>
      <td>1929</td>
    </tr>
    <tr>
      <th>4.0</th>
      <td>700</td>
      <td>773</td>
      <td>875</td>
      <td>993</td>
      <td>700</td>
      <td>773</td>
      <td>875</td>
      <td>993</td>
      <td>1577</td>
    </tr>
    <tr>
      <th>5.0</th>
      <td>609</td>
      <td>668</td>
      <td>744</td>
      <td>828</td>
      <td>609</td>
      <td>668</td>
      <td>745</td>
      <td>828</td>
      <td>1189</td>
    </tr>
    <tr>
      <th>6.0</th>
      <td>523</td>
      <td>498</td>
      <td>599</td>
      <td>631</td>
      <td>523</td>
      <td>498</td>
      <td>599</td>
      <td>631</td>
      <td>883</td>
    </tr>
    <tr>
      <th>7.0</th>
      <td>387</td>
      <td>414</td>
      <td>472</td>
      <td>505</td>
      <td>387</td>
      <td>414</td>
      <td>472</td>
      <td>505</td>
      <td>640</td>
    </tr>
    <tr>
      <th>8.0</th>
      <td>321</td>
      <td>338</td>
      <td>376</td>
      <td>409</td>
      <td>321</td>
      <td>338</td>
      <td>376</td>
      <td>409</td>
      <td>503</td>
    </tr>
    <tr>
      <th>9.0</th>
      <td>286</td>
      <td>275</td>
      <td>305</td>
      <td>339</td>
      <td>286</td>
      <td>275</td>
      <td>305</td>
      <td>339</td>
      <td>405</td>
    </tr>
    <tr>
      <th>10.0</th>
      <td>219</td>
      <td>206</td>
      <td>244</td>
      <td>248</td>
      <td>219</td>
      <td>206</td>
      <td>244</td>
      <td>248</td>
      <td>296</td>
    </tr>
    <tr>
      <th>11.0</th>
      <td>144</td>
      <td>154</td>
      <td>168</td>
      <td>171</td>
      <td>144</td>
      <td>154</td>
      <td>168</td>
      <td>171</td>
      <td>203</td>
    </tr>
    <tr>
      <th>12.0</th>
      <td>148</td>
      <td>139</td>
      <td>159</td>
      <td>171</td>
      <td>148</td>
      <td>139</td>
      <td>159</td>
      <td>171</td>
      <td>191</td>
    </tr>
    <tr>
      <th>13.0</th>
      <td>105</td>
      <td>100</td>
      <td>117</td>
      <td>106</td>
      <td>105</td>
      <td>100</td>
      <td>117</td>
      <td>106</td>
      <td>131</td>
    </tr>
    <tr>
      <th>14.0</th>
      <td>93</td>
      <td>88</td>
      <td>95</td>
      <td>96</td>
      <td>93</td>
      <td>88</td>
      <td>95</td>
      <td>96</td>
      <td>109</td>
    </tr>
    <tr>
      <th>15.0</th>
      <td>97</td>
      <td>89</td>
      <td>94</td>
      <td>97</td>
      <td>97</td>
      <td>89</td>
      <td>94</td>
      <td>97</td>
      <td>108</td>
    </tr>
    <tr>
      <th>16.0</th>
      <td>70</td>
      <td>64</td>
      <td>72</td>
      <td>76</td>
      <td>70</td>
      <td>64</td>
      <td>72</td>
      <td>76</td>
      <td>81</td>
    </tr>
    <tr>
      <th>17.0</th>
      <td>51</td>
      <td>50</td>
      <td>51</td>
      <td>47</td>
      <td>51</td>
      <td>50</td>
      <td>51</td>
      <td>47</td>
      <td>55</td>
    </tr>
    <tr>
      <th>18.0</th>
      <td>29</td>
      <td>30</td>
      <td>32</td>
      <td>33</td>
      <td>29</td>
      <td>30</td>
      <td>32</td>
      <td>33</td>
      <td>35</td>
    </tr>
    <tr>
      <th>19.0</th>
      <td>32</td>
      <td>32</td>
      <td>33</td>
      <td>32</td>
      <td>32</td>
      <td>32</td>
      <td>33</td>
      <td>32</td>
      <td>35</td>
    </tr>
    <tr>
      <th>20.0</th>
      <td>32</td>
      <td>32</td>
      <td>31</td>
      <td>34</td>
      <td>32</td>
      <td>32</td>
      <td>31</td>
      <td>34</td>
      <td>35</td>
    </tr>
    <tr>
      <th>21.0</th>
      <td>26</td>
      <td>27</td>
      <td>25</td>
      <td>24</td>
      <td>26</td>
      <td>27</td>
      <td>25</td>
      <td>24</td>
      <td>28</td>
    </tr>
    <tr>
      <th>22.0</th>
      <td>21</td>
      <td>20</td>
      <td>24</td>
      <td>24</td>
      <td>21</td>
      <td>20</td>
      <td>24</td>
      <td>24</td>
      <td>24</td>
    </tr>
    <tr>
      <th>23.0</th>
      <td>23</td>
      <td>23</td>
      <td>24</td>
      <td>23</td>
      <td>23</td>
      <td>23</td>
      <td>24</td>
      <td>23</td>
      <td>25</td>
    </tr>
    <tr>
      <th>24.0</th>
      <td>16</td>
      <td>17</td>
      <td>18</td>
      <td>19</td>
      <td>16</td>
      <td>17</td>
      <td>18</td>
      <td>19</td>
      <td>20</td>
    </tr>
    <tr>
      <th>25.0</th>
      <td>7</td>
      <td>8</td>
      <td>8</td>
      <td>7</td>
      <td>7</td>
      <td>8</td>
      <td>8</td>
      <td>7</td>
      <td>8</td>
    </tr>
    <tr>
      <th>26.0</th>
      <td>11</td>
      <td>10</td>
      <td>10</td>
      <td>11</td>
      <td>11</td>
      <td>10</td>
      <td>10</td>
      <td>11</td>
      <td>11</td>
    </tr>
    <tr>
      <th>27.0</th>
      <td>8</td>
      <td>9</td>
      <td>9</td>
      <td>8</td>
      <td>8</td>
      <td>9</td>
      <td>9</td>
      <td>8</td>
      <td>9</td>
    </tr>
    <tr>
      <th>28.0</th>
      <td>10</td>
      <td>10</td>
      <td>10</td>
      <td>10</td>
      <td>10</td>
      <td>10</td>
      <td>10</td>
      <td>10</td>
      <td>10</td>
    </tr>
    <tr>
      <th>29.0</th>
      <td>6</td>
      <td>5</td>
      <td>6</td>
      <td>6</td>
      <td>6</td>
      <td>5</td>
      <td>6</td>
      <td>6</td>
      <td>6</td>
    </tr>
    <tr>
      <th>30.0</th>
      <td>4</td>
      <td>3</td>
      <td>4</td>
      <td>4</td>
      <td>4</td>
      <td>3</td>
      <td>4</td>
      <td>4</td>
      <td>4</td>
    </tr>
    <tr>
      <th>31.0</th>
      <td>8</td>
      <td>8</td>
      <td>8</td>
      <td>8</td>
      <td>8</td>
      <td>8</td>
      <td>8</td>
      <td>8</td>
      <td>8</td>
    </tr>
    <tr>
      <th>32.0</th>
      <td>4</td>
      <td>3</td>
      <td>4</td>
      <td>4</td>
      <td>4</td>
      <td>3</td>
      <td>4</td>
      <td>4</td>
      <td>4</td>
    </tr>
    <tr>
      <th>33.0</th>
      <td>7</td>
      <td>5</td>
      <td>7</td>
      <td>6</td>
      <td>7</td>
      <td>5</td>
      <td>7</td>
      <td>6</td>
      <td>7</td>
    </tr>
    <tr>
      <th>34.0</th>
      <td>9</td>
      <td>8</td>
      <td>9</td>
      <td>8</td>
      <td>9</td>
      <td>8</td>
      <td>9</td>
      <td>8</td>
      <td>9</td>
    </tr>
    <tr>
      <th>35.0</th>
      <td>6</td>
      <td>6</td>
      <td>6</td>
      <td>6</td>
      <td>6</td>
      <td>6</td>
      <td>6</td>
      <td>6</td>
      <td>6</td>
    </tr>
    <tr>
      <th>36.0</th>
      <td>6</td>
      <td>5</td>
      <td>6</td>
      <td>6</td>
      <td>6</td>
      <td>5</td>
      <td>6</td>
      <td>6</td>
      <td>6</td>
    </tr>
    <tr>
      <th>37.0</th>
      <td>3</td>
      <td>3</td>
      <td>3</td>
      <td>3</td>
      <td>3</td>
      <td>3</td>
      <td>3</td>
      <td>3</td>
      <td>3</td>
    </tr>
    <tr>
      <th>38.0</th>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>39.0</th>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>40.0</th>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
    </tr>
    <tr>
      <th>42.0</th>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>43.0</th>
      <td>3</td>
      <td>3</td>
      <td>3</td>
      <td>3</td>
      <td>3</td>
      <td>3</td>
      <td>3</td>
      <td>3</td>
      <td>3</td>
    </tr>
    <tr>
      <th>45.0</th>
      <td>3</td>
      <td>3</td>
      <td>3</td>
      <td>3</td>
      <td>3</td>
      <td>3</td>
      <td>3</td>
      <td>3</td>
      <td>3</td>
    </tr>
    <tr>
      <th>46.0</th>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
    </tr>
    <tr>
      <th>48.0</th>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>52.0</th>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>53.0</th>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>54.0</th>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>58.0</th>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>62.0</th>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>63.0</th>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>70.0</th>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>72.0</th>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>140.0</th>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>

<div class="codehilite"><pre><span></span><code><span class="n">df</span><span class="p">[[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">outs</span> <span class="k">if</span> <span class="s1">&#39;Sec&#39;</span> <span class="ow">in</span> <span class="n">i</span><span class="p">]]</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">vert</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>&lt;AxesSubplot:&gt;
</code></pre></div>

<p><img alt="png" src="../X5_Candy_Ribbons_files/X5_Candy_Ribbons_29_1.png" /></p>
<div class="codehilite"><pre><span></span><code><span class="n">df</span><span class="p">[[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">hangs</span> <span class="k">if</span> <span class="s1">&#39;Sec&#39;</span> <span class="ow">in</span> <span class="n">i</span><span class="p">]]</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">vert</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>&lt;AxesSubplot:&gt;
</code></pre></div>

<p><img alt="png" src="../X5_Candy_Ribbons_files/X5_Candy_Ribbons_30_1.png" /></p>
<h2 id="30-look-for-dependent-independent-signal">3.0 Look for dependent-independent signal<a class="headerlink" href="#30-look-for-dependent-independent-signal" title="Permanent link">&para;</a></h2>
<h3 id="are-there-linear-relationships-between-the-dependent-and-independent-variables">Are there linear relationships between the dependent and independent variables?<a class="headerlink" href="#are-there-linear-relationships-between-the-dependent-and-independent-variables" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="n">corr</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="n">outs</span><span class="o">+</span><span class="n">hangs</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mf">0.3</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>Product                                              False
Roll Width                                           False
Block1Pos Out Seconds                                 True
Block2Pos Out Seconds                                 True
Block3Pos Out Seconds                                 True
                                                     ...  
UPEX - UWU PLOT EXTREM (UPEX)                        False
UWG - UWU GRAVIMETRIC WITH SCALE (UWG)               False
UWGP AVG - UWU PLOT GRAVIMETRIC WITH SCALE (UWGP)    False
WATP - WATER PERMEABILITY (WATP)                     False
Total Seconds Out                                     True
Length: 237, dtype: bool
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">cor_filt</span> <span class="o">=</span> <span class="n">corr</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="nb">abs</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="n">outs</span><span class="o">+</span><span class="n">hangs</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mf">0.3</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="n">outs</span><span class="o">+</span><span class="n">hangs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="n">outs</span><span class="o">+</span><span class="n">hangs</span><span class="p">]</span>
<span class="n">cor_filt</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Block1Pos Out Seconds</th>
      <th>Block2Pos Out Seconds</th>
      <th>Block3Pos Out Seconds</th>
      <th>Block4Pos Out Seconds</th>
      <th>Block1Pos Out Count</th>
      <th>Block2Pos Out Count</th>
      <th>Block3Pos Out Count</th>
      <th>Block4Pos Out Count</th>
      <th>Total Position Out</th>
      <th>Total Seconds Out</th>
      <th>Block1Hangs Seconds</th>
      <th>Block2Hangs Seconds</th>
      <th>Block3Hangs Seconds</th>
      <th>Block4Hangs Seconds</th>
      <th>Block1Hangs Count</th>
      <th>Block2Hangs Count</th>
      <th>Block3Hangs Count</th>
      <th>Block4Hangs Count</th>
      <th>TotalHangs</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>ADD ARGUS ARGUSTAT AT 31 HK</th>
      <td>-0.103999</td>
      <td>-0.417688</td>
      <td>-0.383222</td>
      <td>0.202131</td>
      <td>-0.056194</td>
      <td>-0.412274</td>
      <td>0.155126</td>
      <td>0.145535</td>
      <td>0.014216</td>
      <td>0.029563</td>
      <td>0.121682</td>
      <td>-0.256723</td>
      <td>-0.012676</td>
      <td>0.099690</td>
      <td>-0.069354</td>
      <td>-0.041492</td>
      <td>0.094150</td>
      <td>0.041900</td>
      <td>0.344896</td>
    </tr>
    <tr>
      <th>PP INEOS 100 GA02</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>-1.000000</td>
      <td>-1.000000</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>-1.000000</td>
    </tr>
    <tr>
      <th>MFR 4 White</th>
      <td>0.289648</td>
      <td>-0.016268</td>
      <td>0.451446</td>
      <td>-0.155932</td>
      <td>0.297256</td>
      <td>-0.000098</td>
      <td>0.376795</td>
      <td>-0.003129</td>
      <td>0.225425</td>
      <td>0.182687</td>
      <td>0.231764</td>
      <td>-0.045076</td>
      <td>0.283286</td>
      <td>-0.119481</td>
      <td>0.108396</td>
      <td>-0.057188</td>
      <td>0.317089</td>
      <td>0.008018</td>
      <td>0.189109</td>
    </tr>
    <tr>
      <th>PP TOTAL 7089</th>
      <td>0.160268</td>
      <td>0.171023</td>
      <td>0.210796</td>
      <td>0.093720</td>
      <td>0.192159</td>
      <td>0.210942</td>
      <td>0.206859</td>
      <td>0.076058</td>
      <td>0.260505</td>
      <td>0.207522</td>
      <td>0.087954</td>
      <td>0.050670</td>
      <td>0.052622</td>
      <td>-0.050506</td>
      <td>0.218148</td>
      <td>0.251676</td>
      <td>0.134881</td>
      <td>0.121080</td>
      <td>0.331897</td>
    </tr>
    <tr>
      <th>SILIKAT POLYPLUS AB 1001 PP</th>
      <td>0.015132</td>
      <td>0.125801</td>
      <td>0.379559</td>
      <td>0.255662</td>
      <td>-0.018715</td>
      <td>0.012019</td>
      <td>0.161698</td>
      <td>0.067661</td>
      <td>0.127830</td>
      <td>0.137376</td>
      <td>-0.016317</td>
      <td>-0.018187</td>
      <td>-0.018956</td>
      <td>0.086781</td>
      <td>0.011207</td>
      <td>-0.020307</td>
      <td>0.092291</td>
      <td>0.109259</td>
      <td>0.069217</td>
    </tr>
    <tr>
      <th>RJET15219WG1 - Corona Charge I AVG BLK#2</th>
      <td>-0.120204</td>
      <td>-0.120509</td>
      <td>-0.056377</td>
      <td>-0.002054</td>
      <td>-0.198138</td>
      <td>-0.221189</td>
      <td>-0.193393</td>
      <td>-0.024541</td>
      <td>-0.232863</td>
      <td>-0.149862</td>
      <td>-0.090896</td>
      <td>-0.060404</td>
      <td>-0.054169</td>
      <td>-0.052683</td>
      <td>-0.215325</td>
      <td>-0.216545</td>
      <td>-0.182990</td>
      <td>-0.120387</td>
      <td>-0.308217</td>
    </tr>
    <tr>
      <th>BLFL - COLOUR BLACK FILAMENT L value (BLFL)</th>
      <td>-0.360086</td>
      <td>-0.157845</td>
      <td>-0.245565</td>
      <td>-0.268837</td>
      <td>-0.153321</td>
      <td>-0.162697</td>
      <td>-0.212481</td>
      <td>-0.247721</td>
      <td>-0.067632</td>
      <td>-0.121690</td>
      <td>0.097783</td>
      <td>0.146515</td>
      <td>-0.346923</td>
      <td>-0.110987</td>
      <td>0.402310</td>
      <td>-0.274153</td>
      <td>-0.378670</td>
      <td>-0.116264</td>
      <td>-0.117501</td>
    </tr>
    <tr>
      <th>BRFA - COLOUR BROWN FILAMENT a value (BRFa)</th>
      <td>0.159056</td>
      <td>0.250229</td>
      <td>-0.384880</td>
      <td>0.109024</td>
      <td>0.134248</td>
      <td>0.112836</td>
      <td>-0.380715</td>
      <td>-0.054074</td>
      <td>0.099040</td>
      <td>0.166926</td>
      <td>0.170184</td>
      <td>-0.065344</td>
      <td>-0.195062</td>
      <td>0.094596</td>
      <td>0.195404</td>
      <td>-0.333632</td>
      <td>-0.026209</td>
      <td>0.177576</td>
      <td>0.173995</td>
    </tr>
    <tr>
      <th>BRFB - COLOUR BROWN FILAMENT b value (BRFb)</th>
      <td>0.413876</td>
      <td>0.047748</td>
      <td>0.332752</td>
      <td>0.342115</td>
      <td>0.145794</td>
      <td>-0.028170</td>
      <td>0.246787</td>
      <td>0.234624</td>
      <td>0.216156</td>
      <td>0.311363</td>
      <td>0.148441</td>
      <td>-0.210193</td>
      <td>0.118275</td>
      <td>0.285286</td>
      <td>-0.027055</td>
      <td>-0.275750</td>
      <td>0.100830</td>
      <td>0.328240</td>
      <td>0.164345</td>
    </tr>
    <tr>
      <th>BRFL - COLOUR BROWN FILAMENT L value (BRFL)</th>
      <td>0.198864</td>
      <td>-0.178050</td>
      <td>0.483242</td>
      <td>0.205796</td>
      <td>0.017456</td>
      <td>-0.220432</td>
      <td>0.411110</td>
      <td>0.090885</td>
      <td>0.039031</td>
      <td>0.128326</td>
      <td>0.337130</td>
      <td>-0.326368</td>
      <td>0.075738</td>
      <td>0.145878</td>
      <td>0.195055</td>
      <td>-0.467536</td>
      <td>-0.075130</td>
      <td>0.188013</td>
      <td>-0.000575</td>
    </tr>
    <tr>
      <th>E20M AVG - SST ELONGATION 20X20 MD (E20M)</th>
      <td>0.106870</td>
      <td>-0.096775</td>
      <td>-0.249986</td>
      <td>-0.039633</td>
      <td>0.009518</td>
      <td>-0.049131</td>
      <td>-0.367065</td>
      <td>-0.074018</td>
      <td>-0.070058</td>
      <td>-0.071425</td>
      <td>-0.124456</td>
      <td>-0.016993</td>
      <td>-0.070312</td>
      <td>-0.036314</td>
      <td>-0.145788</td>
      <td>-0.075968</td>
      <td>-0.197153</td>
      <td>-0.069477</td>
      <td>-0.072872</td>
    </tr>
    <tr>
      <th>EF1M AVG - SST ELONGATION FOLDED 10 CM MD (EF1M)</th>
      <td>1.000000</td>
      <td>NaN</td>
      <td>1.000000</td>
      <td>-0.081738</td>
      <td>1.000000</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>-0.101606</td>
      <td>-0.178993</td>
      <td>0.313364</td>
      <td>-0.936781</td>
      <td>-1.000000</td>
      <td>-0.517401</td>
      <td>0.306235</td>
      <td>-0.950303</td>
      <td>-1.000000</td>
      <td>-0.324932</td>
      <td>-0.112334</td>
    </tr>
    <tr>
      <th>EF1X AVG - SST ELONGATION FOLDED 10 CM XD (EF1X)</th>
      <td>1.000000</td>
      <td>NaN</td>
      <td>1.000000</td>
      <td>0.126777</td>
      <td>1.000000</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.010039</td>
      <td>-0.063399</td>
      <td>0.896084</td>
      <td>-0.961383</td>
      <td>-1.000000</td>
      <td>-0.609904</td>
      <td>0.892730</td>
      <td>-0.971830</td>
      <td>-1.000000</td>
      <td>-0.340772</td>
      <td>0.050483</td>
    </tr>
    <tr>
      <th>NATM AVG - Nail Tear MD EN 13859-1 (NATM)</th>
      <td>-0.517421</td>
      <td>-0.835147</td>
      <td>0.511409</td>
      <td>-0.258360</td>
      <td>-0.296500</td>
      <td>-0.906038</td>
      <td>NaN</td>
      <td>-0.333754</td>
      <td>-0.100244</td>
      <td>0.013436</td>
      <td>-0.338129</td>
      <td>0.580493</td>
      <td>0.826191</td>
      <td>-0.322585</td>
      <td>-0.348782</td>
      <td>0.063309</td>
      <td>0.929207</td>
      <td>-0.430201</td>
      <td>0.086484</td>
    </tr>
    <tr>
      <th>NATX AVG - Nail Tear XD EN 13859-1 (NATX)</th>
      <td>0.269389</td>
      <td>-0.864128</td>
      <td>0.542651</td>
      <td>0.071499</td>
      <td>-0.053990</td>
      <td>-0.927938</td>
      <td>NaN</td>
      <td>-0.056465</td>
      <td>-0.084131</td>
      <td>0.046366</td>
      <td>-0.190830</td>
      <td>0.541297</td>
      <td>0.777131</td>
      <td>-0.114506</td>
      <td>-0.096640</td>
      <td>0.051081</td>
      <td>0.902927</td>
      <td>-0.295087</td>
      <td>0.093804</td>
    </tr>
    <tr>
      <th>O90 - O90 EN ISO 12956 (O90E)</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.807962</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>-0.265093</td>
      <td>-0.268107</td>
      <td>-0.280791</td>
      <td>-0.378899</td>
      <td>NaN</td>
      <td>-0.451610</td>
      <td>-0.307148</td>
      <td>-0.267261</td>
      <td>NaN</td>
      <td>-0.269680</td>
      <td>-0.193539</td>
    </tr>
    <tr>
      <th>PU AVG - PUNCTURE "US Rod" (PU)</th>
      <td>0.173625</td>
      <td>-0.790779</td>
      <td>-0.165265</td>
      <td>0.451194</td>
      <td>-0.127912</td>
      <td>-0.952390</td>
      <td>-0.184515</td>
      <td>0.734933</td>
      <td>-0.040323</td>
      <td>-0.021124</td>
      <td>0.096383</td>
      <td>-0.998695</td>
      <td>-0.288786</td>
      <td>0.156274</td>
      <td>0.066142</td>
      <td>0.363427</td>
      <td>-0.297118</td>
      <td>0.479459</td>
      <td>-0.239496</td>
    </tr>
    <tr>
      <th>TKO4 AVG - Tack-Tear Ost 4Meter</th>
      <td>-0.170480</td>
      <td>-0.383667</td>
      <td>-0.326335</td>
      <td>0.006590</td>
      <td>-0.104058</td>
      <td>-0.308260</td>
      <td>-0.329544</td>
      <td>0.047734</td>
      <td>-0.171814</td>
      <td>-0.195662</td>
      <td>-0.214633</td>
      <td>-0.440748</td>
      <td>-0.182875</td>
      <td>-0.027353</td>
      <td>-0.077638</td>
      <td>-0.447423</td>
      <td>-0.187893</td>
      <td>0.114764</td>
      <td>-0.160340</td>
    </tr>
    <tr>
      <th>TKO5 AVG - Tack - Tear Ost 5 Meter</th>
      <td>1.000000</td>
      <td>0.134107</td>
      <td>0.560717</td>
      <td>-0.070116</td>
      <td>NaN</td>
      <td>0.106485</td>
      <td>0.152594</td>
      <td>-0.525375</td>
      <td>-0.373817</td>
      <td>-0.306252</td>
      <td>0.338272</td>
      <td>0.155577</td>
      <td>0.034557</td>
      <td>-0.453643</td>
      <td>0.286066</td>
      <td>0.056270</td>
      <td>-0.066270</td>
      <td>-0.400941</td>
      <td>-0.387297</td>
    </tr>
    <tr>
      <th>TKW4 AVG - Tack-Tear West 4Meter</th>
      <td>-0.334291</td>
      <td>-0.282220</td>
      <td>-0.265607</td>
      <td>-0.134467</td>
      <td>-0.320379</td>
      <td>-0.231417</td>
      <td>-0.300679</td>
      <td>-0.265049</td>
      <td>-0.274024</td>
      <td>-0.250617</td>
      <td>-0.277325</td>
      <td>-0.375559</td>
      <td>-0.168965</td>
      <td>-0.154119</td>
      <td>-0.236424</td>
      <td>-0.282687</td>
      <td>-0.168865</td>
      <td>-0.162801</td>
      <td>-0.316193</td>
    </tr>
    <tr>
      <th>TKW5 AVG - Tack - Tear West 5 Meter</th>
      <td>1.000000</td>
      <td>0.051583</td>
      <td>0.100609</td>
      <td>0.018368</td>
      <td>NaN</td>
      <td>0.014194</td>
      <td>-0.167032</td>
      <td>-0.366762</td>
      <td>-0.279911</td>
      <td>-0.190366</td>
      <td>0.069184</td>
      <td>0.108657</td>
      <td>0.224892</td>
      <td>-0.326866</td>
      <td>-0.003422</td>
      <td>0.043730</td>
      <td>0.039670</td>
      <td>-0.362928</td>
      <td>-0.270898</td>
    </tr>
  </tbody>
</table>
</div>

<div class="codehilite"><pre><span></span><code><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">cmap</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">diverging_palette</span><span class="p">(</span><span class="mi">230</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">as_cmap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">cor_filt</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>&lt;AxesSubplot:&gt;
</code></pre></div>

<p><img alt="png" src="../X5_Candy_Ribbons_files/X5_Candy_Ribbons_36_1.png" /></p>
<h4 id="filter-n-100">Filter N &gt; 100<a class="headerlink" href="#filter-n-100" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="n">cor_filt</span> <span class="o">=</span> <span class="n">cor_filt</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">df</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">100</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">cor_filt</span><span class="o">.</span><span class="n">index</span><span class="p">]]</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">cmap</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">diverging_palette</span><span class="p">(</span><span class="mi">230</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">as_cmap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">cor_filt</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">df</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">100</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">cor_filt</span><span class="o">.</span><span class="n">index</span><span class="p">]],</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>&lt;AxesSubplot:&gt;
</code></pre></div>

<p><img alt="png" src="../X5_Candy_Ribbons_files/X5_Candy_Ribbons_39_1.png" /></p>
<h4 id="operating-conditions">Operating Conditions<a class="headerlink" href="#operating-conditions" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">cmap</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">diverging_palette</span><span class="p">(</span><span class="mi">230</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">as_cmap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">cor_filt</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">cor_filt</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">operation</span><span class="p">)],</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Operations Correlations to Hangs and Outs&quot;</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>Text(0.5, 1.0, &#39;Operations Correlations to Hangs and Outs&#39;)
</code></pre></div>

<p><img alt="png" src="../X5_Candy_Ribbons_files/X5_Candy_Ribbons_41_1.png" /></p>
<h4 id="feeds">Feeds<a class="headerlink" href="#feeds" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">cmap</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">diverging_palette</span><span class="p">(</span><span class="mi">230</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">as_cmap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">cor_filt</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">cor_filt</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">operation</span><span class="p">)],</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Feeds Correlations to Hangs and Outs&quot;</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>Text(0.5, 1.0, &#39;Feeds Correlations to Hangs and Outs&#39;)
</code></pre></div>

<p><img alt="png" src="../X5_Candy_Ribbons_files/X5_Candy_Ribbons_43_1.png" /></p>
<div class="codehilite"><pre><span></span><code><span class="n">ind_vars</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cor_filt</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">~</span><span class="n">cor_filt</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">operation</span><span class="p">)])</span>
<span class="n">ind_vars</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>[&#39;MFR 4 White&#39;, &#39;PP TOTAL 7089&#39;, &#39;SILIKAT POLYPLUS AB 1001 PP&#39;]
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">ind_var</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ind_vars</span><span class="p">):</span>
    <span class="n">df</span><span class="p">[[</span><span class="n">ind_var</span><span class="p">]</span> <span class="o">+</span> <span class="n">seconds</span><span class="p">]</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="n">ind_var</span><span class="p">,</span>
                                    <span class="n">value_vars</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                    <span class="n">var_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">ind_var</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
</code></pre></div>

<p><img alt="png" src="../X5_Candy_Ribbons_files/X5_Candy_Ribbons_45_0.png" /></p>
<h2 id="40-understand-the-independent-variable">4.0 Understand the Independent Variable<a class="headerlink" href="#40-understand-the-independent-variable" title="Permanent link">&para;</a></h2>
<h3 id="descriptive-stats-on-ind-var">Descriptive Stats on Ind Var<a class="headerlink" href="#descriptive-stats-on-ind-var" title="Permanent link">&para;</a></h3>
<p>all the feeds sum to 1 (feeds are mass or volume fractions), so we probably won't need to worry about scaling</p>
<div class="codehilite"><pre><span></span><code><span class="n">df</span><span class="p">[</span><span class="n">feeds</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>0        1.0
1        1.0
2        1.0
3        1.0
4        1.0
        ... 
17892    1.0
17893    1.0
17894    1.0
17895    1.0
17896    1.0
Length: 17897, dtype: float64
</code></pre></div>

<p>many of the feeds are not used at all</p>
<div class="codehilite"><pre><span></span><code><span class="n">skew</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">feeds</span><span class="p">]</span><span class="o">.</span><span class="n">skew</span><span class="p">()</span>
<span class="n">kurt</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">feeds</span><span class="p">]</span><span class="o">.</span><span class="n">kurtosis</span><span class="p">()</span>
<span class="n">null</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">feeds</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">feeds</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">med</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">feeds</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
<span class="n">men</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">feeds</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="n">dff</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">skew</span><span class="p">,</span> <span class="n">kurt</span><span class="p">,</span> <span class="n">null</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">med</span><span class="p">,</span> <span class="n">men</span><span class="p">])</span>
<span class="n">dff</span> <span class="o">=</span> <span class="n">dff</span><span class="o">.</span><span class="n">T</span>
<span class="n">dff</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;skew&#39;</span><span class="p">,</span> <span class="s1">&#39;kurtosis&#39;</span><span class="p">,</span> <span class="s1">&#39;null cnt&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="s1">&#39;median&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">]</span>
<span class="n">dff</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">dff</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>skew</th>
      <th>kurtosis</th>
      <th>null cnt</th>
      <th>n</th>
      <th>median</th>
      <th>mean</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>ADD ARGUS ARGUSTAT AT 31 HK</th>
      <td>-1.122018</td>
      <td>-0.275303</td>
      <td>17798.0</td>
      <td>99.0</td>
      <td>0.006560</td>
      <td>0.005080</td>
    </tr>
    <tr>
      <th>ADD ARGUS ARGUTHERM AO 77 PP</th>
      <td>14.927951</td>
      <td>248.300227</td>
      <td>15627.0</td>
      <td>2270.0</td>
      <td>0.005249</td>
      <td>0.010705</td>
    </tr>
    <tr>
      <th>ADD POLYPLAST PPM AO 01 UV PP</th>
      <td>5.788514</td>
      <td>87.051660</td>
      <td>16769.0</td>
      <td>1128.0</td>
      <td>0.006397</td>
      <td>0.006218</td>
    </tr>
    <tr>
      <th>ADD SCHULMAN DTY 20 AOUV</th>
      <td>6.573319</td>
      <td>99.052816</td>
      <td>13484.0</td>
      <td>4413.0</td>
      <td>0.004997</td>
      <td>0.005411</td>
    </tr>
    <tr>
      <th>BEIGE SCHULMAN PZ 91738 1 5 ZA</th>
      <td>-0.455858</td>
      <td>10.108094</td>
      <td>16975.0</td>
      <td>922.0</td>
      <td>0.008922</td>
      <td>0.008708</td>
    </tr>
    <tr>
      <th>BLACK SCHULMAN P7381</th>
      <td>2.301415</td>
      <td>16.313957</td>
      <td>4471.0</td>
      <td>13426.0</td>
      <td>0.000317</td>
      <td>0.002040</td>
    </tr>
    <tr>
      <th>DEVAN 2SPIN PP 106</th>
      <td>0.770601</td>
      <td>11.066370</td>
      <td>13279.0</td>
      <td>4618.0</td>
      <td>0.006658</td>
      <td>0.005554</td>
    </tr>
    <tr>
      <th>GREEN POLYPLAST COLOUR MB PP 6821</th>
      <td>-1.856631</td>
      <td>3.540741</td>
      <td>16894.0</td>
      <td>1003.0</td>
      <td>0.007519</td>
      <td>0.006822</td>
    </tr>
    <tr>
      <th>GREEN SCHULMAN PZ 302446 1 5 T</th>
      <td>0.363239</td>
      <td>8.864015</td>
      <td>17150.0</td>
      <td>747.0</td>
      <td>0.018764</td>
      <td>0.018006</td>
    </tr>
    <tr>
      <th>High MFR Black</th>
      <td>0.473484</td>
      <td>-1.518082</td>
      <td>14862.0</td>
      <td>3035.0</td>
      <td>0.047883</td>
      <td>0.146677</td>
    </tr>
    <tr>
      <th>MFR 4 Black</th>
      <td>1.612264</td>
      <td>4.261601</td>
      <td>12595.0</td>
      <td>5302.0</td>
      <td>0.030099</td>
      <td>0.098792</td>
    </tr>
    <tr>
      <th>MFR 4 Black Brown</th>
      <td>-0.086521</td>
      <td>-0.342944</td>
      <td>16360.0</td>
      <td>1537.0</td>
      <td>0.189244</td>
      <td>0.150273</td>
    </tr>
    <tr>
      <th>High MFR Grey</th>
      <td>-0.364616</td>
      <td>-1.483643</td>
      <td>15900.0</td>
      <td>1997.0</td>
      <td>0.226358</td>
      <td>0.199138</td>
    </tr>
    <tr>
      <th>MFR 4 Green</th>
      <td>0.149918</td>
      <td>8.244109</td>
      <td>15985.0</td>
      <td>1912.0</td>
      <td>0.279622</td>
      <td>0.262574</td>
    </tr>
    <tr>
      <th>PP INEOS 100 GA02</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>17895.0</td>
      <td>2.0</td>
      <td>0.107927</td>
      <td>0.107927</td>
    </tr>
    <tr>
      <th>PP INEOS 100 GA04</th>
      <td>1.294449</td>
      <td>5.764334</td>
      <td>6684.0</td>
      <td>11213.0</td>
      <td>0.208757</td>
      <td>0.216941</td>
    </tr>
    <tr>
      <th>PP INEOS 100 GA09</th>
      <td>-0.449540</td>
      <td>-0.968103</td>
      <td>16802.0</td>
      <td>1095.0</td>
      <td>0.224353</td>
      <td>0.219208</td>
    </tr>
    <tr>
      <th>PP POLYCHIM HB12XF</th>
      <td>-0.222658</td>
      <td>-0.684893</td>
      <td>16525.0</td>
      <td>1372.0</td>
      <td>0.275755</td>
      <td>0.291827</td>
    </tr>
    <tr>
      <th>MFR 4 White</th>
      <td>1.136619</td>
      <td>2.053071</td>
      <td>17559.0</td>
      <td>338.0</td>
      <td>0.098961</td>
      <td>0.111129</td>
    </tr>
    <tr>
      <th>PP TOTAL 7089</th>
      <td>-0.216726</td>
      <td>-1.333059</td>
      <td>16346.0</td>
      <td>1551.0</td>
      <td>0.276430</td>
      <td>0.288643</td>
    </tr>
    <tr>
      <th>PP TOTAL PPH 4065</th>
      <td>0.353911</td>
      <td>0.740658</td>
      <td>611.0</td>
      <td>17286.0</td>
      <td>0.441009</td>
      <td>0.424684</td>
    </tr>
    <tr>
      <th>PP UNIPETROL GB005</th>
      <td>0.117291</td>
      <td>1.045121</td>
      <td>11444.0</td>
      <td>6453.0</td>
      <td>0.324773</td>
      <td>0.295906</td>
    </tr>
    <tr>
      <th>SILIKAT PBH ABPP 05</th>
      <td>2.690146</td>
      <td>26.471577</td>
      <td>15967.0</td>
      <td>1930.0</td>
      <td>0.005001</td>
      <td>0.005229</td>
    </tr>
    <tr>
      <th>SILIKAT POLYPLUS AB 1001 PP</th>
      <td>6.874010</td>
      <td>77.288671</td>
      <td>17360.0</td>
      <td>537.0</td>
      <td>0.002506</td>
      <td>0.002642</td>
    </tr>
    <tr>
      <th>UV ARGUS ARX 904 11 PP</th>
      <td>1.405525</td>
      <td>3.135048</td>
      <td>17166.0</td>
      <td>731.0</td>
      <td>0.019242</td>
      <td>0.025060</td>
    </tr>
    <tr>
      <th>UV ARGUS ARX 904 11 PP.1</th>
      <td>1.405525</td>
      <td>3.135048</td>
      <td>17166.0</td>
      <td>731.0</td>
      <td>0.019242</td>
      <td>0.025060</td>
    </tr>
    <tr>
      <th>UV ARGUS ARX 904 11 PP.2</th>
      <td>1.405525</td>
      <td>3.135048</td>
      <td>17166.0</td>
      <td>731.0</td>
      <td>0.019242</td>
      <td>0.025060</td>
    </tr>
    <tr>
      <th>UV POLYPLAST 6005 PP</th>
      <td>1.426790</td>
      <td>1.634549</td>
      <td>17506.0</td>
      <td>391.0</td>
      <td>0.020009</td>
      <td>0.026245</td>
    </tr>
    <tr>
      <th>UV SCHULMAN FPPUV 38</th>
      <td>2.114261</td>
      <td>14.372541</td>
      <td>17141.0</td>
      <td>756.0</td>
      <td>0.029986</td>
      <td>0.032261</td>
    </tr>
    <tr>
      <th>MFR 4 Grey</th>
      <td>1.718802</td>
      <td>10.970192</td>
      <td>8567.0</td>
      <td>9330.0</td>
      <td>0.269445</td>
      <td>0.263401</td>
    </tr>
    <tr>
      <th>MFR 4 Grey Grey</th>
      <td>3.607370</td>
      <td>20.342313</td>
      <td>15865.0</td>
      <td>2032.0</td>
      <td>0.040035</td>
      <td>0.068547</td>
    </tr>
    <tr>
      <th>UV ARGUS ARX V 16 706 UV PP</th>
      <td>1.889895</td>
      <td>6.474782</td>
      <td>7972.0</td>
      <td>9925.0</td>
      <td>0.002110</td>
      <td>0.007994</td>
    </tr>
  </tbody>
</table>
</div>

<p>our <code>ind_vars</code> feeds have some strong correlations with other feeds</p>
<p>In particular, <code>PP TOTAL 7089</code> and <code>SILIKAT POLYPLUS AB 1001 PP</code> have a correlation w/ eachother of .923</p>
<div class="codehilite"><pre><span></span><code><span class="n">ind_corr</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">feeds</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">()[</span><span class="n">ind_vars</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
<span class="n">ind_corr</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="nb">abs</span><span class="p">(</span><span class="n">ind_corr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="mi">1</span><span class="p">)]</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>MFR 4 White</th>
      <th>PP TOTAL 7089</th>
      <th>SILIKAT POLYPLUS AB 1001 PP</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>ADD SCHULMAN DTY 20 AOUV</th>
      <td>-0.741967</td>
      <td>-0.057221</td>
      <td>-0.875009</td>
    </tr>
    <tr>
      <th>High MFR Black</th>
      <td>NaN</td>
      <td>-0.351428</td>
      <td>0.538436</td>
    </tr>
    <tr>
      <th>MFR 4 Black</th>
      <td>-0.442742</td>
      <td>0.876072</td>
      <td>-0.602269</td>
    </tr>
    <tr>
      <th>PP INEOS 100 GA09</th>
      <td>NaN</td>
      <td>-0.654004</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>PP POLYCHIM HB12XF</th>
      <td>NaN</td>
      <td>-0.697618</td>
      <td>0.322222</td>
    </tr>
    <tr>
      <th>MFR 4 White</th>
      <td>1.000000</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>PP TOTAL 7089</th>
      <td>NaN</td>
      <td>1.000000</td>
      <td>0.923427</td>
    </tr>
    <tr>
      <th>PP UNIPETROL GB005</th>
      <td>-0.634001</td>
      <td>-0.713590</td>
      <td>0.148101</td>
    </tr>
    <tr>
      <th>SILIKAT POLYPLUS AB 1001 PP</th>
      <td>NaN</td>
      <td>0.923427</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
</div>

<p><code>ind_vars</code> feeds exhibit bimodal distributions (2+ recipes)</p>
<div class="codehilite"><pre><span></span><code><span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">ind_vars</span><span class="p">:</span>
    <span class="n">df</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">kde</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

<p><img alt="png" src="../X5_Candy_Ribbons_files/X5_Candy_Ribbons_54_0.png" /></p>
<p><img alt="png" src="../X5_Candy_Ribbons_files/X5_Candy_Ribbons_54_1.png" /></p>
<p><img alt="png" src="../X5_Candy_Ribbons_files/X5_Candy_Ribbons_54_2.png" /></p>
<h2 id="50-hypothesis-tests">5.0 Hypothesis Tests<a class="headerlink" href="#50-hypothesis-tests" title="Permanent link">&para;</a></h2>
<h3 id="non-parametric">Non-Parametric<a class="headerlink" href="#non-parametric" title="Permanent link">&para;</a></h3>
<h4 id="univariate-categorical-to-categorical-chi-square">Univariate Categorical to Categorical (Chi-Square)<a class="headerlink" href="#univariate-categorical-to-categorical-chi-square" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="n">ind_vars</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>[&#39;MFR 4 White&#39;, &#39;PP TOTAL 7089&#39;, &#39;SILIKAT POLYPLUS AB 1001 PP&#39;]
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">chidf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">target</span> <span class="o">=</span> <span class="s1">&#39;Total Position Out&#39;</span>
<span class="n">chidf</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">ind_vars</span><span class="p">:</span>
    <span class="n">chidf</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">())</span>
    <span class="n">display</span><span class="p">(</span><span class="n">chidf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">ind</span><span class="p">)[</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>

    <span class="c1"># in cTable, populations are rows (Tot Pos Out)</span>
    <span class="c1"># groups are columns (w/ the feed w/o the feed)</span>
    <span class="n">cTable</span> <span class="o">=</span> <span class="p">(</span><span class="n">chidf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">ind</span><span class="p">)[</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">cTable</span><span class="p">)</span>
    <span class="n">chi2</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">dof</span><span class="p">,</span> <span class="n">ex</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">chi2_contingency</span><span class="p">(</span><span class="n">cTable</span><span class="p">,</span> <span class="n">correction</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">lambda_</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;chi2 stat: </span><span class="si">{</span><span class="n">chi2</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> </span><span class="se">\t</span><span class="s2">p-value: </span><span class="si">{</span><span class="n">p</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>MFR 4 White  Total Position Out
False        True                  10182
             False                  7377
True         True                    173
             False                   165
Name: Total Position Out, dtype: int64


[[10182   173]
 [ 7377   165]]
chi2 stat: 6.02     p-value: 1.41e-02




PP TOTAL 7089  Total Position Out
False          True                  9171
               False                 7175
True           True                  1184
               False                  367
Name: Total Position Out, dtype: int64


[[9171 1184]
 [7175  367]]
chi2 stat: 237.00   p-value: 1.78e-53




SILIKAT POLYPLUS AB 1001 PP  Total Position Out
False                        True                  9996
                             False                 7364
True                         True                   359
                             False                  178
Name: Total Position Out, dtype: int64


[[9996  359]
 [7364  178]]
chi2 stat: 17.99    p-value: 2.22e-05
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">chidf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">target</span> <span class="o">=</span> <span class="s1">&#39;Total Position Out&#39;</span>
<span class="n">chidf</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span>
<span class="n">chisum</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">cutoff</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">feeds</span><span class="p">:</span>
    <span class="n">chidf</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">())</span>   
    <span class="k">try</span><span class="p">:</span>
        <span class="n">cTable</span> <span class="o">=</span> <span class="p">(</span><span class="n">chidf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">ind</span><span class="p">)[</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">chi2</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">dof</span><span class="p">,</span> <span class="n">ex</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">chi2_contingency</span><span class="p">(</span><span class="n">cTable</span><span class="p">,</span> <span class="n">correction</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">lambda_</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">ratio</span> <span class="o">=</span> <span class="n">cTable</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">cTable</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">ratio</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">ratio</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span>
        <span class="n">chisum</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">chisum</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="n">ind</span><span class="p">,</span> <span class="n">chi2</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">cTable</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">p</span><span class="o">&lt;</span><span class="n">cutoff</span><span class="p">]])])</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="c1"># print(f&quot;\t\t{ind} returned error; n: {chidf[ind].sum()}&quot;)</span>
        <span class="k">pass</span>

<span class="n">chisum</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;feed&#39;</span><span class="p">,</span> <span class="s1">&#39;chi&#39;</span><span class="p">,</span> <span class="s1">&#39;p-value&#39;</span><span class="p">,</span> <span class="s1">&#39;cTable&#39;</span><span class="p">,</span> <span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="s1">&#39;reject null&#39;</span><span class="p">]</span>
<span class="n">chisum</span> <span class="o">=</span> <span class="n">chisum</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;p-value&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">chisum</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">chisum</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">chisum</span><span class="p">[</span><span class="s1">&#39;feed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">master_batch</span><span class="p">),</span> <span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;master_batch&#39;</span>
<span class="n">chisum</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">chisum</span><span class="p">[</span><span class="s1">&#39;feed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">recycle</span><span class="p">),</span> <span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;recyle&#39;</span>
<span class="n">chisum</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">chisum</span><span class="p">[</span><span class="s1">&#39;feed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">virgin_polymer</span><span class="p">),</span> <span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;virgin_polymer&#39;</span>
<span class="n">chisum</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">chisum</span><span class="p">[</span><span class="s1">&#39;feed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">silicates</span><span class="p">),</span> <span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;silicates&#39;</span>
<span class="n">chisum</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">chisum</span><span class="p">[</span><span class="s1">&#39;feed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">uvs</span><span class="p">),</span> <span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;uvs&#39;</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">chisum</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">chisum</span><span class="p">[</span><span class="s1">&#39;reject null&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">]</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>feed</th>
      <th>chi</th>
      <th>p-value</th>
      <th>cTable</th>
      <th>+</th>
      <th>reject null</th>
      <th>type</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>PP TOTAL 7089</td>
      <td>236.997695</td>
      <td>1.775656e-53</td>
      <td>[[9171, 1184], [7175, 367]]</td>
      <td>False</td>
      <td>True</td>
      <td>virgin_polymer</td>
    </tr>
    <tr>
      <th>1</th>
      <td>PP POLYCHIM HB12XF</td>
      <td>160.530330</td>
      <td>8.665205e-37</td>
      <td>[[9338, 1017], [7187, 355]]</td>
      <td>False</td>
      <td>True</td>
      <td>virgin_polymer</td>
    </tr>
    <tr>
      <th>2</th>
      <td>High MFR Grey</td>
      <td>136.568590</td>
      <td>1.498471e-31</td>
      <td>[[8956, 1399], [6944, 598]]</td>
      <td>False</td>
      <td>True</td>
      <td>recyle</td>
    </tr>
    <tr>
      <th>3</th>
      <td>SILIKAT PBH ABPP 05</td>
      <td>125.809746</td>
      <td>3.384213e-29</td>
      <td>[[9008, 1347], [6959, 583]]</td>
      <td>False</td>
      <td>True</td>
      <td>silicates</td>
    </tr>
    <tr>
      <th>4</th>
      <td>BLACK SCHULMAN P7381</td>
      <td>105.280707</td>
      <td>1.060033e-24</td>
      <td>[[2353, 8237], [2118, 5189]]</td>
      <td>False</td>
      <td>True</td>
      <td>master_batch</td>
    </tr>
    <tr>
      <th>5</th>
      <td>PP INEOS 100 GA09</td>
      <td>53.633573</td>
      <td>2.415953e-13</td>
      <td>[[9605, 750], [7197, 345]]</td>
      <td>False</td>
      <td>True</td>
      <td>virgin_polymer</td>
    </tr>
    <tr>
      <th>6</th>
      <td>ADD ARGUS ARGUTHERM AO 77 PP</td>
      <td>49.779216</td>
      <td>1.720570e-12</td>
      <td>[[8886, 1469], [6741, 801]]</td>
      <td>False</td>
      <td>True</td>
      <td>master_batch</td>
    </tr>
    <tr>
      <th>7</th>
      <td>DEVAN 2SPIN PP 106</td>
      <td>35.237690</td>
      <td>2.918209e-09</td>
      <td>[[7511, 2844], [5768, 1774]]</td>
      <td>False</td>
      <td>True</td>
      <td>master_batch</td>
    </tr>
    <tr>
      <th>8</th>
      <td>High MFR Black</td>
      <td>34.917755</td>
      <td>3.439303e-09</td>
      <td>[[8452, 1903], [6410, 1132]]</td>
      <td>False</td>
      <td>True</td>
      <td>recyle</td>
    </tr>
    <tr>
      <th>9</th>
      <td>GREEN POLYPLAST COLOUR MB PP 6821</td>
      <td>29.252089</td>
      <td>6.354766e-08</td>
      <td>[[9692, 663], [7202, 340]]</td>
      <td>False</td>
      <td>True</td>
      <td>master_batch</td>
    </tr>
    <tr>
      <th>10</th>
      <td>MFR 4 Black Brown</td>
      <td>20.494540</td>
      <td>5.980160e-06</td>
      <td>[[9550, 805], [6810, 732]]</td>
      <td>True</td>
      <td>True</td>
      <td>recyle</td>
    </tr>
    <tr>
      <th>11</th>
      <td>UV ARGUS ARX V 16 706 UV PP</td>
      <td>20.048858</td>
      <td>7.548859e-06</td>
      <td>[[4465, 5890], [3507, 4035]]</td>
      <td>False</td>
      <td>True</td>
      <td>uvs</td>
    </tr>
    <tr>
      <th>12</th>
      <td>ADD POLYPLAST PPM AO 01 UV PP</td>
      <td>19.643205</td>
      <td>9.333462e-06</td>
      <td>[[9774, 581], [6995, 547]]</td>
      <td>True</td>
      <td>True</td>
      <td>uvs</td>
    </tr>
    <tr>
      <th>13</th>
      <td>SILIKAT POLYPLUS AB 1001 PP</td>
      <td>17.988635</td>
      <td>2.222278e-05</td>
      <td>[[9996, 359], [7364, 178]]</td>
      <td>False</td>
      <td>True</td>
      <td>silicates</td>
    </tr>
    <tr>
      <th>14</th>
      <td>GREEN SCHULMAN PZ 302446 1 5 T</td>
      <td>14.155700</td>
      <td>1.682865e-04</td>
      <td>[[9973, 382], [7177, 365]]</td>
      <td>True</td>
      <td>True</td>
      <td>master_batch</td>
    </tr>
    <tr>
      <th>15</th>
      <td>MFR 4 Grey Grey</td>
      <td>9.004184</td>
      <td>2.693622e-03</td>
      <td>[[9464, 1141], [6401, 891]]</td>
      <td>True</td>
      <td>True</td>
      <td>recyle</td>
    </tr>
  </tbody>
</table>
</div>

<h5 id="check-confounding-variables">Check confounding variables<a class="headerlink" href="#check-confounding-variables" title="Permanent link">&para;</a></h5>
<p><strong>Isolate Products (product conflation with feed)</strong></p>
<p>Let's isolate the comparison by <em>only</em> products made with the feed (<code>ind_var</code>) in question</p>
<p>We see that <code>MFR 4 White</code> and <code>SILIKAT POLYPLUS AB 1001 PP</code> are very imbalanced compared to <code>PP TOTAL 7089</code></p>
<div class="codehilite"><pre><span></span><code><span class="n">target</span> <span class="o">=</span> <span class="s1">&#39;Total Position Out&#39;</span>

<span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">ind_vars</span><span class="p">:</span>
    <span class="n">chidf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="c1"># isolate products made with `ind`</span>
    <span class="n">dff</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Product&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">][</span><span class="s1">&#39;Product&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())]</span>
    <span class="n">chidf</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">=</span> <span class="n">dff</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="n">chidf</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">dff</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="n">display</span><span class="p">(</span><span class="n">chidf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">ind</span><span class="p">)[</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>

    <span class="c1"># in cTable, populations are rows (Tot Pos Out)</span>
    <span class="c1"># groups are columns (w/ the feed w/o the feed)</span>
    <span class="n">cTable</span> <span class="o">=</span> <span class="p">(</span><span class="n">chidf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">ind</span><span class="p">)[</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">cTable</span><span class="p">)</span>
    <span class="n">chi2</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">dof</span><span class="p">,</span> <span class="n">ex</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">chi2_contingency</span><span class="p">(</span><span class="n">cTable</span><span class="p">,</span> <span class="n">correction</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">lambda_</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;chi2 stat: </span><span class="si">{</span><span class="n">chi2</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> </span><span class="se">\t</span><span class="s2">p-value: </span><span class="si">{</span><span class="n">p</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>MFR 4 White  Total Position Out
False        True                  3978
             False                 2933
True         True                   173
             False                  165
Name: Total Position Out, dtype: int64


[[3978  173]
 [2933  165]]
chi2 stat: 5.10     p-value: 2.40e-02




PP TOTAL 7089  Total Position Out
False          True                  2301
               False                 1393
True           True                  1184
               False                  367
Name: Total Position Out, dtype: int64


[[2301 1184]
 [1393  367]]
chi2 stat: 96.05    p-value: 1.12e-22




SILIKAT POLYPLUS AB 1001 PP  Total Position Out
False                        True                  2418
                             False                 1602
True                         True                   359
                             False                  178
Name: Total Position Out, dtype: int64


[[2418  359]
 [1602  178]]
chi2 stat: 8.66     p-value: 3.25e-03
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">target</span> <span class="o">=</span> <span class="s1">&#39;Total Position Out&#39;</span>
<span class="n">chisum2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">cutoff</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">feeds</span><span class="p">:</span>

    <span class="n">chidf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>    
    <span class="c1"># isolate products made with `ind`</span>
    <span class="n">dff</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Product&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">][</span><span class="s1">&#39;Product&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())]</span>
    <span class="n">chidf</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">=</span> <span class="n">dff</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="n">chidf</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">dff</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">cTable</span> <span class="o">=</span> <span class="p">(</span><span class="n">chidf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">ind</span><span class="p">)[</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">chi2</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">dof</span><span class="p">,</span> <span class="n">ex</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">chi2_contingency</span><span class="p">(</span><span class="n">cTable</span><span class="p">,</span> <span class="n">correction</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">lambda_</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">ratio</span> <span class="o">=</span> <span class="n">cTable</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">cTable</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">ratio</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">ratio</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span>
        <span class="n">chisum2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">chisum2</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="n">ind</span><span class="p">,</span> <span class="n">chi2</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">cTable</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">p</span><span class="o">&lt;</span><span class="n">cutoff</span><span class="p">]])])</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="c1"># print(f&quot;\t\t{ind} returned error; n: {chidf[ind].sum()}&quot;)</span>
        <span class="k">pass</span>

<span class="n">chisum2</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;feed&#39;</span><span class="p">,</span> <span class="s1">&#39;chi&#39;</span><span class="p">,</span> <span class="s1">&#39;p-value&#39;</span><span class="p">,</span> <span class="s1">&#39;cTable&#39;</span><span class="p">,</span> <span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="s1">&#39;reject null&#39;</span><span class="p">]</span>
<span class="n">chisum2</span> <span class="o">=</span> <span class="n">chisum2</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;p-value&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">tests</span> <span class="o">=</span> <span class="n">chisum</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;feed&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">chisum2</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;feed&#39;</span><span class="p">)[[</span><span class="s1">&#39;p-value&#39;</span><span class="p">,</span> <span class="s1">&#39;reject null&#39;</span><span class="p">]],</span> <span class="n">rsuffix</span><span class="o">=</span><span class="s1">&#39;, confound&#39;</span><span class="p">)</span>
<span class="n">tests</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">tests</span><span class="p">[</span><span class="s1">&#39;reject null&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">tests</span><span class="p">[</span><span class="s1">&#39;reject null, confound&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)]</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>chi</th>
      <th>p-value</th>
      <th>cTable</th>
      <th>+</th>
      <th>reject null</th>
      <th>type</th>
      <th>p-value, confound</th>
      <th>reject null, confound</th>
    </tr>
    <tr>
      <th>feed</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>PP TOTAL 7089</th>
      <td>236.997695</td>
      <td>1.775656e-53</td>
      <td>[[9171, 1184], [7175, 367]]</td>
      <td>False</td>
      <td>True</td>
      <td>virgin_polymer</td>
      <td>1.118476e-22</td>
      <td>True</td>
    </tr>
    <tr>
      <th>PP POLYCHIM HB12XF</th>
      <td>160.530330</td>
      <td>8.665205e-37</td>
      <td>[[9338, 1017], [7187, 355]]</td>
      <td>False</td>
      <td>True</td>
      <td>virgin_polymer</td>
      <td>2.117300e-10</td>
      <td>True</td>
    </tr>
    <tr>
      <th>High MFR Grey</th>
      <td>136.568590</td>
      <td>1.498471e-31</td>
      <td>[[8956, 1399], [6944, 598]]</td>
      <td>False</td>
      <td>True</td>
      <td>recyle</td>
      <td>3.703831e-20</td>
      <td>True</td>
    </tr>
    <tr>
      <th>SILIKAT PBH ABPP 05</th>
      <td>125.809746</td>
      <td>3.384213e-29</td>
      <td>[[9008, 1347], [6959, 583]]</td>
      <td>False</td>
      <td>True</td>
      <td>silicates</td>
      <td>1.053579e-05</td>
      <td>True</td>
    </tr>
    <tr>
      <th>BLACK SCHULMAN P7381</th>
      <td>105.280707</td>
      <td>1.060033e-24</td>
      <td>[[2353, 8237], [2118, 5189]]</td>
      <td>False</td>
      <td>True</td>
      <td>master_batch</td>
      <td>1.224043e-26</td>
      <td>True</td>
    </tr>
    <tr>
      <th>PP INEOS 100 GA09</th>
      <td>53.633573</td>
      <td>2.415953e-13</td>
      <td>[[9605, 750], [7197, 345]]</td>
      <td>False</td>
      <td>True</td>
      <td>virgin_polymer</td>
      <td>1.089179e-03</td>
      <td>True</td>
    </tr>
    <tr>
      <th>ADD ARGUS ARGUTHERM AO 77 PP</th>
      <td>49.779216</td>
      <td>1.720570e-12</td>
      <td>[[8886, 1469], [6741, 801]]</td>
      <td>False</td>
      <td>True</td>
      <td>master_batch</td>
      <td>3.540298e-10</td>
      <td>True</td>
    </tr>
    <tr>
      <th>High MFR Black</th>
      <td>34.917755</td>
      <td>3.439303e-09</td>
      <td>[[8452, 1903], [6410, 1132]]</td>
      <td>False</td>
      <td>True</td>
      <td>recyle</td>
      <td>6.799384e-03</td>
      <td>True</td>
    </tr>
    <tr>
      <th>GREEN POLYPLAST COLOUR MB PP 6821</th>
      <td>29.252089</td>
      <td>6.354766e-08</td>
      <td>[[9692, 663], [7202, 340]]</td>
      <td>False</td>
      <td>True</td>
      <td>master_batch</td>
      <td>1.482338e-11</td>
      <td>True</td>
    </tr>
    <tr>
      <th>ADD POLYPLAST PPM AO 01 UV PP</th>
      <td>19.643205</td>
      <td>9.333462e-06</td>
      <td>[[9774, 581], [6995, 547]]</td>
      <td>True</td>
      <td>True</td>
      <td>uvs</td>
      <td>1.905591e-05</td>
      <td>True</td>
    </tr>
    <tr>
      <th>SILIKAT POLYPLUS AB 1001 PP</th>
      <td>17.988635</td>
      <td>2.222278e-05</td>
      <td>[[9996, 359], [7364, 178]]</td>
      <td>False</td>
      <td>True</td>
      <td>silicates</td>
      <td>3.245550e-03</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
</div>

<p>we can compare this with our feed correlation table - there may be other explanatory variables 'hiding'</p>
<div class="codehilite"><pre><span></span><code><span class="n">ind_corr</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="nb">abs</span><span class="p">(</span><span class="n">ind_corr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.3</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="mi">1</span><span class="p">)]</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>MFR 4 White</th>
      <th>PP TOTAL 7089</th>
      <th>SILIKAT POLYPLUS AB 1001 PP</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>ADD SCHULMAN DTY 20 AOUV</th>
      <td>-0.741967</td>
      <td>-0.057221</td>
      <td>-0.875009</td>
    </tr>
    <tr>
      <th>BLACK SCHULMAN P7381</th>
      <td>0.196431</td>
      <td>-0.470838</td>
      <td>0.082699</td>
    </tr>
    <tr>
      <th>DEVAN 2SPIN PP 106</th>
      <td>NaN</td>
      <td>-0.415896</td>
      <td>0.097590</td>
    </tr>
    <tr>
      <th>High MFR Black</th>
      <td>NaN</td>
      <td>-0.351428</td>
      <td>0.538436</td>
    </tr>
    <tr>
      <th>MFR 4 Black</th>
      <td>-0.442742</td>
      <td>0.876072</td>
      <td>-0.602269</td>
    </tr>
    <tr>
      <th>PP INEOS 100 GA04</th>
      <td>0.342077</td>
      <td>-0.248904</td>
      <td>0.402788</td>
    </tr>
    <tr>
      <th>PP INEOS 100 GA09</th>
      <td>NaN</td>
      <td>-0.654004</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>PP POLYCHIM HB12XF</th>
      <td>NaN</td>
      <td>-0.697618</td>
      <td>0.322222</td>
    </tr>
    <tr>
      <th>MFR 4 White</th>
      <td>1.000000</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>PP TOTAL 7089</th>
      <td>NaN</td>
      <td>1.000000</td>
      <td>0.923427</td>
    </tr>
    <tr>
      <th>PP TOTAL PPH 4065</th>
      <td>-0.419569</td>
      <td>-0.160492</td>
      <td>0.089303</td>
    </tr>
    <tr>
      <th>PP UNIPETROL GB005</th>
      <td>-0.634001</td>
      <td>-0.713590</td>
      <td>0.148101</td>
    </tr>
    <tr>
      <th>SILIKAT POLYPLUS AB 1001 PP</th>
      <td>NaN</td>
      <td>0.923427</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>UV ARGUS ARX 904 11 PP</th>
      <td>NaN</td>
      <td>-0.461986</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>UV ARGUS ARX 904 11 PP.1</th>
      <td>NaN</td>
      <td>-0.461986</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>UV ARGUS ARX 904 11 PP.2</th>
      <td>NaN</td>
      <td>-0.461986</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>MFR 4 Grey</th>
      <td>-0.303323</td>
      <td>-0.381548</td>
      <td>0.038125</td>
    </tr>
    <tr>
      <th>MFR 4 Grey Grey</th>
      <td>0.395658</td>
      <td>-0.102141</td>
      <td>-0.086338</td>
    </tr>
    <tr>
      <th>UV ARGUS ARX V 16 706 UV PP</th>
      <td>0.246254</td>
      <td>-0.439913</td>
      <td>-0.084811</td>
    </tr>
  </tbody>
</table>
</div>

<h4 id="univariate-categorical-to-quantitative-moods-median">Univariate Categorical to Quantitative (Moods Median)<a class="headerlink" href="#univariate-categorical-to-quantitative-moods-median" title="Permanent link">&para;</a></h4>
<p>A limitation of the previous analysis is that our threshold for counting an upset in the line was pretty low - any delay (position out &gt; 0 seconds). A way we can naturally increase this threshold is to compare medians (of position out (secs)) across our groups.</p>
<div class="codehilite"><pre><span></span><code><span class="n">chidf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">target</span> <span class="o">=</span> <span class="s1">&#39;Seconds&#39;</span>
<span class="n">chidf</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">seconds</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">moods</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">cutoff</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="n">pop</span> <span class="o">=</span> <span class="n">chidf</span><span class="p">[</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

<span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">feeds</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">chidf</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">())</span>
        <span class="n">grp</span> <span class="o">=</span> <span class="n">chidf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">chidf</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">][</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">chi2</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">cTable</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">median_test</span><span class="p">(</span><span class="n">grp</span><span class="p">,</span> <span class="n">pop</span><span class="p">,</span> <span class="n">correction</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ratio</span> <span class="o">=</span> <span class="n">cTable</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">cTable</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">ratio</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">ratio</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">1</span>
        <span class="n">moods</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">moods</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="n">ind</span><span class="p">,</span> <span class="n">chi2</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">cTable</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">p</span><span class="o">&lt;</span><span class="n">cutoff</span><span class="p">]])])</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="c1"># print(f&quot;\t\t{ind} returned error; n: {chidf[ind].sum()}&quot;)</span>
        <span class="k">pass</span>

<span class="n">moods</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;feed&#39;</span><span class="p">,</span> <span class="s1">&#39;chi&#39;</span><span class="p">,</span> <span class="s1">&#39;p-value&#39;</span><span class="p">,</span> <span class="s1">&#39;cTable&#39;</span><span class="p">,</span> <span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="s1">&#39;reject null&#39;</span><span class="p">]</span>
<span class="n">moods</span> <span class="o">=</span> <span class="n">moods</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;p-value&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">moods</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">moods</span><span class="p">[</span><span class="s1">&#39;reject null&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">]</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>feed</th>
      <th>chi</th>
      <th>p-value</th>
      <th>cTable</th>
      <th>+</th>
      <th>reject null</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>PP TOTAL 7089</td>
      <td>284.071422</td>
      <td>9.736103e-64</td>
      <td>[[1093, 8620], [458, 9277]]</td>
      <td>False</td>
      <td>True</td>
    </tr>
    <tr>
      <th>1</th>
      <td>MFR 4 Grey Grey</td>
      <td>161.505327</td>
      <td>5.305934e-37</td>
      <td>[[744, 9215], [1288, 8682]]</td>
      <td>True</td>
      <td>True</td>
    </tr>
    <tr>
      <th>2</th>
      <td>PP POLYCHIM HB12XF</td>
      <td>140.079653</td>
      <td>2.557382e-32</td>
      <td>[[897, 8734], [475, 9163]]</td>
      <td>False</td>
      <td>True</td>
    </tr>
    <tr>
      <th>3</th>
      <td>High MFR Grey</td>
      <td>134.851343</td>
      <td>3.558380e-31</td>
      <td>[[1244, 8697], [753, 9200]]</td>
      <td>False</td>
      <td>True</td>
    </tr>
    <tr>
      <th>4</th>
      <td>SILIKAT PBH ABPP 05</td>
      <td>132.735135</td>
      <td>1.033157e-30</td>
      <td>[[1205, 8704], [725, 9193]]</td>
      <td>False</td>
      <td>True</td>
    </tr>
    <tr>
      <th>5</th>
      <td>SILIKAT POLYPLUS AB 1001 PP</td>
      <td>40.522176</td>
      <td>1.943972e-10</td>
      <td>[[341, 8870], [196, 9027]]</td>
      <td>False</td>
      <td>True</td>
    </tr>
    <tr>
      <th>6</th>
      <td>DEVAN 2SPIN PP 106</td>
      <td>39.379816</td>
      <td>3.488847e-10</td>
      <td>[[2499, 8758], [2119, 9139]]</td>
      <td>False</td>
      <td>True</td>
    </tr>
    <tr>
      <th>7</th>
      <td>BLACK SCHULMAN P7381</td>
      <td>33.697655</td>
      <td>6.437826e-09</td>
      <td>[[6961, 8686], [6465, 9211]]</td>
      <td>False</td>
      <td>True</td>
    </tr>
    <tr>
      <th>8</th>
      <td>GREEN POLYPLAST COLOUR MB PP 6821</td>
      <td>32.518968</td>
      <td>1.180348e-08</td>
      <td>[[589, 8854], [414, 9043]]</td>
      <td>False</td>
      <td>True</td>
    </tr>
    <tr>
      <th>9</th>
      <td>PP INEOS 100 GA09</td>
      <td>26.828649</td>
      <td>2.223170e-07</td>
      <td>[[630, 8854], [465, 9043]]</td>
      <td>False</td>
      <td>True</td>
    </tr>
    <tr>
      <th>10</th>
      <td>ADD ARGUS ARGUTHERM AO 77 PP</td>
      <td>26.802325</td>
      <td>2.253660e-07</td>
      <td>[[1250, 8823], [1020, 9074]]</td>
      <td>False</td>
      <td>True</td>
    </tr>
    <tr>
      <th>11</th>
      <td>UV ARGUS ARX V 16 706 UV PP</td>
      <td>23.787198</td>
      <td>1.075957e-06</td>
      <td>[[5152, 8744], [4773, 9153]]</td>
      <td>False</td>
      <td>True</td>
    </tr>
    <tr>
      <th>12</th>
      <td>High MFR Black</td>
      <td>18.389746</td>
      <td>1.800242e-05</td>
      <td>[[1626, 8835], [1409, 9062]]</td>
      <td>False</td>
      <td>True</td>
    </tr>
    <tr>
      <th>13</th>
      <td>ADD POLYPLAST PPM AO 01 UV PP</td>
      <td>15.536764</td>
      <td>8.091620e-05</td>
      <td>[[499, 9000], [629, 8897]]</td>
      <td>True</td>
      <td>True</td>
    </tr>
    <tr>
      <th>14</th>
      <td>UV SCHULMAN FPPUV 38</td>
      <td>12.417442</td>
      <td>4.253424e-04</td>
      <td>[[330, 8983], [426, 8914]]</td>
      <td>True</td>
      <td>True</td>
    </tr>
    <tr>
      <th>15</th>
      <td>MFR 4 White</td>
      <td>11.470090</td>
      <td>7.072526e-04</td>
      <td>[[138, 8971], [200, 8926]]</td>
      <td>True</td>
      <td>True</td>
    </tr>
    <tr>
      <th>16</th>
      <td>GREEN SCHULMAN PZ 302446 1 5 T</td>
      <td>9.924320</td>
      <td>1.631091e-03</td>
      <td>[[331, 8983], [416, 8914]]</td>
      <td>True</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
</div>

<p>we see that overall the moods test is <em>slightly</em> less pessimistic</p>
<div class="codehilite"><pre><span></span><code><span class="n">chisum</span><span class="p">[</span><span class="s1">&#39;reject null&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>True     16
False    16
Name: reject null, dtype: int64
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">moods</span><span class="p">[</span><span class="s1">&#39;reject null&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>True     17
False    15
Name: reject null, dtype: int64
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">testsf</span> <span class="o">=</span> <span class="n">tests</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">moods</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;feed&#39;</span><span class="p">)[[</span><span class="s1">&#39;p-value&#39;</span><span class="p">,</span> <span class="s1">&#39;reject null&#39;</span><span class="p">]],</span> <span class="n">lsuffix</span><span class="o">=</span><span class="s1">&#39;, chi&#39;</span><span class="p">,</span> <span class="n">rsuffix</span><span class="o">=</span><span class="s1">&#39;, moods&#39;</span><span class="p">)</span>
<span class="n">testsf</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">testsf</span><span class="p">[</span><span class="s1">&#39;reject null, chi&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">testsf</span><span class="p">[</span><span class="s1">&#39;reject null, moods&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">testsf</span><span class="p">[</span><span class="s1">&#39;reject null, confound&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)]</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>chi</th>
      <th>p-value, chi</th>
      <th>cTable</th>
      <th>+</th>
      <th>reject null, chi</th>
      <th>type</th>
      <th>p-value, confound</th>
      <th>reject null, confound</th>
      <th>p-value, moods</th>
      <th>reject null, moods</th>
    </tr>
    <tr>
      <th>feed</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>PP TOTAL 7089</th>
      <td>236.997695</td>
      <td>1.775656e-53</td>
      <td>[[9171, 1184], [7175, 367]]</td>
      <td>False</td>
      <td>True</td>
      <td>virgin_polymer</td>
      <td>1.118476e-22</td>
      <td>True</td>
      <td>9.736103e-64</td>
      <td>True</td>
    </tr>
    <tr>
      <th>PP POLYCHIM HB12XF</th>
      <td>160.530330</td>
      <td>8.665205e-37</td>
      <td>[[9338, 1017], [7187, 355]]</td>
      <td>False</td>
      <td>True</td>
      <td>virgin_polymer</td>
      <td>2.117300e-10</td>
      <td>True</td>
      <td>2.557382e-32</td>
      <td>True</td>
    </tr>
    <tr>
      <th>High MFR Grey</th>
      <td>136.568590</td>
      <td>1.498471e-31</td>
      <td>[[8956, 1399], [6944, 598]]</td>
      <td>False</td>
      <td>True</td>
      <td>recyle</td>
      <td>3.703831e-20</td>
      <td>True</td>
      <td>3.558380e-31</td>
      <td>True</td>
    </tr>
    <tr>
      <th>SILIKAT PBH ABPP 05</th>
      <td>125.809746</td>
      <td>3.384213e-29</td>
      <td>[[9008, 1347], [6959, 583]]</td>
      <td>False</td>
      <td>True</td>
      <td>silicates</td>
      <td>1.053579e-05</td>
      <td>True</td>
      <td>1.033157e-30</td>
      <td>True</td>
    </tr>
    <tr>
      <th>BLACK SCHULMAN P7381</th>
      <td>105.280707</td>
      <td>1.060033e-24</td>
      <td>[[2353, 8237], [2118, 5189]]</td>
      <td>False</td>
      <td>True</td>
      <td>master_batch</td>
      <td>1.224043e-26</td>
      <td>True</td>
      <td>6.437826e-09</td>
      <td>True</td>
    </tr>
    <tr>
      <th>PP INEOS 100 GA09</th>
      <td>53.633573</td>
      <td>2.415953e-13</td>
      <td>[[9605, 750], [7197, 345]]</td>
      <td>False</td>
      <td>True</td>
      <td>virgin_polymer</td>
      <td>1.089179e-03</td>
      <td>True</td>
      <td>2.223170e-07</td>
      <td>True</td>
    </tr>
    <tr>
      <th>ADD ARGUS ARGUTHERM AO 77 PP</th>
      <td>49.779216</td>
      <td>1.720570e-12</td>
      <td>[[8886, 1469], [6741, 801]]</td>
      <td>False</td>
      <td>True</td>
      <td>master_batch</td>
      <td>3.540298e-10</td>
      <td>True</td>
      <td>2.253660e-07</td>
      <td>True</td>
    </tr>
    <tr>
      <th>High MFR Black</th>
      <td>34.917755</td>
      <td>3.439303e-09</td>
      <td>[[8452, 1903], [6410, 1132]]</td>
      <td>False</td>
      <td>True</td>
      <td>recyle</td>
      <td>6.799384e-03</td>
      <td>True</td>
      <td>1.800242e-05</td>
      <td>True</td>
    </tr>
    <tr>
      <th>GREEN POLYPLAST COLOUR MB PP 6821</th>
      <td>29.252089</td>
      <td>6.354766e-08</td>
      <td>[[9692, 663], [7202, 340]]</td>
      <td>False</td>
      <td>True</td>
      <td>master_batch</td>
      <td>1.482338e-11</td>
      <td>True</td>
      <td>1.180348e-08</td>
      <td>True</td>
    </tr>
    <tr>
      <th>ADD POLYPLAST PPM AO 01 UV PP</th>
      <td>19.643205</td>
      <td>9.333462e-06</td>
      <td>[[9774, 581], [6995, 547]]</td>
      <td>True</td>
      <td>True</td>
      <td>uvs</td>
      <td>1.905591e-05</td>
      <td>True</td>
      <td>8.091620e-05</td>
      <td>True</td>
    </tr>
    <tr>
      <th>SILIKAT POLYPLUS AB 1001 PP</th>
      <td>17.988635</td>
      <td>2.222278e-05</td>
      <td>[[9996, 359], [7364, 178]]</td>
      <td>False</td>
      <td>True</td>
      <td>silicates</td>
      <td>3.245550e-03</td>
      <td>True</td>
      <td>1.943972e-10</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
</div>

<h5 id="non-parametric-conclusions">Non-Parametric Conclusions<a class="headerlink" href="#non-parametric-conclusions" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code><span class="n">problem_vars</span> <span class="o">=</span> <span class="n">testsf</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">testsf</span><span class="p">[</span><span class="s1">&#39;reject null, chi&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span> 
                        <span class="o">&amp;</span> <span class="p">(</span><span class="n">testsf</span><span class="p">[</span><span class="s1">&#39;reject null, moods&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span> 
                        <span class="o">&amp;</span> <span class="p">(</span><span class="n">testsf</span><span class="p">[</span><span class="s1">&#39;reject null, confound&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Compared with correlation</span><span class="se">\n</span><span class="s2">the dependency tests show that the top 5 problem variables are:</span><span class="se">\n</span><span class="si">{</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">problem_vars</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>Compared with correlation
the dependency tests show that the top 5 problem variables are:
[&#39;PP TOTAL 7089&#39;, &#39;PP POLYCHIM HB12XF&#39;, &#39;High MFR Grey&#39;, &#39;SILIKAT PBH ABPP 05&#39;, &#39;BLACK SCHULMAN P7381&#39;]
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">testsf</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">testsf</span><span class="p">[</span><span class="s1">&#39;reject null, chi&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">testsf</span><span class="p">[</span><span class="s1">&#39;reject null, moods&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">testsf</span><span class="p">[</span><span class="s1">&#39;reject null, confound&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>chi</th>
      <th>p-value, chi</th>
      <th>cTable</th>
      <th>+</th>
      <th>reject null, chi</th>
      <th>type</th>
      <th>p-value, confound</th>
      <th>reject null, confound</th>
      <th>p-value, moods</th>
      <th>reject null, moods</th>
    </tr>
    <tr>
      <th>feed</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>PP TOTAL 7089</th>
      <td>236.997695</td>
      <td>1.775656e-53</td>
      <td>[[9171, 1184], [7175, 367]]</td>
      <td>False</td>
      <td>True</td>
      <td>virgin_polymer</td>
      <td>1.118476e-22</td>
      <td>True</td>
      <td>9.736103e-64</td>
      <td>True</td>
    </tr>
    <tr>
      <th>PP POLYCHIM HB12XF</th>
      <td>160.530330</td>
      <td>8.665205e-37</td>
      <td>[[9338, 1017], [7187, 355]]</td>
      <td>False</td>
      <td>True</td>
      <td>virgin_polymer</td>
      <td>2.117300e-10</td>
      <td>True</td>
      <td>2.557382e-32</td>
      <td>True</td>
    </tr>
    <tr>
      <th>High MFR Grey</th>
      <td>136.568590</td>
      <td>1.498471e-31</td>
      <td>[[8956, 1399], [6944, 598]]</td>
      <td>False</td>
      <td>True</td>
      <td>recyle</td>
      <td>3.703831e-20</td>
      <td>True</td>
      <td>3.558380e-31</td>
      <td>True</td>
    </tr>
    <tr>
      <th>SILIKAT PBH ABPP 05</th>
      <td>125.809746</td>
      <td>3.384213e-29</td>
      <td>[[9008, 1347], [6959, 583]]</td>
      <td>False</td>
      <td>True</td>
      <td>silicates</td>
      <td>1.053579e-05</td>
      <td>True</td>
      <td>1.033157e-30</td>
      <td>True</td>
    </tr>
    <tr>
      <th>BLACK SCHULMAN P7381</th>
      <td>105.280707</td>
      <td>1.060033e-24</td>
      <td>[[2353, 8237], [2118, 5189]]</td>
      <td>False</td>
      <td>True</td>
      <td>master_batch</td>
      <td>1.224043e-26</td>
      <td>True</td>
      <td>6.437826e-09</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
</div>

<h3 id="parametric">Parametric<a class="headerlink" href="#parametric" title="Permanent link">&para;</a></h3>
<h4 id="univariate-quantitative-to-quantitative-linear-regression">Univariate Quantitative to Quantitative (Linear Regression)<a class="headerlink" href="#univariate-quantitative-to-quantitative-linear-regression" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">ind_vars</span><span class="p">:</span> 
    <span class="n">lindf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="n">lindf</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
    <span class="n">lindf</span><span class="p">[</span><span class="s1">&#39;seconds&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Total Seconds Out&#39;</span><span class="p">]</span>

    <span class="n">lindf</span> <span class="o">=</span> <span class="n">lindf</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">lindf</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">lindf</span><span class="p">[</span><span class="s1">&#39;seconds&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">()</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>


    <span class="c1">### FIT AND HYP TEST</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;True&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Predicted&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">y_pred</span><span class="p">),</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Residual&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="n">n</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;R2: </span><span class="si">{</span><span class="n">r2_score</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span><span class="si">:</span><span class="s1">.2e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">RSE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">r2_score</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;RSE: </span><span class="si">{</span><span class="n">RSE</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">m</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">coef_</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">intercept_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># b_hat</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;b: </span><span class="si">{</span><span class="n">b</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;m: </span><span class="si">{</span><span class="n">m</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;n: </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">x_bar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;x_bar: </span><span class="si">{</span><span class="n">x_bar</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


    <span class="n">SE_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">RSE</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">/</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">x_bar</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">x</span><span class="o">-</span><span class="n">x_bar</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SE_b: </span><span class="si">{</span><span class="n">SE_b</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">SE_m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">RSE</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">x</span><span class="o">-</span><span class="n">x_bar</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SE_m: </span><span class="si">{</span><span class="n">SE_m</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


    <span class="n">t</span> <span class="o">=</span> <span class="n">m</span><span class="o">/</span><span class="n">SE_m</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;test statistic: </span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;p-value: </span><span class="si">{</span><span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">df</span><span class="o">=</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<p><img alt="png" src="../X5_Candy_Ribbons_files/X5_Candy_Ribbons_82_0.png" /></p>
<p><img alt="png" src="../X5_Candy_Ribbons_files/X5_Candy_Ribbons_82_1.png" /></p>
<div class="codehilite"><pre><span></span><code>R2: 3.34e-02
RSE: 9.97e-03

b: -2.51e-03
m: 3.61e-01

n: 338
x_bar: 1.11e-01
SE_b: 1.51e-03
SE_m: 1.26e-02
test statistic: 28.56535956265302
p-value: 3.2661498371310494e-92
</code></pre></div>

<p><img alt="png" src="../X5_Candy_Ribbons_files/X5_Candy_Ribbons_82_3.png" /></p>
<p><img alt="png" src="../X5_Candy_Ribbons_files/X5_Candy_Ribbons_82_4.png" /></p>
<div class="codehilite"><pre><span></span><code>R2: 4.31e-02
RSE: 5.27e-03

b: -3.19e-03
m: 9.08e-02

n: 1551
x_bar: 2.89e-01
SE_b: 3.09e-04
SE_m: 9.66e-04
test statistic: 94.02166426512674
p-value: 0.0
</code></pre></div>

<p><img alt="png" src="../X5_Candy_Ribbons_files/X5_Candy_Ribbons_82_6.png" /></p>
<p><img alt="png" src="../X5_Candy_Ribbons_files/X5_Candy_Ribbons_82_7.png" /></p>
<div class="codehilite"><pre><span></span><code>R2: 1.89e-02
RSE: 5.94e-03

b: -1.36e-02
m: 1.57e+01

n: 537
x_bar: 2.64e-03
SE_b: 1.04e-03
SE_m: 3.81e-01
test statistic: 41.11483903422569
p-value: 4.981863349397906e-168
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">ind_vars</span><span class="p">:</span> 
    <span class="n">lindf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="n">lindf</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
    <span class="n">lindf</span><span class="p">[</span><span class="s1">&#39;seconds&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Total Seconds Out&#39;</span><span class="p">]</span>

    <span class="n">lindf</span> <span class="o">=</span> <span class="n">lindf</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">lindf</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">lindf</span><span class="p">[</span><span class="s1">&#39;seconds&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">()</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">X2</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">est</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">X2</span><span class="p">)</span>
    <span class="n">est2</span> <span class="o">=</span> <span class="n">est</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">est2</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>                            OLS Regression Results                            
==============================================================================
Dep. Variable:                      y   R-squared:                       0.033
Model:                            OLS   Adj. R-squared:                  0.030
Method:                 Least Squares   F-statistic:                     11.60
Date:                Sat, 02 Apr 2022   Prob (F-statistic):           0.000739
Time:                        10:02:50   Log-Likelihood:                 360.28
No. Observations:                 338   AIC:                            -716.6
Df Residuals:                     336   BIC:                            -708.9
Df Model:                           1                                         
Covariance Type:            nonrobust                                         
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
const         -0.0025      0.013     -0.199      0.843      -0.027       0.022
x1             0.3612      0.106      3.406      0.001       0.153       0.570
==============================================================================
Omnibus:                      457.321   Durbin-Watson:                   1.128
Prob(Omnibus):                  0.000   Jarque-Bera (JB):            55378.392
Skew:                           6.475   Prob(JB):                         0.00
Kurtosis:                      64.356   Cond. No.                         23.6
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
                            OLS Regression Results                            
==============================================================================
Dep. Variable:                      y   R-squared:                       0.043
Model:                            OLS   Adj. R-squared:                  0.042
Method:                 Least Squares   F-statistic:                     69.71
Date:                Sat, 02 Apr 2022   Prob (F-statistic):           1.50e-16
Time:                        10:02:50   Log-Likelihood:                 2180.0
No. Observations:                1551   AIC:                            -4356.
Df Residuals:                    1549   BIC:                            -4345.
Df Model:                           1                                         
Covariance Type:            nonrobust                                         
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
const         -0.0032      0.003     -0.917      0.359      -0.010       0.004
x1             0.0908      0.011      8.349      0.000       0.069       0.112
==============================================================================
Omnibus:                     2262.527   Durbin-Watson:                   1.176
Prob(Omnibus):                  0.000   Jarque-Bera (JB):           660230.502
Skew:                           8.562   Prob(JB):                         0.00
Kurtosis:                     102.615   Cond. No.                         7.82
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
                            OLS Regression Results                            
==============================================================================
Dep. Variable:                      y   R-squared:                       0.019
Model:                            OLS   Adj. R-squared:                  0.017
Method:                 Least Squares   F-statistic:                     10.29
Date:                Sat, 02 Apr 2022   Prob (F-statistic):            0.00142
Time:                        10:02:50   Log-Likelihood:                 622.03
No. Observations:                 537   AIC:                            -1240.
Df Residuals:                     535   BIC:                            -1231.
Df Model:                           1                                         
Covariance Type:            nonrobust                                         
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
const         -0.0136      0.013     -1.020      0.308      -0.040       0.013
x1            15.6795      4.888      3.208      0.001       6.078      25.281
==============================================================================
Omnibus:                      739.911   Durbin-Watson:                   1.268
Prob(Omnibus):                  0.000   Jarque-Bera (JB):           108127.158
Skew:                           7.213   Prob(JB):                         0.00
Kurtosis:                      71.003   Cond. No.                     1.49e+03
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
[2] The condition number is large, 1.49e+03. This might indicate that there are
strong multicollinearity or other numerical problems.
</code></pre></div>

<h5 id="feature-engineering">Feature Engineering<a class="headerlink" href="#feature-engineering" title="Permanent link">&para;</a></h5>
<p>Introducing polynomial features results in poor coefficient estimates</p>
<div class="codehilite"><pre><span></span><code><span class="n">ind</span> <span class="o">=</span> <span class="n">ind_vars</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">lindf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">lindf</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
<span class="n">lindf</span><span class="p">[</span><span class="s1">&#39;seconds&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Total Seconds Out&#39;</span><span class="p">]</span>

<span class="n">lindf</span> <span class="o">=</span> <span class="n">lindf</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">lindf</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">features</span> <span class="o">=</span> <span class="n">PolynomialFeatures</span><span class="p">(</span><span class="n">degree</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">lindf</span><span class="p">[</span><span class="s1">&#39;seconds&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">()</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>


<span class="c1">### FIT AND HYP TEST</span>
<span class="n">X2</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">est</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">X2</span><span class="p">)</span>
<span class="n">est2</span> <span class="o">=</span> <span class="n">est</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">est2</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;True&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Predicted&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">n</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;R2: </span><span class="si">{</span><span class="n">r2_score</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span><span class="si">:</span><span class="s1">.2e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">RSE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">r2_score</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;RSE: </span><span class="si">{</span><span class="n">RSE</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">coef_</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">intercept_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># b_hat</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;b: </span><span class="si">{</span><span class="n">b</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;m: </span><span class="si">{</span><span class="n">m</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;n: </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">x_bar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;x_bar: </span><span class="si">{</span><span class="n">x_bar</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="n">SE_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">RSE</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">/</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">x_bar</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">x</span><span class="o">-</span><span class="n">x_bar</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SE_b: </span><span class="si">{</span><span class="n">SE_b</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">SE_m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">RSE</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">x</span><span class="o">-</span><span class="n">x_bar</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SE_m: </span><span class="si">{</span><span class="n">SE_m</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="n">t</span> <span class="o">=</span> <span class="n">m</span><span class="o">/</span><span class="n">SE_m</span>
<span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">df</span><span class="o">=</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">))</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>                            OLS Regression Results                            
==============================================================================
Dep. Variable:                      y   R-squared:                       0.056
Model:                            OLS   Adj. R-squared:                  0.055
Method:                 Least Squares   F-statistic:                     30.83
Date:                Sat, 02 Apr 2022   Prob (F-statistic):           2.35e-19
Time:                        10:03:01   Log-Likelihood:                 2190.9
No. Observations:                1551   AIC:                            -4374.
Df Residuals:                    1547   BIC:                            -4352.
Df Model:                           3                                         
Covariance Type:            nonrobust                                         
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
const          0.0030      0.009      0.334      0.739      -0.014       0.020
x1             0.1612      0.124      1.301      0.193      -0.082       0.404
x2            -0.9203      0.523     -1.761      0.078      -1.945       0.105
x3             1.6922      0.664      2.550      0.011       0.390       2.994
==============================================================================
Omnibus:                     2252.329   Durbin-Watson:                   1.188
Prob(Omnibus):                  0.000   Jarque-Bera (JB):           651735.784
Skew:                           8.487   Prob(JB):                         0.00
Kurtosis:                     101.979   Cond. No.                         594.
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
</code></pre></div>

<p><img alt="png" src="../X5_Candy_Ribbons_files/X5_Candy_Ribbons_85_1.png" /></p>
<div class="codehilite"><pre><span></span><code>R2: 5.64e-02
RSE: 6.03e-03

b: 2.95e-03
m: 0.00e+00

n: 1551
x_bar: 3.58e-01
SE_b: 1.69e-04
SE_m: 1.96e-04
0.0
0.5
</code></pre></div>

<h4 id="multivariate-quantitative-to-quantitative-multivariate-linear-regression">Multivariate Quantitative to Quantitative (Multivariate Linear Regression)<a class="headerlink" href="#multivariate-quantitative-to-quantitative-multivariate-linear-regression" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="n">lindf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">lindf</span><span class="p">[</span><span class="n">feeds</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">feeds</span><span class="p">]</span>
<span class="n">lindf</span><span class="p">[</span><span class="s1">&#39;seconds&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Total Seconds Out&#39;</span><span class="p">]</span>
<span class="n">lindf</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">lindf</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ADD ARGUS ARGUSTAT AT 31 HK</th>
      <th>ADD ARGUS ARGUTHERM AO 77 PP</th>
      <th>ADD POLYPLAST PPM AO 01 UV PP</th>
      <th>ADD SCHULMAN DTY 20 AOUV</th>
      <th>BEIGE SCHULMAN PZ 91738 1 5 ZA</th>
      <th>BLACK SCHULMAN P7381</th>
      <th>DEVAN 2SPIN PP 106</th>
      <th>GREEN POLYPLAST COLOUR MB PP 6821</th>
      <th>GREEN SCHULMAN PZ 302446 1 5 T</th>
      <th>High MFR Black</th>
      <th>...</th>
      <th>UV POLYPLAST 6005 PP</th>
      <th>UV SCHULMAN FPPUV 38</th>
      <th>MFR 4 Grey</th>
      <th>PP POLYCHIM HL10XF</th>
      <th>MFR 4 Grey Grey</th>
      <th>PP POLYMER TEST MFI4</th>
      <th>PP TOTAL 4069</th>
      <th>RR MASTERBATCH TEST</th>
      <th>UV ARGUS ARX V 16 706 UV PP</th>
      <th>seconds</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.005337</td>
      <td>0.0</td>
      <td>0.000253</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.409353</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>9.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.005867</td>
      <td>0.0</td>
      <td>0.000272</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.452007</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>536.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.005895</td>
      <td>0.0</td>
      <td>0.000270</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.449608</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>20.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.005743</td>
      <td>0.0</td>
      <td>0.000272</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.440883</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>1001.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.004553</td>
      <td>0.0</td>
      <td>0.000211</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.349459</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>17892</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.000187</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.339726</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.002062</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>17893</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.342659</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.002071</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>17894</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.000190</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.345886</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.002107</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>17895</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.000187</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.344945</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.002095</td>
      <td>799.0</td>
    </tr>
    <tr>
      <th>17896</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.000190</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.345288</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.002105</td>
      <td>429.0</td>
    </tr>
  </tbody>
</table>
<p>17897 rows  45 columns</p>
</div>

<div class="codehilite"><pre><span></span><code><span class="n">lindf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">lindf</span><span class="p">[</span><span class="n">feeds</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">feeds</span><span class="p">]</span>
<span class="n">lindf</span><span class="p">[</span><span class="s1">&#39;seconds&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Total Seconds Out&#39;</span><span class="p">]</span>
<span class="n">lindf</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">lindf</span><span class="p">[</span><span class="n">feeds</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="c1"># features = PolynomialFeatures(degree=3)</span>
<span class="c1"># x = features.fit_transform(x.reshape(-1,1))</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">lindf</span><span class="p">[</span><span class="s1">&#39;seconds&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">()</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>


<span class="c1">### FIT AND HYP TEST</span>
<span class="n">X2</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">est</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">X2</span><span class="p">)</span>
<span class="n">est2</span> <span class="o">=</span> <span class="n">est</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">est2</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;True&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Predicted&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">n</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;R2: </span><span class="si">{</span><span class="n">r2_score</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span><span class="si">:</span><span class="s1">.2e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">RSE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">r2_score</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;RSE: </span><span class="si">{</span><span class="n">RSE</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">coef_</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">intercept_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># b_hat</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;b: </span><span class="si">{</span><span class="n">b</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;m: </span><span class="si">{</span><span class="n">m</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;n: </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">x_bar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;x_bar: </span><span class="si">{</span><span class="n">x_bar</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="n">SE_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">RSE</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">/</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">x_bar</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">x</span><span class="o">-</span><span class="n">x_bar</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SE_b: </span><span class="si">{</span><span class="n">SE_b</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">SE_m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">RSE</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">x</span><span class="o">-</span><span class="n">x_bar</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SE_m: </span><span class="si">{</span><span class="n">SE_m</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="n">t</span> <span class="o">=</span> <span class="n">m</span><span class="o">/</span><span class="n">SE_m</span>
<span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">df</span><span class="o">=</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">))</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>                            OLS Regression Results                            
==============================================================================
Dep. Variable:                      y   R-squared:                       0.050
Model:                            OLS   Adj. R-squared:                  0.049
Method:                 Least Squares   F-statistic:                     31.47
Date:                Sat, 02 Apr 2022   Prob (F-statistic):          2.76e-174
Time:                        10:03:19   Log-Likelihood:                 44791.
No. Observations:               17897   AIC:                        -8.952e+04
Df Residuals:                   17866   BIC:                        -8.928e+04
Df Model:                          30                                         
Covariance Type:            nonrobust                                         
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
const          0.0123      0.002      5.316      0.000       0.008       0.017
x1            -1.0553      0.382     -2.760      0.006      -1.805      -0.306
x2            -0.0119      0.010     -1.241      0.215      -0.031       0.007
x3             0.0351      0.100      0.352      0.725      -0.161       0.231
x4            -0.2377      0.069     -3.438      0.001      -0.373      -0.102
x5             0.4001      0.145      2.750      0.006       0.115       0.685
x6            -0.0224      0.128     -0.175      0.861      -0.272       0.228
x7            -0.3174      0.096     -3.305      0.001      -0.506      -0.129
x8            -0.5909      0.209     -2.825      0.005      -1.001      -0.181
x9            -0.4059      0.087     -4.655      0.000      -0.577      -0.235
x10           -0.0241      0.005     -5.206      0.000      -0.033      -0.015
x11        -2.473e-14   1.17e-14     -2.107      0.035   -4.77e-14   -1.73e-15
x12           -0.0050      0.004     -1.371      0.171      -0.012       0.002
x13           -0.0288      0.007     -4.319      0.000      -0.042      -0.016
x14           -0.0268      0.005     -5.644      0.000      -0.036      -0.018
x15           -0.0200      0.006     -3.620      0.000      -0.031      -0.009
x16        -1.023e-14    3.5e-15     -2.923      0.003   -1.71e-14   -3.37e-15
x17        -9.109e-16    2.5e-16     -3.649      0.000    -1.4e-15   -4.22e-16
x18           -0.0994      0.093     -1.073      0.283      -0.281       0.082
x19           -0.0055      0.003     -2.044      0.041      -0.011      -0.000
x20            0.0003      0.005      0.058      0.954      -0.009       0.010
x21         1.325e-15    1.2e-16     11.078      0.000    1.09e-15    1.56e-15
x22        -2.494e-16   8.68e-17     -2.873      0.004    -4.2e-16   -7.93e-17
x23            0.0145      0.004      3.827      0.000       0.007       0.022
x24           -0.0100      0.010     -1.051      0.293      -0.029       0.009
x25            0.0216      0.004      5.724      0.000       0.014       0.029
x26           -0.0101      0.002     -4.198      0.000      -0.015      -0.005
x27         -1.03e-16   8.73e-17     -1.180      0.238   -2.74e-16     6.8e-17
x28         9.329e-16   7.53e-17     12.396      0.000    7.85e-16    1.08e-15
x29           -0.0074      0.003     -2.881      0.004      -0.012      -0.002
x30            1.7091      0.132     12.994      0.000       1.451       1.967
x31            4.1538      0.376     11.053      0.000       3.417       4.890
x32                 0          0        nan        nan           0           0
x33            0.0031      0.012      0.263      0.792      -0.020       0.026
x34            0.0031      0.012      0.263      0.792      -0.020       0.026
x35            0.0031      0.012      0.263      0.792      -0.020       0.026
x36            0.0790      0.042      1.868      0.062      -0.004       0.162
x37            0.0525      0.030      1.774      0.076      -0.006       0.111
x38           -0.0064      0.003     -2.521      0.012      -0.011      -0.001
x39                 0          0        nan        nan           0           0
x40           -0.0136      0.005     -2.762      0.006      -0.023      -0.004
x41                 0          0        nan        nan           0           0
x42                 0          0        nan        nan           0           0
x43                 0          0        nan        nan           0           0
x44            0.1990      0.048      4.119      0.000       0.104       0.294
==============================================================================
Omnibus:                    43479.020   Durbin-Watson:                   1.074
Prob(Omnibus):                  0.000   Jarque-Bera (JB):        693938974.691
Skew:                          25.434   Prob(JB):                         0.00
Kurtosis:                     966.322   Cond. No.                     1.11e+16
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
[2] The smallest eigenvalue is 1.79e-28. This might indicate that there are
strong multicollinearity problems or that the design matrix is singular.
</code></pre></div>

<p><img alt="png" src="../X5_Candy_Ribbons_files/X5_Candy_Ribbons_88_1.png" /></p>
<div class="codehilite"><pre><span></span><code>R2: 5.02e-02
RSE: 1.67e-03

b: 1.23e-02
m: -1.06e+00

n: 17897
x_bar: 2.26e-02
SE_b: 1.25e-05
SE_m: 2.14e-05
-49284.75476441197
1.0
</code></pre></div>

<h5 id="forward-selection">Forward Selection<a class="headerlink" href="#forward-selection" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">add_feature</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">basemodel</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">r2max</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">feed</span> <span class="ow">in</span> <span class="n">features</span><span class="p">:</span>

        <span class="n">basemodel</span><span class="p">[</span><span class="n">feed</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">feed</span><span class="p">]</span>
        <span class="n">basemodel</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">basemodel</span><span class="p">[[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">basemodel</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span> <span class="o">!=</span> <span class="s1">&#39;seconds&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span>


        <span class="c1">### FIT AND HYP TEST</span>
        <span class="n">X2</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">est</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">X2</span><span class="p">)</span>
        <span class="n">est2</span> <span class="o">=</span> <span class="n">est</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">est2</span><span class="o">.</span><span class="n">rsquared</span> <span class="o">&gt;</span> <span class="n">r2max</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">est2</span><span class="o">.</span><span class="n">pvalues</span> <span class="o">&gt;</span> <span class="n">cutoff</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="n">r2max</span> <span class="o">=</span> <span class="n">est2</span><span class="o">.</span><span class="n">rsquared</span>
            <span class="n">feedmax</span> <span class="o">=</span> <span class="n">feed</span>
            <span class="n">bestsum</span> <span class="o">=</span> <span class="n">est2</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
            <span class="n">newmodel</span> <span class="o">=</span> <span class="n">basemodel</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="n">basemodel</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">labels</span> <span class="o">=</span> <span class="n">feed</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">r2max</span><span class="p">,</span> <span class="n">feedmax</span><span class="p">,</span> <span class="n">bestsum</span><span class="p">,</span> <span class="n">newmodel</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">lindf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">lindf</span><span class="p">[</span><span class="s1">&#39;seconds&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Total Seconds Out&#39;</span><span class="p">]</span>
<span class="n">lindf</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">lindf</span><span class="p">[</span><span class="s1">&#39;seconds&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">()</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">r2max</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">candidates</span> <span class="o">=</span> <span class="n">feeds</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">basemodel</span> <span class="o">=</span> <span class="n">lindf</span>

<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">newr2max</span><span class="p">,</span> <span class="n">feedmax</span><span class="p">,</span> <span class="n">bestsum</span><span class="p">,</span> <span class="n">newmodel</span> <span class="o">=</span> <span class="n">add_feature</span><span class="p">(</span>
        <span class="n">features</span><span class="o">=</span><span class="n">candidates</span><span class="p">,</span> 
        <span class="n">basemodel</span><span class="o">=</span><span class="n">basemodel</span><span class="p">,</span> 
        <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> 
        <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
        <span class="n">r2max</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">newr2max</span> <span class="o">&gt;</span> <span class="n">r2max</span><span class="p">:</span>
        <span class="c1"># print(newr2max, feedmax)</span>
        <span class="n">candidates</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">feedmax</span><span class="p">)</span>
        <span class="n">r2max</span> <span class="o">=</span> <span class="n">newr2max</span>
        <span class="n">basemodel</span> <span class="o">=</span> <span class="n">newmodel</span>
        <span class="k">continue</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">break</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>/home/wbeckner/anaconda3/envs/py39/lib/python3.9/site-packages/statsmodels/regression/linear_model.py:1918: RuntimeWarning: divide by zero encountered in double_scalars
  return np.sqrt(eigvals[0]/eigvals[-1])
/home/wbeckner/anaconda3/envs/py39/lib/python3.9/site-packages/statsmodels/regression/linear_model.py:1918: RuntimeWarning: divide by zero encountered in double_scalars
  return np.sqrt(eigvals[0]/eigvals[-1])
/home/wbeckner/anaconda3/envs/py39/lib/python3.9/site-packages/statsmodels/regression/linear_model.py:1918: RuntimeWarning: divide by zero encountered in double_scalars
  return np.sqrt(eigvals[0]/eigvals[-1])
/home/wbeckner/anaconda3/envs/py39/lib/python3.9/site-packages/statsmodels/regression/linear_model.py:1918: RuntimeWarning: divide by zero encountered in double_scalars
  return np.sqrt(eigvals[0]/eigvals[-1])
</code></pre></div>

<p>we see some of the usual suspects from the chi-square tests. Notably some are missing: <code>High MFR Grey</code>, <code>BLACK SCHULMAN P7381</code>, <code>PP INEOS 100 GA09</code> and others.</p>
<div class="codehilite"><pre><span></span><code><span class="n">basemodel</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>seconds</th>
      <th>PP TOTAL 7089</th>
      <th>PP POLYCHIM HB12XF</th>
      <th>SILIKAT PBH ABPP 05</th>
      <th>SILIKAT POLYPLUS AB 1001 PP</th>
      <th>MFR 4 Green</th>
      <th>ADD SCHULMAN DTY 20 AOUV</th>
      <th>GREEN SCHULMAN PZ 302446 1 5 T</th>
      <th>MFR 4 Grey</th>
      <th>UV ARGUS ARX V 16 706 UV PP</th>
      <th>GREEN SCHULMAN PZ 34198 1 5 T</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>9.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.005337</td>
      <td>0.0</td>
      <td>0.409353</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>536.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.005867</td>
      <td>0.0</td>
      <td>0.452007</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>20.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.005895</td>
      <td>0.0</td>
      <td>0.449608</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1001.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.005743</td>
      <td>0.0</td>
      <td>0.440883</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.004553</td>
      <td>0.0</td>
      <td>0.349459</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div>

<div class="codehilite"><pre><span></span><code><span class="n">forward_selection_feeds</span> <span class="o">=</span> <span class="n">basemodel</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">bestsum</span>
</code></pre></div>

<table class="simpletable">
<caption>OLS Regression Results</caption>
<tr>
  <th>Dep. Variable:</th>            <td>y</td>        <th>  R-squared:         </th>  <td>   0.046</td> 
</tr>
<tr>
  <th>Model:</th>                   <td>OLS</td>       <th>  Adj. R-squared:    </th>  <td>   0.045</td> 
</tr>
<tr>
  <th>Method:</th>             <td>Least Squares</td>  <th>  F-statistic:       </th>  <td>   94.99</td> 
</tr>
<tr>
  <th>Date:</th>             <td>Sat, 02 Apr 2022</td> <th>  Prob (F-statistic):</th>  <td>5.51e-174</td>
</tr>
<tr>
  <th>Time:</th>                 <td>10:04:41</td>     <th>  Log-Likelihood:    </th>  <td>  44748.</td> 
</tr>
<tr>
  <th>No. Observations:</th>      <td> 17897</td>      <th>  AIC:               </th> <td>-8.948e+04</td>
</tr>
<tr>
  <th>Df Residuals:</th>          <td> 17887</td>      <th>  BIC:               </th> <td>-8.940e+04</td>
</tr>
<tr>
  <th>Df Model:</th>              <td>     9</td>      <th>                     </th>      <td> </td>    
</tr>
<tr>
  <th>Covariance Type:</th>      <td>nonrobust</td>    <th>                     </th>      <td> </td>    
</tr>
</table>
<table class="simpletable">
<tr>
    <td></td>       <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>const</th> <td>    0.0034</td> <td>    0.000</td> <td>   11.288</td> <td> 0.000</td> <td>    0.003</td> <td>    0.004</td>
</tr>
<tr>
  <th>x1</th>    <td>    0.0214</td> <td>    0.002</td> <td>   11.535</td> <td> 0.000</td> <td>    0.018</td> <td>    0.025</td>
</tr>
<tr>
  <th>x2</th>    <td>    0.0146</td> <td>    0.002</td> <td>    7.837</td> <td> 0.000</td> <td>    0.011</td> <td>    0.018</td>
</tr>
<tr>
  <th>x3</th>    <td>    1.5742</td> <td>    0.110</td> <td>   14.375</td> <td> 0.000</td> <td>    1.360</td> <td>    1.789</td>
</tr>
<tr>
  <th>x4</th>    <td>    4.1700</td> <td>    0.363</td> <td>   11.497</td> <td> 0.000</td> <td>    3.459</td> <td>    4.881</td>
</tr>
<tr>
  <th>x5</th>    <td>   -0.0181</td> <td>    0.003</td> <td>   -6.276</td> <td> 0.000</td> <td>   -0.024</td> <td>   -0.012</td>
</tr>
<tr>
  <th>x6</th>    <td>   -0.2879</td> <td>    0.065</td> <td>   -4.450</td> <td> 0.000</td> <td>   -0.415</td> <td>   -0.161</td>
</tr>
<tr>
  <th>x7</th>    <td>   -0.1932</td> <td>    0.052</td> <td>   -3.698</td> <td> 0.000</td> <td>   -0.296</td> <td>   -0.091</td>
</tr>
<tr>
  <th>x8</th>    <td>    0.0037</td> <td>    0.001</td> <td>    3.322</td> <td> 0.001</td> <td>    0.002</td> <td>    0.006</td>
</tr>
<tr>
  <th>x9</th>    <td>    0.0736</td> <td>    0.028</td> <td>    2.641</td> <td> 0.008</td> <td>    0.019</td> <td>    0.128</td>
</tr>
<tr>
  <th>x10</th>   <td>         0</td> <td>        0</td> <td>      nan</td> <td>   nan</td> <td>        0</td> <td>        0</td>
</tr>
<tr>
  <th>x11</th>   <td>         0</td> <td>        0</td> <td>      nan</td> <td>   nan</td> <td>        0</td> <td>        0</td>
</tr>
</table>
<table class="simpletable">
<tr>
  <th>Omnibus:</th>       <td>43415.763</td> <th>  Durbin-Watson:     </th>   <td>   1.068</td>   
</tr>
<tr>
  <th>Prob(Omnibus):</th>  <td> 0.000</td>   <th>  Jarque-Bera (JB):  </th> <td>683838684.139</td>
</tr>
<tr>
  <th>Skew:</th>           <td>25.346</td>   <th>  Prob(JB):          </th>   <td>    0.00</td>   
</tr>
<tr>
  <th>Kurtosis:</th>       <td>959.275</td>  <th>  Cond. No.          </th>   <td>     inf</td>   
</tr>
</table>
<p>Notes:[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.[2] The smallest eigenvalue is      0. This might indicate that there arestrong multicollinearity problems or that the design matrix is singular.</p>
<h4 id="multivariate-conclusions">Multivariate Conclusions<a class="headerlink" href="#multivariate-conclusions" title="Permanent link">&para;</a></h4>
<p>y poses a problem with out of the box regression. Extreme tails will upset the residual plots.</p>
<p>We some overlap of the parametric and non-parametric approaches:</p>
<div class="codehilite"><pre><span></span><code><span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">basemodel</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">(</span><span class="n">problem_vars</span><span class="p">)]</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>[&#39;PP TOTAL 7089&#39;, &#39;PP POLYCHIM HB12XF&#39;, &#39;SILIKAT PBH ABPP 05&#39;]
</code></pre></div>

<h4 id="multivariate-quantitative-to-categorical-binned-output-variable">Multivariate Quantitative to Categorical (Binned Output Variable)<a class="headerlink" href="#multivariate-quantitative-to-categorical-binned-output-variable" title="Permanent link">&para;</a></h4>
<p>Logistic regression does little better than random guessing</p>
<div class="codehilite"><pre><span></span><code><span class="n">lindf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">lindf</span><span class="p">[</span><span class="s1">&#39;seconds&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Total Seconds Out&#39;</span><span class="p">]</span>
<span class="n">lindf</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">lindf</span><span class="p">[</span><span class="s1">&#39;seconds&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">r2max</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">candidates</span> <span class="o">=</span> <span class="n">feeds</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">basemodel</span> <span class="o">=</span> <span class="n">lindf</span>

<span class="n">labels</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">labels</span><span class="p">[</span><span class="n">labels</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="mf">.25</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">labels</span><span class="p">[(</span><span class="n">labels</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="mf">.25</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">labels</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="mf">.5</span><span class="p">))]</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">labels</span><span class="p">[(</span><span class="n">labels</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="mf">.5</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">labels</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="mf">.75</span><span class="p">))]</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">labels</span><span class="p">[(</span><span class="n">labels</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="mf">.75</span><span class="p">))]</span> <span class="o">=</span> <span class="mi">4</span>

<span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">names</span> <span class="o">+=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;less than </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="mf">.25</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> sec&quot;</span><span class="p">]</span>
<span class="n">names</span> <span class="o">+=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="mf">.25</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> &lt; sec &lt;= </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="mf">.5</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
<span class="n">names</span> <span class="o">+=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="mf">.5</span><span class="p">)</span><span class="o">/</span><span class="mi">60</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> &lt; min &lt;= </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="mf">.75</span><span class="p">)</span><span class="o">/</span><span class="mi">60</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
<span class="n">names</span> <span class="o">+=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;greater than </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="mf">.75</span><span class="p">)</span><span class="o">/</span><span class="mi">60</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> min&quot;</span><span class="p">]</span>

<span class="n">y</span> <span class="o">=</span> <span class="n">labels</span>
<span class="n">ind</span> <span class="o">=</span> <span class="n">feeds</span>
<span class="n">lindf</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
<span class="n">lindf</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">lindf</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="c1">#.reshape(-1,1)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Train Acc: </span><span class="si">{</span><span class="n">accuracy_score</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Test Acc: </span><span class="si">{</span><span class="n">accuracy_score</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>Train Acc: 0.37
Test Acc: 0.37


/home/wbeckner/anaconda3/envs/py39/lib/python3.9/site-packages/sklearn/linear_model/_logistic.py:814: ConvergenceWarning: lbfgs failed to converge (status=1):
STOP: TOTAL NO. of ITERATIONS REACHED LIMIT.

Increase the number of iterations (max_iter) or scale the data as shown in:
    https://scikit-learn.org/stable/modules/preprocessing.html
Please also refer to the documentation for alternative solver options:
    https://scikit-learn.org/stable/modules/linear_model.html#logistic-regression
  n_iter_i = _check_optimize_result(
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="nb">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">zero_division</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">y_pred</span><span class="p">),</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="n">names</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="n">names</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>              precision    recall  f1-score   support

         1.0       0.35      0.80      0.49      4527
         2.0       0.36      0.32      0.34      4434
         3.0       0.30      0.03      0.06      4463
         4.0       0.43      0.32      0.37      4473

    accuracy                           0.37     17897
   macro avg       0.36      0.37      0.31     17897
weighted avg       0.36      0.37      0.31     17897






&lt;AxesSubplot:&gt;
</code></pre></div>

<p><img alt="png" src="../X5_Candy_Ribbons_files/X5_Candy_Ribbons_101_2.png" /></p>
<p>If we are careful about regularizing the random forest model, it does a little bit better</p>
<div class="codehilite"><pre><span></span><code><span class="n">lindf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">lindf</span><span class="p">[</span><span class="s1">&#39;seconds&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Total Seconds Out&#39;</span><span class="p">]</span>
<span class="n">lindf</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">lindf</span><span class="p">[</span><span class="s1">&#39;seconds&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">r2max</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">candidates</span> <span class="o">=</span> <span class="n">feeds</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">basemodel</span> <span class="o">=</span> <span class="n">lindf</span>

<span class="n">labels</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">labels</span><span class="p">[</span><span class="n">labels</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="mf">.25</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">labels</span><span class="p">[(</span><span class="n">labels</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="mf">.25</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">labels</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="mf">.5</span><span class="p">))]</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">labels</span><span class="p">[(</span><span class="n">labels</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="mf">.5</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">labels</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="mf">.75</span><span class="p">))]</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">labels</span><span class="p">[(</span><span class="n">labels</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="mf">.75</span><span class="p">))]</span> <span class="o">=</span> <span class="mi">4</span>

<span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">names</span> <span class="o">+=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;less than </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="mf">.25</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> sec&quot;</span><span class="p">]</span>
<span class="n">names</span> <span class="o">+=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="mf">.25</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> &lt; sec &lt;= </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="mf">.5</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
<span class="n">names</span> <span class="o">+=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="mf">.5</span><span class="p">)</span><span class="o">/</span><span class="mi">60</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> &lt; min &lt;= </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="mf">.75</span><span class="p">)</span><span class="o">/</span><span class="mi">60</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
<span class="n">names</span> <span class="o">+=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;greater than </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="mf">.75</span><span class="p">)</span><span class="o">/</span><span class="mi">60</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> min&quot;</span><span class="p">]</span>

<span class="n">y</span> <span class="o">=</span> <span class="n">labels</span>

<span class="n">ind</span> <span class="o">=</span> <span class="n">feeds</span>
<span class="n">lindf</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
<span class="n">lindf</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">lindf</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="c1">#.reshape(-1,1)</span>

<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Train Acc: </span><span class="si">{</span><span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">))</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Test Acc: </span><span class="si">{</span><span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">))</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>Train Acc: 0.99
Test Acc: 0.39
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">y_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">zero_division</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">y_pred</span><span class="p">),</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="n">names</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="n">names</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>              precision    recall  f1-score   support

         1.0       0.41      0.48      0.44       898
         2.0       0.33      0.30      0.31       881
         3.0       0.29      0.27      0.28       893
         4.0       0.50      0.51      0.51       908

    accuracy                           0.39      3580
   macro avg       0.38      0.39      0.38      3580
weighted avg       0.38      0.39      0.38      3580






&lt;AxesSubplot:&gt;
</code></pre></div>

<p><img alt="png" src="../X5_Candy_Ribbons_files/X5_Candy_Ribbons_104_2.png" /></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># grab feature importances</span>
<span class="n">imp</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">feature_importances_</span>

<span class="c1"># their std</span>
<span class="n">std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">([</span><span class="n">tree</span><span class="o">.</span><span class="n">feature_importances_</span> <span class="k">for</span> <span class="n">tree</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">estimators_</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># create new dataframe</span>
<span class="n">feat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">ind</span><span class="p">,</span> <span class="n">imp</span><span class="p">,</span> <span class="n">std</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
<span class="n">feat</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;feature&#39;</span><span class="p">,</span> <span class="s1">&#39;importance&#39;</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">]</span>
<span class="n">feat</span> <span class="o">=</span> <span class="n">feat</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;importance&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">feat</span> <span class="o">=</span> <span class="n">feat</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">feat</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">feat</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</code></pre></div>

<p><br/><br/><br/><br/><br/><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>feature</th>
      <th>importance</th>
      <th>std</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>PP TOTAL PPH 4065</td>
      <td>0.150387</td>
      <td>0.008053</td>
    </tr>
    <tr>
      <th>1</th>
      <td>BLACK SCHULMAN P7381</td>
      <td>0.118158</td>
      <td>0.008725</td>
    </tr>
    <tr>
      <th>2</th>
      <td>PP INEOS 100 GA04</td>
      <td>0.100635</td>
      <td>0.005217</td>
    </tr>
    <tr>
      <th>3</th>
      <td>UV ARGUS ARX V 16 706 UV PP</td>
      <td>0.090776</td>
      <td>0.006273</td>
    </tr>
    <tr>
      <th>4</th>
      <td>MFR 4 Grey</td>
      <td>0.08828</td>
      <td>0.005656</td>
    </tr>
    <tr>
      <th>5</th>
      <td>PP UNIPETROL GB005</td>
      <td>0.060558</td>
      <td>0.003569</td>
    </tr>
    <tr>
      <th>6</th>
      <td>MFR 4 Black</td>
      <td>0.052589</td>
      <td>0.003695</td>
    </tr>
    <tr>
      <th>7</th>
      <td>ADD SCHULMAN DTY 20 AOUV</td>
      <td>0.041478</td>
      <td>0.003554</td>
    </tr>
    <tr>
      <th>8</th>
      <td>DEVAN 2SPIN PP 106</td>
      <td>0.038438</td>
      <td>0.004061</td>
    </tr>
    <tr>
      <th>9</th>
      <td>High MFR Black</td>
      <td>0.028838</td>
      <td>0.002515</td>
    </tr>
    <tr>
      <th>10</th>
      <td>MFR 4 Grey Grey</td>
      <td>0.025758</td>
      <td>0.002319</td>
    </tr>
    <tr>
      <th>11</th>
      <td>ADD ARGUS ARGUTHERM AO 77 PP</td>
      <td>0.024526</td>
      <td>0.002253</td>
    </tr>
    <tr>
      <th>12</th>
      <td>High MFR Grey</td>
      <td>0.020652</td>
      <td>0.004188</td>
    </tr>
    <tr>
      <th>13</th>
      <td>MFR 4 Green</td>
      <td>0.016508</td>
      <td>0.002725</td>
    </tr>
    <tr>
      <th>14</th>
      <td>SILIKAT PBH ABPP 05</td>
      <td>0.016283</td>
      <td>0.002291</td>
    </tr>
    <tr>
      <th>15</th>
      <td>PP TOTAL 7089</td>
      <td>0.01624</td>
      <td>0.004897</td>
    </tr>
    <tr>
      <th>16</th>
      <td>ADD POLYPLAST PPM AO 01 UV PP</td>
      <td>0.013499</td>
      <td>0.001685</td>
    </tr>
    <tr>
      <th>17</th>
      <td>MFR 4 Black Brown</td>
      <td>0.013401</td>
      <td>0.002131</td>
    </tr>
    <tr>
      <th>18</th>
      <td>PP POLYCHIM HB12XF</td>
      <td>0.01245</td>
      <td>0.002185</td>
    </tr>
    <tr>
      <th>19</th>
      <td>PP INEOS 100 GA09</td>
      <td>0.010354</td>
      <td>0.00156</td>
    </tr>
  </tbody>
</table>
</div>
</p>
<h2 id="60-business-impact">6.0 Business Impact<a class="headerlink" href="#60-business-impact" title="Permanent link">&para;</a></h2>
<p>What is the so what?</p>
<p>From Hyp tests - target is either <code>'Total Position Out'</code> or <code>'Total Seconds Out'</code></p>
<p>We had culprits from pearsons:</p>
<div class="codehilite"><pre><span></span><code><span class="n">ind_vars</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>[&#39;MFR 4 White&#39;, &#39;PP TOTAL 7089&#39;, &#39;SILIKAT POLYPLUS AB 1001 PP&#39;]
</code></pre></div>

<p>culprits from non parametric tests:</p>
<div class="codehilite"><pre><span></span><code><span class="nb">list</span><span class="p">(</span><span class="n">problem_vars</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>[&#39;PP TOTAL 7089&#39;,
 &#39;PP POLYCHIM HB12XF&#39;,
 &#39;High MFR Grey&#39;,
 &#39;SILIKAT PBH ABPP 05&#39;,
 &#39;BLACK SCHULMAN P7381&#39;]
</code></pre></div>

<p>and culprits from linear regression</p>
<div class="codehilite"><pre><span></span><code><span class="n">forward_selection_feeds</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>Index([&#39;PP TOTAL 7089&#39;, &#39;PP POLYCHIM HB12XF&#39;, &#39;SILIKAT PBH ABPP 05&#39;,
       &#39;SILIKAT POLYPLUS AB 1001 PP&#39;, &#39;MFR 4 Green&#39;,
       &#39;ADD SCHULMAN DTY 20 AOUV&#39;, &#39;GREEN SCHULMAN PZ 302446 1 5 T&#39;,
       &#39;MFR 4 Grey&#39;, &#39;UV ARGUS ARX V 16 706 UV PP&#39;,
       &#39;GREEN SCHULMAN PZ 34198 1 5 T&#39;],
      dtype=&#39;object&#39;)
</code></pre></div>

<p>and we can check the overlap between non-parametric and linear regression (parametric):</p>
<div class="codehilite"><pre><span></span><code><span class="n">predict_vars</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">basemodel</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">(</span><span class="n">problem_vars</span><span class="p">)]</span>
<span class="n">predict_vars</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>[&#39;PP TOTAL 7089&#39;, &#39;PP POLYCHIM HB12XF&#39;, &#39;SILIKAT PBH ABPP 05&#39;]
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">all_vars</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">problem_vars</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">forward_selection_feeds</span><span class="p">))</span>
<span class="n">all_vars</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>{&#39;ADD SCHULMAN DTY 20 AOUV&#39;,
 &#39;BLACK SCHULMAN P7381&#39;,
 &#39;GREEN SCHULMAN PZ 302446 1 5 T&#39;,
 &#39;GREEN SCHULMAN PZ 34198 1 5 T&#39;,
 &#39;High MFR Grey&#39;,
 &#39;MFR 4 Green&#39;,
 &#39;MFR 4 Grey&#39;,
 &#39;PP POLYCHIM HB12XF&#39;,
 &#39;PP TOTAL 7089&#39;,
 &#39;SILIKAT PBH ABPP 05&#39;,
 &#39;SILIKAT POLYPLUS AB 1001 PP&#39;,
 &#39;UV ARGUS ARX V 16 706 UV PP&#39;}
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1"># add to DF</span>
<span class="n">business</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">value_line_by_day</span> <span class="o">=</span> <span class="mi">99000</span>
<span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">problem_vars</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># products, </span>
        <span class="n">prods</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">][</span><span class="s1">&#39;Product&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        <span class="n">nprods</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">][</span><span class="s1">&#39;Product&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span>
        <span class="n">dff</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Product&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">prods</span><span class="p">)]</span>
        <span class="c1"># total runtime, </span>
        <span class="n">tot_runtime</span> <span class="o">=</span> <span class="n">dff</span><span class="p">[</span><span class="s1">&#39;Time Delta&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="c1"># total runtime with feed, </span>
        <span class="n">tot_runtime_wfeed</span> <span class="o">=</span> <span class="n">dff</span><span class="p">[</span><span class="n">dff</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">][</span><span class="s1">&#39;Time Delta&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="c1">#downtime w/o feed, downtime w/ feed, </span>
        <span class="n">avg_downtime_min</span> <span class="o">=</span> <span class="n">dff</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">dff</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)[</span><span class="n">seconds</span><span class="p">[:</span><span class="mi">4</span><span class="p">]]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">60</span>
        <span class="n">avg_downtime_min_wfeed</span> <span class="o">=</span> <span class="n">avg_downtime_min</span><span class="p">[</span><span class="kc">True</span><span class="p">]</span>
        <span class="n">avg_downtime_min_w_ofeed</span> <span class="o">=</span> <span class="n">avg_downtime_min</span><span class="p">[</span><span class="kc">False</span><span class="p">]</span>
        <span class="n">ratio</span> <span class="o">=</span> <span class="n">avg_downtime_min_wfeed</span> <span class="o">/</span> <span class="n">avg_downtime_min_w_ofeed</span>
        <span class="c1"># average runtime, </span>
        <span class="n">avg_runtime_min</span> <span class="o">=</span> <span class="n">dff</span><span class="p">[</span><span class="s1">&#39;Time Delta&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span><span class="o">/</span><span class="mi">60</span>
        <span class="c1"># days saved, dollars saved</span>
        <span class="n">days_saved</span> <span class="o">=</span> <span class="p">(</span><span class="n">tot_runtime_wfeed</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span><span class="o">/</span><span class="mi">60</span> <span class="o">/</span> <span class="n">avg_runtime_min</span> <span class="o">*</span> <span class="n">avg_downtime_min</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">60</span><span class="o">/</span><span class="mi">24</span>

        <span class="n">dollars_saved_per_batch</span> <span class="o">=</span> <span class="n">value_line_by_day</span> <span class="o">*</span> <span class="n">avg_downtime_min</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mi">60</span><span class="o">*</span><span class="mi">24</span><span class="p">)</span>

        <span class="n">business</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">business</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="n">ind</span><span class="p">,</span> <span class="n">nprods</span><span class="p">,</span> <span class="n">tot_runtime</span><span class="p">,</span> <span class="n">tot_runtime_wfeed</span><span class="p">,</span> <span class="n">avg_downtime_min_wfeed</span><span class="p">,</span> 
                                                       <span class="n">avg_downtime_min_w_ofeed</span><span class="p">,</span> <span class="n">ratio</span><span class="p">,</span> <span class="n">avg_runtime_min</span><span class="p">,</span> <span class="n">days_saved</span><span class="p">,</span> 
                                                       <span class="n">days_saved</span><span class="o">*</span><span class="n">value_line_by_day</span><span class="p">,</span> <span class="n">dollars_saved_per_batch</span><span class="p">]],</span>
                    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Feed&#39;</span><span class="p">,</span> <span class="s1">&#39;Products&#39;</span><span class="p">,</span> <span class="s1">&#39;Total Runtime, Products&#39;</span><span class="p">,</span> <span class="s1">&#39;Total Runtime With Feed&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;Average Downtime With Feed&#39;</span><span class="p">,</span> <span class="s1">&#39;Average Downtime Without Feed&#39;</span><span class="p">,</span> <span class="s1">&#39;Downtime Mult X (with feed)&#39;</span><span class="p">,</span> 
                             <span class="s1">&#39;Average Runtime&#39;</span><span class="p">,</span> <span class="s1">&#39;Days Saved (2 YRS)&#39;</span><span class="p">,</span> <span class="s1">&#39;Dollars Saved (2 YRS)&#39;</span><span class="p">,</span> <span class="s1">&#39;Dollars Saved (Per Batch)&#39;</span><span class="p">])))</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">dff</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)[</span><span class="n">seconds</span><span class="p">[:</span><span class="mi">4</span><span class="p">]]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">60</span><span class="p">)</span>
<span class="n">business</span> <span class="o">=</span> <span class="n">business</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;Dollars Saved (Per Batch)&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">business</span>
<span class="c1"># workshop downtime ratio</span>
<span class="c1"># feed products, feed products</span>
<span class="c1"># Dollars saved per batch</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Feed</th>
      <th>Products</th>
      <th>Total Runtime, Products</th>
      <th>Total Runtime With Feed</th>
      <th>Average Downtime With Feed</th>
      <th>Average Downtime Without Feed</th>
      <th>Downtime Mult X (with feed)</th>
      <th>Average Runtime</th>
      <th>Days Saved (2 YRS)</th>
      <th>Dollars Saved (2 YRS)</th>
      <th>Dollars Saved (Per Batch)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>SILIKAT PBH ABPP 05</td>
      <td>26</td>
      <td>409 days 20:43:21</td>
      <td>94 days 04:36:05</td>
      <td>26.250639</td>
      <td>13.671063</td>
      <td>1.920161</td>
      <td>70.835736</td>
      <td>16.727319</td>
      <td>1.656005e+06</td>
      <td>864.845823</td>
    </tr>
    <tr>
      <th>1</th>
      <td>High MFR Grey</td>
      <td>36</td>
      <td>564 days 04:13:41</td>
      <td>94 days 12:26:59</td>
      <td>23.623539</td>
      <td>12.809036</td>
      <td>1.844287</td>
      <td>65.459164</td>
      <td>15.615433</td>
      <td>1.545928e+06</td>
      <td>743.497080</td>
    </tr>
    <tr>
      <th>2</th>
      <td>PP POLYCHIM HB12XF</td>
      <td>17</td>
      <td>383 days 00:03:51</td>
      <td>67 days 09:13:53</td>
      <td>21.043525</td>
      <td>15.600015</td>
      <td>1.348943</td>
      <td>70.908183</td>
      <td>5.173013</td>
      <td>5.121283e+05</td>
      <td>374.241303</td>
    </tr>
    <tr>
      <th>3</th>
      <td>BLACK SCHULMAN P7381</td>
      <td>64</td>
      <td>751 days 20:01:57</td>
      <td>590 days 12:21:50</td>
      <td>14.902871</td>
      <td>12.363943</td>
      <td>1.205349</td>
      <td>63.216276</td>
      <td>23.716605</td>
      <td>2.347944e+06</td>
      <td>174.551301</td>
    </tr>
    <tr>
      <th>4</th>
      <td>PP TOTAL 7089</td>
      <td>13</td>
      <td>291 days 22:06:22</td>
      <td>79 days 15:56:47</td>
      <td>20.651050</td>
      <td>18.269305</td>
      <td>1.130369</td>
      <td>80.146114</td>
      <td>2.367430</td>
      <td>2.343756e+05</td>
      <td>163.744933</td>
    </tr>
  </tbody>
</table>
</div>

<div class="codehilite"><pre><span></span><code><span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.precision&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">business</span><span class="p">[[</span><span class="s1">&#39;Feed&#39;</span><span class="p">,</span> <span class="s1">&#39;Average Downtime With Feed&#39;</span><span class="p">,</span> <span class="s1">&#39;Average Downtime Without Feed&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;Downtime Mult X (with feed)&#39;</span><span class="p">,</span> <span class="s1">&#39;Days Saved (2 YRS)&#39;</span><span class="p">,</span> <span class="s1">&#39;Dollars Saved (2 YRS)&#39;</span><span class="p">,</span> 
                  <span class="s1">&#39;Dollars Saved (Per Batch)&#39;</span><span class="p">]],</span>
        <span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.precision&#39;</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Feed</th>
      <th>Average Downtime With Feed</th>
      <th>Average Downtime Without Feed</th>
      <th>Downtime Mult X (with feed)</th>
      <th>Days Saved (2 YRS)</th>
      <th>Dollars Saved (2 YRS)</th>
      <th>Dollars Saved (Per Batch)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>SILIKAT PBH ABPP 05</td>
      <td>26.25</td>
      <td>13.67</td>
      <td>1.92</td>
      <td>16.73</td>
      <td>1.66e+06</td>
      <td>864.85</td>
    </tr>
    <tr>
      <th>1</th>
      <td>High MFR Grey</td>
      <td>23.62</td>
      <td>12.81</td>
      <td>1.84</td>
      <td>15.62</td>
      <td>1.55e+06</td>
      <td>743.50</td>
    </tr>
    <tr>
      <th>2</th>
      <td>PP POLYCHIM HB12XF</td>
      <td>21.04</td>
      <td>15.60</td>
      <td>1.35</td>
      <td>5.17</td>
      <td>5.12e+05</td>
      <td>374.24</td>
    </tr>
    <tr>
      <th>3</th>
      <td>BLACK SCHULMAN P7381</td>
      <td>14.90</td>
      <td>12.36</td>
      <td>1.21</td>
      <td>23.72</td>
      <td>2.35e+06</td>
      <td>174.55</td>
    </tr>
    <tr>
      <th>4</th>
      <td>PP TOTAL 7089</td>
      <td>20.65</td>
      <td>18.27</td>
      <td>1.13</td>
      <td>2.37</td>
      <td>2.34e+05</td>
      <td>163.74</td>
    </tr>
  </tbody>
</table>
</div>

<p>We see that <code>'SILKAT PBH ABPP 05'</code> as well as <code>'High MFR Grey'</code> have a large amount of days saved over the two years, a strong downtime multiplier effect and the largest dollars saved per batch. Since High MFR Grey is a recycle feed, we may not have the ability to remove it from the feed list. Leaving the SILKAT (Silicate) feed the prime feedstock to remove</p>
<h2 id="70-visualizations">7.0 Visualizations<a class="headerlink" href="#70-visualizations" title="Permanent link">&para;</a></h2>
<h3 id="pp-total-7089">PP TOTAL 7089<a class="headerlink" href="#pp-total-7089" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="n">predict_var</span> <span class="o">=</span> <span class="n">predict_vars</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">outcome_var</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="s1">&#39;Seconds&#39;</span> <span class="ow">in</span> <span class="n">i</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">myplot</span><span class="p">(</span><span class="n">col</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">predict_var</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">][</span><span class="s1">&#39;Product&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
    <span class="n">axt</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>

    <span class="c1"># other feeds</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Product&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">col</span><span class="p">][</span><span class="n">feeds</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>

    <span class="c1"># predict_var feed</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Product&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">col</span><span class="p">][</span><span class="n">feeds</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="n">predict_var</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

    <span class="c1"># outcome_var</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Product&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">col</span><span class="p">][</span><span class="n">outcome_var</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axt</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span>
                                                                                <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Total Seconds Out&#39;</span><span class="p">)</span>

    <span class="c1"># outliers</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">axt</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> 
                <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Product&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">col</span><span class="p">][</span><span class="n">outcome_var</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="mf">0.997</span><span class="p">))</span>

    <span class="n">h1</span><span class="p">,</span> <span class="n">l1</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
    <span class="n">h2</span><span class="p">,</span> <span class="n">l2</span> <span class="o">=</span> <span class="n">axt</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">h1</span><span class="o">+</span><span class="n">h2</span><span class="p">,</span> <span class="n">l1</span><span class="o">+</span><span class="n">l2</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">interact</span><span class="p">(</span><span class="n">myplot</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>interactive(children=(Dropdown(description=&#39;col&#39;, options=(0.0, 125617.0, 55626.0, 110617.0, 260607.0, 165215.





&lt;function __main__.myplot(col=[0.0, 125617.0, 55626.0, 110617.0, 260607.0, 165215.0, 136215.0, 125215.0, 110215.0, 100215.0, 80215.0, 100617.0, 90617.0, 90215.0, 90216.0, 110520.0, 80617.0])&gt;
</code></pre></div>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2022 Wesley Beckner
    </div>
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.361d90f1.min.js"}</script>
    
    
      <script src="../../assets/javascripts/bundle.289a2a4b.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      
    
  </body>
</html>