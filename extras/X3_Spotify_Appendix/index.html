
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.1.4">
    
    
      
        <title>What makes a playlist successful? - Data Science Foundations</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.bb3983ee.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../extra.css">
    
      <link rel="stylesheet" href="../../styles.css">
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  


  <script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-114664473-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){var e;this.value&&(e=document.location.pathname,ga("send","pageview",e+"?q="+this.value))}),"undefined"!=typeof location$&&location$.subscribe(function(e){ga("send","pageview",e.pathname)})})</script>
  <script async src="https://www.google-analytics.com/analytics.js"></script>


    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#what-makes-a-playlist-successful" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Data Science Foundations" class="md-header__button md-logo" aria-label="Data Science Foundations" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Data Science Foundations
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              What makes a playlist successful?
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Data Science Foundations" class="md-nav__button md-logo" aria-label="Data Science Foundations" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Data Science Foundations
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        About
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../introduction/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Sessions
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Sessions" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Sessions
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../S1_Regression_and_Analysis/" class="md-nav__link">
        Regression and Analysis
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../S2_Inferential_Statistics/" class="md-nav__link">
        Inferential Statistics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../S3_Model_Selection_and_Validation/" class="md-nav__link">
        Model Selection and Validation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../S4_Feature_Engineering/" class="md-nav__link">
        Feature Engineering
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../S5_Unsupervised_Learning/" class="md-nav__link">
        Unsupervised Learning
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../S6_Bagging/" class="md-nav__link">
        Bagging
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../S7_Boosting/" class="md-nav__link">
        Boosting
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Labs
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Labs" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Labs
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../labs/L1_Descriptive_Statistics_Data_Hunt/" class="md-nav__link">
        Descriptive Statistics Data Hunt
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../labs/L2_Inferential_Statistics_Data_Hunt/" class="md-nav__link">
        Inferential Statistics Data Hunt
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../labs/L3_Feature_Engineering/" class="md-nav__link">
        Practice with Feature Engineering
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../labs/L4_Supervised_Learners/" class="md-nav__link">
        Practice with Supervised Learners
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../labs/L5_Writing_Unit_Tests/" class="md-nav__link">
        Practice with Writing Unit Tests
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Project
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Project" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Project
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../project/P1_Statistical_Analysis_of_TicTacToe/" class="md-nav__link">
        Statistical Analysis of TicTacToe
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../project/P2_Heuristical_TicTacToe_Agents/" class="md-nav__link">
        Heuristical TicTacToe Agents
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../project/P3_1_Step_Look_Ahead_Agents/" class="md-nav__link">
        1-Step Look Ahead Agents
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../project/P4_N_Step_Look_Ahead_Agents/" class="md-nav__link">
        N-Step Look Ahead Agents
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Extras
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Extras" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Extras
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../X1_Bayesian_Probability/" class="md-nav__link">
        Probability
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../X2_Airbnb/" class="md-nav__link">
        Airbnb
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../X3_AB_Testing/" class="md-nav__link">
        AB Tests
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#imports" class="md-nav__link">
    Imports
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#depenent-variable" class="md-nav__link">
    Depenent Variable
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#independent-variable" class="md-nav__link">
    Independent Variable
  </a>
  
    <nav class="md-nav" aria-label="Independent Variable">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#discrete-features" class="md-nav__link">
    Discrete Features
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#continuous-features" class="md-nav__link">
    Continuous Features
  </a>
  
    <nav class="md-nav" aria-label="Continuous Features">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bootstrapping" class="md-nav__link">
    Bootstrapping
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dependency" class="md-nav__link">
    Dependency
  </a>
  
    <nav class="md-nav" aria-label="Dependency">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#categorical-target" class="md-nav__link">
    Categorical Target
  </a>
  
    <nav class="md-nav" aria-label="Categorical Target">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#categorical-feature" class="md-nav__link">
    Categorical Feature
  </a>
  
    <nav class="md-nav" aria-label="Categorical Feature">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#moods" class="md-nav__link">
    Moods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chi-square" class="md-nav__link">
    Chi-Square
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#categorical-categorical-conclusions" class="md-nav__link">
    Categorical-Categorical Conclusions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#continuous-feature" class="md-nav__link">
    Continuous Feature
  </a>
  
    <nav class="md-nav" aria-label="Continuous Feature">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#t-test" class="md-nav__link">
    t-Test
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#categorical-continuous-conclusions" class="md-nav__link">
    Categorical-Continuous Conclusions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#putting-it-all-together" class="md-nav__link">
    Putting it All Together
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#models-multi-feature-analysis" class="md-nav__link">
    Models (Multi-Feature Analysis)
  </a>
  
    <nav class="md-nav" aria-label="Models (Multi-Feature Analysis)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deciles-random-forest" class="md-nav__link">
    Deciles - Random Forest
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#quartiles-random-forest" class="md-nav__link">
    Quartiles - Random Forest
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#binary-90th-percentile-random-forest" class="md-nav__link">
    Binary, 90th Percentile, Random Forest
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#forward-selection-model" class="md-nav__link">
    Forward Selection Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#binary-99th-percentile" class="md-nav__link">
    Binary, 99th Percentile
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#other-metrics" class="md-nav__link">
    Other Metrics
  </a>
  
    <nav class="md-nav" aria-label="Other Metrics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#listen-and-user-conversions-mau-growing" class="md-nav__link">
    Listen and User Conversions, MAU Growing
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#considering-outliers" class="md-nav__link">
    Considering outliers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multiple-criteria-for-success" class="md-nav__link">
    Multiple Criteria for Success
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dependency_1" class="md-nav__link">
    Dependency
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusions" class="md-nav__link">
    Conclusions
  </a>
  
    <nav class="md-nav" aria-label="Conclusions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#discrete-independent-variables" class="md-nav__link">
    Discrete, Independent Variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#continuous-independent-variables" class="md-nav__link">
    Continuous, Independent Variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#discrete-dependent-variables" class="md-nav__link">
    Discrete, Dependent Variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dependency_2" class="md-nav__link">
    Dependency
  </a>
  
    <nav class="md-nav" aria-label="Dependency">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chi-square_1" class="md-nav__link">
    Chi Square
  </a>
  
    <nav class="md-nav" aria-label="Chi Square">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-is-the-most-influential-primary-genre-on-monthly-streams-over-30-seconds" class="md-nav__link">
    What is the most influential primary genre on monthly streams over 30 seconds?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-is-the-most-influential-primary-mood-on-monthly-streams-over-30-seconds" class="md-nav__link">
    What is the most influential primary mood on monthly streams over 30 seconds?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#which-categorical-feature-is-most-influential-overall" class="md-nav__link">
    Which Categorical Feature is most influential overall?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-are-the-shortcomings-of-this-analysis" class="md-nav__link">
    What are the shortcomings of this analysis?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#t-test_1" class="md-nav__link">
    t-Test
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#models" class="md-nav__link">
    Models
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-simplified-final-approach" class="md-nav__link">
    The simplified, final approach
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                

<h1 id="what-makes-a-playlist-successful">What makes a playlist successful?<a class="headerlink" href="#what-makes-a-playlist-successful" title="Permanent link">&para;</a></h1>
<p><strong>Analysis</strong></p>
<ul>
<li>Simple metric (dependent variable)<ul>
<li>mau_previous_month</li>
<li>mau_both_months</li>
<li>monthly_stream30s</li>
<li>stream30s</li>
</ul>
</li>
<li>Design metric (dependent variable)<ul>
<li>30s listens/tot listens (listen conversions)</li>
<li>Users both months/users prev month (user conversions)</li>
<li>Best small time performers (less than X total monthly listens + high conversion)</li>
<li>Best new user playlist (owner has only 1 popular playlist)</li>
</ul>
</li>
<li>Define "top"<ul>
<li>Top 10%<ul>
<li>mau_previous_month: 9.0</li>
<li>mau_both_months: 2.0</li>
<li>mau: 9.0</li>
<li>monthly_stream30s: 432.0</li>
<li>stream30s: 17.0</li>
</ul>
</li>
<li>Top 1%<ul>
<li>mau_previous_month: 130.0</li>
<li>mau_both_months: 19.0</li>
<li>mau: 143.0</li>
<li>monthly_stream30s: 2843.0</li>
<li>stream30s: 113.0</li>
</ul>
</li>
</ul>
</li>
<li>Independent variables<ul>
<li>moods and genres (categorical)</li>
<li>number of tracks, albums, artists, and local tracks (continuous)</li>
</ul>
</li>
</ul>
<p>The analysis will consist of:</p>
<ol>
<li>understand the distribution characteristics of the dependent and independent variables</li>
<li>quantify the dependency of the dependent/independent variables for each of the simple and design metrics<ol>
<li>chi-square test</li>
<li>bootstrap/t-test</li>
</ol>
</li>
</ol>
<p><strong>Key Conclusions</strong></p>
<p>for the simple metrics, key genres and moods were <strong>Romantic, Latin, Children's, Lively, Traditional, and Jazz</strong>. Playlists that included these genres/moods had a positive multiplier effect (usually in the vicinicty of 2x more likely) on the key simple metric (i.e. playlists with latin as a primary genre were 2.5x more likely to be in the top 10% of streams longer than 30 seconds)</p>
<p>skippers - is this associated with the current playlist </p>
<table>
<thead>
<tr>
<th>Column Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>playlist_uri</td>
<td>The key, Spotify uri of the playlist</td>
</tr>
<tr>
<td>owner</td>
<td>Playlist owner, Spotify username</td>
</tr>
<tr>
<td>streams</td>
<td>Number of streams from the playlist today</td>
</tr>
<tr>
<td>stream30s</td>
<td>Number of streams over 30 seconds from playlist today</td>
</tr>
<tr>
<td>dau</td>
<td>Number of Daily Active Users, i.e. users with a stream over 30 seconds from playlist today</td>
</tr>
<tr>
<td>wau</td>
<td>Number of Weekly Active Users, i.e. users with a stream over 30 seconds from playlist in past week</td>
</tr>
<tr>
<td>mau</td>
<td>Number of Monthly Active Users, i.e. users with a stream over 30 seconds from playlist in the past month</td>
</tr>
<tr>
<td>mau_previous_months</td>
<td>Number of Monthly Active users in the month prior to this one</td>
</tr>
<tr>
<td>mau_both_months</td>
<td>Number of users that were active on the playlist both this and the previous month</td>
</tr>
<tr>
<td>users</td>
<td>Number of users streaming (all streams) from this playlist this month</td>
</tr>
<tr>
<td>skippers</td>
<td>Number of users who skipped more than 90 percent of their streams today</td>
</tr>
<tr>
<td>owner_country</td>
<td>Country of the playlist owner</td>
</tr>
<tr>
<td>n_tracks</td>
<td>Number of tracks in playlist</td>
</tr>
<tr>
<td>n_local_tracks</td>
<td>Change in number of tracks on playlist since yesterday</td>
</tr>
<tr>
<td>n_artists</td>
<td>Number of unique artists in playlist</td>
</tr>
<tr>
<td>n_albums</td>
<td>Number of unique albums in playlist</td>
</tr>
<tr>
<td>monthly_stream30s</td>
<td>Number of streams over 30 seconds this month</td>
</tr>
<tr>
<td>monthly_owner_stream30s</td>
<td>Number of streams over 30 seconds by playlist owner this month</td>
</tr>
<tr>
<td>tokens</td>
<td>List of playlist title tokens, stopwords and punctuation removed</td>
</tr>
<tr>
<td>genre_1</td>
<td>No. 1 Genre by weight of playlist tracks, from Gracenote metadata</td>
</tr>
<tr>
<td>genre_2</td>
<td>No. 2 Genre by weight of playlist tracks, from Gracenote metadata</td>
</tr>
<tr>
<td>genre_3</td>
<td>No. 3 Genre by weight of playlist tracks, from Gracenote metadata</td>
</tr>
<tr>
<td>mood_1</td>
<td>No. 1 Mood by weight of playlist tracks, from Gracenote metadata</td>
</tr>
<tr>
<td>mood_2</td>
<td>No. 2 Mood by weight of playlist tracks, from Gracenote metadata</td>
</tr>
<tr>
<td>mood_3</td>
<td>No. 3 Mood by weight of playlist tracks, from Gracenote metadata</td>
</tr>
</tbody>
</table>
<h2 id="imports">Imports<a class="headerlink" href="#imports" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><code><span class="c1"># basic packages</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_columns&#39;</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">copy</span>

<span class="c1"># visualization packages</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span><span class="p">;</span> <span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
<span class="kn">import</span> <span class="nn">graphviz</span> 

<span class="c1"># stats packages</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">stats</span>
<span class="kn">from</span> <span class="nn">scipy.spatial.distance</span> <span class="kn">import</span> <span class="n">cdist</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="kn">from</span> <span class="nn">statsmodels.formula.api</span> <span class="kn">import</span> <span class="n">ols</span>
<span class="kn">from</span> <span class="nn">statsmodels.discrete.discrete_model</span> <span class="kn">import</span> <span class="n">Logit</span>
<span class="kn">from</span> <span class="nn">statsmodels.stats.outliers_influence</span> <span class="kn">import</span> <span class="n">variance_inflation_factor</span>

<span class="c1"># sklearn preprocessing</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">OneHotEncoder</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">PolynomialFeatures</span>
<span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>
<span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">SimpleImputer</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">make_pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.utils.class_weight</span> <span class="kn">import</span> <span class="n">compute_class_weight</span>

<span class="c1"># sklearn modeling</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span><span class="p">,</span> <span class="n">RandomForestRegressor</span><span class="p">,</span> <span class="n">AdaBoostClassifier</span><span class="p">,</span> <span class="n">GradientBoostingClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span><span class="p">,</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.mixture</span> <span class="kn">import</span> <span class="n">GaussianMixture</span>

<span class="c1"># sklearn evaluation</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">r2_score</span><span class="p">,</span> <span class="n">accuracy_score</span><span class="p">,</span> <span class="n">classification_report</span><span class="p">,</span> <span class="n">confusion_matrix</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span><span class="p">,</span> <span class="n">cross_val_score</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../../data/playlist_summary_external-4.txt&quot;</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>playlist_uri</th>
      <th>owner</th>
      <th>streams</th>
      <th>stream30s</th>
      <th>dau</th>
      <th>wau</th>
      <th>mau</th>
      <th>mau_previous_month</th>
      <th>mau_both_months</th>
      <th>users</th>
      <th>skippers</th>
      <th>owner_country</th>
      <th>n_tracks</th>
      <th>n_local_tracks</th>
      <th>n_artists</th>
      <th>n_albums</th>
      <th>monthly_stream30s</th>
      <th>monthly_owner_stream30s</th>
      <th>tokens</th>
      <th>genre_1</th>
      <th>genre_2</th>
      <th>genre_3</th>
      <th>mood_1</th>
      <th>mood_2</th>
      <th>mood_3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>spotify:user:36069af6af076ccd9e597184a67b68c9:...</td>
      <td>36069af6af076ccd9e597184a67b68c9</td>
      <td>27</td>
      <td>27</td>
      <td>1</td>
      <td>1</td>
      <td>3</td>
      <td>3</td>
      <td>0</td>
      <td>8</td>
      <td>0</td>
      <td>US</td>
      <td>52</td>
      <td>0</td>
      <td>4</td>
      <td>7</td>
      <td>30</td>
      <td>27</td>
      <td>["ambient", "music", "therapy", "binaural", "b...</td>
      <td>Dance &amp; House</td>
      <td>New Age</td>
      <td>Country &amp; Folk</td>
      <td>Peaceful</td>
      <td>Romantic</td>
      <td>Somber</td>
    </tr>
    <tr>
      <th>1</th>
      <td>spotify:user:d1144a65b1c31c5f9f56b94f831124d5:...</td>
      <td>d1144a65b1c31c5f9f56b94f831124d5</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>2</td>
      <td>1</td>
      <td>1</td>
      <td>3</td>
      <td>0</td>
      <td>US</td>
      <td>131</td>
      <td>0</td>
      <td>112</td>
      <td>113</td>
      <td>112</td>
      <td>94</td>
      <td>["good", "living"]</td>
      <td>Pop</td>
      <td>Indie Rock</td>
      <td>Alternative</td>
      <td>Excited</td>
      <td>Yearning</td>
      <td>Defiant</td>
    </tr>
    <tr>
      <th>2</th>
      <td>spotify:user:6b7fbed9edd6418ddd3b555bba441536:...</td>
      <td>6b7fbed9edd6418ddd3b555bba441536</td>
      <td>4</td>
      <td>2</td>
      <td>1</td>
      <td>1</td>
      <td>7</td>
      <td>5</td>
      <td>0</td>
      <td>15</td>
      <td>0</td>
      <td>US</td>
      <td>43</td>
      <td>0</td>
      <td>35</td>
      <td>36</td>
      <td>63</td>
      <td>0</td>
      <td>["norte\u00f1a"]</td>
      <td>Latin</td>
      <td>-</td>
      <td>-</td>
      <td>Lively</td>
      <td>Upbeat</td>
      <td>Romantic</td>
    </tr>
    <tr>
      <th>3</th>
      <td>spotify:user:580b98725077a94c3c8d01d07390426b:...</td>
      <td>580b98725077a94c3c8d01d07390426b</td>
      <td>12</td>
      <td>12</td>
      <td>1</td>
      <td>1</td>
      <td>4</td>
      <td>6</td>
      <td>1</td>
      <td>10</td>
      <td>0</td>
      <td>US</td>
      <td>27</td>
      <td>1</td>
      <td>27</td>
      <td>26</td>
      <td>154</td>
      <td>108</td>
      <td>[]</td>
      <td>Dance &amp; House</td>
      <td>Electronica</td>
      <td>Pop</td>
      <td>Excited</td>
      <td>Aggressive</td>
      <td>Defiant</td>
    </tr>
    <tr>
      <th>4</th>
      <td>spotify:user:1305d39070c95d161cc502e15014897d:...</td>
      <td>1305d39070c95d161cc502e15014897d</td>
      <td>20</td>
      <td>4</td>
      <td>1</td>
      <td>1</td>
      <td>2</td>
      <td>1</td>
      <td>1</td>
      <td>2</td>
      <td>1</td>
      <td>US</td>
      <td>52</td>
      <td>0</td>
      <td>47</td>
      <td>51</td>
      <td>230</td>
      <td>0</td>
      <td>["cheesy", "pants"]</td>
      <td>Indie Rock</td>
      <td>Alternative</td>
      <td>Electronica</td>
      <td>Excited</td>
      <td>Defiant</td>
      <td>Yearning</td>
    </tr>
  </tbody>
</table>
</div>

<div class="codehilite"><pre><span></span><code><span class="n">df</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>playlist_uri</th>
      <th>owner</th>
      <th>streams</th>
      <th>stream30s</th>
      <th>dau</th>
      <th>wau</th>
      <th>mau</th>
      <th>mau_previous_month</th>
      <th>mau_both_months</th>
      <th>users</th>
      <th>skippers</th>
      <th>owner_country</th>
      <th>n_tracks</th>
      <th>n_local_tracks</th>
      <th>n_artists</th>
      <th>n_albums</th>
      <th>monthly_stream30s</th>
      <th>monthly_owner_stream30s</th>
      <th>tokens</th>
      <th>genre_1</th>
      <th>genre_2</th>
      <th>genre_3</th>
      <th>mood_1</th>
      <th>mood_2</th>
      <th>mood_3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>403361</th>
      <td>spotify:user:4672952d42bdd93b9215ce9a40394ea6:...</td>
      <td>4672952d42bdd93b9215ce9a40394ea6</td>
      <td>18</td>
      <td>6</td>
      <td>2</td>
      <td>6</td>
      <td>13</td>
      <td>12</td>
      <td>8</td>
      <td>20</td>
      <td>1</td>
      <td>US</td>
      <td>48</td>
      <td>0</td>
      <td>44</td>
      <td>48</td>
      <td>464</td>
      <td>43</td>
      <td>["discover", "mix"]</td>
      <td>Indie Rock</td>
      <td>Alternative</td>
      <td>Dance &amp; House</td>
      <td>Excited</td>
      <td>Yearning</td>
      <td>Energizing</td>
    </tr>
    <tr>
      <th>403362</th>
      <td>spotify:user:28c4378e099b4843f5dd42bb848c78ea:...</td>
      <td>28c4378e099b4843f5dd42bb848c78ea</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>2</td>
      <td>1</td>
      <td>1</td>
      <td>3</td>
      <td>0</td>
      <td>US</td>
      <td>182</td>
      <td>27</td>
      <td>114</td>
      <td>129</td>
      <td>44</td>
      <td>14</td>
      <td>["ambient", "study", "music"]</td>
      <td>Electronica</td>
      <td>Dance &amp; House</td>
      <td>Rap</td>
      <td>Sensual</td>
      <td>Excited</td>
      <td>Brooding</td>
    </tr>
    <tr>
      <th>403363</th>
      <td>spotify:user:1c54302dc7e610a10c51eed81e26a168:...</td>
      <td>1c54302dc7e610a10c51eed81e26a168</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>2</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>2</td>
      <td>0</td>
      <td>US</td>
      <td>36</td>
      <td>0</td>
      <td>16</td>
      <td>15</td>
      <td>82</td>
      <td>80</td>
      <td>["october"]</td>
      <td>Rap</td>
      <td>Indie Rock</td>
      <td>Alternative</td>
      <td>Brooding</td>
      <td>Defiant</td>
      <td>Sophisticated</td>
    </tr>
    <tr>
      <th>403364</th>
      <td>spotify:user:adc973443cdf1abecdfb4244e530d451:...</td>
      <td>adc973443cdf1abecdfb4244e530d451</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>2</td>
      <td>0</td>
      <td>US</td>
      <td>50</td>
      <td>0</td>
      <td>25</td>
      <td>25</td>
      <td>2</td>
      <td>0</td>
      <td>[]</td>
      <td>Rap</td>
      <td>R&amp;B</td>
      <td>Latin</td>
      <td>Defiant</td>
      <td>Energizing</td>
      <td>Aggressive</td>
    </tr>
    <tr>
      <th>403365</th>
      <td>spotify:user:b3752c94e387192b7950b687453bcf45:...</td>
      <td>b3752c94e387192b7950b687453bcf45</td>
      <td>74</td>
      <td>16</td>
      <td>1</td>
      <td>1</td>
      <td>2</td>
      <td>1</td>
      <td>1</td>
      <td>3</td>
      <td>1</td>
      <td>US</td>
      <td>348</td>
      <td>10</td>
      <td>281</td>
      <td>290</td>
      <td>216</td>
      <td>178</td>
      <td>["eclecticism"]</td>
      <td>Rap</td>
      <td>Rock</td>
      <td>Alternative</td>
      <td>Defiant</td>
      <td>Energizing</td>
      <td>Cool</td>
    </tr>
  </tbody>
</table>
</div>

<div class="codehilite"><pre><span></span><code><span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>playlist_uri</th>
      <th>owner</th>
      <th>streams</th>
      <th>stream30s</th>
      <th>dau</th>
      <th>wau</th>
      <th>mau</th>
      <th>mau_previous_month</th>
      <th>mau_both_months</th>
      <th>users</th>
      <th>skippers</th>
      <th>owner_country</th>
      <th>n_tracks</th>
      <th>n_local_tracks</th>
      <th>n_artists</th>
      <th>n_albums</th>
      <th>monthly_stream30s</th>
      <th>monthly_owner_stream30s</th>
      <th>tokens</th>
      <th>genre_1</th>
      <th>genre_2</th>
      <th>genre_3</th>
      <th>mood_1</th>
      <th>mood_2</th>
      <th>mood_3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>152032</th>
      <td>spotify:user:spotify:playlist:5FJXhjdILmRA2z5b...</td>
      <td>spotify</td>
      <td>2527075</td>
      <td>1461324</td>
      <td>152929</td>
      <td>669966</td>
      <td>1944150</td>
      <td>1478684</td>
      <td>578391</td>
      <td>3455406</td>
      <td>86162</td>
      <td>US</td>
      <td>51</td>
      <td>0</td>
      <td>51</td>
      <td>51</td>
      <td>42497334</td>
      <td>22</td>
      <td>["top", "hits"]</td>
      <td>Pop</td>
      <td>R&amp;B</td>
      <td>Dance &amp; House</td>
      <td>Excited</td>
      <td>Cool</td>
      <td>Brooding</td>
    </tr>
    <tr>
      <th>163726</th>
      <td>spotify:user:spotify:playlist:4hOKQuZbraPDIfaG...</td>
      <td>spotify</td>
      <td>2629715</td>
      <td>1513237</td>
      <td>122005</td>
      <td>514627</td>
      <td>1453097</td>
      <td>970905</td>
      <td>364140</td>
      <td>2448881</td>
      <td>56707</td>
      <td>US</td>
      <td>100</td>
      <td>0</td>
      <td>93</td>
      <td>86</td>
      <td>40722305</td>
      <td>0</td>
      <td>["top", "tracks", "currently", "spotify"]</td>
      <td>Pop</td>
      <td>Dance &amp; House</td>
      <td>Indie Rock</td>
      <td>Excited</td>
      <td>Defiant</td>
      <td>Energizing</td>
    </tr>
    <tr>
      <th>216752</th>
      <td>spotify:user:spotify:playlist:3ZgmfR6lsnCwdffZ...</td>
      <td>spotify</td>
      <td>735281</td>
      <td>348391</td>
      <td>43498</td>
      <td>219817</td>
      <td>688999</td>
      <td>365968</td>
      <td>109688</td>
      <td>1233952</td>
      <td>34145</td>
      <td>US</td>
      <td>100</td>
      <td>0</td>
      <td>100</td>
      <td>99</td>
      <td>9879201</td>
      <td>0</td>
      <td>["top", "pop", "tracks", "spotify"]</td>
      <td>Pop</td>
      <td>R&amp;B</td>
      <td>Rap</td>
      <td>Excited</td>
      <td>Defiant</td>
      <td>Empowering</td>
    </tr>
    <tr>
      <th>401060</th>
      <td>spotify:user:spotify:playlist:3MlpudZs4HT3i0yG...</td>
      <td>spotify</td>
      <td>505876</td>
      <td>245377</td>
      <td>33152</td>
      <td>121173</td>
      <td>430129</td>
      <td>339921</td>
      <td>79443</td>
      <td>973788</td>
      <td>23846</td>
      <td>US</td>
      <td>43</td>
      <td>0</td>
      <td>41</td>
      <td>42</td>
      <td>5567649</td>
      <td>44</td>
      <td>["teen", "party"]</td>
      <td>Pop</td>
      <td>R&amp;B</td>
      <td>Rap</td>
      <td>Excited</td>
      <td>Yearning</td>
      <td>Urgent</td>
    </tr>
    <tr>
      <th>307283</th>
      <td>spotify:user:spotify:playlist:04MJzJlzOoy5bTyt...</td>
      <td>spotify</td>
      <td>252309</td>
      <td>124903</td>
      <td>16480</td>
      <td>68518</td>
      <td>278966</td>
      <td>448102</td>
      <td>75371</td>
      <td>917174</td>
      <td>11888</td>
      <td>US</td>
      <td>296</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>4178965</td>
      <td>8</td>
      <td>["dance", "mega", "mix"]</td>
      <td>Dance &amp; House</td>
      <td>Electronica</td>
      <td>Pop</td>
      <td>Excited</td>
      <td>Aggressive</td>
      <td>Energizing</td>
    </tr>
  </tbody>
</table>
</div>

<div class="codehilite"><pre><span></span><code><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">403361</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>&#39;spotify:user:4672952d42bdd93b9215ce9a40394ea6:playlist:6W45lqDBZ1TKma71Uu2F5x&#39;
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">df</span><span class="o">.</span><span class="n">columns</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>Index([&#39;playlist_uri&#39;, &#39;owner&#39;, &#39;streams&#39;, &#39;stream30s&#39;, &#39;dau&#39;, &#39;wau&#39;, &#39;mau&#39;,
       &#39;mau_previous_month&#39;, &#39;mau_both_months&#39;, &#39;users&#39;, &#39;skippers&#39;,
       &#39;owner_country&#39;, &#39;n_tracks&#39;, &#39;n_local_tracks&#39;, &#39;n_artists&#39;, &#39;n_albums&#39;,
       &#39;monthly_stream30s&#39;, &#39;monthly_owner_stream30s&#39;, &#39;tokens&#39;, &#39;genre_1&#39;,
       &#39;genre_2&#39;, &#39;genre_3&#39;, &#39;mood_1&#39;, &#39;mood_2&#39;, &#39;mood_3&#39;],
      dtype=&#39;object&#39;)
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="nb">id</span> <span class="o">=</span> <span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
<span class="n">targets</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">11</span><span class="p">])</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;monthly_stream30s&quot;</span><span class="p">,</span> <span class="s2">&quot;monthly_owner_stream30s&quot;</span><span class="p">]</span>
<span class="n">features</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">targets</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
<span class="n">features</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;id columns: </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;target columns: </span><span class="si">{</span><span class="n">targets</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;feature columns: </span><span class="si">{</span><span class="n">features</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>id columns: [&#39;playlist_uri&#39;, &#39;owner&#39;]
target columns: [&#39;streams&#39;, &#39;stream30s&#39;, &#39;dau&#39;, &#39;wau&#39;, &#39;mau&#39;, &#39;mau_previous_month&#39;, &#39;mau_both_months&#39;, &#39;users&#39;, &#39;skippers&#39;, &#39;monthly_stream30s&#39;, &#39;monthly_owner_stream30s&#39;]
feature columns: [&#39;n_albums&#39;, &#39;n_artists&#39;, &#39;mood_1&#39;, &#39;n_tracks&#39;, &#39;mood_3&#39;, &#39;genre_1&#39;, &#39;genre_2&#39;, &#39;genre_3&#39;, &#39;tokens&#39;, &#39;owner_country&#39;, &#39;n_local_tracks&#39;, &#39;mood_2&#39;]
</code></pre></div>

<p><code>stream30s</code>, <code>dau</code>, <code>wau</code>, <code>mau</code>, <code>monthly_stream30s</code>, <code>monthly_owner_stream30s</code>, <code>mau_previous_months</code> and <code>mau_both_months</code> are all specifically for users who have streamed the playlist for over 30 seconds</p>
<p>Let's make the north star metric</p>
<ul>
<li><code>mau_previous_month</code> - tells us how many users have streamed over 30 seconds from the playlist this past month<ul>
<li><strong>downside</strong>: since we don't know when the playlist was created, we may falsely label some playlists as having low rate of success</li>
</ul>
</li>
</ul>
<p>Let's make a guardrail metric</p>
<ul>
<li>
<p><code>mau_both_months</code> - tells us if the playlist has replay value</p>
<ul>
<li><strong>downside</strong>: since we don't know when the playlist was created, we don't know at what stage the playlist is in its lifetime, i.e. do users fall off from months 1-2 or months 10-11</li>
</ul>
</li>
<li>
<p><code>stream30s</code> - number of streams over 30 seconds today; tells us demand of playlist unormalized by number of users accessing the stream (i.e. some users will stream multiple times)</p>
<ul>
<li><strong>downside</strong> - a few users can dominate the overall number of listens</li>
</ul>
</li>
<li>
<p><code>monthly_stream30s</code> - number of streams over 30 seconds for the month; will give us a longer term comparison between streams</p>
<ul>
<li><strong>downside</strong> - playlists created at some point in the month will be compared unequally</li>
</ul>
</li>
</ul>
<p>Secondary metric</p>
<ul>
<li><code>monthly_owner_stream30s</code> - tells us if the owner or the playlist is significant in making a successful playlist; semi-feature column</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="n">sub_targets</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;mau_previous_month&#39;</span><span class="p">,</span> <span class="s1">&#39;mau_both_months&#39;</span><span class="p">,</span>  <span class="s1">&#39;mau&#39;</span><span class="p">,</span> <span class="s1">&#39;monthly_stream30s&#39;</span><span class="p">,</span> <span class="s1">&#39;stream30s&#39;</span><span class="p">]</span>
</code></pre></div>

<h2 id="depenent-variable">Depenent Variable<a class="headerlink" href="#depenent-variable" title="Permanent link">&para;</a></h2>
<p>it looks like <code>mau</code> may be from an incomplete month (comparing the frequency to <code>mau_previous_months</code>)</p>
<div class="codehilite"><pre><span></span><code><span class="n">df</span><span class="p">[</span><span class="n">targets</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>streams</th>
      <th>stream30s</th>
      <th>dau</th>
      <th>wau</th>
      <th>mau</th>
      <th>mau_previous_month</th>
      <th>mau_both_months</th>
      <th>users</th>
      <th>skippers</th>
      <th>monthly_stream30s</th>
      <th>monthly_owner_stream30s</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>streams</th>
      <td>1.000000</td>
      <td>0.994380</td>
      <td>0.988381</td>
      <td>0.967860</td>
      <td>0.958000</td>
      <td>0.905523</td>
      <td>0.957998</td>
      <td>0.911023</td>
      <td>0.948062</td>
      <td>0.984383</td>
      <td>-0.001338</td>
    </tr>
    <tr>
      <th>stream30s</th>
      <td>0.994380</td>
      <td>1.000000</td>
      <td>0.985062</td>
      <td>0.968307</td>
      <td>0.957810</td>
      <td>0.908967</td>
      <td>0.956223</td>
      <td>0.912391</td>
      <td>0.937712</td>
      <td>0.992060</td>
      <td>-0.000767</td>
    </tr>
    <tr>
      <th>dau</th>
      <td>0.988381</td>
      <td>0.985062</td>
      <td>1.000000</td>
      <td>0.986290</td>
      <td>0.981306</td>
      <td>0.938572</td>
      <td>0.975665</td>
      <td>0.946317</td>
      <td>0.980372</td>
      <td>0.980044</td>
      <td>-0.003330</td>
    </tr>
    <tr>
      <th>wau</th>
      <td>0.967860</td>
      <td>0.968307</td>
      <td>0.986290</td>
      <td>1.000000</td>
      <td>0.995568</td>
      <td>0.957752</td>
      <td>0.974101</td>
      <td>0.970788</td>
      <td>0.976330</td>
      <td>0.978300</td>
      <td>-0.004150</td>
    </tr>
    <tr>
      <th>mau</th>
      <td>0.958000</td>
      <td>0.957810</td>
      <td>0.981306</td>
      <td>0.995568</td>
      <td>1.000000</td>
      <td>0.969613</td>
      <td>0.969983</td>
      <td>0.983961</td>
      <td>0.980052</td>
      <td>0.970658</td>
      <td>-0.004432</td>
    </tr>
    <tr>
      <th>mau_previous_month</th>
      <td>0.905523</td>
      <td>0.908967</td>
      <td>0.938572</td>
      <td>0.957752</td>
      <td>0.969613</td>
      <td>1.000000</td>
      <td>0.954992</td>
      <td>0.990228</td>
      <td>0.943692</td>
      <td>0.931162</td>
      <td>-0.004802</td>
    </tr>
    <tr>
      <th>mau_both_months</th>
      <td>0.957998</td>
      <td>0.956223</td>
      <td>0.975665</td>
      <td>0.974101</td>
      <td>0.969983</td>
      <td>0.954992</td>
      <td>1.000000</td>
      <td>0.942426</td>
      <td>0.951045</td>
      <td>0.971727</td>
      <td>-0.003219</td>
    </tr>
    <tr>
      <th>users</th>
      <td>0.911023</td>
      <td>0.912391</td>
      <td>0.946317</td>
      <td>0.970788</td>
      <td>0.983961</td>
      <td>0.990228</td>
      <td>0.942426</td>
      <td>1.000000</td>
      <td>0.963877</td>
      <td>0.931219</td>
      <td>-0.005115</td>
    </tr>
    <tr>
      <th>skippers</th>
      <td>0.948062</td>
      <td>0.937712</td>
      <td>0.980372</td>
      <td>0.976330</td>
      <td>0.980052</td>
      <td>0.943692</td>
      <td>0.951045</td>
      <td>0.963877</td>
      <td>1.000000</td>
      <td>0.935228</td>
      <td>-0.004150</td>
    </tr>
    <tr>
      <th>monthly_stream30s</th>
      <td>0.984383</td>
      <td>0.992060</td>
      <td>0.980044</td>
      <td>0.978300</td>
      <td>0.970658</td>
      <td>0.931162</td>
      <td>0.971727</td>
      <td>0.931219</td>
      <td>0.935228</td>
      <td>1.000000</td>
      <td>-0.000519</td>
    </tr>
    <tr>
      <th>monthly_owner_stream30s</th>
      <td>-0.001338</td>
      <td>-0.000767</td>
      <td>-0.003330</td>
      <td>-0.004150</td>
      <td>-0.004432</td>
      <td>-0.004802</td>
      <td>-0.003219</td>
      <td>-0.005115</td>
      <td>-0.004150</td>
      <td>-0.000519</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
</div>

<div class="codehilite"><pre><span></span><code><span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;mau&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;mau_previous_month&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>&lt;AxesSubplot:xlabel=&#39;mau&#39;&gt;
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_17_1.png" /></p>
<div class="codehilite"><pre><span></span><code><span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;mau&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;dau&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>&lt;AxesSubplot:xlabel=&#39;mau&#39;&gt;
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_18_1.png" /></p>
<div class="codehilite"><pre><span></span><code><span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;mau&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;wau&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>&lt;AxesSubplot:xlabel=&#39;mau&#39;&gt;
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_19_1.png" /></p>
<div class="codehilite"><pre><span></span><code><span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;mau&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;stream30s&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>&lt;AxesSubplot:xlabel=&#39;mau&#39;&gt;
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_20_1.png" /></p>
<div class="codehilite"><pre><span></span><code><span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;stream30s&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;monthly_owner_stream30s&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>&lt;AxesSubplot:xlabel=&#39;stream30s&#39;&gt;
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_21_1.png" /></p>
<div class="codehilite"><pre><span></span><code><span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;stream30s&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;skippers&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>&lt;AxesSubplot:xlabel=&#39;stream30s&#39;&gt;
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_22_1.png" /></p>
<div class="codehilite"><pre><span></span><code>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">quant</span> <span class="o">=</span> <span class="mf">0.99</span>
<span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">targets</span><span class="p">:</span>
    <span class="n">cutoff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">target</span><span class="p">],</span> <span class="n">quant</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">cutoff</span><span class="p">]</span>
    <span class="n">y</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;hist&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_24_0.png" /></p>
<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_24_1.png" /></p>
<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_24_2.png" /></p>
<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_24_3.png" /></p>
<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_24_4.png" /></p>
<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_24_5.png" /></p>
<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_24_6.png" /></p>
<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_24_7.png" /></p>
<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_24_8.png" /></p>
<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_24_9.png" /></p>
<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_24_10.png" /></p>
<div class="codehilite"><pre><span></span><code><span class="n">quant</span> <span class="o">=</span> <span class="mf">0.997</span>
<span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">sub_targets</span><span class="p">:</span>
    <span class="n">cutoff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">target</span><span class="p">],</span> <span class="n">quant</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">cutoff</span><span class="p">]</span>
    <span class="n">removed</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">cutoff</span><span class="p">)]</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;removed items: </span><span class="si">{</span><span class="n">removed</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">y</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;hist&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>removed items: 1212
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_25_1.png" /></p>
<div class="codehilite"><pre><span></span><code>removed items: 1216
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_25_3.png" /></p>
<div class="codehilite"><pre><span></span><code>removed items: 1211
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_25_5.png" /></p>
<div class="codehilite"><pre><span></span><code>removed items: 1211
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_25_7.png" /></p>
<div class="codehilite"><pre><span></span><code><span class="n">df</span><span class="p">[</span><span class="n">sub_targets</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mau_previous_month</th>
      <th>mau_both_months</th>
      <th>monthly_stream30s</th>
      <th>stream30s</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>4.033660e+05</td>
      <td>403366.000000</td>
      <td>4.033660e+05</td>
      <td>4.033660e+05</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>5.819009e+01</td>
      <td>12.937065</td>
      <td>1.260489e+03</td>
      <td>4.283333e+01</td>
    </tr>
    <tr>
      <th>std</th>
      <td>3.827248e+03</td>
      <td>1240.912979</td>
      <td>1.062463e+05</td>
      <td>3.772412e+03</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.000000e+00</td>
      <td>0.000000</td>
      <td>2.000000e+00</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>1.000000e+00</td>
      <td>1.000000</td>
      <td>3.100000e+01</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>2.000000e+00</td>
      <td>1.000000</td>
      <td>7.900000e+01</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>3.000000e+00</td>
      <td>2.000000</td>
      <td>1.930000e+02</td>
      <td>5.000000e+00</td>
    </tr>
    <tr>
      <th>max</th>
      <td>1.478684e+06</td>
      <td>578391.000000</td>
      <td>4.249733e+07</td>
      <td>1.513237e+06</td>
    </tr>
  </tbody>
</table>
</div>

<h2 id="independent-variable">Independent Variable<a class="headerlink" href="#independent-variable" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><code><span class="n">features</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>[&#39;n_albums&#39;,
 &#39;n_artists&#39;,
 &#39;mood_1&#39;,
 &#39;n_tracks&#39;,
 &#39;mood_3&#39;,
 &#39;genre_1&#39;,
 &#39;genre_2&#39;,
 &#39;genre_3&#39;,
 &#39;tokens&#39;,
 &#39;owner_country&#39;,
 &#39;n_local_tracks&#39;,
 &#39;mood_2&#39;]
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">df</span><span class="p">[</span><span class="n">features</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>n_albums</th>
      <th>n_artists</th>
      <th>mood_1</th>
      <th>n_tracks</th>
      <th>mood_3</th>
      <th>genre_1</th>
      <th>genre_2</th>
      <th>genre_3</th>
      <th>tokens</th>
      <th>owner_country</th>
      <th>n_local_tracks</th>
      <th>mood_2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>7</td>
      <td>4</td>
      <td>Peaceful</td>
      <td>52</td>
      <td>Somber</td>
      <td>Dance &amp; House</td>
      <td>New Age</td>
      <td>Country &amp; Folk</td>
      <td>["ambient", "music", "therapy", "binaural", "b...</td>
      <td>US</td>
      <td>0</td>
      <td>Romantic</td>
    </tr>
    <tr>
      <th>1</th>
      <td>113</td>
      <td>112</td>
      <td>Excited</td>
      <td>131</td>
      <td>Defiant</td>
      <td>Pop</td>
      <td>Indie Rock</td>
      <td>Alternative</td>
      <td>["good", "living"]</td>
      <td>US</td>
      <td>0</td>
      <td>Yearning</td>
    </tr>
    <tr>
      <th>2</th>
      <td>36</td>
      <td>35</td>
      <td>Lively</td>
      <td>43</td>
      <td>Romantic</td>
      <td>Latin</td>
      <td>-</td>
      <td>-</td>
      <td>["norte\u00f1a"]</td>
      <td>US</td>
      <td>0</td>
      <td>Upbeat</td>
    </tr>
    <tr>
      <th>3</th>
      <td>26</td>
      <td>27</td>
      <td>Excited</td>
      <td>27</td>
      <td>Defiant</td>
      <td>Dance &amp; House</td>
      <td>Electronica</td>
      <td>Pop</td>
      <td>[]</td>
      <td>US</td>
      <td>1</td>
      <td>Aggressive</td>
    </tr>
    <tr>
      <th>4</th>
      <td>51</td>
      <td>47</td>
      <td>Excited</td>
      <td>52</td>
      <td>Yearning</td>
      <td>Indie Rock</td>
      <td>Alternative</td>
      <td>Electronica</td>
      <td>["cheesy", "pants"]</td>
      <td>US</td>
      <td>0</td>
      <td>Defiant</td>
    </tr>
  </tbody>
</table>
</div>

<div class="codehilite"><pre><span></span><code>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">con_features</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">features</span><span class="p">]</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="s1">&#39;number&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">con_features</span><span class="p">)</span>
<span class="n">des_features</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">features</span><span class="p">]</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="s1">&#39;object&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">des_features</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>[&#39;n_albums&#39;, &#39;n_artists&#39;, &#39;n_tracks&#39;, &#39;n_local_tracks&#39;]
[&#39;mood_1&#39;, &#39;mood_3&#39;, &#39;genre_1&#39;, &#39;genre_2&#39;, &#39;genre_3&#39;, &#39;tokens&#39;, &#39;owner_country&#39;, &#39;mood_2&#39;]
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">df</span><span class="p">[</span><span class="n">des_features</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mood_1</th>
      <th>mood_3</th>
      <th>genre_1</th>
      <th>genre_2</th>
      <th>genre_3</th>
      <th>tokens</th>
      <th>owner_country</th>
      <th>mood_2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>403366</td>
      <td>403366</td>
      <td>403366</td>
      <td>403366</td>
      <td>403366</td>
      <td>403366</td>
      <td>403366</td>
      <td>403366</td>
    </tr>
    <tr>
      <th>unique</th>
      <td>27</td>
      <td>27</td>
      <td>26</td>
      <td>26</td>
      <td>26</td>
      <td>192107</td>
      <td>1</td>
      <td>27</td>
    </tr>
    <tr>
      <th>top</th>
      <td>Defiant</td>
      <td>Energizing</td>
      <td>Indie Rock</td>
      <td>Alternative</td>
      <td>Pop</td>
      <td>[]</td>
      <td>US</td>
      <td>Energizing</td>
    </tr>
    <tr>
      <th>freq</th>
      <td>81079</td>
      <td>56450</td>
      <td>70571</td>
      <td>66252</td>
      <td>78758</td>
      <td>32568</td>
      <td>403366</td>
      <td>51643</td>
    </tr>
  </tbody>
</table>
</div>

<p>we will go ahead and remove <code>owner_country</code> (1 unique), <code>owner</code>, and <code>tokens</code> (cardinal) from our feature analysis</p>
<div class="codehilite"><pre><span></span><code><span class="nb">id</span> <span class="o">=</span> <span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
<span class="n">targets</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">11</span><span class="p">])</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;monthly_stream30s&quot;</span><span class="p">,</span> <span class="s2">&quot;monthly_owner_stream30s&quot;</span><span class="p">]</span>
<span class="n">features</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">targets</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">([</span><span class="s2">&quot;owner_country&quot;</span><span class="p">,</span> <span class="s2">&quot;owner&quot;</span><span class="p">,</span> <span class="s2">&quot;tokens&quot;</span><span class="p">])</span>
<span class="n">features</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;id columns: </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;target columns: </span><span class="si">{</span><span class="n">targets</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;feature columns: </span><span class="si">{</span><span class="n">features</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">con_features</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">features</span><span class="p">]</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="s1">&#39;number&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">con_features</span><span class="p">)</span>
<span class="n">des_features</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;mood_1&#39;</span><span class="p">,</span> <span class="s1">&#39;mood_2&#39;</span><span class="p">,</span> <span class="s1">&#39;mood_3&#39;</span><span class="p">,</span> <span class="s1">&#39;genre_1&#39;</span><span class="p">,</span> <span class="s1">&#39;genre_2&#39;</span><span class="p">,</span> <span class="s1">&#39;genre_3&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">des_features</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>id columns: [&#39;playlist_uri&#39;]
target columns: [&#39;streams&#39;, &#39;stream30s&#39;, &#39;dau&#39;, &#39;wau&#39;, &#39;mau&#39;, &#39;mau_previous_month&#39;, &#39;mau_both_months&#39;, &#39;users&#39;, &#39;skippers&#39;, &#39;monthly_stream30s&#39;, &#39;monthly_owner_stream30s&#39;]
feature columns: [&#39;n_albums&#39;, &#39;mood_1&#39;, &#39;n_artists&#39;, &#39;n_tracks&#39;, &#39;mood_3&#39;, &#39;genre_1&#39;, &#39;genre_2&#39;, &#39;genre_3&#39;, &#39;n_local_tracks&#39;, &#39;mood_2&#39;]
[&#39;n_albums&#39;, &#39;n_artists&#39;, &#39;n_tracks&#39;, &#39;n_local_tracks&#39;]
[&#39;mood_1&#39;, &#39;mood_2&#39;, &#39;mood_3&#39;, &#39;genre_1&#39;, &#39;genre_2&#39;, &#39;genre_3&#39;]
</code></pre></div>

<h3 id="discrete-features">Discrete Features<a class="headerlink" href="#discrete-features" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="n">df</span><span class="p">[</span><span class="n">des_features</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mood_1</th>
      <th>mood_2</th>
      <th>mood_3</th>
      <th>genre_1</th>
      <th>genre_2</th>
      <th>genre_3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>403366</td>
      <td>403366</td>
      <td>403366</td>
      <td>403366</td>
      <td>403366</td>
      <td>403366</td>
    </tr>
    <tr>
      <th>unique</th>
      <td>27</td>
      <td>27</td>
      <td>27</td>
      <td>26</td>
      <td>26</td>
      <td>26</td>
    </tr>
    <tr>
      <th>top</th>
      <td>Defiant</td>
      <td>Energizing</td>
      <td>Energizing</td>
      <td>Indie Rock</td>
      <td>Alternative</td>
      <td>Pop</td>
    </tr>
    <tr>
      <th>freq</th>
      <td>81079</td>
      <td>51643</td>
      <td>56450</td>
      <td>70571</td>
      <td>66252</td>
      <td>78758</td>
    </tr>
  </tbody>
</table>
</div>

<div class="codehilite"><pre><span></span><code><span class="n">df</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">des_features</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>mood_1    mood_2      mood_3      genre_1        genre_2        genre_3
Excited   Aggressive  Energizing  Dance &amp; House  Electronica    Pop        4824
Defiant   Cool        Energizing  Rap            R&amp;B            Pop        4458
          Energizing  Cool        Rap            R&amp;B            Pop        4003
                                                 Pop            R&amp;B        1803
                      Excited     Rap            Pop            R&amp;B        1225
                                                                           ... 
Excited   Aggressive  Urgent      Alternative    Electronica    Metal         1
                                                 Dance &amp; House  Pop           1
                      Upbeat      Pop            Soundtrack     -             1
                                  Indie Rock     Alternative    -             1
Yearning  Urgent      Upbeat      Soundtrack     Pop            Rap           1
Length: 138379, dtype: int64
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">df</span><span class="p">[</span><span class="n">des_features</span><span class="p">[:</span><span class="mi">3</span><span class="p">]]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>mood_1    mood_2      mood_3    
Defiant   Cool        Energizing    15125
          Energizing  Cool          12278
Excited   Aggressive  Energizing     7564
Defiant   Energizing  Excited        6672
          Excited     Energizing     6179
                                    ...  
Peaceful  Urgent      Yearning          1
          Yearning    Cool              1
                      Excited           1
                      Fiery             1
Other     Urgent      Aggressive        1
Length: 9326, dtype: int64
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">df</span><span class="p">[</span><span class="n">des_features</span><span class="p">[</span><span class="mi">3</span><span class="p">:]]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>genre_1        genre_2         genre_3    
Rap            R&amp;B             Pop            15477
Indie Rock     Alternative     Rock           13102
Dance &amp; House  Electronica     Pop            10800
Indie Rock     Alternative     Pop             9981
                               Electronica     7233
                                              ...  
New Age        Country &amp; Folk  Rock               1
               Dance &amp; House   R&amp;B                1
                               Rock               1
                               Soundtrack         1
Traditional    Spoken &amp; Audio  Religious          1
Length: 6664, dtype: int64
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>

<span class="n">dff</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">des_features</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">des_features</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()))</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">des_features</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()))</span>
<span class="n">dff</span> <span class="o">=</span> <span class="n">dff</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
<span class="n">dff</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;mood&#39;</span><span class="p">,</span> <span class="s1">&#39;order&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">]</span>
<span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">dff</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;order&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;mood&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="n">dff</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">des_features</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">des_features</span><span class="p">[</span><span class="mi">4</span><span class="p">]]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()))</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">des_features</span><span class="p">[</span><span class="mi">5</span><span class="p">]]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()))</span>
<span class="n">dff</span> <span class="o">=</span> <span class="n">dff</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
<span class="n">dff</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;genre&#39;</span><span class="p">,</span> <span class="s1">&#39;order&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">]</span>
<span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">dff</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;order&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;genre&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_40_0.png" /></p>
<h3 id="continuous-features">Continuous Features<a class="headerlink" href="#continuous-features" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="n">df</span><span class="p">[</span><span class="n">con_features</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>n_albums</th>
      <th>n_artists</th>
      <th>n_tracks</th>
      <th>n_local_tracks</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>403366.000000</td>
      <td>403366.000000</td>
      <td>403366.000000</td>
      <td>403366.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>88.224250</td>
      <td>83.852050</td>
      <td>201.483432</td>
      <td>3.084035</td>
    </tr>
    <tr>
      <th>std</th>
      <td>133.193118</td>
      <td>128.152488</td>
      <td>584.077765</td>
      <td>40.330266</td>
    </tr>
    <tr>
      <th>min</th>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>19.000000</td>
      <td>18.000000</td>
      <td>38.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>48.000000</td>
      <td>46.000000</td>
      <td>84.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>106.000000</td>
      <td>100.000000</td>
      <td>192.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>6397.000000</td>
      <td>5226.000000</td>
      <td>79984.000000</td>
      <td>9117.000000</td>
    </tr>
  </tbody>
</table>
</div>

<div class="codehilite"><pre><span></span><code><span class="n">quant</span> <span class="o">=</span> <span class="mf">0.999</span>
<span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">con_features</span><span class="p">:</span>
    <span class="n">cutoff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">target</span><span class="p">],</span> <span class="n">quant</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">cutoff</span><span class="p">]</span>
    <span class="n">removed</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">cutoff</span><span class="p">)]</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;removed items: </span><span class="si">{</span><span class="n">removed</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">y</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;hist&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>removed items: 404
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_43_1.png" /></p>
<div class="codehilite"><pre><span></span><code>removed items: 405
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_43_3.png" /></p>
<div class="codehilite"><pre><span></span><code>removed items: 404
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_43_5.png" /></p>
<div class="codehilite"><pre><span></span><code>removed items: 406
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_43_7.png" /></p>
<h4 id="bootstrapping">Bootstrapping<a class="headerlink" href="#bootstrapping" title="Permanent link">&para;</a></h4>
<p>An example of how we will bootstrap to perform hypothesis tests later on</p>
<div class="codehilite"><pre><span></span><code><span class="n">means</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">ind</span> <span class="o">=</span> <span class="n">con_features</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
    <span class="n">boot</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
                <span class="nb">list</span><span class="p">(</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                        <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">9</span><span class="p">)</span> 
                        <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">999</span><span class="p">)</span>
                    <span class="p">][</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">),</span>
                <span class="n">k</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
    <span class="n">means</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">boot</span><span class="p">))</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">stuff</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">means</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_46_0.png" /></p>
<h2 id="dependency">Dependency<a class="headerlink" href="#dependency" title="Permanent link">&para;</a></h2>
<h3 id="categorical-target">Categorical Target<a class="headerlink" href="#categorical-target" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="n">sub_targets</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>[&#39;mau_previous_month&#39;,
 &#39;mau_both_months&#39;,
 &#39;mau&#39;,
 &#39;monthly_stream30s&#39;,
 &#39;stream30s&#39;]
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">sub_targets</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;p99 </span><span class="si">{</span><span class="n">target</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">target</span><span class="p">],</span> <span class="mf">0.99</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>p99 mau_previous_month: 130.0
p99 mau_both_months: 19.0
p99 mau: 143.0
p99 monthly_stream30s: 2843.0
p99 stream30s: 113.0
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">des_features</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>[&#39;mood_1&#39;, &#39;mood_2&#39;, &#39;mood_3&#39;, &#39;genre_1&#39;, &#39;genre_2&#39;, &#39;genre_3&#39;]
</code></pre></div>

<h4 id="categorical-feature">Categorical Feature<a class="headerlink" href="#categorical-feature" title="Permanent link">&para;</a></h4>
<h5 id="moods">Moods<a class="headerlink" href="#moods" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code><span class="n">chidf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">target</span> <span class="o">=</span> <span class="n">sub_targets</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">chidf</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">target</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">chidf</span><span class="p">[</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">())</span>
<span class="n">moods</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">cutoff</span> <span class="o">=</span> <span class="mf">0.001</span>
<span class="n">pop</span> <span class="o">=</span> <span class="n">chidf</span><span class="p">[</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

<span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">des_features</span><span class="p">:</span>
    <span class="c1"># ind = des_features[0]</span>
    <span class="n">chidf</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">grp_label</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
        <span class="c1"># grp_label = df[ind].unique()[0]</span>
        <span class="n">grp</span> <span class="o">=</span> <span class="n">chidf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">chidf</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">==</span> <span class="n">grp_label</span><span class="p">][</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">chi2</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">cTable</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">median_test</span><span class="p">(</span><span class="n">grp</span><span class="p">,</span> <span class="n">pop</span><span class="p">,</span> <span class="n">correction</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ratio</span> <span class="o">=</span> <span class="n">cTable</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">cTable</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">ratio</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">ratio</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span>
        <span class="n">moods</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">moods</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="n">ind</span><span class="p">,</span> <span class="n">grp_label</span><span class="p">,</span> <span class="n">chi2</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">cTable</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">p</span><span class="o">&lt;</span><span class="n">cutoff</span><span class="p">]])])</span>

<span class="n">moods</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;feature&#39;</span><span class="p">,</span> <span class="s1">&#39;group&#39;</span><span class="p">,</span> <span class="s1">&#39;chi&#39;</span><span class="p">,</span> <span class="s1">&#39;p-value&#39;</span><span class="p">,</span> <span class="s1">&#39;cTable&#39;</span><span class="p">,</span> <span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="s1">&#39;reject null&#39;</span><span class="p">]</span>
<span class="n">moods</span> <span class="o">=</span> <span class="n">moods</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;p-value&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>79.0
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">moods</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">moods</span><span class="p">[</span><span class="s1">&#39;reject null&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">]</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>feature</th>
      <th>group</th>
      <th>chi</th>
      <th>p-value</th>
      <th>cTable</th>
      <th>+</th>
      <th>reject null</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>genre_3</td>
      <td>-</td>
      <td>1725.882036</td>
      <td>0.000000e+00</td>
      <td>[[16033, 205049], [24090, 198317]]</td>
      <td>False</td>
      <td>True</td>
    </tr>
    <tr>
      <th>1</th>
      <td>genre_2</td>
      <td>-</td>
      <td>1104.759466</td>
      <td>3.051013e-242</td>
      <td>[[8216, 203517], [12990, 199849]]</td>
      <td>False</td>
      <td>True</td>
    </tr>
    <tr>
      <th>2</th>
      <td>genre_1</td>
      <td>Latin</td>
      <td>651.374931</td>
      <td>1.122254e-143</td>
      <td>[[9000, 199027], [6012, 204339]]</td>
      <td>True</td>
      <td>True</td>
    </tr>
    <tr>
      <th>3</th>
      <td>mood_1</td>
      <td>Energizing</td>
      <td>611.189037</td>
      <td>6.167816e-135</td>
      <td>[[10316, 203517], [14071, 199849]]</td>
      <td>False</td>
      <td>True</td>
    </tr>
    <tr>
      <th>4</th>
      <td>genre_1</td>
      <td>Rock</td>
      <td>315.827189</td>
      <td>1.174487e-70</td>
      <td>[[12514, 201911], [15563, 201455]]</td>
      <td>False</td>
      <td>True</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>93</th>
      <td>mood_1</td>
      <td>Stirring</td>
      <td>12.333846</td>
      <td>4.448190e-04</td>
      <td>[[877, 200454], [1044, 202912]]</td>
      <td>False</td>
      <td>True</td>
    </tr>
    <tr>
      <th>94</th>
      <td>mood_1</td>
      <td>Serious</td>
      <td>12.316512</td>
      <td>4.489689e-04</td>
      <td>[[778, 200454], [935, 202912]]</td>
      <td>False</td>
      <td>True</td>
    </tr>
    <tr>
      <th>95</th>
      <td>mood_2</td>
      <td>Lively</td>
      <td>12.161071</td>
      <td>4.879735e-04</td>
      <td>[[2588, 200454], [2882, 202912]]</td>
      <td>False</td>
      <td>True</td>
    </tr>
    <tr>
      <th>96</th>
      <td>mood_2</td>
      <td>Somber</td>
      <td>11.618507</td>
      <td>6.529880e-04</td>
      <td>[[792, 200454], [946, 202912]]</td>
      <td>False</td>
      <td>True</td>
    </tr>
    <tr>
      <th>97</th>
      <td>genre_2</td>
      <td>Dance &amp; House</td>
      <td>10.834697</td>
      <td>9.961560e-04</td>
      <td>[[12678, 201911], [13196, 201455]]</td>
      <td>False</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
<p>98 rows  7 columns</p>
</div>

<h5 id="chi-square">Chi-Square<a class="headerlink" href="#chi-square" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code><span class="n">chidf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">target</span> <span class="o">=</span> <span class="n">sub_targets</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">chidf</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">target</span><span class="p">]</span>
<span class="n">quant_value</span> <span class="o">=</span> <span class="mf">0.90</span>
<span class="n">tar_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">chidf</span><span class="p">[</span><span class="n">target</span><span class="p">],</span> <span class="n">quant_value</span><span class="p">)</span>
<span class="n">chidf</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">=</span> <span class="n">chidf</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">tar_value</span>
<span class="n">chisum</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">cutoff</span> <span class="o">=</span> <span class="mf">0.0001</span>
<span class="n">pop</span> <span class="o">=</span> <span class="n">chidf</span><span class="p">[</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

<span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">des_features</span><span class="p">:</span>
    <span class="c1"># ind = des_features[0]</span>
    <span class="n">chidf</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">grp_label</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
    <span class="c1"># grp_label = df[ind].unique()[0]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cTable</span> <span class="o">=</span> <span class="n">chidf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">chidf</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">==</span> <span class="n">grp_label</span><span class="p">)[</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
            <span class="n">chi2</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">dof</span><span class="p">,</span> <span class="n">ex</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">chi2_contingency</span><span class="p">(</span><span class="n">cTable</span><span class="p">,</span> <span class="n">correction</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">lambda_</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
            <span class="n">ratio</span> <span class="o">=</span> <span class="n">cTable</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">cTable</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">ratio</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">ratio</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">chisum</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">chisum</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="n">ind</span><span class="p">,</span> <span class="n">grp_label</span><span class="p">,</span> <span class="n">chi2</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">cTable</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">p</span><span class="o">&lt;</span><span class="n">cutoff</span><span class="p">]])])</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

<span class="n">chisum</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;feature&#39;</span><span class="p">,</span> <span class="s1">&#39;group&#39;</span><span class="p">,</span> <span class="s1">&#39;chi&#39;</span><span class="p">,</span> <span class="s1">&#39;p-value&#39;</span><span class="p">,</span> <span class="s1">&#39;cTable&#39;</span><span class="p">,</span> <span class="s1">&#39;multiplier&#39;</span><span class="p">,</span> <span class="s1">&#39;reject null&#39;</span><span class="p">]</span>
<span class="n">chisum</span> <span class="o">=</span> <span class="n">chisum</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;p-value&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>

<h5 id="categorical-categorical-conclusions">Categorical-Categorical Conclusions<a class="headerlink" href="#categorical-categorical-conclusions" title="Permanent link">&para;</a></h5>
<p>increasing <code>quant_value</code> will render additional features; as the population performance worsens, new feature/group pairs have an opportunity to increase the multiplier</p>
<p>Best Groups</p>
<div class="codehilite"><pre><span></span><code><span class="n">chisum</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">chisum</span><span class="p">[</span><span class="s1">&#39;reject null&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">chisum</span><span class="p">[</span><span class="s1">&#39;multiplier&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;multiplier&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>feature</th>
      <th>group</th>
      <th>chi</th>
      <th>p-value</th>
      <th>cTable</th>
      <th>multiplier</th>
      <th>reject null</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>6</th>
      <td>genre_1</td>
      <td>Children's</td>
      <td>262.624693</td>
      <td>4.596280e-59</td>
      <td>[[361785, 1286], [39933, 362]]</td>
      <td>2.550270</td>
      <td>True</td>
    </tr>
    <tr>
      <th>11</th>
      <td>mood_1</td>
      <td>Other</td>
      <td>197.598843</td>
      <td>6.979647e-45</td>
      <td>[[361719, 1352], [39952, 343]]</td>
      <td>2.296943</td>
      <td>True</td>
    </tr>
    <tr>
      <th>19</th>
      <td>genre_1</td>
      <td>Spoken &amp; Audio</td>
      <td>120.508309</td>
      <td>4.896128e-28</td>
      <td>[[362147, 924], [40068, 227]]</td>
      <td>2.220451</td>
      <td>True</td>
    </tr>
    <tr>
      <th>0</th>
      <td>genre_1</td>
      <td>Latin</td>
      <td>1150.625294</td>
      <td>3.280867e-252</td>
      <td>[[350782, 12289], [37572, 2723]]</td>
      <td>2.068731</td>
      <td>True</td>
    </tr>
    <tr>
      <th>12</th>
      <td>genre_1</td>
      <td>New Age</td>
      <td>166.484617</td>
      <td>4.335181e-38</td>
      <td>[[361286, 1785], [39896, 399]]</td>
      <td>2.024214</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
</div>

<p>Worst Groups</p>
<div class="codehilite"><pre><span></span><code><span class="n">chisum</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">chisum</span><span class="p">[</span><span class="s1">&#39;reject null&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">chisum</span><span class="p">[</span><span class="s1">&#39;multiplier&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.8</span><span class="p">)]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;multiplier&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>feature</th>
      <th>group</th>
      <th>chi</th>
      <th>p-value</th>
      <th>cTable</th>
      <th>multiplier</th>
      <th>reject null</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>28</th>
      <td>mood_2</td>
      <td>Sensual</td>
      <td>85.309680</td>
      <td>2.551113e-20</td>
      <td>[[343873, 19198], [38598, 1697]]</td>
      <td>0.787516</td>
      <td>True</td>
    </tr>
    <tr>
      <th>40</th>
      <td>genre_1</td>
      <td>Electronica</td>
      <td>65.249731</td>
      <td>6.598320e-16</td>
      <td>[[350162, 12909], [39176, 1119]]</td>
      <td>0.774794</td>
      <td>True</td>
    </tr>
    <tr>
      <th>2</th>
      <td>genre_1</td>
      <td>Indie Rock</td>
      <td>366.567076</td>
      <td>1.046303e-81</td>
      <td>[[298164, 64907], [34631, 5664]]</td>
      <td>0.751315</td>
      <td>True</td>
    </tr>
    <tr>
      <th>13</th>
      <td>genre_3</td>
      <td>Electronica</td>
      <td>163.908151</td>
      <td>1.584260e-37</td>
      <td>[[337501, 25570], [38143, 2152]]</td>
      <td>0.744684</td>
      <td>True</td>
    </tr>
    <tr>
      <th>21</th>
      <td>mood_1</td>
      <td>Brooding</td>
      <td>109.456909</td>
      <td>1.288759e-25</td>
      <td>[[346296, 16775], [38893, 1402]]</td>
      <td>0.744152</td>
      <td>True</td>
    </tr>
    <tr>
      <th>48</th>
      <td>mood_1</td>
      <td>Gritty</td>
      <td>49.741710</td>
      <td>1.753777e-12</td>
      <td>[[355800, 7271], [39695, 600]]</td>
      <td>0.739652</td>
      <td>True</td>
    </tr>
    <tr>
      <th>14</th>
      <td>mood_1</td>
      <td>Energizing</td>
      <td>162.542129</td>
      <td>3.149562e-37</td>
      <td>[[340541, 22530], [38438, 1857]]</td>
      <td>0.730229</td>
      <td>True</td>
    </tr>
    <tr>
      <th>68</th>
      <td>mood_3</td>
      <td>Other</td>
      <td>27.407286</td>
      <td>1.648091e-07</td>
      <td>[[361541, 1530], [40196, 99]]</td>
      <td>0.581994</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
</div>

<p>We would recommend would-be superstar playlist maker construct a playlist with the following attributes:</p>
<ul>
<li><strong>Genre 1: Children's</strong> <ul>
<li>2.6x more likely to be in the 90<sup>th</sup> percentile</li>
<li>4.8x more likely to be in the 99<sup>th</sup> percentile</li>
</ul>
</li>
<li><strong>Mood 1: Other</strong> <ul>
<li>2.3x more likely to be in the 90<sup>th</sup> percentile</li>
<li>2.4x more likely to be in the 99<sup>th</sup> percentile</li>
</ul>
</li>
</ul>
<h4 id="continuous-feature">Continuous Feature<a class="headerlink" href="#continuous-feature" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="n">targets</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>[&#39;streams&#39;,
 &#39;stream30s&#39;,
 &#39;dau&#39;,
 &#39;wau&#39;,
 &#39;mau&#39;,
 &#39;mau_previous_month&#39;,
 &#39;mau_both_months&#39;,
 &#39;users&#39;,
 &#39;skippers&#39;,
 &#39;monthly_stream30s&#39;,
 &#39;monthly_owner_stream30s&#39;]
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">con_features</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>[&#39;n_albums&#39;, &#39;n_artists&#39;, &#39;n_tracks&#39;, &#39;n_local_tracks&#39;]
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">target</span> <span class="o">=</span> <span class="s2">&quot;monthly_stream30s&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
<span class="n">chidf</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">target</span><span class="p">]</span>
<span class="n">quant_value</span> <span class="o">=</span> <span class="mf">0.90</span>
<span class="n">tar_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">chidf</span><span class="p">[</span><span class="n">target</span><span class="p">],</span> <span class="n">quant_value</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">tar_value</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;n_albums&#39;</span><span class="p">)[[</span><span class="s1">&#39;wau&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="c1"># ax.set_ylim(0, 100)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>monthly_stream30s





(0.0, 200.0)
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_67_2.png" /></p>
<h5 id="t-test">t-Test<a class="headerlink" href="#t-test" title="Permanent link">&para;</a></h5>
<p>For t tests we need to deal with the long tails in the distributions along the independent variable</p>
<div class="codehilite"><pre><span></span><code><span class="n">df</span><span class="p">[</span><span class="n">targets</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>streams</th>
      <th>stream30s</th>
      <th>dau</th>
      <th>wau</th>
      <th>mau</th>
      <th>mau_previous_month</th>
      <th>mau_both_months</th>
      <th>users</th>
      <th>skippers</th>
      <th>monthly_stream30s</th>
      <th>monthly_owner_stream30s</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>4.033660e+05</td>
      <td>4.033660e+05</td>
      <td>403366.000000</td>
      <td>403366.000000</td>
      <td>4.033660e+05</td>
      <td>4.033660e+05</td>
      <td>403366.000000</td>
      <td>4.033660e+05</td>
      <td>403366.000000</td>
      <td>4.033660e+05</td>
      <td>403366.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>7.101375e+01</td>
      <td>4.283333e+01</td>
      <td>4.418265</td>
      <td>21.784446</td>
      <td>6.614290e+01</td>
      <td>5.819009e+01</td>
      <td>12.937065</td>
      <td>1.493085e+02</td>
      <td>2.827749</td>
      <td>1.260489e+03</td>
      <td>93.556621</td>
    </tr>
    <tr>
      <th>std</th>
      <td>6.492014e+03</td>
      <td>3.772412e+03</td>
      <td>358.855685</td>
      <td>1614.650805</td>
      <td>4.732580e+03</td>
      <td>3.827248e+03</td>
      <td>1240.912979</td>
      <td>9.247484e+03</td>
      <td>205.059728</td>
      <td>1.062463e+05</td>
      <td>226.250189</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>2.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000</td>
      <td>2.000000e+00</td>
      <td>0.000000</td>
      <td>2.000000e+00</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>2.000000e+00</td>
      <td>1.000000e+00</td>
      <td>1.000000</td>
      <td>2.000000e+00</td>
      <td>0.000000</td>
      <td>3.100000e+01</td>
      <td>6.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>1.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>2.000000e+00</td>
      <td>2.000000e+00</td>
      <td>1.000000</td>
      <td>3.000000e+00</td>
      <td>0.000000</td>
      <td>7.900000e+01</td>
      <td>30.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>8.000000e+00</td>
      <td>5.000000e+00</td>
      <td>1.000000</td>
      <td>2.000000</td>
      <td>4.000000e+00</td>
      <td>3.000000e+00</td>
      <td>2.000000</td>
      <td>7.000000e+00</td>
      <td>0.000000</td>
      <td>1.930000e+02</td>
      <td>96.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>2.629715e+06</td>
      <td>1.513237e+06</td>
      <td>152929.000000</td>
      <td>669966.000000</td>
      <td>1.944150e+06</td>
      <td>1.478684e+06</td>
      <td>578391.000000</td>
      <td>3.455406e+06</td>
      <td>86162.000000</td>
      <td>4.249733e+07</td>
      <td>25904.000000</td>
    </tr>
  </tbody>
</table>
</div>

<div class="codehilite"><pre><span></span><code><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;owner&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;spotify&#39;</span><span class="p">][</span><span class="n">targets</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>streams</th>
      <th>stream30s</th>
      <th>dau</th>
      <th>wau</th>
      <th>mau</th>
      <th>mau_previous_month</th>
      <th>mau_both_months</th>
      <th>users</th>
      <th>skippers</th>
      <th>monthly_stream30s</th>
      <th>monthly_owner_stream30s</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>402967.000000</td>
      <td>402967.000000</td>
      <td>402967.000000</td>
      <td>402967.000000</td>
      <td>402967.000000</td>
      <td>402967.000000</td>
      <td>402967.000000</td>
      <td>402967.000000</td>
      <td>402967.000000</td>
      <td>4.029670e+05</td>
      <td>402967.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>20.968960</td>
      <td>11.990945</td>
      <td>1.232421</td>
      <td>5.275308</td>
      <td>14.860487</td>
      <td>13.483665</td>
      <td>3.029327</td>
      <td>32.824100</td>
      <td>0.728640</td>
      <td>3.543268e+02</td>
      <td>93.647783</td>
    </tr>
    <tr>
      <th>std</th>
      <td>766.262668</td>
      <td>404.190477</td>
      <td>41.227771</td>
      <td>185.706612</td>
      <td>504.704081</td>
      <td>548.731437</td>
      <td>129.629183</td>
      <td>1157.601711</td>
      <td>27.054367</td>
      <td>1.093559e+04</td>
      <td>226.343585</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>2.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>2.000000</td>
      <td>0.000000</td>
      <td>2.000000e+00</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>2.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>2.000000</td>
      <td>0.000000</td>
      <td>3.100000e+01</td>
      <td>6.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>2.000000</td>
      <td>2.000000</td>
      <td>1.000000</td>
      <td>3.000000</td>
      <td>0.000000</td>
      <td>7.900000e+01</td>
      <td>30.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>8.000000</td>
      <td>5.000000</td>
      <td>1.000000</td>
      <td>2.000000</td>
      <td>4.000000</td>
      <td>3.000000</td>
      <td>2.000000</td>
      <td>7.000000</td>
      <td>0.000000</td>
      <td>1.930000e+02</td>
      <td>96.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>293283.000000</td>
      <td>173753.000000</td>
      <td>18290.000000</td>
      <td>71891.000000</td>
      <td>206756.000000</td>
      <td>190026.000000</td>
      <td>59049.000000</td>
      <td>439699.000000</td>
      <td>11755.000000</td>
      <td>5.098585e+06</td>
      <td>25904.000000</td>
    </tr>
  </tbody>
</table>
</div>

<div class="codehilite"><pre><span></span><code><span class="n">chidf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">target</span> <span class="o">=</span> <span class="s2">&quot;mau&quot;</span>
<span class="n">chidf</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">target</span><span class="p">]</span>
<span class="n">quant_value</span> <span class="o">=</span> <span class="mf">0.99</span>
<span class="n">tar_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">chidf</span><span class="p">[</span><span class="n">target</span><span class="p">],</span> <span class="n">quant_value</span><span class="p">)</span>
<span class="n">chidf</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">=</span> <span class="n">chidf</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">tar_value</span>
<span class="n">welchsum</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">cutoff</span> <span class="o">=</span> <span class="mf">0.0001</span>
<span class="n">pop</span> <span class="o">=</span> <span class="n">chidf</span><span class="p">[</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

<span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">con_features</span><span class="p">:</span>
    <span class="c1"># ind = con_features[0]</span>
    <span class="n">chidf</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>

    <span class="c1"># for grp_label in df[ind].unique():</span>
    <span class="c1"># try:</span>
    <span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">b</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
        <span class="n">boot1</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
                    <span class="nb">list</span><span class="p">(</span>
                        <span class="n">chidf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                            <span class="p">(</span><span class="n">chidf</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span>
                        <span class="p">][</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">),</span>
                    <span class="n">k</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
        <span class="n">boot2</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
                    <span class="nb">list</span><span class="p">(</span>
                        <span class="n">chidf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                            <span class="p">(</span><span class="n">chidf</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span>
                        <span class="p">][</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">),</span>
                    <span class="n">k</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">boot1</span><span class="p">))</span>
        <span class="n">b</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">boot2</span><span class="p">))</span>
    <span class="n">testt</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">ttest_ind</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">equal_var</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">a_avg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="n">b_avg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
    <span class="n">welchsum</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">welchsum</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="n">ind</span><span class="p">,</span> <span class="n">testt</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">a_avg</span><span class="p">,</span> <span class="n">b_avg</span><span class="p">,</span> <span class="n">p</span><span class="o">&lt;</span><span class="n">cutoff</span><span class="p">]])])</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:orange&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">target</span><span class="si">}</span><span class="s2"> &gt; </span><span class="si">{</span><span class="n">tar_value</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">target</span><span class="si">}</span><span class="s2"> &lt;= </span><span class="si">{</span><span class="n">tar_value</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="c1"># except:</span>
    <span class="c1">#     pass</span>

<span class="n">welchsum</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;feature&#39;</span><span class="p">,</span> <span class="s1">&#39;test stat&#39;</span><span class="p">,</span> <span class="s1">&#39;p-value&#39;</span><span class="p">,</span> <span class="s1">&#39;upper q avg&#39;</span><span class="p">,</span> <span class="s1">&#39;lower q avg&#39;</span><span class="p">,</span> <span class="s1">&#39;reject null&#39;</span><span class="p">]</span>
<span class="n">welchsum</span> <span class="o">=</span> <span class="n">welchsum</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;p-value&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_71_0.png" /></p>
<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_71_1.png" /></p>
<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_71_2.png" /></p>
<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_71_3.png" /></p>
<div class="codehilite"><pre><span></span><code><span class="n">welchsum</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>feature</th>
      <th>test stat</th>
      <th>p-value</th>
      <th>upper q avg</th>
      <th>lower q avg</th>
      <th>reject null</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>n_tracks</td>
      <td>10.277868</td>
      <td>4.444906e-20</td>
      <td>214.33164</td>
      <td>193.07872</td>
      <td>True</td>
    </tr>
    <tr>
      <th>1</th>
      <td>n_artists</td>
      <td>5.367785</td>
      <td>2.238566e-07</td>
      <td>84.92819</td>
      <td>81.98974</td>
      <td>True</td>
    </tr>
    <tr>
      <th>2</th>
      <td>n_local_tracks</td>
      <td>-2.602519</td>
      <td>1.006900e-02</td>
      <td>2.59716</td>
      <td>2.84386</td>
      <td>False</td>
    </tr>
    <tr>
      <th>3</th>
      <td>n_albums</td>
      <td>-0.827392</td>
      <td>4.090126e-01</td>
      <td>85.92611</td>
      <td>86.46785</td>
      <td>False</td>
    </tr>
  </tbody>
</table>
</div>

<p>Let's perform the same test again this time let's say we're only interested in playlists with at least 10 tracks and fewer than 1000 tracks</p>
<div class="codehilite"><pre><span></span><code><span class="n">chidf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">target</span> <span class="o">=</span> <span class="n">sub_targets</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">chidf</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">target</span><span class="p">]</span>
<span class="n">chidf</span><span class="p">[</span><span class="s1">&#39;n_tracks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;n_tracks&#39;</span><span class="p">]</span>
<span class="n">quant_value</span> <span class="o">=</span> <span class="mf">0.90</span>
<span class="n">tar_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">chidf</span><span class="p">[</span><span class="n">target</span><span class="p">],</span> <span class="n">quant_value</span><span class="p">)</span>
<span class="n">chidf</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">=</span> <span class="n">chidf</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">tar_value</span>
<span class="n">welchsum</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">cutoff</span> <span class="o">=</span> <span class="mf">0.0001</span>
<span class="n">pop</span> <span class="o">=</span> <span class="n">chidf</span><span class="p">[</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

<span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">con_features</span><span class="p">:</span>
    <span class="c1"># ind = con_features[0]</span>
    <span class="n">chidf</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>

    <span class="c1"># for grp_label in df[ind].unique():</span>
    <span class="c1"># try:</span>
    <span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">b</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
        <span class="n">boot1</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
                    <span class="nb">list</span><span class="p">(</span>
                        <span class="n">chidf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                            <span class="p">(</span><span class="n">chidf</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span>
                            <span class="o">&amp;</span> <span class="p">(</span><span class="n">chidf</span><span class="p">[</span><span class="s1">&#39;n_tracks&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">9</span><span class="p">)</span>
                            <span class="o">&amp;</span> <span class="p">(</span><span class="n">chidf</span><span class="p">[</span><span class="s1">&#39;n_tracks&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">999</span><span class="p">)</span>
                        <span class="p">][</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">),</span>
                    <span class="n">k</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
        <span class="n">boot2</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
                    <span class="nb">list</span><span class="p">(</span>
                        <span class="n">chidf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                            <span class="p">(</span><span class="n">chidf</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span>
                            <span class="o">&amp;</span> <span class="p">(</span><span class="n">chidf</span><span class="p">[</span><span class="s1">&#39;n_tracks&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">9</span><span class="p">)</span>
                            <span class="o">&amp;</span> <span class="p">(</span><span class="n">chidf</span><span class="p">[</span><span class="s1">&#39;n_tracks&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">999</span><span class="p">)</span>
                        <span class="p">][</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">),</span>
                    <span class="n">k</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">boot1</span><span class="p">))</span>
        <span class="n">b</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">boot2</span><span class="p">))</span>
    <span class="n">testt</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">ttest_ind</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">equal_var</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">a_avg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="n">b_avg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
    <span class="n">welchsum</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">welchsum</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="n">ind</span><span class="p">,</span> <span class="n">testt</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">a_avg</span><span class="p">,</span> <span class="n">b_avg</span><span class="p">,</span> <span class="n">p</span><span class="o">&lt;</span><span class="n">cutoff</span><span class="p">]])])</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:orange&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">target</span><span class="si">}</span><span class="s2"> &gt; </span><span class="si">{</span><span class="n">tar_value</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">target</span><span class="si">}</span><span class="s2"> &lt;= </span><span class="si">{</span><span class="n">tar_value</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="c1"># except:</span>
    <span class="c1">#     pass</span>

<span class="n">welchsum</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;feature&#39;</span><span class="p">,</span> <span class="s1">&#39;test stat&#39;</span><span class="p">,</span> <span class="s1">&#39;p-value&#39;</span><span class="p">,</span> <span class="s1">&#39;upper q avg&#39;</span><span class="p">,</span> <span class="s1">&#39;lower q avg&#39;</span><span class="p">,</span> <span class="s1">&#39;reject null&#39;</span><span class="p">]</span>
<span class="n">welchsum</span> <span class="o">=</span> <span class="n">welchsum</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;p-value&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_74_0.png" /></p>
<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_74_1.png" /></p>
<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_74_2.png" /></p>
<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_74_3.png" /></p>
<div class="codehilite"><pre><span></span><code><span class="n">welchsum</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>feature</th>
      <th>test stat</th>
      <th>p-value</th>
      <th>upper q avg</th>
      <th>lower q avg</th>
      <th>reject null</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>n_tracks</td>
      <td>115.613349</td>
      <td>3.417496e-174</td>
      <td>231.30575</td>
      <td>136.10481</td>
      <td>True</td>
    </tr>
    <tr>
      <th>1</th>
      <td>n_artists</td>
      <td>97.323391</td>
      <td>2.230656e-167</td>
      <td>108.74091</td>
      <td>70.18516</td>
      <td>True</td>
    </tr>
    <tr>
      <th>2</th>
      <td>n_albums</td>
      <td>94.393421</td>
      <td>2.063549e-160</td>
      <td>114.38747</td>
      <td>74.44801</td>
      <td>True</td>
    </tr>
    <tr>
      <th>3</th>
      <td>n_local_tracks</td>
      <td>15.122963</td>
      <td>4.889333e-34</td>
      <td>3.04746</td>
      <td>1.99517</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
</div>

<h5 id="categorical-continuous-conclusions">Categorical-Continuous Conclusions<a class="headerlink" href="#categorical-continuous-conclusions" title="Permanent link">&para;</a></h5>
<p>Our conclusions are the same. There is a clear delineation between number of tracks, albums, and artists for popular and unpopular playlists</p>
<h4 id="putting-it-all-together">Putting it All Together<a class="headerlink" href="#putting-it-all-together" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="n">sub_targets</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>[&#39;mau_previous_month&#39;, &#39;mau_both_months&#39;, &#39;monthly_stream30s&#39;, &#39;stream30s&#39;]
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">des_features</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>[&#39;mood_1&#39;, &#39;mood_2&#39;, &#39;mood_3&#39;, &#39;genre_1&#39;, &#39;genre_2&#39;, &#39;genre_3&#39;]
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">master</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">sub_targets</span><span class="p">:</span>
    <span class="c1"># target = sub_targets[0]</span>
    <span class="k">for</span> <span class="n">quant_value</span> <span class="ow">in</span> <span class="p">[</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">]:</span>
        <span class="c1"># quant_value = 0.90</span>
        <span class="n">chidf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="n">chidf</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">target</span><span class="p">]</span>
        <span class="n">tar_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">chidf</span><span class="p">[</span><span class="n">target</span><span class="p">],</span> <span class="n">quant_value</span><span class="p">)</span>
        <span class="n">chidf</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">=</span> <span class="n">chidf</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">tar_value</span>
        <span class="n">chisum</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="n">cutoff</span> <span class="o">=</span> <span class="mf">0.0001</span>
        <span class="n">pop</span> <span class="o">=</span> <span class="n">chidf</span><span class="p">[</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

        <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">des_features</span><span class="p">:</span>
            <span class="c1"># ind = des_features[0]</span>
            <span class="n">chidf</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">grp_label</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
            <span class="c1"># grp_label = df[ind].unique()[0]</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">cTable</span> <span class="o">=</span> <span class="n">chidf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">chidf</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">==</span> <span class="n">grp_label</span><span class="p">)[</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
                    <span class="n">chi2</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">dof</span><span class="p">,</span> <span class="n">ex</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">chi2_contingency</span><span class="p">(</span><span class="n">cTable</span><span class="p">,</span> <span class="n">correction</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">lambda_</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
                    <span class="n">ratio</span> <span class="o">=</span> <span class="n">cTable</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">cTable</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">pos</span> <span class="o">=</span> <span class="n">ratio</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">ratio</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">chisum</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">chisum</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="n">target</span><span class="p">,</span> <span class="n">quant_value</span><span class="p">,</span> <span class="n">tar_value</span><span class="p">,</span> <span class="n">ind</span><span class="p">,</span> <span class="n">grp_label</span><span class="p">,</span> <span class="n">chi2</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">cTable</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">p</span><span class="o">&lt;</span><span class="n">cutoff</span><span class="p">]])])</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>

        <span class="n">chisum</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">,</span> <span class="s1">&#39;upper q&#39;</span><span class="p">,</span> <span class="s1">&#39;upper q value&#39;</span><span class="p">,</span> <span class="s1">&#39;feature&#39;</span><span class="p">,</span> <span class="s1">&#39;group&#39;</span><span class="p">,</span> <span class="s1">&#39;chi&#39;</span><span class="p">,</span> <span class="s1">&#39;p-value&#39;</span><span class="p">,</span> <span class="s1">&#39;cTable&#39;</span><span class="p">,</span> <span class="s1">&#39;multiplier&#39;</span><span class="p">,</span> <span class="s1">&#39;reject null&#39;</span><span class="p">]</span>
        <span class="n">chisum</span> <span class="o">=</span> <span class="n">chisum</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;p-value&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">chisum</span> <span class="o">=</span> <span class="n">chisum</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">chisum</span><span class="p">[</span><span class="s1">&#39;reject null&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">chisum</span><span class="p">[</span><span class="s1">&#39;multiplier&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;multiplier&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">master</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">master</span><span class="p">,</span> <span class="n">chisum</span><span class="p">))</span>

<span class="n">master</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>target</th>
      <th>upper q</th>
      <th>upper q value</th>
      <th>feature</th>
      <th>group</th>
      <th>chi</th>
      <th>p-value</th>
      <th>cTable</th>
      <th>multiplier</th>
      <th>reject null</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2</th>
      <td>mau_previous_month</td>
      <td>0.90</td>
      <td>9.0</td>
      <td>genre_1</td>
      <td>Latin</td>
      <td>5590.525321</td>
      <td>0.000000e+00</td>
      <td>[[355002, 11016], [33352, 3996]]</td>
      <td>3.861095</td>
      <td>True</td>
    </tr>
    <tr>
      <th>18</th>
      <td>mau_previous_month</td>
      <td>0.90</td>
      <td>9.0</td>
      <td>genre_1</td>
      <td>Children's</td>
      <td>434.974313</td>
      <td>1.343518e-96</td>
      <td>[[364768, 1250], [36950, 398]]</td>
      <td>3.143224</td>
      <td>True</td>
    </tr>
    <tr>
      <th>1</th>
      <td>mau_previous_month</td>
      <td>0.90</td>
      <td>9.0</td>
      <td>mood_1</td>
      <td>Lively</td>
      <td>2312.708732</td>
      <td>0.000000e+00</td>
      <td>[[358030, 7988], [34990, 2358]]</td>
      <td>3.020517</td>
      <td>True</td>
    </tr>
    <tr>
      <th>22</th>
      <td>mau_previous_month</td>
      <td>0.90</td>
      <td>9.0</td>
      <td>genre_1</td>
      <td>Traditional</td>
      <td>357.345743</td>
      <td>1.065483e-79</td>
      <td>[[364829, 1189], [36989, 359]]</td>
      <td>2.978032</td>
      <td>True</td>
    </tr>
    <tr>
      <th>7</th>
      <td>mau_previous_month</td>
      <td>0.90</td>
      <td>9.0</td>
      <td>genre_2</td>
      <td>Jazz</td>
      <td>1046.212802</td>
      <td>1.619916e-229</td>
      <td>[[362333, 3685], [36262, 1086]]</td>
      <td>2.944750</td>
      <td>True</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>36</th>
      <td>stream30s</td>
      <td>0.99</td>
      <td>113.0</td>
      <td>genre_2</td>
      <td>Easy Listening</td>
      <td>26.570340</td>
      <td>2.541152e-07</td>
      <td>[[397291, 2078], [3952, 45]]</td>
      <td>2.177002</td>
      <td>True</td>
    </tr>
    <tr>
      <th>29</th>
      <td>stream30s</td>
      <td>0.99</td>
      <td>113.0</td>
      <td>genre_2</td>
      <td>Traditional</td>
      <td>39.102302</td>
      <td>4.021695e-10</td>
      <td>[[396243, 3126], [3930, 67]]</td>
      <td>2.161001</td>
      <td>True</td>
    </tr>
    <tr>
      <th>24</th>
      <td>stream30s</td>
      <td>0.99</td>
      <td>113.0</td>
      <td>genre_3</td>
      <td>Jazz</td>
      <td>46.586071</td>
      <td>8.768129e-12</td>
      <td>[[395431, 3938], [3914, 83]]</td>
      <td>2.129376</td>
      <td>True</td>
    </tr>
    <tr>
      <th>22</th>
      <td>stream30s</td>
      <td>0.99</td>
      <td>113.0</td>
      <td>mood_2</td>
      <td>Easygoing</td>
      <td>48.122685</td>
      <td>4.003676e-12</td>
      <td>[[394690, 4679], [3902, 95]]</td>
      <td>2.053711</td>
      <td>True</td>
    </tr>
    <tr>
      <th>18</th>
      <td>stream30s</td>
      <td>0.99</td>
      <td>113.0</td>
      <td>mood_2</td>
      <td>Lively</td>
      <td>53.658720</td>
      <td>2.385226e-13</td>
      <td>[[394007, 5362], [3889, 108]]</td>
      <td>2.040624</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
<p>182 rows  10 columns</p>
</div>

<div class="codehilite"><pre><span></span><code><span class="n">master</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>-                 22
Romantic          19
Lively            17
Traditional       16
Children&#39;s        16
Jazz              14
Latin             12
Serious            8
Easy Listening     8
Soundtrack         8
Other              7
New Age            7
Holiday            6
Peaceful           6
Spoken &amp; Audio     4
Fiery              3
Tender             3
Easygoing          3
Sophisticated      2
Somber             1
Name: group, dtype: int64
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">master</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">master</span><span class="p">[</span><span class="s1">&#39;upper q&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.90</span><span class="p">][</span><span class="s1">&#39;group&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>-                 12
Lively             7
Traditional        7
Children&#39;s         7
Jazz               7
Latin              7
Romantic           6
Other              5
Serious            5
Holiday            5
Easy Listening     4
Soundtrack         4
Spoken &amp; Audio     3
Fiery              3
Sophisticated      2
New Age            1
Tender             1
Name: group, dtype: int64
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">sort_key</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="n">j</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">master</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="n">master</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()))}</span>
<span class="n">master</span><span class="p">[</span><span class="s1">&#39;rank&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">master</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">sort_key</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
<span class="n">master</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;rank&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># master.drop(&#39;rank&#39;, axis=1, inplace=True)</span>
<span class="n">master</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">master</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;-&#39;</span><span class="p">][:</span><span class="mi">20</span><span class="p">]</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>target</th>
      <th>upper q</th>
      <th>upper q value</th>
      <th>feature</th>
      <th>group</th>
      <th>chi</th>
      <th>p-value</th>
      <th>cTable</th>
      <th>multiplier</th>
      <th>reject null</th>
      <th>rank</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>7</th>
      <td>monthly_stream30s</td>
      <td>0.99</td>
      <td>2843.0</td>
      <td>mood_2</td>
      <td>Romantic</td>
      <td>146.934024</td>
      <td>8.112487e-34</td>
      <td>[[389339, 9994], [3810, 223]]</td>
      <td>2.280176</td>
      <td>True</td>
      <td>1</td>
    </tr>
    <tr>
      <th>6</th>
      <td>stream30s</td>
      <td>0.99</td>
      <td>113.0</td>
      <td>mood_2</td>
      <td>Romantic</td>
      <td>148.026986</td>
      <td>4.679851e-34</td>
      <td>[[389374, 9995], [3775, 222]]</td>
      <td>2.290974</td>
      <td>True</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>monthly_stream30s</td>
      <td>0.99</td>
      <td>2843.0</td>
      <td>mood_1</td>
      <td>Romantic</td>
      <td>175.072639</td>
      <td>5.772239e-40</td>
      <td>[[390131, 9202], [3812, 221]]</td>
      <td>2.457919</td>
      <td>True</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>mau</td>
      <td>0.99</td>
      <td>143.0</td>
      <td>mood_1</td>
      <td>Romantic</td>
      <td>202.823985</td>
      <td>5.053546e-46</td>
      <td>[[390156, 9193], [3787, 230]]</td>
      <td>2.577588</td>
      <td>True</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>mau</td>
      <td>0.90</td>
      <td>9.0</td>
      <td>mood_2</td>
      <td>Romantic</td>
      <td>1531.190216</td>
      <td>0.000000e+00</td>
      <td>[[355299, 8035], [37850, 2182]]</td>
      <td>2.549159</td>
      <td>True</td>
      <td>1</td>
    </tr>
    <tr>
      <th>8</th>
      <td>mau_previous_month</td>
      <td>0.90</td>
      <td>9.0</td>
      <td>mood_3</td>
      <td>Romantic</td>
      <td>1013.797108</td>
      <td>1.800082e-222</td>
      <td>[[357949, 8069], [35525, 1823]]</td>
      <td>2.276429</td>
      <td>True</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>mau_previous_month</td>
      <td>0.99</td>
      <td>130.0</td>
      <td>mood_1</td>
      <td>Romantic</td>
      <td>156.500834</td>
      <td>6.579992e-36</td>
      <td>[[390127, 9209], [3816, 214]]</td>
      <td>2.375740</td>
      <td>True</td>
      <td>1</td>
    </tr>
    <tr>
      <th>8</th>
      <td>mau</td>
      <td>0.90</td>
      <td>9.0</td>
      <td>mood_3</td>
      <td>Romantic</td>
      <td>1170.355016</td>
      <td>1.690629e-256</td>
      <td>[[355429, 7905], [38045, 1987]]</td>
      <td>2.348287</td>
      <td>True</td>
      <td>1</td>
    </tr>
    <tr>
      <th>6</th>
      <td>mau</td>
      <td>0.99</td>
      <td>143.0</td>
      <td>mood_2</td>
      <td>Romantic</td>
      <td>105.450504</td>
      <td>9.729814e-25</td>
      <td>[[389336, 10013], [3813, 204]]</td>
      <td>2.080289</td>
      <td>True</td>
      <td>1</td>
    </tr>
    <tr>
      <th>5</th>
      <td>mau_previous_month</td>
      <td>0.99</td>
      <td>130.0</td>
      <td>mood_3</td>
      <td>Romantic</td>
      <td>112.605179</td>
      <td>2.633191e-26</td>
      <td>[[389647, 9689], [3827, 203]]</td>
      <td>2.133192</td>
      <td>True</td>
      <td>1</td>
    </tr>
    <tr>
      <th>6</th>
      <td>monthly_stream30s</td>
      <td>0.99</td>
      <td>2843.0</td>
      <td>mood_3</td>
      <td>Romantic</td>
      <td>149.750731</td>
      <td>1.965370e-34</td>
      <td>[[389660, 9673], [3814, 219]]</td>
      <td>2.313066</td>
      <td>True</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>mau_both_months</td>
      <td>0.99</td>
      <td>19.0</td>
      <td>mood_1</td>
      <td>Romantic</td>
      <td>109.693770</td>
      <td>1.143607e-25</td>
      <td>[[390177, 9231], [3766, 192]]</td>
      <td>2.154933</td>
      <td>True</td>
      <td>1</td>
    </tr>
    <tr>
      <th>6</th>
      <td>mau_previous_month</td>
      <td>0.90</td>
      <td>9.0</td>
      <td>mood_1</td>
      <td>Romantic</td>
      <td>1142.816205</td>
      <td>1.633755e-250</td>
      <td>[[358408, 7610], [35535, 1813]]</td>
      <td>2.402893</td>
      <td>True</td>
      <td>1</td>
    </tr>
    <tr>
      <th>10</th>
      <td>stream30s</td>
      <td>0.99</td>
      <td>113.0</td>
      <td>mood_3</td>
      <td>Romantic</td>
      <td>136.025552</td>
      <td>1.969792e-31</td>
      <td>[[389689, 9680], [3785, 212]]</td>
      <td>2.254825</td>
      <td>True</td>
      <td>1</td>
    </tr>
    <tr>
      <th>5</th>
      <td>mau</td>
      <td>0.99</td>
      <td>143.0</td>
      <td>mood_3</td>
      <td>Romantic</td>
      <td>122.574129</td>
      <td>1.728356e-28</td>
      <td>[[389664, 9685], [3810, 207]]</td>
      <td>2.185929</td>
      <td>True</td>
      <td>1</td>
    </tr>
    <tr>
      <th>6</th>
      <td>mau</td>
      <td>0.90</td>
      <td>9.0</td>
      <td>mood_1</td>
      <td>Romantic</td>
      <td>1328.179994</td>
      <td>8.498925e-291</td>
      <td>[[355892, 7442], [38051, 1981]]</td>
      <td>2.489700</td>
      <td>True</td>
      <td>1</td>
    </tr>
    <tr>
      <th>6</th>
      <td>mau_previous_month</td>
      <td>0.99</td>
      <td>130.0</td>
      <td>mood_2</td>
      <td>Romantic</td>
      <td>104.434543</td>
      <td>1.624732e-24</td>
      <td>[[389323, 10013], [3826, 204]]</td>
      <td>2.073152</td>
      <td>True</td>
      <td>1</td>
    </tr>
    <tr>
      <th>8</th>
      <td>stream30s</td>
      <td>0.99</td>
      <td>113.0</td>
      <td>mood_1</td>
      <td>Romantic</td>
      <td>139.245969</td>
      <td>3.891401e-32</td>
      <td>[[390152, 9217], [3791, 206]]</td>
      <td>2.300158</td>
      <td>True</td>
      <td>1</td>
    </tr>
    <tr>
      <th>5</th>
      <td>mau_previous_month</td>
      <td>0.90</td>
      <td>9.0</td>
      <td>mood_2</td>
      <td>Romantic</td>
      <td>1379.938658</td>
      <td>4.806442e-302</td>
      <td>[[357822, 8196], [35327, 2021]]</td>
      <td>2.497610</td>
      <td>True</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>mau_both_months</td>
      <td>0.90</td>
      <td>2.0</td>
      <td>mood_1</td>
      <td>Lively</td>
      <td>750.247385</td>
      <td>3.544959e-165</td>
      <td>[[361665, 8747], [31355, 1599]]</td>
      <td>2.108575</td>
      <td>True</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div>

<div class="codehilite"><pre><span></span><code><span class="n">sub_targets</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>[&#39;mau_previous_month&#39;,
 &#39;mau_both_months&#39;,
 &#39;mau&#39;,
 &#39;monthly_stream30s&#39;,
 &#39;stream30s&#39;]
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">master</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>target</th>
      <th>upper q</th>
      <th>upper q value</th>
      <th>feature</th>
      <th>group</th>
      <th>chi</th>
      <th>p-value</th>
      <th>cTable</th>
      <th>multiplier</th>
      <th>reject null</th>
      <th>rank</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>12</th>
      <td>stream30s</td>
      <td>0.99</td>
      <td>113.0</td>
      <td>mood_3</td>
      <td>-</td>
      <td>125.854082</td>
      <td>3.309444e-29</td>
      <td>[[397434, 1935], [3927, 70]]</td>
      <td>3.661181</td>
      <td>True</td>
      <td>0</td>
    </tr>
    <tr>
      <th>11</th>
      <td>monthly_stream30s</td>
      <td>0.99</td>
      <td>2843.0</td>
      <td>mood_2</td>
      <td>-</td>
      <td>109.163417</td>
      <td>1.494430e-25</td>
      <td>[[397529, 1804], [3969, 64]]</td>
      <td>3.553294</td>
      <td>True</td>
      <td>0</td>
    </tr>
    <tr>
      <th>67</th>
      <td>mau_previous_month</td>
      <td>0.90</td>
      <td>9.0</td>
      <td>genre_1</td>
      <td>-</td>
      <td>95.863487</td>
      <td>1.230846e-22</td>
      <td>[[365249, 769], [37173, 175]]</td>
      <td>2.236007</td>
      <td>True</td>
      <td>0</td>
    </tr>
    <tr>
      <th>10</th>
      <td>monthly_stream30s</td>
      <td>0.99</td>
      <td>2843.0</td>
      <td>mood_1</td>
      <td>-</td>
      <td>112.668942</td>
      <td>2.549855e-26</td>
      <td>[[397605, 1728], [3970, 63]]</td>
      <td>3.651389</td>
      <td>True</td>
      <td>0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>stream30s</td>
      <td>0.99</td>
      <td>113.0</td>
      <td>mood_1</td>
      <td>-</td>
      <td>141.501726</td>
      <td>1.249779e-32</td>
      <td>[[397646, 1723], [3929, 68]]</td>
      <td>3.994277</td>
      <td>True</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>

<div class="codehilite"><pre><span></span><code><span class="n">master</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">master</span><span class="p">[</span><span class="s1">&#39;feature&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;genre&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;group&#39;</span><span class="p">)[[</span><span class="s1">&#39;multiplier&#39;</span><span class="p">,</span> <span class="s1">&#39;rank&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;multiplier&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>multiplier</th>
      <th>rank</th>
    </tr>
    <tr>
      <th>group</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Tender</th>
      <td>3.033890</td>
      <td>16.0</td>
    </tr>
    <tr>
      <th>-</th>
      <td>2.935235</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>Peaceful</th>
      <td>2.564297</td>
      <td>13.0</td>
    </tr>
    <tr>
      <th>Other</th>
      <td>2.494292</td>
      <td>10.0</td>
    </tr>
    <tr>
      <th>Lively</th>
      <td>2.364492</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>Romantic</th>
      <td>2.318001</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>Fiery</th>
      <td>2.244027</td>
      <td>15.0</td>
    </tr>
    <tr>
      <th>Somber</th>
      <td>2.194114</td>
      <td>19.0</td>
    </tr>
    <tr>
      <th>Serious</th>
      <td>2.190306</td>
      <td>7.0</td>
    </tr>
    <tr>
      <th>Easygoing</th>
      <td>2.088064</td>
      <td>17.0</td>
    </tr>
    <tr>
      <th>Sophisticated</th>
      <td>2.055203</td>
      <td>18.0</td>
    </tr>
  </tbody>
</table>
</div>

<div class="codehilite"><pre><span></span><code><span class="n">master</span><span class="p">[</span><span class="s1">&#39;rank&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">master</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">sort_key</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
<span class="n">master</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;group&#39;</span><span class="p">)[[</span><span class="s1">&#39;multiplier&#39;</span><span class="p">,</span> <span class="s1">&#39;rank&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;multiplier&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>multiplier</th>
      <th>rank</th>
    </tr>
    <tr>
      <th>group</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>-</th>
      <td>3.049100</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>Tender</th>
      <td>3.033890</td>
      <td>16.0</td>
    </tr>
    <tr>
      <th>Latin</th>
      <td>3.001282</td>
      <td>6.0</td>
    </tr>
    <tr>
      <th>Children's</th>
      <td>2.871261</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>Holiday</th>
      <td>2.836528</td>
      <td>12.0</td>
    </tr>
    <tr>
      <th>New Age</th>
      <td>2.754796</td>
      <td>11.0</td>
    </tr>
    <tr>
      <th>Spoken &amp; Audio</th>
      <td>2.610393</td>
      <td>14.0</td>
    </tr>
    <tr>
      <th>Peaceful</th>
      <td>2.564297</td>
      <td>13.0</td>
    </tr>
    <tr>
      <th>Other</th>
      <td>2.425104</td>
      <td>10.0</td>
    </tr>
    <tr>
      <th>Easy Listening</th>
      <td>2.407295</td>
      <td>8.0</td>
    </tr>
    <tr>
      <th>Lively</th>
      <td>2.364492</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>Traditional</th>
      <td>2.361342</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>Jazz</th>
      <td>2.342954</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Romantic</th>
      <td>2.318001</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>Fiery</th>
      <td>2.244027</td>
      <td>15.0</td>
    </tr>
    <tr>
      <th>Soundtrack</th>
      <td>2.209295</td>
      <td>9.0</td>
    </tr>
    <tr>
      <th>Somber</th>
      <td>2.194114</td>
      <td>19.0</td>
    </tr>
    <tr>
      <th>Serious</th>
      <td>2.190306</td>
      <td>7.0</td>
    </tr>
    <tr>
      <th>Easygoing</th>
      <td>2.088064</td>
      <td>17.0</td>
    </tr>
    <tr>
      <th>Sophisticated</th>
      <td>2.055203</td>
      <td>18.0</td>
    </tr>
  </tbody>
</table>
</div>

<div class="codehilite"><pre><span></span><code><span class="n">master</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;chi_square_results.csv&quot;</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">con_master</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">sub_targets</span><span class="p">:</span>
    <span class="c1"># target = sub_targets[2]</span>
    <span class="k">for</span> <span class="n">quant_value</span> <span class="ow">in</span> <span class="p">[</span><span class="mf">0.90</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">]:</span>
        <span class="n">chidf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="n">chidf</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">target</span><span class="p">]</span>
        <span class="n">chidf</span><span class="p">[</span><span class="s1">&#39;n_tracks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;n_tracks&#39;</span><span class="p">]</span>
        <span class="c1"># quant_value = 0.90</span>
        <span class="n">tar_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">chidf</span><span class="p">[</span><span class="n">target</span><span class="p">],</span> <span class="n">quant_value</span><span class="p">)</span>
        <span class="n">chidf</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">=</span> <span class="n">chidf</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">tar_value</span>
        <span class="n">welchsum</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="n">cutoff</span> <span class="o">=</span> <span class="mf">0.0001</span>
        <span class="n">pop</span> <span class="o">=</span> <span class="n">chidf</span><span class="p">[</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

        <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">con_features</span><span class="p">:</span>
            <span class="c1"># ind = con_features[0]</span>
            <span class="n">chidf</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>

            <span class="c1"># for grp_label in df[ind].unique():</span>
            <span class="c1"># try:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">b</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
                <span class="n">boot1</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
                            <span class="nb">list</span><span class="p">(</span>
                                <span class="n">chidf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                                    <span class="p">(</span><span class="n">chidf</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span>
                                    <span class="o">&amp;</span> <span class="p">(</span><span class="n">chidf</span><span class="p">[</span><span class="s1">&#39;n_tracks&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">9</span><span class="p">)</span>
                                    <span class="o">&amp;</span> <span class="p">(</span><span class="n">chidf</span><span class="p">[</span><span class="s1">&#39;n_tracks&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">999</span><span class="p">)</span>
                                <span class="p">][</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">),</span>
                            <span class="n">k</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
                <span class="n">boot2</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
                            <span class="nb">list</span><span class="p">(</span>
                                <span class="n">chidf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                                    <span class="p">(</span><span class="n">chidf</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span>
                                    <span class="o">&amp;</span> <span class="p">(</span><span class="n">chidf</span><span class="p">[</span><span class="s1">&#39;n_tracks&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">9</span><span class="p">)</span>
                                    <span class="o">&amp;</span> <span class="p">(</span><span class="n">chidf</span><span class="p">[</span><span class="s1">&#39;n_tracks&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">999</span><span class="p">)</span>
                                <span class="p">][</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">),</span>
                            <span class="n">k</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
                <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">boot1</span><span class="p">))</span>
                <span class="n">b</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">boot2</span><span class="p">))</span>
            <span class="n">testt</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">ttest_ind</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">equal_var</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">a_avg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
            <span class="n">b_avg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
            <span class="n">welchsum</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">welchsum</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="n">target</span><span class="p">,</span> <span class="n">quant_value</span><span class="p">,</span> <span class="n">ind</span><span class="p">,</span> <span class="n">testt</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">a_avg</span><span class="p">,</span> <span class="n">b_avg</span><span class="p">,</span> <span class="n">p</span><span class="o">&lt;</span><span class="n">cutoff</span><span class="p">]])])</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">quant_value</span><span class="p">)</span>
            <span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:orange&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">target</span><span class="si">}</span><span class="s2"> &gt; </span><span class="si">{</span><span class="n">tar_value</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">target</span><span class="si">}</span><span class="s2"> &lt;= </span><span class="si">{</span><span class="n">tar_value</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            <span class="c1"># except:</span>
            <span class="c1">#     pass</span>

        <span class="n">welchsum</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">,</span> <span class="s1">&#39;quantile&#39;</span><span class="p">,</span> <span class="s1">&#39;feature&#39;</span><span class="p">,</span> <span class="s1">&#39;test stat&#39;</span><span class="p">,</span> <span class="s1">&#39;p-value&#39;</span><span class="p">,</span> <span class="s1">&#39;upper q avg&#39;</span><span class="p">,</span> <span class="s1">&#39;lower q avg&#39;</span><span class="p">,</span> <span class="s1">&#39;reject null&#39;</span><span class="p">]</span>
        <span class="n">welchsum</span> <span class="o">=</span> <span class="n">welchsum</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;p-value&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">con_master</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">con_master</span><span class="p">,</span> <span class="n">welchsum</span><span class="p">))</span>
<span class="n">con_master</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>mau_previous_month 0.9
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_89_1.png" /></p>
<div class="codehilite"><pre><span></span><code>mau_previous_month 0.9
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_89_3.png" /></p>
<div class="codehilite"><pre><span></span><code>mau_previous_month 0.9
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_89_5.png" /></p>
<div class="codehilite"><pre><span></span><code>mau_previous_month 0.9
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_89_7.png" /></p>
<div class="codehilite"><pre><span></span><code>mau_previous_month 0.99
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_89_9.png" /></p>
<div class="codehilite"><pre><span></span><code>mau_previous_month 0.99
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_89_11.png" /></p>
<div class="codehilite"><pre><span></span><code>mau_previous_month 0.99
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_89_13.png" /></p>
<div class="codehilite"><pre><span></span><code>mau_previous_month 0.99
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_89_15.png" /></p>
<div class="codehilite"><pre><span></span><code>mau_both_months 0.9
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_89_17.png" /></p>
<div class="codehilite"><pre><span></span><code>mau_both_months 0.9
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_89_19.png" /></p>
<div class="codehilite"><pre><span></span><code>mau_both_months 0.9
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_89_21.png" /></p>
<div class="codehilite"><pre><span></span><code>mau_both_months 0.9
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_89_23.png" /></p>
<div class="codehilite"><pre><span></span><code>mau_both_months 0.99
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_89_25.png" /></p>
<div class="codehilite"><pre><span></span><code>mau_both_months 0.99
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_89_27.png" /></p>
<div class="codehilite"><pre><span></span><code>mau_both_months 0.99
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_89_29.png" /></p>
<div class="codehilite"><pre><span></span><code>mau_both_months 0.99
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_89_31.png" /></p>
<div class="codehilite"><pre><span></span><code>mau 0.9
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_89_33.png" /></p>
<div class="codehilite"><pre><span></span><code>mau 0.9
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_89_35.png" /></p>
<div class="codehilite"><pre><span></span><code>mau 0.9
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_89_37.png" /></p>
<div class="codehilite"><pre><span></span><code>mau 0.9
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_89_39.png" /></p>
<div class="codehilite"><pre><span></span><code>mau 0.99
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_89_41.png" /></p>
<div class="codehilite"><pre><span></span><code>mau 0.99
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_89_43.png" /></p>
<div class="codehilite"><pre><span></span><code>mau 0.99
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_89_45.png" /></p>
<div class="codehilite"><pre><span></span><code>mau 0.99
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_89_47.png" /></p>
<div class="codehilite"><pre><span></span><code>monthly_stream30s 0.9
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_89_49.png" /></p>
<div class="codehilite"><pre><span></span><code>monthly_stream30s 0.9
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_89_51.png" /></p>
<div class="codehilite"><pre><span></span><code>monthly_stream30s 0.9
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_89_53.png" /></p>
<div class="codehilite"><pre><span></span><code>monthly_stream30s 0.9
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_89_55.png" /></p>
<div class="codehilite"><pre><span></span><code>monthly_stream30s 0.99
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_89_57.png" /></p>
<div class="codehilite"><pre><span></span><code>monthly_stream30s 0.99
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_89_59.png" /></p>
<div class="codehilite"><pre><span></span><code>monthly_stream30s 0.99
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_89_61.png" /></p>
<div class="codehilite"><pre><span></span><code>monthly_stream30s 0.99
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_89_63.png" /></p>
<div class="codehilite"><pre><span></span><code>stream30s 0.9
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_89_65.png" /></p>
<div class="codehilite"><pre><span></span><code>stream30s 0.9
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_89_67.png" /></p>
<div class="codehilite"><pre><span></span><code>stream30s 0.9
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_89_69.png" /></p>
<div class="codehilite"><pre><span></span><code>stream30s 0.9
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_89_71.png" /></p>
<div class="codehilite"><pre><span></span><code>stream30s 0.99
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_89_73.png" /></p>
<div class="codehilite"><pre><span></span><code>stream30s 0.99
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_89_75.png" /></p>
<div class="codehilite"><pre><span></span><code>stream30s 0.99
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_89_77.png" /></p>
<div class="codehilite"><pre><span></span><code>stream30s 0.99
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_89_79.png" /></p>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>target</th>
      <th>quantile</th>
      <th>feature</th>
      <th>test stat</th>
      <th>p-value</th>
      <th>upper q avg</th>
      <th>lower q avg</th>
      <th>reject null</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>mau_previous_month</td>
      <td>0.90</td>
      <td>n_albums</td>
      <td>-23.264501</td>
      <td>1.517148e-58</td>
      <td>69.19828</td>
      <td>78.75130</td>
      <td>True</td>
    </tr>
    <tr>
      <th>1</th>
      <td>mau_previous_month</td>
      <td>0.90</td>
      <td>n_artists</td>
      <td>-19.090166</td>
      <td>9.131465e-47</td>
      <td>67.78967</td>
      <td>74.42581</td>
      <td>True</td>
    </tr>
    <tr>
      <th>2</th>
      <td>mau_previous_month</td>
      <td>0.90</td>
      <td>n_local_tracks</td>
      <td>-8.591563</td>
      <td>3.210041e-15</td>
      <td>1.68487</td>
      <td>2.13934</td>
      <td>True</td>
    </tr>
    <tr>
      <th>3</th>
      <td>mau_previous_month</td>
      <td>0.90</td>
      <td>n_tracks</td>
      <td>4.900218</td>
      <td>2.017971e-06</td>
      <td>149.27223</td>
      <td>145.40243</td>
      <td>True</td>
    </tr>
    <tr>
      <th>0</th>
      <td>mau_previous_month</td>
      <td>0.99</td>
      <td>n_tracks</td>
      <td>19.149805</td>
      <td>1.101097e-46</td>
      <td>157.92259</td>
      <td>144.56996</td>
      <td>True</td>
    </tr>
    <tr>
      <th>1</th>
      <td>mau_previous_month</td>
      <td>0.99</td>
      <td>n_artists</td>
      <td>9.668152</td>
      <td>4.508161e-18</td>
      <td>77.26126</td>
      <td>73.71656</td>
      <td>True</td>
    </tr>
    <tr>
      <th>2</th>
      <td>mau_previous_month</td>
      <td>0.99</td>
      <td>n_local_tracks</td>
      <td>-4.443426</td>
      <td>1.514586e-05</td>
      <td>1.89286</td>
      <td>2.11507</td>
      <td>True</td>
    </tr>
    <tr>
      <th>3</th>
      <td>mau_previous_month</td>
      <td>0.99</td>
      <td>n_albums</td>
      <td>1.862787</td>
      <td>6.399527e-02</td>
      <td>78.89529</td>
      <td>78.24458</td>
      <td>False</td>
    </tr>
    <tr>
      <th>0</th>
      <td>mau_both_months</td>
      <td>0.90</td>
      <td>n_tracks</td>
      <td>49.521659</td>
      <td>1.017659e-108</td>
      <td>181.22258</td>
      <td>141.77758</td>
      <td>True</td>
    </tr>
    <tr>
      <th>1</th>
      <td>mau_both_months</td>
      <td>0.90</td>
      <td>n_albums</td>
      <td>44.662168</td>
      <td>7.684105e-105</td>
      <td>96.16066</td>
      <td>75.92092</td>
      <td>True</td>
    </tr>
    <tr>
      <th>2</th>
      <td>mau_both_months</td>
      <td>0.90</td>
      <td>n_artists</td>
      <td>44.359056</td>
      <td>9.041628e-103</td>
      <td>90.79743</td>
      <td>72.15272</td>
      <td>True</td>
    </tr>
    <tr>
      <th>3</th>
      <td>mau_both_months</td>
      <td>0.90</td>
      <td>n_local_tracks</td>
      <td>13.737285</td>
      <td>1.342361e-30</td>
      <td>2.78731</td>
      <td>1.97483</td>
      <td>True</td>
    </tr>
    <tr>
      <th>0</th>
      <td>mau_both_months</td>
      <td>0.99</td>
      <td>n_tracks</td>
      <td>43.038413</td>
      <td>5.369851e-102</td>
      <td>175.40377</td>
      <td>145.00116</td>
      <td>True</td>
    </tr>
    <tr>
      <th>1</th>
      <td>mau_both_months</td>
      <td>0.99</td>
      <td>n_artists</td>
      <td>38.561073</td>
      <td>1.471847e-93</td>
      <td>88.24552</td>
      <td>73.26184</td>
      <td>True</td>
    </tr>
    <tr>
      <th>2</th>
      <td>mau_both_months</td>
      <td>0.99</td>
      <td>n_albums</td>
      <td>34.193348</td>
      <td>1.157948e-84</td>
      <td>91.12947</td>
      <td>77.20951</td>
      <td>True</td>
    </tr>
    <tr>
      <th>3</th>
      <td>mau_both_months</td>
      <td>0.99</td>
      <td>n_local_tracks</td>
      <td>6.722576</td>
      <td>1.917602e-10</td>
      <td>2.56940</td>
      <td>2.10191</td>
      <td>True</td>
    </tr>
    <tr>
      <th>0</th>
      <td>mau</td>
      <td>0.90</td>
      <td>n_albums</td>
      <td>-28.035344</td>
      <td>2.209065e-70</td>
      <td>67.80156</td>
      <td>79.48186</td>
      <td>True</td>
    </tr>
    <tr>
      <th>1</th>
      <td>mau</td>
      <td>0.90</td>
      <td>n_artists</td>
      <td>-23.052205</td>
      <td>7.021697e-58</td>
      <td>66.03151</td>
      <td>74.84314</td>
      <td>True</td>
    </tr>
    <tr>
      <th>2</th>
      <td>mau</td>
      <td>0.90</td>
      <td>n_local_tracks</td>
      <td>-9.891800</td>
      <td>5.454116e-19</td>
      <td>1.57376</td>
      <td>2.12208</td>
      <td>True</td>
    </tr>
    <tr>
      <th>3</th>
      <td>mau</td>
      <td>0.90</td>
      <td>n_tracks</td>
      <td>1.804461</td>
      <td>7.267873e-02</td>
      <td>146.48072</td>
      <td>145.09618</td>
      <td>False</td>
    </tr>
    <tr>
      <th>0</th>
      <td>mau</td>
      <td>0.99</td>
      <td>n_tracks</td>
      <td>12.627041</td>
      <td>3.513887e-27</td>
      <td>155.01260</td>
      <td>145.83850</td>
      <td>True</td>
    </tr>
    <tr>
      <th>1</th>
      <td>mau</td>
      <td>0.99</td>
      <td>n_artists</td>
      <td>7.983360</td>
      <td>1.264344e-13</td>
      <td>76.43482</td>
      <td>73.73105</td>
      <td>True</td>
    </tr>
    <tr>
      <th>2</th>
      <td>mau</td>
      <td>0.99</td>
      <td>n_local_tracks</td>
      <td>-6.172898</td>
      <td>4.276522e-09</td>
      <td>1.76129</td>
      <td>2.07410</td>
      <td>True</td>
    </tr>
    <tr>
      <th>3</th>
      <td>mau</td>
      <td>0.99</td>
      <td>n_albums</td>
      <td>1.442954</td>
      <td>1.506168e-01</td>
      <td>78.53564</td>
      <td>77.96526</td>
      <td>False</td>
    </tr>
    <tr>
      <th>0</th>
      <td>monthly_stream30s</td>
      <td>0.90</td>
      <td>n_tracks</td>
      <td>116.726338</td>
      <td>2.452095e-164</td>
      <td>232.32350</td>
      <td>136.98027</td>
      <td>True</td>
    </tr>
    <tr>
      <th>1</th>
      <td>monthly_stream30s</td>
      <td>0.90</td>
      <td>n_artists</td>
      <td>92.368904</td>
      <td>2.578108e-157</td>
      <td>108.07236</td>
      <td>70.08310</td>
      <td>True</td>
    </tr>
    <tr>
      <th>2</th>
      <td>monthly_stream30s</td>
      <td>0.90</td>
      <td>n_albums</td>
      <td>86.396836</td>
      <td>1.619061e-153</td>
      <td>114.85460</td>
      <td>74.19437</td>
      <td>True</td>
    </tr>
    <tr>
      <th>3</th>
      <td>monthly_stream30s</td>
      <td>0.90</td>
      <td>n_local_tracks</td>
      <td>17.521798</td>
      <td>4.704385e-40</td>
      <td>3.01074</td>
      <td>1.97501</td>
      <td>True</td>
    </tr>
    <tr>
      <th>0</th>
      <td>monthly_stream30s</td>
      <td>0.99</td>
      <td>n_tracks</td>
      <td>72.651978</td>
      <td>1.071572e-144</td>
      <td>199.50667</td>
      <td>144.19406</td>
      <td>True</td>
    </tr>
    <tr>
      <th>1</th>
      <td>monthly_stream30s</td>
      <td>0.99</td>
      <td>n_albums</td>
      <td>40.530369</td>
      <td>8.810322e-98</td>
      <td>95.06869</td>
      <td>77.58295</td>
      <td>True</td>
    </tr>
    <tr>
      <th>2</th>
      <td>monthly_stream30s</td>
      <td>0.99</td>
      <td>n_artists</td>
      <td>41.165863</td>
      <td>1.560381e-97</td>
      <td>90.42413</td>
      <td>74.19337</td>
      <td>True</td>
    </tr>
    <tr>
      <th>3</th>
      <td>monthly_stream30s</td>
      <td>0.99</td>
      <td>n_local_tracks</td>
      <td>6.120756</td>
      <td>5.135842e-09</td>
      <td>2.37637</td>
      <td>2.04232</td>
      <td>True</td>
    </tr>
    <tr>
      <th>0</th>
      <td>stream30s</td>
      <td>0.90</td>
      <td>n_tracks</td>
      <td>90.846516</td>
      <td>2.364112e-160</td>
      <td>207.07344</td>
      <td>139.38590</td>
      <td>True</td>
    </tr>
    <tr>
      <th>1</th>
      <td>stream30s</td>
      <td>0.90</td>
      <td>n_albums</td>
      <td>68.563722</td>
      <td>6.972523e-137</td>
      <td>105.31471</td>
      <td>75.42986</td>
      <td>True</td>
    </tr>
    <tr>
      <th>2</th>
      <td>stream30s</td>
      <td>0.90</td>
      <td>n_artists</td>
      <td>68.402932</td>
      <td>2.057561e-132</td>
      <td>99.37767</td>
      <td>70.87686</td>
      <td>True</td>
    </tr>
    <tr>
      <th>3</th>
      <td>stream30s</td>
      <td>0.90</td>
      <td>n_local_tracks</td>
      <td>14.588639</td>
      <td>6.290309e-32</td>
      <td>2.89681</td>
      <td>1.93857</td>
      <td>True</td>
    </tr>
    <tr>
      <th>0</th>
      <td>stream30s</td>
      <td>0.99</td>
      <td>n_tracks</td>
      <td>77.043302</td>
      <td>2.214047e-149</td>
      <td>201.25989</td>
      <td>144.76511</td>
      <td>True</td>
    </tr>
    <tr>
      <th>1</th>
      <td>stream30s</td>
      <td>0.99</td>
      <td>n_artists</td>
      <td>47.632996</td>
      <td>2.794842e-107</td>
      <td>92.60628</td>
      <td>73.13416</td>
      <td>True</td>
    </tr>
    <tr>
      <th>2</th>
      <td>stream30s</td>
      <td>0.99</td>
      <td>n_albums</td>
      <td>44.900868</td>
      <td>5.246137e-103</td>
      <td>98.01367</td>
      <td>78.12288</td>
      <td>True</td>
    </tr>
    <tr>
      <th>3</th>
      <td>stream30s</td>
      <td>0.99</td>
      <td>n_local_tracks</td>
      <td>4.520672</td>
      <td>1.062456e-05</td>
      <td>2.29328</td>
      <td>2.05241</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
</div>

<div class="codehilite"><pre><span></span><code><span class="n">con_master</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>target</th>
      <th>quantile</th>
      <th>feature</th>
      <th>test stat</th>
      <th>p-value</th>
      <th>upper q avg</th>
      <th>lower q avg</th>
      <th>reject null</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>mau_previous_month</td>
      <td>0.90</td>
      <td>n_albums</td>
      <td>-23.264501</td>
      <td>1.517148e-58</td>
      <td>69.19828</td>
      <td>78.75130</td>
      <td>True</td>
    </tr>
    <tr>
      <th>1</th>
      <td>mau_previous_month</td>
      <td>0.90</td>
      <td>n_artists</td>
      <td>-19.090166</td>
      <td>9.131465e-47</td>
      <td>67.78967</td>
      <td>74.42581</td>
      <td>True</td>
    </tr>
    <tr>
      <th>2</th>
      <td>mau_previous_month</td>
      <td>0.90</td>
      <td>n_local_tracks</td>
      <td>-8.591563</td>
      <td>3.210041e-15</td>
      <td>1.68487</td>
      <td>2.13934</td>
      <td>True</td>
    </tr>
    <tr>
      <th>3</th>
      <td>mau_previous_month</td>
      <td>0.90</td>
      <td>n_tracks</td>
      <td>4.900218</td>
      <td>2.017971e-06</td>
      <td>149.27223</td>
      <td>145.40243</td>
      <td>True</td>
    </tr>
    <tr>
      <th>0</th>
      <td>mau_previous_month</td>
      <td>0.99</td>
      <td>n_tracks</td>
      <td>19.149805</td>
      <td>1.101097e-46</td>
      <td>157.92259</td>
      <td>144.56996</td>
      <td>True</td>
    </tr>
    <tr>
      <th>1</th>
      <td>mau_previous_month</td>
      <td>0.99</td>
      <td>n_artists</td>
      <td>9.668152</td>
      <td>4.508161e-18</td>
      <td>77.26126</td>
      <td>73.71656</td>
      <td>True</td>
    </tr>
    <tr>
      <th>2</th>
      <td>mau_previous_month</td>
      <td>0.99</td>
      <td>n_local_tracks</td>
      <td>-4.443426</td>
      <td>1.514586e-05</td>
      <td>1.89286</td>
      <td>2.11507</td>
      <td>True</td>
    </tr>
    <tr>
      <th>3</th>
      <td>mau_previous_month</td>
      <td>0.99</td>
      <td>n_albums</td>
      <td>1.862787</td>
      <td>6.399527e-02</td>
      <td>78.89529</td>
      <td>78.24458</td>
      <td>False</td>
    </tr>
    <tr>
      <th>0</th>
      <td>mau_both_months</td>
      <td>0.90</td>
      <td>n_tracks</td>
      <td>49.521659</td>
      <td>1.017659e-108</td>
      <td>181.22258</td>
      <td>141.77758</td>
      <td>True</td>
    </tr>
    <tr>
      <th>1</th>
      <td>mau_both_months</td>
      <td>0.90</td>
      <td>n_albums</td>
      <td>44.662168</td>
      <td>7.684105e-105</td>
      <td>96.16066</td>
      <td>75.92092</td>
      <td>True</td>
    </tr>
    <tr>
      <th>2</th>
      <td>mau_both_months</td>
      <td>0.90</td>
      <td>n_artists</td>
      <td>44.359056</td>
      <td>9.041628e-103</td>
      <td>90.79743</td>
      <td>72.15272</td>
      <td>True</td>
    </tr>
    <tr>
      <th>3</th>
      <td>mau_both_months</td>
      <td>0.90</td>
      <td>n_local_tracks</td>
      <td>13.737285</td>
      <td>1.342361e-30</td>
      <td>2.78731</td>
      <td>1.97483</td>
      <td>True</td>
    </tr>
    <tr>
      <th>0</th>
      <td>mau_both_months</td>
      <td>0.99</td>
      <td>n_tracks</td>
      <td>43.038413</td>
      <td>5.369851e-102</td>
      <td>175.40377</td>
      <td>145.00116</td>
      <td>True</td>
    </tr>
    <tr>
      <th>1</th>
      <td>mau_both_months</td>
      <td>0.99</td>
      <td>n_artists</td>
      <td>38.561073</td>
      <td>1.471847e-93</td>
      <td>88.24552</td>
      <td>73.26184</td>
      <td>True</td>
    </tr>
    <tr>
      <th>2</th>
      <td>mau_both_months</td>
      <td>0.99</td>
      <td>n_albums</td>
      <td>34.193348</td>
      <td>1.157948e-84</td>
      <td>91.12947</td>
      <td>77.20951</td>
      <td>True</td>
    </tr>
    <tr>
      <th>3</th>
      <td>mau_both_months</td>
      <td>0.99</td>
      <td>n_local_tracks</td>
      <td>6.722576</td>
      <td>1.917602e-10</td>
      <td>2.56940</td>
      <td>2.10191</td>
      <td>True</td>
    </tr>
    <tr>
      <th>0</th>
      <td>mau</td>
      <td>0.90</td>
      <td>n_albums</td>
      <td>-28.035344</td>
      <td>2.209065e-70</td>
      <td>67.80156</td>
      <td>79.48186</td>
      <td>True</td>
    </tr>
    <tr>
      <th>1</th>
      <td>mau</td>
      <td>0.90</td>
      <td>n_artists</td>
      <td>-23.052205</td>
      <td>7.021697e-58</td>
      <td>66.03151</td>
      <td>74.84314</td>
      <td>True</td>
    </tr>
    <tr>
      <th>2</th>
      <td>mau</td>
      <td>0.90</td>
      <td>n_local_tracks</td>
      <td>-9.891800</td>
      <td>5.454116e-19</td>
      <td>1.57376</td>
      <td>2.12208</td>
      <td>True</td>
    </tr>
    <tr>
      <th>3</th>
      <td>mau</td>
      <td>0.90</td>
      <td>n_tracks</td>
      <td>1.804461</td>
      <td>7.267873e-02</td>
      <td>146.48072</td>
      <td>145.09618</td>
      <td>False</td>
    </tr>
    <tr>
      <th>0</th>
      <td>mau</td>
      <td>0.99</td>
      <td>n_tracks</td>
      <td>12.627041</td>
      <td>3.513887e-27</td>
      <td>155.01260</td>
      <td>145.83850</td>
      <td>True</td>
    </tr>
    <tr>
      <th>1</th>
      <td>mau</td>
      <td>0.99</td>
      <td>n_artists</td>
      <td>7.983360</td>
      <td>1.264344e-13</td>
      <td>76.43482</td>
      <td>73.73105</td>
      <td>True</td>
    </tr>
    <tr>
      <th>2</th>
      <td>mau</td>
      <td>0.99</td>
      <td>n_local_tracks</td>
      <td>-6.172898</td>
      <td>4.276522e-09</td>
      <td>1.76129</td>
      <td>2.07410</td>
      <td>True</td>
    </tr>
    <tr>
      <th>3</th>
      <td>mau</td>
      <td>0.99</td>
      <td>n_albums</td>
      <td>1.442954</td>
      <td>1.506168e-01</td>
      <td>78.53564</td>
      <td>77.96526</td>
      <td>False</td>
    </tr>
    <tr>
      <th>0</th>
      <td>monthly_stream30s</td>
      <td>0.90</td>
      <td>n_tracks</td>
      <td>116.726338</td>
      <td>2.452095e-164</td>
      <td>232.32350</td>
      <td>136.98027</td>
      <td>True</td>
    </tr>
    <tr>
      <th>1</th>
      <td>monthly_stream30s</td>
      <td>0.90</td>
      <td>n_artists</td>
      <td>92.368904</td>
      <td>2.578108e-157</td>
      <td>108.07236</td>
      <td>70.08310</td>
      <td>True</td>
    </tr>
    <tr>
      <th>2</th>
      <td>monthly_stream30s</td>
      <td>0.90</td>
      <td>n_albums</td>
      <td>86.396836</td>
      <td>1.619061e-153</td>
      <td>114.85460</td>
      <td>74.19437</td>
      <td>True</td>
    </tr>
    <tr>
      <th>3</th>
      <td>monthly_stream30s</td>
      <td>0.90</td>
      <td>n_local_tracks</td>
      <td>17.521798</td>
      <td>4.704385e-40</td>
      <td>3.01074</td>
      <td>1.97501</td>
      <td>True</td>
    </tr>
    <tr>
      <th>0</th>
      <td>monthly_stream30s</td>
      <td>0.99</td>
      <td>n_tracks</td>
      <td>72.651978</td>
      <td>1.071572e-144</td>
      <td>199.50667</td>
      <td>144.19406</td>
      <td>True</td>
    </tr>
    <tr>
      <th>1</th>
      <td>monthly_stream30s</td>
      <td>0.99</td>
      <td>n_albums</td>
      <td>40.530369</td>
      <td>8.810322e-98</td>
      <td>95.06869</td>
      <td>77.58295</td>
      <td>True</td>
    </tr>
    <tr>
      <th>2</th>
      <td>monthly_stream30s</td>
      <td>0.99</td>
      <td>n_artists</td>
      <td>41.165863</td>
      <td>1.560381e-97</td>
      <td>90.42413</td>
      <td>74.19337</td>
      <td>True</td>
    </tr>
    <tr>
      <th>3</th>
      <td>monthly_stream30s</td>
      <td>0.99</td>
      <td>n_local_tracks</td>
      <td>6.120756</td>
      <td>5.135842e-09</td>
      <td>2.37637</td>
      <td>2.04232</td>
      <td>True</td>
    </tr>
    <tr>
      <th>0</th>
      <td>stream30s</td>
      <td>0.90</td>
      <td>n_tracks</td>
      <td>90.846516</td>
      <td>2.364112e-160</td>
      <td>207.07344</td>
      <td>139.38590</td>
      <td>True</td>
    </tr>
    <tr>
      <th>1</th>
      <td>stream30s</td>
      <td>0.90</td>
      <td>n_albums</td>
      <td>68.563722</td>
      <td>6.972523e-137</td>
      <td>105.31471</td>
      <td>75.42986</td>
      <td>True</td>
    </tr>
    <tr>
      <th>2</th>
      <td>stream30s</td>
      <td>0.90</td>
      <td>n_artists</td>
      <td>68.402932</td>
      <td>2.057561e-132</td>
      <td>99.37767</td>
      <td>70.87686</td>
      <td>True</td>
    </tr>
    <tr>
      <th>3</th>
      <td>stream30s</td>
      <td>0.90</td>
      <td>n_local_tracks</td>
      <td>14.588639</td>
      <td>6.290309e-32</td>
      <td>2.89681</td>
      <td>1.93857</td>
      <td>True</td>
    </tr>
    <tr>
      <th>0</th>
      <td>stream30s</td>
      <td>0.99</td>
      <td>n_tracks</td>
      <td>77.043302</td>
      <td>2.214047e-149</td>
      <td>201.25989</td>
      <td>144.76511</td>
      <td>True</td>
    </tr>
    <tr>
      <th>1</th>
      <td>stream30s</td>
      <td>0.99</td>
      <td>n_artists</td>
      <td>47.632996</td>
      <td>2.794842e-107</td>
      <td>92.60628</td>
      <td>73.13416</td>
      <td>True</td>
    </tr>
    <tr>
      <th>2</th>
      <td>stream30s</td>
      <td>0.99</td>
      <td>n_albums</td>
      <td>44.900868</td>
      <td>5.246137e-103</td>
      <td>98.01367</td>
      <td>78.12288</td>
      <td>True</td>
    </tr>
    <tr>
      <th>3</th>
      <td>stream30s</td>
      <td>0.99</td>
      <td>n_local_tracks</td>
      <td>4.520672</td>
      <td>1.062456e-05</td>
      <td>2.29328</td>
      <td>2.05241</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
</div>

<div class="codehilite"><pre><span></span><code><span class="n">con_master</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;t_test_results.csv&quot;</span><span class="p">)</span>
</code></pre></div>

<h4 id="models-multi-feature-analysis">Models (Multi-Feature Analysis)<a class="headerlink" href="#models-multi-feature-analysis" title="Permanent link">&para;</a></h4>
<h5 id="deciles-random-forest">Deciles - Random Forest<a class="headerlink" href="#deciles-random-forest" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code><span class="n">sub_targets</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>[&#39;mau_previous_month&#39;,
 &#39;mau_both_months&#39;,
 &#39;mau&#39;,
 &#39;monthly_stream30s&#39;,
 &#39;stream30s&#39;]
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">target</span> <span class="o">=</span> <span class="n">sub_targets</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">labels</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">quant</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">11</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">11</span><span class="p">)):</span>
    <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">prev</span> <span class="o">=</span> <span class="n">quant</span>
        <span class="k">continue</span>
    <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">labels</span><span class="p">[</span><span class="n">labels</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">quant</span><span class="p">)]</span> <span class="o">=</span> <span class="n">idx</span>
        <span class="n">names</span> <span class="o">+=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;less than </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">quant</span><span class="p">)</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2"> listens&quot;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">labels</span><span class="p">[(</span><span class="n">labels</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">prev</span><span class="p">))</span>
              <span class="o">&amp;</span><span class="p">(</span><span class="n">labels</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">quant</span><span class="p">))]</span> <span class="o">=</span> <span class="n">idx</span>
        <span class="n">names</span> <span class="o">+=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">prev</span><span class="p">)</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2"> &lt; listens &lt;= </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">quant</span><span class="p">)</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
    <span class="n">prev</span> <span class="o">=</span> <span class="n">quant</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">labels</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">names</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>[&#39;less than 13 listens&#39;,
 &#39;13 &lt; listens &lt;= 24&#39;,
 &#39;24 &lt; listens &lt;= 38&#39;,
 &#39;38 &lt; listens &lt;= 55&#39;,
 &#39;55 &lt; listens &lt;= 79&#39;,
 &#39;79 &lt; listens &lt;= 111&#39;,
 &#39;111 &lt; listens &lt;= 159&#39;,
 &#39;159 &lt; listens &lt;= 240&#39;,
 &#39;240 &lt; listens &lt;= 432&#39;,
 &#39;432 &lt; listens &lt;= 42497334&#39;]
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">des_features</span> <span class="o">+</span> <span class="n">con_features</span><span class="p">]</span>
<span class="n">enc</span> <span class="o">=</span> <span class="n">OneHotEncoder</span><span class="p">()</span>
<span class="n">std</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>

<span class="n">X_cat</span> <span class="o">=</span> <span class="n">enc</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">des_features</span><span class="p">])</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span>
<span class="n">X_con</span> <span class="o">=</span> <span class="n">std</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">con_features</span><span class="p">])</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">X_con</span><span class="p">,</span> <span class="n">X_cat</span><span class="p">))</span>

<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">model</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>RandomForestClassifier()
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">y_hat_test</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Train Acc: </span><span class="si">{</span><span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_hat_test</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Test Acc: </span><span class="si">{</span><span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_hat_test</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>Train Acc: 0.14
Test Acc: 0.14
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="nb">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_hat_test</span><span class="p">,</span> <span class="n">zero_division</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>              precision    recall  f1-score   support

           1       0.19      0.26      0.22      8363
           2       0.13      0.13      0.13      7866
           3       0.13      0.12      0.13      8173
           4       0.10      0.09      0.10      7773
           5       0.11      0.10      0.10      8252
           6       0.11      0.09      0.10      7976
           7       0.11      0.10      0.10      8018
           8       0.12      0.10      0.11      8185
           9       0.14      0.14      0.14      8009
          10       0.20      0.26      0.23      8059

    accuracy                           0.14     80674
   macro avg       0.13      0.14      0.14     80674
weighted avg       0.13      0.14      0.14     80674
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_hat_test</span><span class="p">),</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="n">names</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="n">names</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>&lt;AxesSubplot:&gt;
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_102_1.png" /></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># grab feature importances</span>
<span class="n">imp</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">feature_importances_</span>

<span class="c1"># their std</span>
<span class="n">std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">([</span><span class="n">tree</span><span class="o">.</span><span class="n">feature_importances_</span> <span class="k">for</span> <span class="n">tree</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">estimators_</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># build feature names</span>
<span class="n">feature_names</span> <span class="o">=</span> <span class="n">con_features</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">enc</span><span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">())</span>

<span class="c1"># create new dataframe</span>
<span class="n">feat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">feature_names</span><span class="p">,</span> <span class="n">imp</span><span class="p">,</span> <span class="n">std</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
<span class="n">feat</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;feature&#39;</span><span class="p">,</span> <span class="s1">&#39;importance&#39;</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">]</span>
<span class="n">feat</span> <span class="o">=</span> <span class="n">feat</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;importance&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">feat</span> <span class="o">=</span> <span class="n">feat</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">feat</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">feat</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>feature</th>
      <th>importance</th>
      <th>std</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>n_tracks</td>
      <td>0.152852</td>
      <td>0.006907</td>
    </tr>
    <tr>
      <th>1</th>
      <td>n_albums</td>
      <td>0.135581</td>
      <td>0.007403</td>
    </tr>
    <tr>
      <th>2</th>
      <td>n_artists</td>
      <td>0.133666</td>
      <td>0.007421</td>
    </tr>
    <tr>
      <th>3</th>
      <td>n_local_tracks</td>
      <td>0.038311</td>
      <td>0.005365</td>
    </tr>
    <tr>
      <th>4</th>
      <td>genre_2_Pop</td>
      <td>0.011607</td>
      <td>0.000991</td>
    </tr>
    <tr>
      <th>5</th>
      <td>genre_3_Pop</td>
      <td>0.01145</td>
      <td>0.003792</td>
    </tr>
    <tr>
      <th>6</th>
      <td>genre_3_Alternative</td>
      <td>0.010917</td>
      <td>0.002062</td>
    </tr>
    <tr>
      <th>7</th>
      <td>genre_3_Rock</td>
      <td>0.009709</td>
      <td>0.002517</td>
    </tr>
    <tr>
      <th>8</th>
      <td>mood_3_Excited</td>
      <td>0.009644</td>
      <td>0.000618</td>
    </tr>
    <tr>
      <th>9</th>
      <td>mood_2_Excited</td>
      <td>0.009271</td>
      <td>0.000782</td>
    </tr>
    <tr>
      <th>10</th>
      <td>genre_2_Alternative</td>
      <td>0.009073</td>
      <td>0.003263</td>
    </tr>
    <tr>
      <th>11</th>
      <td>mood_3_Yearning</td>
      <td>0.00904</td>
      <td>0.001758</td>
    </tr>
    <tr>
      <th>12</th>
      <td>genre_3_Indie Rock</td>
      <td>0.00876</td>
      <td>0.000795</td>
    </tr>
    <tr>
      <th>13</th>
      <td>mood_3_Defiant</td>
      <td>0.008758</td>
      <td>0.000674</td>
    </tr>
    <tr>
      <th>14</th>
      <td>mood_3_Urgent</td>
      <td>0.008581</td>
      <td>0.000502</td>
    </tr>
    <tr>
      <th>15</th>
      <td>mood_2_Defiant</td>
      <td>0.008537</td>
      <td>0.000787</td>
    </tr>
    <tr>
      <th>16</th>
      <td>mood_3_Empowering</td>
      <td>0.008351</td>
      <td>0.001044</td>
    </tr>
    <tr>
      <th>17</th>
      <td>mood_3_Sensual</td>
      <td>0.008343</td>
      <td>0.000575</td>
    </tr>
    <tr>
      <th>18</th>
      <td>mood_2_Yearning</td>
      <td>0.008315</td>
      <td>0.00197</td>
    </tr>
    <tr>
      <th>19</th>
      <td>genre_2_Rock</td>
      <td>0.008229</td>
      <td>0.000827</td>
    </tr>
  </tbody>
</table>
</div>

<h5 id="quartiles-random-forest">Quartiles - Random Forest<a class="headerlink" href="#quartiles-random-forest" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code><span class="c1">### Create Categories</span>

<span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">labels</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">lim</span> <span class="o">=</span> <span class="mi">5</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">quant</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">lim</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">lim</span><span class="p">)):</span>
    <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">prev</span> <span class="o">=</span> <span class="n">quant</span>
        <span class="k">continue</span>
    <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">labels</span><span class="p">[</span><span class="n">labels</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">quant</span><span class="p">)]</span> <span class="o">=</span> <span class="n">idx</span>
        <span class="n">names</span> <span class="o">+=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;less than </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">quant</span><span class="p">)</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2"> listens&quot;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">labels</span><span class="p">[(</span><span class="n">labels</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">prev</span><span class="p">))</span>
              <span class="o">&amp;</span><span class="p">(</span><span class="n">labels</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">quant</span><span class="p">))]</span> <span class="o">=</span> <span class="n">idx</span>
        <span class="n">names</span> <span class="o">+=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">prev</span><span class="p">)</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2"> &lt; listens &lt;= </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">quant</span><span class="p">)</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
    <span class="n">prev</span> <span class="o">=</span> <span class="n">quant</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">labels</span>

<span class="c1">### Create Training Data</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">des_features</span> <span class="o">+</span> <span class="n">con_features</span><span class="p">]</span>
<span class="n">enc</span> <span class="o">=</span> <span class="n">OneHotEncoder</span><span class="p">()</span>
<span class="n">std</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>

<span class="n">X_cat</span> <span class="o">=</span> <span class="n">enc</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">des_features</span><span class="p">])</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span>
<span class="n">X_con</span> <span class="o">=</span> <span class="n">std</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">con_features</span><span class="p">])</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">X_con</span><span class="p">,</span> <span class="n">X_cat</span><span class="p">))</span>

<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>

<span class="c1">### Train Model</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="c1">### Asses Performance</span>

<span class="n">y_hat_test</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">y_hat_train</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Train Acc: </span><span class="si">{</span><span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">y_hat_train</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Test Acc: </span><span class="si">{</span><span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_hat_test</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_hat_test</span><span class="p">,</span> <span class="n">zero_division</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_hat_test</span><span class="p">),</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>Train Acc: 0.99
Test Acc: 0.33
              precision    recall  f1-score   support

           1       0.37      0.43      0.40     20461
           2       0.27      0.23      0.25     19966
           3       0.27      0.23      0.25     20082
           4       0.39      0.44      0.41     20165

    accuracy                           0.33     80674
   macro avg       0.33      0.33      0.33     80674
weighted avg       0.33      0.33      0.33     80674






&lt;AxesSubplot:&gt;
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_105_2.png" /></p>
<h5 id="binary-90th-percentile-random-forest">Binary, 90<sup>th</sup> Percentile, Random Forest<a class="headerlink" href="#binary-90th-percentile-random-forest" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code><span class="c1">### Create Categories</span>

<span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">labels</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">weights</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">weights</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;float&#39;</span>
<span class="n">lim</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">dom_class_weight</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">lim</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">quant</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">lim</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">lim</span><span class="p">)):</span>
    <span class="k">if</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="n">lim</span> <span class="o">-</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">prev</span> <span class="o">=</span> <span class="n">quant</span>
        <span class="k">continue</span>
    <span class="k">elif</span> <span class="n">idx</span> <span class="o">==</span> <span class="n">lim</span> <span class="o">-</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">weights</span><span class="p">[</span><span class="n">y</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">quant</span><span class="p">)]</span> <span class="o">=</span> <span class="n">dom_class_weight</span>
        <span class="n">labels</span><span class="p">[</span><span class="n">labels</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">quant</span><span class="p">)]</span> <span class="o">=</span> <span class="n">idx</span>
        <span class="n">names</span> <span class="o">+=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;less than </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">quant</span><span class="p">)</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2"> listens&quot;</span><span class="p">]</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">labels</span><span class="p">[(</span><span class="n">labels</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">prev</span><span class="p">))</span>
              <span class="o">&amp;</span><span class="p">(</span><span class="n">labels</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">quant</span><span class="p">))]</span> <span class="o">=</span> <span class="n">idx</span>
        <span class="n">weights</span><span class="p">[(</span><span class="n">y</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">prev</span><span class="p">))</span>
              <span class="o">&amp;</span><span class="p">(</span><span class="n">y</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">quant</span><span class="p">))]</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="n">names</span> <span class="o">+=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">prev</span><span class="p">)</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2"> &lt; listens &lt;= </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">quant</span><span class="p">)</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>

    <span class="n">prev</span> <span class="o">=</span> <span class="n">quant</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">labels</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">### Create Training Data</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">des_features</span> <span class="o">+</span> <span class="n">con_features</span><span class="p">]</span>
<span class="n">enc</span> <span class="o">=</span> <span class="n">OneHotEncoder</span><span class="p">()</span>
<span class="n">std</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>

<span class="n">X_cat</span> <span class="o">=</span> <span class="n">enc</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">des_features</span><span class="p">])</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span>
<span class="n">X_con</span> <span class="o">=</span> <span class="n">std</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">con_features</span><span class="p">])</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">X_con</span><span class="p">,</span> <span class="n">X_cat</span><span class="p">))</span>

<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">weight_train</span><span class="p">,</span> <span class="n">weight_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>


<span class="c1">### Strateification Code</span>

<span class="c1"># strat_y0_idx = np.array(random.sample(list(np.argwhere(y_train==3).reshape(-1)), np.unique(y_train, return_counts=True)[1][1]))</span>
<span class="c1"># strat_y1_idx = np.argwhere(y_train==4).reshape(-1)</span>
<span class="c1"># strat_idx = np.hstack((strat_y0_idx, strat_y1_idx))</span>
<span class="c1"># X_train = X_train[strat_idx]</span>
<span class="c1"># y_train = y_train[strat_idx]</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1">### Train Model</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="c1">### Assess Performance</span>

<span class="n">y_hat_test</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">y_hat_train</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Train Acc: </span><span class="si">{</span><span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">y_hat_train</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Test Acc: </span><span class="si">{</span><span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_hat_test</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_hat_test</span><span class="p">,</span> <span class="n">zero_division</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_hat_test</span><span class="p">),</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>/home/wbeckner/anaconda3/envs/py39/lib/python3.9/site-packages/sklearn/linear_model/_logistic.py:814: ConvergenceWarning: lbfgs failed to converge (status=1):
STOP: TOTAL NO. of ITERATIONS REACHED LIMIT.

Increase the number of iterations (max_iter) or scale the data as shown in:
    https://scikit-learn.org/stable/modules/preprocessing.html
Please also refer to the documentation for alternative solver options:
    https://scikit-learn.org/stable/modules/linear_model.html#logistic-regression
  n_iter_i = _check_optimize_result(


Train Acc: 0.76
Test Acc: 0.76
              precision    recall  f1-score   support

           3       0.76      0.98      0.86     60509
           4       0.58      0.08      0.13     20165

    accuracy                           0.76     80674
   macro avg       0.67      0.53      0.50     80674
weighted avg       0.72      0.76      0.68     80674






&lt;AxesSubplot:&gt;
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_109_3.png" /></p>
<h5 id="forward-selection-model">Forward Selection Model<a class="headerlink" href="#forward-selection-model" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code><span class="c1">### y</span>
<span class="nb">print</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">labels</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">weights</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">weights</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;float&#39;</span>
<span class="n">lim</span> <span class="o">=</span> <span class="mi">11</span>
<span class="n">dom_class_weight</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">lim</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">quant</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">lim</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">lim</span><span class="p">)):</span>
    <span class="k">if</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="n">lim</span> <span class="o">-</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">prev</span> <span class="o">=</span> <span class="n">quant</span>
        <span class="k">continue</span>
    <span class="k">elif</span> <span class="n">idx</span> <span class="o">==</span> <span class="n">lim</span> <span class="o">-</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">weights</span><span class="p">[</span><span class="n">y</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">quant</span><span class="p">)]</span> <span class="o">=</span> <span class="n">dom_class_weight</span>
        <span class="n">labels</span><span class="p">[</span><span class="n">labels</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">quant</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">names</span> <span class="o">+=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;less than </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">quant</span><span class="p">)</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2"> listens&quot;</span><span class="p">]</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">labels</span><span class="p">[(</span><span class="n">labels</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">prev</span><span class="p">))</span>
              <span class="o">&amp;</span> <span class="p">(</span><span class="n">labels</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">quant</span><span class="p">))]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">weights</span><span class="p">[(</span><span class="n">y</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">prev</span><span class="p">))</span>
              <span class="o">&amp;</span> <span class="p">(</span><span class="n">y</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">quant</span><span class="p">))]</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="n">names</span> <span class="o">+=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">prev</span><span class="p">)</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2"> &lt; listens &lt;= </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">quant</span><span class="p">)</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
    <span class="n">prev</span> <span class="o">=</span> <span class="n">quant</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">labels</span>

<span class="c1">#### X</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">des_features</span> <span class="o">+</span> <span class="n">con_features</span><span class="p">]</span>

<span class="n">enc</span> <span class="o">=</span> <span class="n">OneHotEncoder</span><span class="p">()</span>
<span class="n">std</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>

<span class="n">X_cat</span> <span class="o">=</span> <span class="n">enc</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">des_features</span><span class="p">])</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span>
<span class="n">X_con</span> <span class="o">=</span> <span class="n">std</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">con_features</span><span class="p">])</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">X_con</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">X_con</span><span class="p">,</span> <span class="n">X_cat</span><span class="p">))</span>
<span class="n">feature_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;intercept&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">con_features</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">enc</span><span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">())</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">feature_names</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>monthly_stream30s
[&#39;less than 432 listens&#39;, &#39;432 &lt; listens &lt;= 42497334&#39;]
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">add_feature</span><span class="p">(</span><span class="n">feature_names</span><span class="p">,</span> <span class="n">basemodel</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">r2max</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">disp</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="n">feature_max</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">bestsum</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">newmodel</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">feature_names</span><span class="p">:</span>
        <span class="n">basemodel</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span>
        <span class="n">X2</span> <span class="o">=</span> <span class="n">basemodel</span><span class="o">.</span><span class="n">values</span>
        <span class="n">est</span> <span class="o">=</span> <span class="n">Logit</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">X2</span><span class="p">)</span>
        <span class="n">est2</span> <span class="o">=</span> <span class="n">est</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">disp</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">summ</span> <span class="o">=</span> <span class="n">est2</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
        <span class="n">score</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">summ</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]))</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">score</span> <span class="o">&gt;</span> <span class="n">r2max</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">est2</span><span class="o">.</span><span class="n">pvalues</span> <span class="o">&gt;</span> <span class="n">cutoff</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="n">r2max</span> <span class="o">=</span> <span class="n">score</span>
            <span class="n">feature_max</span> <span class="o">=</span> <span class="n">feature</span>
            <span class="n">bestsum</span> <span class="o">=</span> <span class="n">est2</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
            <span class="n">newmodel</span> <span class="o">=</span> <span class="n">basemodel</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">disp</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;new r2max, </span><span class="si">{</span><span class="n">feature_max</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">r2max</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">basemodel</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">labels</span> <span class="o">=</span> <span class="n">feature</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">r2max</span><span class="p">,</span> <span class="n">feature_max</span><span class="p">,</span> <span class="n">bestsum</span><span class="p">,</span> <span class="n">newmodel</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">candidates</span> <span class="o">=</span> <span class="n">feature_names</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">basemodel</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">r2max</span> <span class="o">=</span> <span class="mi">0</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;canidates.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;w+&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">file_data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">candidates</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">basemodel</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;basemodel.csv&quot;</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;canidates.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="c1"># file_data = f.read()</span>
    <span class="n">new</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">current_place</span> <span class="o">=</span> <span class="n">line</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">new</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_place</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">new</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;basemodel.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;fwd_selection_results.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;r+&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="n">lastline</span> <span class="o">=</span> <span class="n">line</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">stuff</span> <span class="o">=</span> <span class="n">lastline</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="p">)</span>
    <span class="n">new</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">stuff</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">new</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>0.04052
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">newr2max</span><span class="p">,</span> <span class="n">feature_max</span><span class="p">,</span> <span class="n">bestsum</span><span class="p">,</span> <span class="n">newmodel</span> <span class="o">=</span> <span class="n">add_feature</span><span class="p">(</span>
        <span class="n">feature_names</span><span class="o">=</span><span class="n">candidates</span><span class="p">,</span> 
        <span class="n">basemodel</span><span class="o">=</span><span class="n">basemodel</span><span class="p">,</span> 
        <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> 
        <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
        <span class="n">r2max</span><span class="o">=</span><span class="n">r2max</span><span class="p">)</span>    
    <span class="k">if</span> <span class="n">newr2max</span> <span class="o">&gt;</span> <span class="n">r2max</span><span class="p">:</span>
        <span class="n">r2max</span> <span class="o">=</span> <span class="n">newr2max</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;new r2max, </span><span class="si">{</span><span class="n">feature_max</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">r2max</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;fwd_selection_results.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;a+&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">file_data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;new r2max, </span><span class="si">{</span><span class="n">feature_max</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">r2max</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">candidates</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">feature_max</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;canidates.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;w+&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">file_data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">candidates</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">basemodel</span> <span class="o">=</span> <span class="n">newmodel</span>
        <span class="n">basemodel</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;basemodel.csv&quot;</span><span class="p">)</span>
        <span class="k">continue</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">break</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>new r2max, n_albums, 0.02614
new r2max, genre_1_Latin, 0.03093
new r2max, genre_1_Indie Rock, 0.03274
new r2max, genre_1_Rap, 0.03431
new r2max, genre_1_Dance &amp; House, 0.03568
new r2max, genre_1_Rock, 0.03674
new r2max, mood_1_Energizing, 0.03772
new r2max, genre_1_Children&#39;s, 0.03863
new r2max, mood_1_Tender, 0.03931
new r2max, mood_1_Other, 0.03995
new r2max, n_tracks, 0.04052



---------------------------------------------------------------------------

KeyboardInterrupt                         Traceback (most recent call last)

Input In [675], in &lt;module&gt;
      1 while True:
----&gt; 2     newr2max, feature_max, bestsum, newmodel = add_feature(
      3         feature_names=candidates, 
      4         basemodel=basemodel, 
      5         data=data, 
      6         y=y,
      7         r2max=r2max)    
      8     if newr2max &gt; r2max:
      9         r2max = newr2max


Input In [669], in add_feature(feature_names, basemodel, data, y, r2max, model, disp)
      8 est = Logit(y, X2)
      9 est2 = est.fit(disp=0)
---&gt; 10 summ = est2.summary()
     11 score = float(str(pd.DataFrame(summ.tables[0]).loc[3, 3]))
     12 if (score &gt; r2max) and not (est2.pvalues &gt; cutoff).any():


File ~/anaconda3/envs/py39/lib/python3.9/site-packages/statsmodels/discrete/discrete_model.py:4015, in BinaryResults.summary(self, yname, xname, title, alpha, yname_list)
   4012 @Appender(DiscreteResults.summary.__doc__)
   4013 def summary(self, yname=None, xname=None, title=None, alpha=.05,
   4014             yname_list=None):
-&gt; 4015     smry = super(BinaryResults, self).summary(yname, xname, title, alpha,
   4016                                               yname_list)
   4017     fittedvalues = self.model.cdf(self.fittedvalues)
   4018     absprederror = np.abs(self.model.endog - fittedvalues)


File ~/anaconda3/envs/py39/lib/python3.9/site-packages/statsmodels/discrete/discrete_model.py:3769, in DiscreteResults.summary(self, yname, xname, title, alpha, yname_list)
   3731 &quot;&quot;&quot;
   3732 Summarize the Regression Results.
   3733 
   (...)
   3755 statsmodels.iolib.summary.Summary : Class that hold summary results.
   3756 &quot;&quot;&quot;
   3758 top_left = [(&#39;Dep. Variable:&#39;, None),
   3759              (&#39;Model:&#39;, [self.model.__class__.__name__]),
   3760              (&#39;Method:&#39;, [&#39;MLE&#39;]),
   (...)
   3763              (&#39;converged:&#39;, [&quot;%s&quot; % self.mle_retvals[&#39;converged&#39;]]),
   3764             ]
   3766 top_right = [(&#39;No. Observations:&#39;, None),
   3767              (&#39;Df Residuals:&#39;, None),
   3768              (&#39;Df Model:&#39;, None),
-&gt; 3769              (&#39;Pseudo R-squ.:&#39;, [&quot;%#6.4g&quot; % self.prsquared]),
   3770              (&#39;Log-Likelihood:&#39;, None),
   3771              (&#39;LL-Null:&#39;, [&quot;%#8.5g&quot; % self.llnull]),
   3772              (&#39;LLR p-value:&#39;, [&quot;%#6.4g&quot; % self.llr_pvalue])
   3773              ]
   3775 if hasattr(self, &#39;cov_type&#39;):
   3776     top_left.append((&#39;Covariance Type:&#39;, [self.cov_type]))


File ~/anaconda3/envs/py39/lib/python3.9/site-packages/pandas/_libs/properties.pyx:37, in pandas._libs.properties.CachedProperty.__get__()


File ~/anaconda3/envs/py39/lib/python3.9/site-packages/statsmodels/discrete/discrete_model.py:3511, in DiscreteResults.prsquared(self)
   3506 @cache_readonly
   3507 def prsquared(self):
   3508     &quot;&quot;&quot;
   3509     McFadden&#39;s pseudo-R-squared. `1 - (llf / llnull)`
   3510     &quot;&quot;&quot;
-&gt; 3511     return 1 - self.llf/self.llnull


File ~/anaconda3/envs/py39/lib/python3.9/site-packages/pandas/_libs/properties.pyx:37, in pandas._libs.properties.CachedProperty.__get__()


File ~/anaconda3/envs/py39/lib/python3.9/site-packages/statsmodels/discrete/discrete_model.py:3604, in DiscreteResults.llnull(self)
   3601     res_null = mod_null.fit(start_params=sp_null, **opt_kwds)
   3602 else:
   3603     # this should be a reasonably method case across versions
-&gt; 3604     res_null = mod_null.fit(start_params=sp_null, method=&#39;nm&#39;,
   3605                             warn_convergence=False,
   3606                             maxiter=10000, disp=0)
   3607     res_null = mod_null.fit(start_params=res_null.params, method=&#39;bfgs&#39;,
   3608                             warn_convergence=False,
   3609                             maxiter=10000, disp=0)
   3611 if getattr(self, &#39;_attach_nullmodel&#39;, False) is not False:


File ~/anaconda3/envs/py39/lib/python3.9/site-packages/statsmodels/discrete/discrete_model.py:1983, in Logit.fit(self, start_params, method, maxiter, full_output, disp, callback, **kwargs)
   1980 @Appender(DiscreteModel.fit.__doc__)
   1981 def fit(self, start_params=None, method=&#39;newton&#39;, maxiter=35,
   1982         full_output=1, disp=1, callback=None, **kwargs):
-&gt; 1983     bnryfit = super().fit(start_params=start_params,
   1984                           method=method,
   1985                           maxiter=maxiter,
   1986                           full_output=full_output,
   1987                           disp=disp,
   1988                           callback=callback,
   1989                           **kwargs)
   1991     discretefit = LogitResults(self, bnryfit)
   1992     return BinaryResultsWrapper(discretefit)


File ~/anaconda3/envs/py39/lib/python3.9/site-packages/statsmodels/discrete/discrete_model.py:230, in DiscreteModel.fit(self, start_params, method, maxiter, full_output, disp, callback, **kwargs)
    227 else:
    228     pass  # TODO: make a function factory to have multiple call-backs
--&gt; 230 mlefit = super().fit(start_params=start_params,
    231                      method=method,
    232                      maxiter=maxiter,
    233                      full_output=full_output,
    234                      disp=disp,
    235                      callback=callback,
    236                      **kwargs)
    238 return mlefit


File ~/anaconda3/envs/py39/lib/python3.9/site-packages/statsmodels/base/model.py:563, in LikelihoodModel.fit(self, start_params, method, maxiter, full_output, disp, fargs, callback, retall, skip_hessian, **kwargs)
    560     del kwargs[&quot;use_t&quot;]
    562 optimizer = Optimizer()
--&gt; 563 xopt, retvals, optim_settings = optimizer._fit(f, score, start_params,
    564                                                fargs, kwargs,
    565                                                hessian=hess,
    566                                                method=method,
    567                                                disp=disp,
    568                                                maxiter=maxiter,
    569                                                callback=callback,
    570                                                retall=retall,
    571                                                full_output=full_output)
    572 # Restore cov_type, cov_kwds and use_t
    573 optim_settings.update(kwds)


File ~/anaconda3/envs/py39/lib/python3.9/site-packages/statsmodels/base/optimizer.py:241, in Optimizer._fit(self, objective, gradient, start_params, fargs, kwargs, hessian, method, maxiter, full_output, disp, callback, retall)
    238     fit_funcs.update(extra_fit_funcs)
    240 func = fit_funcs[method]
--&gt; 241 xopt, retvals = func(objective, gradient, start_params, fargs, kwargs,
    242                      disp=disp, maxiter=maxiter, callback=callback,
    243                      retall=retall, full_output=full_output,
    244                      hess=hessian)
    246 optim_settings = {&#39;optimizer&#39;: method, &#39;start_params&#39;: start_params,
    247                   &#39;maxiter&#39;: maxiter, &#39;full_output&#39;: full_output,
    248                   &#39;disp&#39;: disp, &#39;fargs&#39;: fargs, &#39;callback&#39;: callback,
    249                   &#39;retall&#39;: retall, &quot;extra_fit_funcs&quot;: extra_fit_funcs}
    250 optim_settings.update(kwargs)


File ~/anaconda3/envs/py39/lib/python3.9/site-packages/statsmodels/base/optimizer.py:728, in _fit_nm(f, score, start_params, fargs, kwargs, disp, maxiter, callback, retall, full_output, hess)
    726 ftol = kwargs.setdefault(&#39;ftol&#39;, 0.0001)
    727 maxfun = kwargs.setdefault(&#39;maxfun&#39;, None)
--&gt; 728 retvals = optimize.fmin(f, start_params, args=fargs, xtol=xtol,
    729                         ftol=ftol, maxiter=maxiter, maxfun=maxfun,
    730                         full_output=full_output, disp=disp, retall=retall,
    731                         callback=callback)
    732 if full_output:
    733     if not retall:


File ~/anaconda3/envs/py39/lib/python3.9/site-packages/scipy/optimize/optimize.py:580, in fmin(func, x0, args, xtol, ftol, maxiter, maxfun, full_output, disp, retall, callback, initial_simplex)
    471 &quot;&quot;&quot;
    472 Minimize a function using the downhill simplex algorithm.
    473 
   (...)
    570 
    571 &quot;&quot;&quot;
    572 opts = {&#39;xatol&#39;: xtol,
    573         &#39;fatol&#39;: ftol,
    574         &#39;maxiter&#39;: maxiter,
   (...)
    577         &#39;return_all&#39;: retall,
    578         &#39;initial_simplex&#39;: initial_simplex}
--&gt; 580 res = _minimize_neldermead(func, x0, args, callback=callback, **opts)
    581 if full_output:
    582     retlist = res[&#39;x&#39;], res[&#39;fun&#39;], res[&#39;nit&#39;], res[&#39;nfev&#39;], res[&#39;status&#39;]


File ~/anaconda3/envs/py39/lib/python3.9/site-packages/scipy/optimize/optimize.py:768, in _minimize_neldermead(func, x0, args, callback, maxiter, maxfev, disp, return_all, initial_simplex, xatol, fatol, adaptive, bounds, **unknown_options)
    766 if bounds is not None:
    767     xr = np.clip(xr, lower_bound, upper_bound)
--&gt; 768 fxr = func(xr)
    769 doshrink = 0
    771 if fxr &lt; fsim[0]:


File ~/anaconda3/envs/py39/lib/python3.9/site-packages/scipy/optimize/optimize.py:464, in _wrap_function.&lt;locals&gt;.function_wrapper(x, *wrapper_args)
    462 def function_wrapper(x, *wrapper_args):
    463     ncalls[0] += 1
--&gt; 464     return function(np.copy(x), *(wrapper_args + args))


File ~/anaconda3/envs/py39/lib/python3.9/site-packages/statsmodels/base/model.py:531, in LikelihoodModel.fit.&lt;locals&gt;.f(params, *args)
    530 def f(params, *args):
--&gt; 531     return -self.loglike(params, *args) / nobs


File ~/anaconda3/envs/py39/lib/python3.9/site-packages/statsmodels/discrete/discrete_model.py:1872, in Logit.loglike(self, params)
   1870 q = 2*self.endog - 1
   1871 X = self.exog
-&gt; 1872 return np.sum(np.log(self.cdf(q*np.dot(X,params))))


File &lt;__array_function__ internals&gt;:5, in dot(*args, **kwargs)


KeyboardInterrupt:
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">candidates</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>[&#39;n_artists&#39;,
 &#39;n_local_tracks&#39;,
 &#39;mood_1_-&#39;,
 &#39;mood_1_Aggressive&#39;,
 &#39;mood_1_Brooding&#39;,
 &#39;mood_1_Cool&#39;,
 &#39;mood_1_Defiant&#39;,
 &#39;mood_1_Easygoing&#39;,
 &#39;mood_1_Empowering&#39;,
 &#39;mood_1_Excited&#39;,
 &#39;mood_1_Fiery&#39;,
 &#39;mood_1_Gritty&#39;,
 &#39;mood_1_Lively&#39;,
 &#39;mood_1_Melancholy&#39;,
 &#39;mood_1_Peaceful&#39;,
 &#39;mood_1_Romantic&#39;,
 &#39;mood_1_Rowdy&#39;,
 &#39;mood_1_Sensual&#39;,
 &#39;mood_1_Sentimental&#39;,
 &#39;mood_1_Serious&#39;,
 &#39;mood_1_Somber&#39;,
 &#39;mood_1_Sophisticated&#39;,
 &#39;mood_1_Stirring&#39;,
 &#39;mood_1_Upbeat&#39;,
 &#39;mood_1_Urgent&#39;,
 &#39;mood_1_Yearning&#39;,
 &#39;mood_2_-&#39;,
 &#39;mood_2_Aggressive&#39;,
 &#39;mood_2_Brooding&#39;,
 &#39;mood_2_Cool&#39;,
 &#39;mood_2_Defiant&#39;,
 &#39;mood_2_Easygoing&#39;,
 &#39;mood_2_Empowering&#39;,
 &#39;mood_2_Energizing&#39;,
 &#39;mood_2_Excited&#39;,
 &#39;mood_2_Fiery&#39;,
 &#39;mood_2_Gritty&#39;,
 &#39;mood_2_Lively&#39;,
 &#39;mood_2_Melancholy&#39;,
 &#39;mood_2_Other&#39;,
 &#39;mood_2_Peaceful&#39;,
 &#39;mood_2_Romantic&#39;,
 &#39;mood_2_Rowdy&#39;,
 &#39;mood_2_Sensual&#39;,
 &#39;mood_2_Sentimental&#39;,
 &#39;mood_2_Serious&#39;,
 &#39;mood_2_Somber&#39;,
 &#39;mood_2_Sophisticated&#39;,
 &#39;mood_2_Stirring&#39;,
 &#39;mood_2_Tender&#39;,
 &#39;mood_2_Upbeat&#39;,
 &#39;mood_2_Urgent&#39;,
 &#39;mood_2_Yearning&#39;,
 &#39;mood_3_-&#39;,
 &#39;mood_3_Aggressive&#39;,
 &#39;mood_3_Brooding&#39;,
 &#39;mood_3_Cool&#39;,
 &#39;mood_3_Defiant&#39;,
 &#39;mood_3_Easygoing&#39;,
 &#39;mood_3_Empowering&#39;,
 &#39;mood_3_Energizing&#39;,
 &#39;mood_3_Excited&#39;,
 &#39;mood_3_Fiery&#39;,
 &#39;mood_3_Gritty&#39;,
 &#39;mood_3_Lively&#39;,
 &#39;mood_3_Melancholy&#39;,
 &#39;mood_3_Other&#39;,
 &#39;mood_3_Peaceful&#39;,
 &#39;mood_3_Romantic&#39;,
 &#39;mood_3_Rowdy&#39;,
 &#39;mood_3_Sensual&#39;,
 &#39;mood_3_Sentimental&#39;,
 &#39;mood_3_Serious&#39;,
 &#39;mood_3_Somber&#39;,
 &#39;mood_3_Sophisticated&#39;,
 &#39;mood_3_Stirring&#39;,
 &#39;mood_3_Tender&#39;,
 &#39;mood_3_Upbeat&#39;,
 &#39;mood_3_Urgent&#39;,
 &#39;mood_3_Yearning&#39;,
 &#39;genre_1_-&#39;,
 &#39;genre_1_Alternative&#39;,
 &#39;genre_1_Blues&#39;,
 &#39;genre_1_Classical&#39;,
 &#39;genre_1_Country &amp; Folk&#39;,
 &#39;genre_1_Easy Listening&#39;,
 &#39;genre_1_Electronica&#39;,
 &#39;genre_1_Holiday&#39;,
 &#39;genre_1_Jazz&#39;,
 &#39;genre_1_Metal&#39;,
 &#39;genre_1_New Age&#39;,
 &#39;genre_1_Other&#39;,
 &#39;genre_1_Pop&#39;,
 &#39;genre_1_Punk&#39;,
 &#39;genre_1_R&amp;B&#39;,
 &#39;genre_1_Reggae&#39;,
 &#39;genre_1_Religious&#39;,
 &#39;genre_1_Soundtrack&#39;,
 &#39;genre_1_Spoken &amp; Audio&#39;,
 &#39;genre_1_Traditional&#39;,
 &#39;genre_2_-&#39;,
 &#39;genre_2_Alternative&#39;,
 &#39;genre_2_Blues&#39;,
 &quot;genre_2_Children&#39;s&quot;,
 &#39;genre_2_Classical&#39;,
 &#39;genre_2_Country &amp; Folk&#39;,
 &#39;genre_2_Dance &amp; House&#39;,
 &#39;genre_2_Easy Listening&#39;,
 &#39;genre_2_Electronica&#39;,
 &#39;genre_2_Holiday&#39;,
 &#39;genre_2_Indie Rock&#39;,
 &#39;genre_2_Jazz&#39;,
 &#39;genre_2_Latin&#39;,
 &#39;genre_2_Metal&#39;,
 &#39;genre_2_New Age&#39;,
 &#39;genre_2_Other&#39;,
 &#39;genre_2_Pop&#39;,
 &#39;genre_2_Punk&#39;,
 &#39;genre_2_R&amp;B&#39;,
 &#39;genre_2_Rap&#39;,
 &#39;genre_2_Reggae&#39;,
 &#39;genre_2_Religious&#39;,
 &#39;genre_2_Rock&#39;,
 &#39;genre_2_Soundtrack&#39;,
 &#39;genre_2_Spoken &amp; Audio&#39;,
 &#39;genre_2_Traditional&#39;,
 &#39;genre_3_-&#39;,
 &#39;genre_3_Alternative&#39;,
 &#39;genre_3_Blues&#39;,
 &quot;genre_3_Children&#39;s&quot;,
 &#39;genre_3_Classical&#39;,
 &#39;genre_3_Country &amp; Folk&#39;,
 &#39;genre_3_Dance &amp; House&#39;,
 &#39;genre_3_Easy Listening&#39;,
 &#39;genre_3_Electronica&#39;,
 &#39;genre_3_Holiday&#39;,
 &#39;genre_3_Indie Rock&#39;,
 &#39;genre_3_Jazz&#39;,
 &#39;genre_3_Latin&#39;,
 &#39;genre_3_Metal&#39;,
 &#39;genre_3_New Age&#39;,
 &#39;genre_3_Other&#39;,
 &#39;genre_3_Pop&#39;,
 &#39;genre_3_Punk&#39;,
 &#39;genre_3_R&amp;B&#39;,
 &#39;genre_3_Rap&#39;,
 &#39;genre_3_Reggae&#39;,
 &#39;genre_3_Religious&#39;,
 &#39;genre_3_Rock&#39;,
 &#39;genre_3_Soundtrack&#39;,
 &#39;genre_3_Spoken &amp; Audio&#39;,
 &#39;genre_3_Traditional&#39;]
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">X2</span> <span class="o">=</span> <span class="n">basemodel</span><span class="o">.</span><span class="n">values</span>
<span class="n">est</span> <span class="o">=</span> <span class="n">Logit</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">X2</span><span class="p">)</span>
<span class="n">est2</span> <span class="o">=</span> <span class="n">est</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">disp</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">summ</span> <span class="o">=</span> <span class="n">est2</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>

<span class="n">res_table</span> <span class="o">=</span> <span class="n">summ</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">res_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">res_table</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="n">cols</span> <span class="o">=</span> <span class="n">res_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">]</span>
<span class="n">res_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">res_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">res_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">cols</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
<span class="n">res_df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">basemodel</span><span class="o">.</span><span class="n">columns</span>
<span class="n">res_df</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>coef</th>
      <th>std err</th>
      <th>z</th>
      <th>P&gt;|z|</th>
      <th>[0.025</th>
      <th>0.975]</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>intercept</th>
      <td>-2.0979</td>
      <td>0.008</td>
      <td>-273.128</td>
      <td>0.000</td>
      <td>-2.113</td>
      <td>-2.083</td>
    </tr>
    <tr>
      <th>n_albums</th>
      <td>0.3430</td>
      <td>0.006</td>
      <td>61.214</td>
      <td>0.000</td>
      <td>0.332</td>
      <td>0.354</td>
    </tr>
    <tr>
      <th>genre_1_Latin</th>
      <td>0.6929</td>
      <td>0.023</td>
      <td>30.536</td>
      <td>0.000</td>
      <td>0.648</td>
      <td>0.737</td>
    </tr>
    <tr>
      <th>genre_1_Indie Rock</th>
      <td>-0.4654</td>
      <td>0.016</td>
      <td>-28.755</td>
      <td>0.000</td>
      <td>-0.497</td>
      <td>-0.434</td>
    </tr>
    <tr>
      <th>genre_1_Rap</th>
      <td>-0.3804</td>
      <td>0.016</td>
      <td>-23.163</td>
      <td>0.000</td>
      <td>-0.413</td>
      <td>-0.348</td>
    </tr>
    <tr>
      <th>genre_1_Dance &amp; House</th>
      <td>-0.3978</td>
      <td>0.022</td>
      <td>-18.022</td>
      <td>0.000</td>
      <td>-0.441</td>
      <td>-0.355</td>
    </tr>
    <tr>
      <th>genre_1_Rock</th>
      <td>-0.3562</td>
      <td>0.023</td>
      <td>-15.423</td>
      <td>0.000</td>
      <td>-0.402</td>
      <td>-0.311</td>
    </tr>
    <tr>
      <th>mood_1_Energizing</th>
      <td>-0.3623</td>
      <td>0.025</td>
      <td>-14.323</td>
      <td>0.000</td>
      <td>-0.412</td>
      <td>-0.313</td>
    </tr>
    <tr>
      <th>genre_1_Children's</th>
      <td>0.9479</td>
      <td>0.061</td>
      <td>15.652</td>
      <td>0.000</td>
      <td>0.829</td>
      <td>1.067</td>
    </tr>
    <tr>
      <th>mood_1_Tender</th>
      <td>0.6629</td>
      <td>0.047</td>
      <td>14.006</td>
      <td>0.000</td>
      <td>0.570</td>
      <td>0.756</td>
    </tr>
    <tr>
      <th>mood_1_Other</th>
      <td>0.8465</td>
      <td>0.062</td>
      <td>13.611</td>
      <td>0.000</td>
      <td>0.725</td>
      <td>0.968</td>
    </tr>
    <tr>
      <th>n_tracks</th>
      <td>0.0688</td>
      <td>0.006</td>
      <td>11.549</td>
      <td>0.000</td>
      <td>0.057</td>
      <td>0.080</td>
    </tr>
    <tr>
      <th>mood_2_Serious</th>
      <td>0.0046</td>
      <td>0.080</td>
      <td>0.058</td>
      <td>0.954</td>
      <td>-0.151</td>
      <td>0.161</td>
    </tr>
  </tbody>
</table>
</div>

<h5 id="binary-99th-percentile">Binary, 99<sup>th</sup> Percentile<a class="headerlink" href="#binary-99th-percentile" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code><span class="c1">### Create Categories</span>

<span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">labels</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">weights</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">weights</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;float&#39;</span>
<span class="n">lim</span> <span class="o">=</span> <span class="mi">11</span>
<span class="n">dom_class_weight</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">lim</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">quant</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">lim</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">lim</span><span class="p">)):</span>
    <span class="k">if</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="n">lim</span> <span class="o">-</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">prev</span> <span class="o">=</span> <span class="n">quant</span>
        <span class="k">continue</span>
    <span class="k">elif</span> <span class="n">idx</span> <span class="o">==</span> <span class="n">lim</span> <span class="o">-</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">weights</span><span class="p">[</span><span class="n">y</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">quant</span><span class="p">)]</span> <span class="o">=</span> <span class="n">dom_class_weight</span>
        <span class="n">labels</span><span class="p">[</span><span class="n">labels</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">quant</span><span class="p">)]</span> <span class="o">=</span> <span class="n">idx</span>
        <span class="n">names</span> <span class="o">+=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;less than </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">quant</span><span class="p">)</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2"> listens&quot;</span><span class="p">]</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">labels</span><span class="p">[(</span><span class="n">labels</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">prev</span><span class="p">))</span>
              <span class="o">&amp;</span><span class="p">(</span><span class="n">labels</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">quant</span><span class="p">))]</span> <span class="o">=</span> <span class="n">idx</span>
        <span class="n">weights</span><span class="p">[(</span><span class="n">y</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">prev</span><span class="p">))</span>
              <span class="o">&amp;</span><span class="p">(</span><span class="n">y</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">quant</span><span class="p">))]</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="n">names</span> <span class="o">+=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">prev</span><span class="p">)</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2"> &lt; listens &lt;= </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">quant</span><span class="p">)</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>

    <span class="n">prev</span> <span class="o">=</span> <span class="n">quant</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">labels</span>

<span class="c1">### Create Training Data</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">des_features</span> <span class="o">+</span> <span class="n">con_features</span><span class="p">]</span>
<span class="n">enc</span> <span class="o">=</span> <span class="n">OneHotEncoder</span><span class="p">()</span>
<span class="n">std</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>

<span class="n">X_cat</span> <span class="o">=</span> <span class="n">enc</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">des_features</span><span class="p">])</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span>
<span class="n">X_con</span> <span class="o">=</span> <span class="n">std</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">con_features</span><span class="p">])</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">X_con</span><span class="p">,</span> <span class="n">X_cat</span><span class="p">))</span>

<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">weight_train</span><span class="p">,</span> <span class="n">weight_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>

<span class="c1">### Train Model</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">weight_train</span><span class="p">)</span>

<span class="c1">### Asses Performance</span>

<span class="n">y_hat_test</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">y_hat_train</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Train Acc: </span><span class="si">{</span><span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">y_hat_train</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Test Acc: </span><span class="si">{</span><span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_hat_test</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_hat_test</span><span class="p">,</span> <span class="n">zero_division</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_hat_test</span><span class="p">),</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>Train Acc: 1.00
Test Acc: 0.90
              precision    recall  f1-score   support

           9       0.90      0.99      0.94     72615
          10       0.27      0.03      0.05      8059

    accuracy                           0.90     80674
   macro avg       0.59      0.51      0.50     80674
weighted avg       0.84      0.90      0.86     80674






&lt;AxesSubplot:&gt;
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_124_2.png" /></p>
<h2 id="other-metrics">Other Metrics<a class="headerlink" href="#other-metrics" title="Permanent link">&para;</a></h2>
<ul>
<li>30s listens/tot listens (listen conversions) <em>also like a bounce rate</em></li>
<li>Users both months/users prev month (user conversions)<ul>
<li>combine with mau &gt; mau_previous_month</li>
</ul>
</li>
<li>Best small time performers (less than X total monthly listens + high conversion)</li>
<li>Best new user playlist (owner has only 1 popular playlist)</li>
</ul>
<h3 id="listen-and-user-conversions-mau-growing">Listen and User Conversions, MAU Growing<a class="headerlink" href="#listen-and-user-conversions-mau-growing" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="n">df</span><span class="p">[</span><span class="s1">&#39;listen_conversions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;stream30s&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;streams&#39;</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;listen_conversions&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">df</span><span class="p">[</span><span class="s1">&#39;user_retention&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;mau_both_months&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;mau_previous_month&#39;</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;user_retention&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">df</span><span class="p">[</span><span class="s1">&#39;user_conversions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;mau&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;users&#39;</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;user_conversions&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<span class="n">df</span><span class="p">[</span><span class="s1">&#39;mau_growing&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;mau&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;mau_previous_month&#39;</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;mau_growth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;mau&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;mau_previous_month&#39;</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;mau_growth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;mau_growth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">new_metrics</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;listen_conversions&#39;</span><span class="p">,</span> <span class="s1">&#39;user_conversions&#39;</span><span class="p">,</span> <span class="s1">&#39;user_retention&#39;</span><span class="p">,</span> <span class="s1">&#39;mau_growth&#39;</span><span class="p">]</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">df</span><span class="p">[</span><span class="n">new_metrics</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>listen_conversions</th>
      <th>user_conversions</th>
      <th>user_retention</th>
      <th>mau_growth</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>403366.000000</td>
      <td>403366.000000</td>
      <td>403366.000000</td>
      <td>403366.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>0.334701</td>
      <td>0.724072</td>
      <td>0.571070</td>
      <td>1.513218</td>
    </tr>
    <tr>
      <th>std</th>
      <td>0.399968</td>
      <td>0.261708</td>
      <td>0.392073</td>
      <td>17.459669</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.000000</td>
      <td>0.020348</td>
      <td>0.000000</td>
      <td>0.031250</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>0.000000</td>
      <td>0.500000</td>
      <td>0.200000</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>0.000000</td>
      <td>0.666667</td>
      <td>0.500000</td>
      <td>1.066667</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>0.730769</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>2.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>7859.000000</td>
    </tr>
  </tbody>
</table>
</div>

<div class="codehilite"><pre><span></span><code><span class="n">df</span><span class="p">[</span><span class="s1">&#39;listen_conversions&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;hist&#39;</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>&lt;AxesSubplot:ylabel=&#39;Frequency&#39;&gt;
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_130_1.png" /></p>
<div class="codehilite"><pre><span></span><code><span class="n">df</span><span class="p">[</span><span class="s1">&#39;user_conversions&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;hist&#39;</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>&lt;AxesSubplot:ylabel=&#39;Frequency&#39;&gt;
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_131_1.png" /></p>
<div class="codehilite"><pre><span></span><code><span class="n">df</span><span class="p">[</span><span class="s1">&#39;user_retention&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;hist&#39;</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>&lt;AxesSubplot:ylabel=&#39;Frequency&#39;&gt;
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_132_1.png" /></p>
<div class="codehilite"><pre><span></span><code><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;mau_growth&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">][</span><span class="s1">&#39;mau_growth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;hist&#39;</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>&lt;AxesSubplot:ylabel=&#39;Frequency&#39;&gt;
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_133_1.png" /></p>
<div class="codehilite"><pre><span></span><code><span class="n">df</span><span class="p">[</span><span class="s1">&#39;mau_growing&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>&lt;AxesSubplot:&gt;
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_134_1.png" /></p>
<div class="codehilite"><pre><span></span><code><span class="n">df</span><span class="p">[</span><span class="s1">&#39;new_success&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">new_metrics</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="k">else</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">df</span><span class="p">[</span><span class="s1">&#39;new_success&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>False    362869
True      40497
Name: new_success, dtype: int64
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;new_success&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">]</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>playlist_uri</th>
      <th>owner</th>
      <th>streams</th>
      <th>stream30s</th>
      <th>dau</th>
      <th>wau</th>
      <th>mau</th>
      <th>mau_previous_month</th>
      <th>mau_both_months</th>
      <th>users</th>
      <th>skippers</th>
      <th>owner_country</th>
      <th>n_tracks</th>
      <th>n_local_tracks</th>
      <th>n_artists</th>
      <th>n_albums</th>
      <th>monthly_stream30s</th>
      <th>monthly_owner_stream30s</th>
      <th>tokens</th>
      <th>genre_1</th>
      <th>genre_2</th>
      <th>genre_3</th>
      <th>mood_1</th>
      <th>mood_2</th>
      <th>mood_3</th>
      <th>success</th>
      <th>listen_conversions</th>
      <th>user_retention</th>
      <th>user_conversions</th>
      <th>mau_growing</th>
      <th>mau_growth</th>
      <th>new_success</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>14</th>
      <td>spotify:user:9a3580868994077be27d244788d494cd:...</td>
      <td>9a3580868994077be27d244788d494cd</td>
      <td>28</td>
      <td>15</td>
      <td>1</td>
      <td>1</td>
      <td>2</td>
      <td>1</td>
      <td>1</td>
      <td>2</td>
      <td>0</td>
      <td>US</td>
      <td>321</td>
      <td>0</td>
      <td>170</td>
      <td>205</td>
      <td>83</td>
      <td>77</td>
      <td>["sunny", "daze"]</td>
      <td>Alternative</td>
      <td>Indie Rock</td>
      <td>Electronica</td>
      <td>Brooding</td>
      <td>Excited</td>
      <td>Sensual</td>
      <td>False</td>
      <td>0.535714</td>
      <td>1.0</td>
      <td>1.000000</td>
      <td>True</td>
      <td>2.000000</td>
      <td>True</td>
    </tr>
    <tr>
      <th>18</th>
      <td>spotify:user:7abbdbd3119687473b8f2986e73e2ad6:...</td>
      <td>7abbdbd3119687473b8f2986e73e2ad6</td>
      <td>9</td>
      <td>5</td>
      <td>1</td>
      <td>2</td>
      <td>2</td>
      <td>1</td>
      <td>1</td>
      <td>2</td>
      <td>0</td>
      <td>US</td>
      <td>373</td>
      <td>8</td>
      <td>1</td>
      <td>1</td>
      <td>18</td>
      <td>11</td>
      <td>[]</td>
      <td>Pop</td>
      <td>Alternative</td>
      <td>Indie Rock</td>
      <td>Empowering</td>
      <td>Excited</td>
      <td>Urgent</td>
      <td>False</td>
      <td>0.555556</td>
      <td>1.0</td>
      <td>1.000000</td>
      <td>True</td>
      <td>2.000000</td>
      <td>True</td>
    </tr>
    <tr>
      <th>20</th>
      <td>spotify:user:838141e861005b6a955cb389c19671a5:...</td>
      <td>838141e861005b6a955cb389c19671a5</td>
      <td>32</td>
      <td>25</td>
      <td>2</td>
      <td>3</td>
      <td>4</td>
      <td>3</td>
      <td>3</td>
      <td>5</td>
      <td>1</td>
      <td>US</td>
      <td>904</td>
      <td>0</td>
      <td>81</td>
      <td>125</td>
      <td>327</td>
      <td>253</td>
      <td>["metalcore", "forever"]</td>
      <td>Punk</td>
      <td>Metal</td>
      <td>Rock</td>
      <td>Defiant</td>
      <td>Urgent</td>
      <td>Aggressive</td>
      <td>False</td>
      <td>0.781250</td>
      <td>1.0</td>
      <td>0.800000</td>
      <td>True</td>
      <td>1.333333</td>
      <td>True</td>
    </tr>
    <tr>
      <th>36</th>
      <td>spotify:user:2217942070bcaa5f1e651e27744b4402:...</td>
      <td>2217942070bcaa5f1e651e27744b4402</td>
      <td>18</td>
      <td>17</td>
      <td>1</td>
      <td>2</td>
      <td>4</td>
      <td>3</td>
      <td>3</td>
      <td>5</td>
      <td>1</td>
      <td>US</td>
      <td>141</td>
      <td>1</td>
      <td>122</td>
      <td>131</td>
      <td>567</td>
      <td>0</td>
      <td>["chill"]</td>
      <td>Rap</td>
      <td>Dance &amp; House</td>
      <td>Alternative</td>
      <td>Excited</td>
      <td>Defiant</td>
      <td>Energizing</td>
      <td>False</td>
      <td>0.944444</td>
      <td>1.0</td>
      <td>0.800000</td>
      <td>True</td>
      <td>1.333333</td>
      <td>True</td>
    </tr>
    <tr>
      <th>59</th>
      <td>spotify:user:dfde15dd16b4ad87a75036276b4c9f66:...</td>
      <td>dfde15dd16b4ad87a75036276b4c9f66</td>
      <td>5</td>
      <td>5</td>
      <td>1</td>
      <td>1</td>
      <td>2</td>
      <td>1</td>
      <td>1</td>
      <td>3</td>
      <td>0</td>
      <td>US</td>
      <td>84</td>
      <td>0</td>
      <td>73</td>
      <td>78</td>
      <td>254</td>
      <td>239</td>
      <td>["vegas"]</td>
      <td>Rock</td>
      <td>Pop</td>
      <td>R&amp;B</td>
      <td>Upbeat</td>
      <td>Excited</td>
      <td>Empowering</td>
      <td>False</td>
      <td>1.000000</td>
      <td>1.0</td>
      <td>0.666667</td>
      <td>True</td>
      <td>2.000000</td>
      <td>True</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>403329</th>
      <td>spotify:user:358b83239c6a2557fbfb053330d49a41:...</td>
      <td>358b83239c6a2557fbfb053330d49a41</td>
      <td>4</td>
      <td>4</td>
      <td>1</td>
      <td>1</td>
      <td>3</td>
      <td>1</td>
      <td>1</td>
      <td>3</td>
      <td>0</td>
      <td>US</td>
      <td>33</td>
      <td>0</td>
      <td>28</td>
      <td>31</td>
      <td>271</td>
      <td>32</td>
      <td>["one", "dirt", "road"]</td>
      <td>Country &amp; Folk</td>
      <td>Rock</td>
      <td>-</td>
      <td>Yearning</td>
      <td>Empowering</td>
      <td>Gritty</td>
      <td>False</td>
      <td>1.000000</td>
      <td>1.0</td>
      <td>1.000000</td>
      <td>True</td>
      <td>3.000000</td>
      <td>True</td>
    </tr>
    <tr>
      <th>403336</th>
      <td>spotify:user:a0781a2de47beb8bd693f3022f316327:...</td>
      <td>a0781a2de47beb8bd693f3022f316327</td>
      <td>856</td>
      <td>855</td>
      <td>3</td>
      <td>10</td>
      <td>10</td>
      <td>5</td>
      <td>5</td>
      <td>10</td>
      <td>0</td>
      <td>US</td>
      <td>168</td>
      <td>0</td>
      <td>6</td>
      <td>9</td>
      <td>33747</td>
      <td>1391</td>
      <td>["evning", "song"]</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>True</td>
      <td>0.998832</td>
      <td>1.0</td>
      <td>1.000000</td>
      <td>True</td>
      <td>2.000000</td>
      <td>True</td>
    </tr>
    <tr>
      <th>403338</th>
      <td>spotify:user:06f6dd666f1bbf9148c792b87ed4d22f:...</td>
      <td>06f6dd666f1bbf9148c792b87ed4d22f</td>
      <td>5</td>
      <td>4</td>
      <td>1</td>
      <td>1</td>
      <td>2</td>
      <td>1</td>
      <td>1</td>
      <td>2</td>
      <td>0</td>
      <td>US</td>
      <td>59</td>
      <td>0</td>
      <td>34</td>
      <td>46</td>
      <td>21</td>
      <td>9</td>
      <td>["rhc"]</td>
      <td>Religious</td>
      <td>Pop</td>
      <td>Alternative</td>
      <td>Empowering</td>
      <td>Upbeat</td>
      <td>Brooding</td>
      <td>False</td>
      <td>0.800000</td>
      <td>1.0</td>
      <td>1.000000</td>
      <td>True</td>
      <td>2.000000</td>
      <td>True</td>
    </tr>
    <tr>
      <th>403348</th>
      <td>spotify:user:c6af258245d55221cebedb1175f08d83:...</td>
      <td>c6af258245d55221cebedb1175f08d83</td>
      <td>13</td>
      <td>11</td>
      <td>1</td>
      <td>1</td>
      <td>2</td>
      <td>1</td>
      <td>1</td>
      <td>2</td>
      <td>0</td>
      <td>US</td>
      <td>31</td>
      <td>0</td>
      <td>30</td>
      <td>29</td>
      <td>208</td>
      <td>206</td>
      <td>["zumba", "val", "silva", "playlist"]</td>
      <td>Latin</td>
      <td>Pop</td>
      <td>Dance &amp; House</td>
      <td>Aggressive</td>
      <td>Excited</td>
      <td>Defiant</td>
      <td>False</td>
      <td>0.846154</td>
      <td>1.0</td>
      <td>1.000000</td>
      <td>True</td>
      <td>2.000000</td>
      <td>True</td>
    </tr>
    <tr>
      <th>403353</th>
      <td>spotify:user:5461b6b460dd512d7b4fd4fb488f3520:...</td>
      <td>5461b6b460dd512d7b4fd4fb488f3520</td>
      <td>2</td>
      <td>2</td>
      <td>1</td>
      <td>1</td>
      <td>2</td>
      <td>1</td>
      <td>1</td>
      <td>2</td>
      <td>0</td>
      <td>US</td>
      <td>146</td>
      <td>0</td>
      <td>115</td>
      <td>123</td>
      <td>405</td>
      <td>321</td>
      <td>["myfavorites"]</td>
      <td>Indie Rock</td>
      <td>Electronica</td>
      <td>Alternative</td>
      <td>Yearning</td>
      <td>Energizing</td>
      <td>Brooding</td>
      <td>False</td>
      <td>1.000000</td>
      <td>1.0</td>
      <td>1.000000</td>
      <td>True</td>
      <td>2.000000</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
<p>40497 rows  32 columns</p>
</div>

<div class="codehilite"><pre><span></span><code><span class="n">chidf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">target</span> <span class="o">=</span> <span class="s1">&#39;new_success&#39;</span>
<span class="n">chidf</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">target</span><span class="p">]</span>
<span class="c1"># quant_value = 0.90</span>
<span class="c1"># tar_value = np.quantile(chidf[target], quant_value)</span>
<span class="c1"># chidf[target] = chidf[target] &gt; tar_value</span>
<span class="n">chisum</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">cutoff</span> <span class="o">=</span> <span class="mf">0.0001</span>
<span class="n">pop</span> <span class="o">=</span> <span class="n">chidf</span><span class="p">[</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

<span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">des_features</span><span class="p">:</span>
    <span class="c1"># ind = des_features[0]</span>
    <span class="n">chidf</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">grp_label</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
    <span class="c1"># grp_label = df[ind].unique()[0]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cTable</span> <span class="o">=</span> <span class="n">chidf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">chidf</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">==</span> <span class="n">grp_label</span><span class="p">)[</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
            <span class="n">chi2</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">dof</span><span class="p">,</span> <span class="n">ex</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">chi2_contingency</span><span class="p">(</span><span class="n">cTable</span><span class="p">,</span> <span class="n">correction</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">lambda_</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
            <span class="n">ratio</span> <span class="o">=</span> <span class="n">cTable</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">cTable</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">ratio</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">ratio</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">chisum</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">chisum</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="n">ind</span><span class="p">,</span> <span class="n">grp_label</span><span class="p">,</span> <span class="n">chi2</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">cTable</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">p</span><span class="o">&lt;</span><span class="n">cutoff</span><span class="p">]])])</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

<span class="n">chisum</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;feature&#39;</span><span class="p">,</span> <span class="s1">&#39;group&#39;</span><span class="p">,</span> <span class="s1">&#39;chi&#39;</span><span class="p">,</span> <span class="s1">&#39;p-value&#39;</span><span class="p">,</span> <span class="s1">&#39;cTable&#39;</span><span class="p">,</span> <span class="s1">&#39;multiplier&#39;</span><span class="p">,</span> <span class="s1">&#39;reject null&#39;</span><span class="p">]</span>
<span class="n">chisum</span> <span class="o">=</span> <span class="n">chisum</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;p-value&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">chisum</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">chisum</span><span class="p">[</span><span class="s1">&#39;reject null&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;multiplier&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>feature</th>
      <th>group</th>
      <th>chi</th>
      <th>p-value</th>
      <th>cTable</th>
      <th>multiplier</th>
      <th>reject null</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>6</th>
      <td>genre_1</td>
      <td>Dance &amp; House</td>
      <td>231.225731</td>
      <td>3.221322e-52</td>
      <td>[[334768, 28101], [36487, 4010]]</td>
      <td>1.309267</td>
      <td>True</td>
    </tr>
    <tr>
      <th>2</th>
      <td>genre_1</td>
      <td>Indie Rock</td>
      <td>386.328998</td>
      <td>5.212769e-86</td>
      <td>[[300809, 62060], [31986, 8511]]</td>
      <td>1.289733</td>
      <td>True</td>
    </tr>
    <tr>
      <th>3</th>
      <td>mood_1</td>
      <td>Excited</td>
      <td>289.821405</td>
      <td>5.438394e-65</td>
      <td>[[306376, 56493], [32871, 7626]]</td>
      <td>1.258184</td>
      <td>True</td>
    </tr>
    <tr>
      <th>4</th>
      <td>mood_1</td>
      <td>Defiant</td>
      <td>285.014998</td>
      <td>6.064223e-64</td>
      <td>[[291222, 71647], [31065, 9432]]</td>
      <td>1.234123</td>
      <td>True</td>
    </tr>
    <tr>
      <th>16</th>
      <td>genre_2</td>
      <td>Electronica</td>
      <td>124.733558</td>
      <td>5.820843e-29</td>
      <td>[[335186, 27683], [36772, 3725]]</td>
      <td>1.226540</td>
      <td>True</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>70</th>
      <td>mood_1</td>
      <td>Somber</td>
      <td>30.852148</td>
      <td>2.784538e-08</td>
      <td>[[361994, 875], [40456, 41]]</td>
      <td>0.419270</td>
      <td>True</td>
    </tr>
    <tr>
      <th>0</th>
      <td>genre_3</td>
      <td>-</td>
      <td>1404.327669</td>
      <td>2.410008e-307</td>
      <td>[[324633, 38236], [38610, 1887]]</td>
      <td>0.414947</td>
      <td>True</td>
    </tr>
    <tr>
      <th>1</th>
      <td>genre_2</td>
      <td>-</td>
      <td>861.809401</td>
      <td>1.968786e-189</td>
      <td>[[342541, 20328], [39619, 878]]</td>
      <td>0.373430</td>
      <td>True</td>
    </tr>
    <tr>
      <th>24</th>
      <td>mood_1</td>
      <td>Other</td>
      <td>81.806778</td>
      <td>1.500630e-19</td>
      <td>[[361232, 1637], [40439, 58]]</td>
      <td>0.316494</td>
      <td>True</td>
    </tr>
    <tr>
      <th>42</th>
      <td>genre_1</td>
      <td>Spoken &amp; Audio</td>
      <td>58.779116</td>
      <td>1.764037e-14</td>
      <td>[[361755, 1114], [40460, 37]]</td>
      <td>0.296965</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
<p>101 rows  7 columns</p>
</div>

<div class="codehilite"><pre><span></span><code><span class="n">chisum</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">chisum</span><span class="p">[</span><span class="s1">&#39;reject null&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;multiplier&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)[:</span><span class="mi">20</span><span class="p">]</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>feature</th>
      <th>group</th>
      <th>chi</th>
      <th>p-value</th>
      <th>cTable</th>
      <th>multiplier</th>
      <th>reject null</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>42</th>
      <td>genre_1</td>
      <td>Spoken &amp; Audio</td>
      <td>58.779116</td>
      <td>1.764037e-14</td>
      <td>[[361755, 1114], [40460, 37]]</td>
      <td>0.296965</td>
      <td>True</td>
    </tr>
    <tr>
      <th>24</th>
      <td>mood_1</td>
      <td>Other</td>
      <td>81.806778</td>
      <td>1.500630e-19</td>
      <td>[[361232, 1637], [40439, 58]]</td>
      <td>0.316494</td>
      <td>True</td>
    </tr>
    <tr>
      <th>1</th>
      <td>genre_2</td>
      <td>-</td>
      <td>861.809401</td>
      <td>1.968786e-189</td>
      <td>[[342541, 20328], [39619, 878]]</td>
      <td>0.373430</td>
      <td>True</td>
    </tr>
    <tr>
      <th>0</th>
      <td>genre_3</td>
      <td>-</td>
      <td>1404.327669</td>
      <td>2.410008e-307</td>
      <td>[[324633, 38236], [38610, 1887]]</td>
      <td>0.414947</td>
      <td>True</td>
    </tr>
    <tr>
      <th>70</th>
      <td>mood_1</td>
      <td>Somber</td>
      <td>30.852148</td>
      <td>2.784538e-08</td>
      <td>[[361994, 875], [40456, 41]]</td>
      <td>0.419270</td>
      <td>True</td>
    </tr>
    <tr>
      <th>73</th>
      <td>genre_1</td>
      <td>Easy Listening</td>
      <td>30.613123</td>
      <td>3.149562e-08</td>
      <td>[[361984, 885], [40455, 42]]</td>
      <td>0.424642</td>
      <td>True</td>
    </tr>
    <tr>
      <th>40</th>
      <td>mood_2</td>
      <td>-</td>
      <td>60.796108</td>
      <td>6.330294e-15</td>
      <td>[[361087, 1782], [40411, 86]]</td>
      <td>0.431224</td>
      <td>True</td>
    </tr>
    <tr>
      <th>43</th>
      <td>mood_1</td>
      <td>-</td>
      <td>57.600397</td>
      <td>3.211607e-14</td>
      <td>[[361161, 1708], [40414, 83]]</td>
      <td>0.434269</td>
      <td>True</td>
    </tr>
    <tr>
      <th>37</th>
      <td>mood_3</td>
      <td>-</td>
      <td>64.489845</td>
      <td>9.703118e-16</td>
      <td>[[360957, 1912], [40404, 93]]</td>
      <td>0.434536</td>
      <td>True</td>
    </tr>
    <tr>
      <th>48</th>
      <td>genre_1</td>
      <td>Children's</td>
      <td>52.188042</td>
      <td>5.043231e-13</td>
      <td>[[361298, 1571], [40420, 77]]</td>
      <td>0.438111</td>
      <td>True</td>
    </tr>
    <tr>
      <th>32</th>
      <td>mood_1</td>
      <td>Easygoing</td>
      <td>72.784800</td>
      <td>1.445861e-17</td>
      <td>[[360451, 2418], [40371, 126]]</td>
      <td>0.465255</td>
      <td>True</td>
    </tr>
    <tr>
      <th>56</th>
      <td>mood_3</td>
      <td>Serious</td>
      <td>43.083601</td>
      <td>5.245004e-11</td>
      <td>[[361404, 1465], [40420, 77]]</td>
      <td>0.469948</td>
      <td>True</td>
    </tr>
    <tr>
      <th>59</th>
      <td>genre_2</td>
      <td>Other</td>
      <td>41.614387</td>
      <td>1.111721e-10</td>
      <td>[[361446, 1423], [40422, 75]]</td>
      <td>0.471283</td>
      <td>True</td>
    </tr>
    <tr>
      <th>82</th>
      <td>mood_2</td>
      <td>Other</td>
      <td>25.423296</td>
      <td>4.603257e-07</td>
      <td>[[361970, 899], [40449, 48]]</td>
      <td>0.477800</td>
      <td>True</td>
    </tr>
    <tr>
      <th>60</th>
      <td>genre_1</td>
      <td>Traditional</td>
      <td>39.228043</td>
      <td>3.770852e-10</td>
      <td>[[361402, 1467], [40416, 81]]</td>
      <td>0.493733</td>
      <td>True</td>
    </tr>
    <tr>
      <th>39</th>
      <td>genre_3</td>
      <td>Easy Listening</td>
      <td>61.357952</td>
      <td>4.758655e-15</td>
      <td>[[360552, 2317], [40368, 129]]</td>
      <td>0.497272</td>
      <td>True</td>
    </tr>
    <tr>
      <th>47</th>
      <td>genre_2</td>
      <td>Easy Listening</td>
      <td>53.106215</td>
      <td>3.159911e-13</td>
      <td>[[360858, 2011], [40385, 112]]</td>
      <td>0.497648</td>
      <td>True</td>
    </tr>
    <tr>
      <th>65</th>
      <td>mood_2</td>
      <td>Stirring</td>
      <td>34.226638</td>
      <td>4.905289e-09</td>
      <td>[[361548, 1321], [40423, 74]]</td>
      <td>0.501033</td>
      <td>True</td>
    </tr>
    <tr>
      <th>57</th>
      <td>mood_1</td>
      <td>Serious</td>
      <td>42.044137</td>
      <td>8.923632e-11</td>
      <td>[[361247, 1622], [40406, 91]]</td>
      <td>0.501590</td>
      <td>True</td>
    </tr>
    <tr>
      <th>10</th>
      <td>genre_1</td>
      <td>Soundtrack</td>
      <td>169.038371</td>
      <td>1.200050e-38</td>
      <td>[[356345, 6524], [40127, 370]]</td>
      <td>0.503642</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
</div>

<div class="codehilite"><pre><span></span><code><span class="n">chidf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">target</span> <span class="o">=</span> <span class="s2">&quot;success&quot;</span>
<span class="n">chidf</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">target</span><span class="p">]</span>
<span class="c1"># chidf.iloc[:int(chidf.shape[0]/2),:] = True</span>
<span class="c1"># chidf.iloc[int(chidf.shape[0]/2):,:] = False</span>
<span class="c1"># quant_value = 0.99</span>
<span class="c1"># tar_value = np.quantile(chidf[target], quant_value)</span>
<span class="c1"># chidf[target] = chidf[target] &gt; tar_value</span>
<span class="n">welchsum</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">cutoff</span> <span class="o">=</span> <span class="mf">0.0001</span>
<span class="n">pop</span> <span class="o">=</span> <span class="n">chidf</span><span class="p">[</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

<span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">con_features</span><span class="p">:</span>
    <span class="c1"># ind = con_features[0]</span>
    <span class="n">chidf</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>

    <span class="c1"># for grp_label in df[ind].unique():</span>
    <span class="c1"># try:</span>
    <span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">b</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
        <span class="n">boot1</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
                    <span class="nb">list</span><span class="p">(</span>
                        <span class="n">chidf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                            <span class="p">(</span><span class="n">chidf</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span>
                        <span class="p">][</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">),</span>
                    <span class="n">k</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
        <span class="n">boot2</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
                    <span class="nb">list</span><span class="p">(</span>
                        <span class="n">chidf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                            <span class="p">(</span><span class="n">chidf</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span>
                        <span class="p">][</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">),</span>
                    <span class="n">k</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">boot1</span><span class="p">))</span>
        <span class="n">b</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">boot2</span><span class="p">))</span>
    <span class="n">testt</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">ttest_ind</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">equal_var</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">a_avg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="n">b_avg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
    <span class="n">welchsum</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">welchsum</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="n">ind</span><span class="p">,</span> <span class="n">testt</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">a_avg</span><span class="p">,</span> <span class="n">b_avg</span><span class="p">,</span> <span class="n">p</span><span class="o">&lt;</span><span class="n">cutoff</span><span class="p">]])])</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:orange&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">target</span><span class="si">}</span><span class="s2"> == True&quot;</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">target</span><span class="si">}</span><span class="s2"> == False&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="c1"># except:</span>
    <span class="c1">#     pass</span>

<span class="n">welchsum</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;feature&#39;</span><span class="p">,</span> <span class="s1">&#39;test stat&#39;</span><span class="p">,</span> <span class="s1">&#39;p-value&#39;</span><span class="p">,</span> <span class="s1">&#39;upper q avg&#39;</span><span class="p">,</span> <span class="s1">&#39;lower q avg&#39;</span><span class="p">,</span> <span class="s1">&#39;reject null&#39;</span><span class="p">]</span>
<span class="n">welchsum</span> <span class="o">=</span> <span class="n">welchsum</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;p-value&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_141_0.png" /></p>
<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_141_1.png" /></p>
<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_141_2.png" /></p>
<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_141_3.png" /></p>
<div class="codehilite"><pre><span></span><code><span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;listen_conversions&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;mau_growing&#39;</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>&lt;AxesSubplot:xlabel=&#39;listen_conversions&#39;, ylabel=&#39;Count&#39;&gt;
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_142_1.png" /></p>
<div class="codehilite"><pre><span></span><code><span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;user_conversions&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;mau_growing&#39;</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>&lt;AxesSubplot:xlabel=&#39;user_conversions&#39;, ylabel=&#39;Count&#39;&gt;
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_143_1.png" /></p>
<div class="codehilite"><pre><span></span><code><span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;user_conversions&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;dau&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>&lt;AxesSubplot:xlabel=&#39;user_conversions&#39;, ylabel=&#39;Count&#39;&gt;
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_144_1.png" /></p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;mau&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>count     403366
unique         2
top        False
freq      338256
Name: mau, dtype: object
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;mau&#39;</span><span class="p">],</span> <span class="mf">0.9</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>9.0
</code></pre></div>

<h3 id="considering-outliers">Considering outliers<a class="headerlink" href="#considering-outliers" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">targets</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="o">*</span><span class="n">x</span><span class="o">.</span><span class="n">std</span><span class="p">())</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="nb">int</span> <span class="ow">or</span> <span class="n">x</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="nb">float</span><span class="p">)</span> <span class="k">else</span> <span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;owner&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;spotify&#39;</span><span class="p">]</span>
</code></pre></div>

<h3 id="multiple-criteria-for-success">Multiple Criteria for Success<a class="headerlink" href="#multiple-criteria-for-success" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="n">df</span><span class="p">[</span><span class="s1">&#39;success&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">sub_targets</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;success&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;n_tracks&#39;</span><span class="p">)[[</span><span class="s1">&#39;wau&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5000</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>(0.0, 5000.0)
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_152_1.png" /></p>
<div class="codehilite"><pre><span></span><code><span class="n">chidf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">target</span> <span class="o">=</span> <span class="s1">&#39;success&#39;</span>
<span class="n">chidf</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">target</span><span class="p">]</span>
<span class="c1"># quant_value = 0.90</span>
<span class="c1"># tar_value = np.quantile(chidf[target], quant_value)</span>
<span class="c1"># chidf[target] = chidf[target] &gt; tar_value</span>
<span class="n">chisum</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">cutoff</span> <span class="o">=</span> <span class="mf">0.0001</span>
<span class="n">pop</span> <span class="o">=</span> <span class="n">chidf</span><span class="p">[</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

<span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">des_features</span><span class="p">:</span>
    <span class="c1"># ind = des_features[0]</span>
    <span class="n">chidf</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">grp_label</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
    <span class="c1"># grp_label = df[ind].unique()[0]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cTable</span> <span class="o">=</span> <span class="n">chidf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">chidf</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">==</span> <span class="n">grp_label</span><span class="p">)[</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
            <span class="n">chi2</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">dof</span><span class="p">,</span> <span class="n">ex</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">chi2_contingency</span><span class="p">(</span><span class="n">cTable</span><span class="p">,</span> <span class="n">correction</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">lambda_</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
            <span class="n">ratio</span> <span class="o">=</span> <span class="n">cTable</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">cTable</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">ratio</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">ratio</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">chisum</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">chisum</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="n">ind</span><span class="p">,</span> <span class="n">grp_label</span><span class="p">,</span> <span class="n">chi2</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">cTable</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">p</span><span class="o">&lt;</span><span class="n">cutoff</span><span class="p">]])])</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

<span class="n">chisum</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;feature&#39;</span><span class="p">,</span> <span class="s1">&#39;group&#39;</span><span class="p">,</span> <span class="s1">&#39;chi&#39;</span><span class="p">,</span> <span class="s1">&#39;p-value&#39;</span><span class="p">,</span> <span class="s1">&#39;cTable&#39;</span><span class="p">,</span> <span class="s1">&#39;multiplier&#39;</span><span class="p">,</span> <span class="s1">&#39;reject null&#39;</span><span class="p">]</span>
<span class="n">chisum</span> <span class="o">=</span> <span class="n">chisum</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;p-value&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">chisum</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">chisum</span><span class="p">[</span><span class="s1">&#39;reject null&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;multiplier&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>feature</th>
      <th>group</th>
      <th>chi</th>
      <th>p-value</th>
      <th>cTable</th>
      <th>multiplier</th>
      <th>reject null</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>genre_1</td>
      <td>Latin</td>
      <td>3516.528142</td>
      <td>0.000000e+00</td>
      <td>[[371720, 12806], [16634, 2206]]</td>
      <td>3.849561</td>
      <td>True</td>
    </tr>
    <tr>
      <th>4</th>
      <td>genre_2</td>
      <td>Jazz</td>
      <td>708.535543</td>
      <td>4.164954e-156</td>
      <td>[[380364, 4162], [18231, 609]]</td>
      <td>3.052841</td>
      <td>True</td>
    </tr>
    <tr>
      <th>1</th>
      <td>mood_1</td>
      <td>Lively</td>
      <td>1287.773814</td>
      <td>5.130420e-282</td>
      <td>[[375424, 9102], [17596, 1244]]</td>
      <td>2.916028</td>
      <td>True</td>
    </tr>
    <tr>
      <th>14</th>
      <td>genre_1</td>
      <td>Children's</td>
      <td>208.802667</td>
      <td>2.506648e-47</td>
      <td>[[383079, 1447], [18639, 201]]</td>
      <td>2.854916</td>
      <td>True</td>
    </tr>
    <tr>
      <th>20</th>
      <td>genre_1</td>
      <td>Traditional</td>
      <td>149.152847</td>
      <td>2.655403e-34</td>
      <td>[[383152, 1374], [18666, 174]]</td>
      <td>2.599455</td>
      <td>True</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>22</th>
      <td>genre_2</td>
      <td>Indie Rock</td>
      <td>137.000630</td>
      <td>1.205469e-31</td>
      <td>[[353648, 30878], [17772, 1068]]</td>
      <td>0.688267</td>
      <td>True</td>
    </tr>
    <tr>
      <th>34</th>
      <td>mood_1</td>
      <td>Brooding</td>
      <td>84.460032</td>
      <td>3.920608e-20</td>
      <td>[[366942, 17584], [18247, 593]]</td>
      <td>0.678177</td>
      <td>True</td>
    </tr>
    <tr>
      <th>9</th>
      <td>genre_2</td>
      <td>Alternative</td>
      <td>331.424544</td>
      <td>4.704591e-74</td>
      <td>[[320464, 64062], [16650, 2190]]</td>
      <td>0.657974</td>
      <td>True</td>
    </tr>
    <tr>
      <th>11</th>
      <td>mood_1</td>
      <td>Yearning</td>
      <td>223.850708</td>
      <td>1.307610e-50</td>
      <td>[[347224, 37302], [17631, 1209]]</td>
      <td>0.638303</td>
      <td>True</td>
    </tr>
    <tr>
      <th>2</th>
      <td>genre_1</td>
      <td>Indie Rock</td>
      <td>866.348545</td>
      <td>2.029540e-190</td>
      <td>[[315752, 68774], [17043, 1797]]</td>
      <td>0.484087</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
<p>92 rows  7 columns</p>
</div>

<div class="codehilite"><pre><span></span><code><span class="n">ind</span> <span class="o">=</span> <span class="s1">&#39;n_tracks&#39;</span>
<span class="n">target</span> <span class="o">=</span> <span class="s1">&#39;wau&#39;</span>
<span class="n">mean_wau_vs_track</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">track</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">201</span><span class="p">):</span>
    <span class="n">means</span> <span class="o">=</span> <span class="p">[]</span> 
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
        <span class="n">boot</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
                    <span class="nb">list</span><span class="p">(</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                            <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;success&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span> 
                            <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">==</span> <span class="n">track</span><span class="p">)</span>
                        <span class="p">][</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">),</span>
                    <span class="n">k</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                            <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;success&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span> 
                            <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">==</span> <span class="n">track</span><span class="p">)</span>
                        <span class="p">][</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)),</span> <span class="mi">1000</span><span class="p">))</span>
        <span class="n">means</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">boot</span><span class="p">))</span>
    <span class="n">mean_wau_vs_track</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">means</span><span class="p">))</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mean_wau_vs_track</span><span class="p">)),</span> <span class="n">mean_wau_vs_track</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
<span class="c1"># ax.set_ylim(0,5)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>[&lt;matplotlib.lines.Line2D at 0x7f838e3d99a0&gt;]
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_156_1.png" /></p>
<div class="codehilite"><pre><span></span><code><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                            <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;success&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span> 
                            <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">==</span> <span class="n">track</span><span class="p">)</span>
                        <span class="p">][</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>14
</code></pre></div>

<h3 id="dependency_1">Dependency<a class="headerlink" href="#dependency_1" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="n">master</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">new_metrics</span><span class="p">:</span>
    <span class="c1"># target = sub_targets[0]</span>
    <span class="n">chidf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="n">chidf</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">target</span><span class="p">]</span>
    <span class="n">quant_value</span> <span class="o">=</span> <span class="mf">0.90</span>
    <span class="n">tar_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">chidf</span><span class="p">[</span><span class="n">target</span><span class="p">],</span> <span class="n">quant_value</span><span class="p">)</span>
    <span class="n">tar_value</span> <span class="o">=</span> <span class="mf">0.8</span>
    <span class="n">chidf</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">=</span> <span class="n">chidf</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">tar_value</span>
    <span class="n">chisum</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="n">cutoff</span> <span class="o">=</span> <span class="mf">0.0001</span>
    <span class="n">pop</span> <span class="o">=</span> <span class="n">chidf</span><span class="p">[</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

    <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">des_features</span><span class="p">:</span>
        <span class="c1"># ind = des_features[0]</span>
        <span class="n">chidf</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">grp_label</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
        <span class="c1"># grp_label = df[ind].unique()[0]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">cTable</span> <span class="o">=</span> <span class="n">chidf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">chidf</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">==</span> <span class="n">grp_label</span><span class="p">)[</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
                <span class="n">chi2</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">dof</span><span class="p">,</span> <span class="n">ex</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">chi2_contingency</span><span class="p">(</span><span class="n">cTable</span><span class="p">,</span> <span class="n">correction</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">lambda_</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
                <span class="n">ratio</span> <span class="o">=</span> <span class="n">cTable</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">cTable</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">pos</span> <span class="o">=</span> <span class="n">ratio</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">ratio</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">chisum</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">chisum</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="n">target</span><span class="p">,</span> <span class="n">ind</span><span class="p">,</span> <span class="n">grp_label</span><span class="p">,</span> <span class="n">chi2</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">cTable</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">p</span><span class="o">&lt;</span><span class="n">cutoff</span><span class="p">]])])</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>

    <span class="n">chisum</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">,</span> <span class="s1">&#39;feature&#39;</span><span class="p">,</span> <span class="s1">&#39;group&#39;</span><span class="p">,</span> <span class="s1">&#39;chi&#39;</span><span class="p">,</span> <span class="s1">&#39;p-value&#39;</span><span class="p">,</span> <span class="s1">&#39;cTable&#39;</span><span class="p">,</span> <span class="s1">&#39;multiplier&#39;</span><span class="p">,</span> <span class="s1">&#39;reject null&#39;</span><span class="p">]</span>
    <span class="n">chisum</span> <span class="o">=</span> <span class="n">chisum</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;p-value&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># chisum = chisum.loc[(chisum[&#39;reject null&#39;] == True) &amp; (chisum[&#39;multiplier&#39;] &gt; 2)].sort_values(&#39;multiplier&#39;, ascending=False)</span>
    <span class="n">master</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">master</span><span class="p">,</span> <span class="n">chisum</span><span class="p">))</span>

<span class="n">master</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>target</th>
      <th>feature</th>
      <th>group</th>
      <th>chi</th>
      <th>p-value</th>
      <th>cTable</th>
      <th>multiplier</th>
      <th>reject null</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>listen_conversions</td>
      <td>genre_1</td>
      <td>Rap</td>
      <td>399.045079</td>
      <td>8.888113e-89</td>
      <td>[[263266, 51481], [76577, 12042]]</td>
      <td>0.804170</td>
      <td>True</td>
    </tr>
    <tr>
      <th>1</th>
      <td>listen_conversions</td>
      <td>genre_1</td>
      <td>Latin</td>
      <td>340.400638</td>
      <td>5.219381e-76</td>
      <td>[[303952, 10795], [84402, 4217]]</td>
      <td>1.406803</td>
      <td>True</td>
    </tr>
    <tr>
      <th>2</th>
      <td>listen_conversions</td>
      <td>mood_1</td>
      <td>Defiant</td>
      <td>324.874553</td>
      <td>1.256443e-72</td>
      <td>[[249581, 65166], [72706, 15913]]</td>
      <td>0.838248</td>
      <td>True</td>
    </tr>
    <tr>
      <th>3</th>
      <td>listen_conversions</td>
      <td>genre_3</td>
      <td>-</td>
      <td>282.376331</td>
      <td>2.279083e-63</td>
      <td>[[284762, 29985], [78481, 10138]]</td>
      <td>1.226777</td>
      <td>True</td>
    </tr>
    <tr>
      <th>4</th>
      <td>listen_conversions</td>
      <td>genre_2</td>
      <td>-</td>
      <td>259.043360</td>
      <td>2.773590e-58</td>
      <td>[[299145, 15602], [83015, 5604]]</td>
      <td>1.294324</td>
      <td>True</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>154</th>
      <td>user_conversions</td>
      <td>mood_1</td>
      <td>Gritty</td>
      <td>0.255320</td>
      <td>6.133538e-01</td>
      <td>[[235846, 4671], [159649, 3200]]</td>
      <td>1.012051</td>
      <td>False</td>
    </tr>
    <tr>
      <th>155</th>
      <td>user_conversions</td>
      <td>mood_1</td>
      <td>Melancholy</td>
      <td>0.183720</td>
      <td>6.681957e-01</td>
      <td>[[237216, 3301], [160587, 2262]]</td>
      <td>1.012233</td>
      <td>False</td>
    </tr>
    <tr>
      <th>156</th>
      <td>user_conversions</td>
      <td>mood_3</td>
      <td>Gritty</td>
      <td>0.091581</td>
      <td>7.621766e-01</td>
      <td>[[233926, 6591], [158413, 4436]]</td>
      <td>0.993866</td>
      <td>False</td>
    </tr>
    <tr>
      <th>157</th>
      <td>user_conversions</td>
      <td>mood_2</td>
      <td>Urgent</td>
      <td>0.026083</td>
      <td>8.716985e-01</td>
      <td>[[227220, 13297], [153866, 8983]]</td>
      <td>0.997635</td>
      <td>False</td>
    </tr>
    <tr>
      <th>158</th>
      <td>user_conversions</td>
      <td>genre_2</td>
      <td>Spoken &amp; Audio</td>
      <td>0.006088</td>
      <td>9.378078e-01</td>
      <td>[[239335, 1182], [162045, 804]]</td>
      <td>1.004637</td>
      <td>False</td>
    </tr>
  </tbody>
</table>
<p>318 rows  8 columns</p>
</div>

<div class="codehilite"><pre><span></span><code><span class="n">master</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">master</span><span class="p">[</span><span class="s1">&#39;reject null&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">master</span><span class="p">[</span><span class="s1">&#39;multiplier&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">1.5</span><span class="p">)]</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>target</th>
      <th>feature</th>
      <th>group</th>
      <th>chi</th>
      <th>p-value</th>
      <th>cTable</th>
      <th>multiplier</th>
      <th>reject null</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>7</th>
      <td>listen_conversions</td>
      <td>genre_1</td>
      <td>New Age</td>
      <td>136.770883</td>
      <td>1.353331e-31</td>
      <td>[[313269, 1478], [87913, 706]]</td>
      <td>1.702137</td>
      <td>True</td>
    </tr>
    <tr>
      <th>9</th>
      <td>listen_conversions</td>
      <td>mood_1</td>
      <td>Tender</td>
      <td>115.194233</td>
      <td>7.135481e-27</td>
      <td>[[312449, 2298], [87647, 972]]</td>
      <td>1.507851</td>
      <td>True</td>
    </tr>
    <tr>
      <th>18</th>
      <td>listen_conversions</td>
      <td>genre_2</td>
      <td>New Age</td>
      <td>71.594191</td>
      <td>2.643338e-17</td>
      <td>[[313509, 1238], [88081, 538]]</td>
      <td>1.546783</td>
      <td>True</td>
    </tr>
    <tr>
      <th>23</th>
      <td>listen_conversions</td>
      <td>genre_1</td>
      <td>Children's</td>
      <td>60.468486</td>
      <td>7.476593e-15</td>
      <td>[[313592, 1155], [88126, 493]]</td>
      <td>1.518888</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
</div>

<div class="codehilite"><pre><span></span><code><span class="n">master</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">master</span><span class="p">[</span><span class="s1">&#39;reject null&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">master</span><span class="p">[</span><span class="s1">&#39;multiplier&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">.5</span><span class="p">)]</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>target</th>
      <th>feature</th>
      <th>group</th>
      <th>chi</th>
      <th>p-value</th>
      <th>cTable</th>
      <th>multiplier</th>
      <th>reject null</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>user_conversions</td>
      <td>genre_2</td>
      <td>-</td>
      <td>3922.996570</td>
      <td>0.000000e+00</td>
      <td>[[223516, 17001], [158644, 4205]]</td>
      <td>0.348479</td>
      <td>True</td>
    </tr>
    <tr>
      <th>1</th>
      <td>user_conversions</td>
      <td>genre_1</td>
      <td>Latin</td>
      <td>1976.239449</td>
      <td>0.000000e+00</td>
      <td>[[228943, 11574], [159411, 3438]]</td>
      <td>0.426610</td>
      <td>True</td>
    </tr>
    <tr>
      <th>3</th>
      <td>user_conversions</td>
      <td>genre_3</td>
      <td>-</td>
      <td>6170.632022</td>
      <td>0.000000e+00</td>
      <td>[[209266, 31251], [153977, 8872]]</td>
      <td>0.385834</td>
      <td>True</td>
    </tr>
    <tr>
      <th>4</th>
      <td>user_conversions</td>
      <td>mood_1</td>
      <td>Lively</td>
      <td>1155.365166</td>
      <td>3.060886e-253</td>
      <td>[[232673, 7844], [160347, 2502]]</td>
      <td>0.462844</td>
      <td>True</td>
    </tr>
    <tr>
      <th>11</th>
      <td>user_conversions</td>
      <td>genre_2</td>
      <td>Jazz</td>
      <td>534.239051</td>
      <td>3.378526e-118</td>
      <td>[[236893, 3624], [161702, 1147]]</td>
      <td>0.463673</td>
      <td>True</td>
    </tr>
    <tr>
      <th>16</th>
      <td>user_conversions</td>
      <td>mood_3</td>
      <td>-</td>
      <td>436.706320</td>
      <td>5.640063e-97</td>
      <td>[[238863, 1654], [162498, 351]]</td>
      <td>0.311941</td>
      <td>True</td>
    </tr>
    <tr>
      <th>18</th>
      <td>user_conversions</td>
      <td>mood_2</td>
      <td>-</td>
      <td>395.335894</td>
      <td>5.705144e-88</td>
      <td>[[238982, 1535], [162516, 333]]</td>
      <td>0.319010</td>
      <td>True</td>
    </tr>
    <tr>
      <th>21</th>
      <td>user_conversions</td>
      <td>mood_1</td>
      <td>-</td>
      <td>379.442742</td>
      <td>1.645452e-84</td>
      <td>[[239045, 1472], [162530, 319]]</td>
      <td>0.318734</td>
      <td>True</td>
    </tr>
    <tr>
      <th>23</th>
      <td>user_conversions</td>
      <td>mood_1</td>
      <td>Other</td>
      <td>340.234697</td>
      <td>5.672282e-76</td>
      <td>[[239134, 1383], [162537, 312]]</td>
      <td>0.331911</td>
      <td>True</td>
    </tr>
    <tr>
      <th>26</th>
      <td>user_conversions</td>
      <td>mood_1</td>
      <td>Tender</td>
      <td>313.405005</td>
      <td>3.958040e-70</td>
      <td>[[238072, 2445], [162024, 825]]</td>
      <td>0.495797</td>
      <td>True</td>
    </tr>
    <tr>
      <th>30</th>
      <td>user_conversions</td>
      <td>genre_1</td>
      <td>Spoken &amp; Audio</td>
      <td>282.114763</td>
      <td>2.598715e-63</td>
      <td>[[239551, 966], [162664, 185]]</td>
      <td>0.282034</td>
      <td>True</td>
    </tr>
    <tr>
      <th>32</th>
      <td>user_conversions</td>
      <td>genre_1</td>
      <td>Children's</td>
      <td>267.069910</td>
      <td>4.937672e-60</td>
      <td>[[239209, 1308], [162509, 340]]</td>
      <td>0.382623</td>
      <td>True</td>
    </tr>
    <tr>
      <th>41</th>
      <td>user_conversions</td>
      <td>genre_1</td>
      <td>New Age</td>
      <td>239.970389</td>
      <td>3.991738e-54</td>
      <td>[[238860, 1657], [162322, 527]]</td>
      <td>0.468009</td>
      <td>True</td>
    </tr>
    <tr>
      <th>45</th>
      <td>user_conversions</td>
      <td>genre_2</td>
      <td>Easy Listening</td>
      <td>225.530477</td>
      <td>5.624862e-51</td>
      <td>[[238912, 1605], [162331, 518]]</td>
      <td>0.474997</td>
      <td>True</td>
    </tr>
    <tr>
      <th>48</th>
      <td>user_conversions</td>
      <td>genre_1</td>
      <td>Traditional</td>
      <td>214.931791</td>
      <td>1.153312e-48</td>
      <td>[[239311, 1206], [162507, 342]]</td>
      <td>0.417609</td>
      <td>True</td>
    </tr>
    <tr>
      <th>52</th>
      <td>user_conversions</td>
      <td>genre_1</td>
      <td>-</td>
      <td>175.754457</td>
      <td>4.096893e-40</td>
      <td>[[239754, 763], [162668, 181]]</td>
      <td>0.349637</td>
      <td>True</td>
    </tr>
    <tr>
      <th>54</th>
      <td>user_conversions</td>
      <td>mood_1</td>
      <td>Serious</td>
      <td>162.207641</td>
      <td>3.726709e-37</td>
      <td>[[239237, 1280], [162416, 433]]</td>
      <td>0.498285</td>
      <td>True</td>
    </tr>
    <tr>
      <th>64</th>
      <td>user_conversions</td>
      <td>genre_1</td>
      <td>Easy Listening</td>
      <td>146.743632</td>
      <td>8.928423e-34</td>
      <td>[[239783, 734], [162656, 193]]</td>
      <td>0.387623</td>
      <td>True</td>
    </tr>
    <tr>
      <th>77</th>
      <td>user_conversions</td>
      <td>mood_1</td>
      <td>Somber</td>
      <td>112.482411</td>
      <td>2.801392e-26</td>
      <td>[[239813, 704], [162637, 212]]</td>
      <td>0.444034</td>
      <td>True</td>
    </tr>
    <tr>
      <th>95</th>
      <td>user_conversions</td>
      <td>genre_1</td>
      <td>Blues</td>
      <td>64.312880</td>
      <td>1.061495e-15</td>
      <td>[[240162, 355], [162750, 99]]</td>
      <td>0.411519</td>
      <td>True</td>
    </tr>
    <tr>
      <th>96</th>
      <td>user_conversions</td>
      <td>genre_3</td>
      <td>Holiday</td>
      <td>62.618863</td>
      <td>2.508395e-15</td>
      <td>[[240238, 279], [162782, 67]]</td>
      <td>0.354410</td>
      <td>True</td>
    </tr>
    <tr>
      <th>99</th>
      <td>user_conversions</td>
      <td>genre_2</td>
      <td>Holiday</td>
      <td>55.198819</td>
      <td>1.089342e-13</td>
      <td>[[240302, 215], [162803, 46]]</td>
      <td>0.315802</td>
      <td>True</td>
    </tr>
    <tr>
      <th>117</th>
      <td>user_conversions</td>
      <td>genre_1</td>
      <td>Other</td>
      <td>24.171106</td>
      <td>8.814482e-07</td>
      <td>[[240383, 134], [162812, 37]]</td>
      <td>0.407675</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
</div>

<div class="codehilite"><pre><span></span><code><span class="n">new_master</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">new_metrics</span><span class="p">:</span>
    <span class="c1"># target = sub_targets[2]</span>
    <span class="n">chidf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="n">chidf</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">target</span><span class="p">]</span>
    <span class="n">chidf</span><span class="p">[</span><span class="s1">&#39;n_tracks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;n_tracks&#39;</span><span class="p">]</span>
    <span class="n">quant_value</span> <span class="o">=</span> <span class="mf">0.90</span>
    <span class="n">tar_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">chidf</span><span class="p">[</span><span class="n">target</span><span class="p">],</span> <span class="n">quant_value</span><span class="p">)</span>
    <span class="n">tar_value</span> <span class="o">=</span> <span class="mf">0.8</span>
    <span class="n">chidf</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">=</span> <span class="n">chidf</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">tar_value</span>
    <span class="n">welchsum</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="n">cutoff</span> <span class="o">=</span> <span class="mf">0.0001</span>
    <span class="n">pop</span> <span class="o">=</span> <span class="n">chidf</span><span class="p">[</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

    <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">con_features</span><span class="p">:</span>
        <span class="c1"># ind = con_features[0]</span>
        <span class="n">chidf</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>

        <span class="c1"># for grp_label in df[ind].unique():</span>
        <span class="c1"># try:</span>
        <span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">b</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
            <span class="n">boot1</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
                        <span class="nb">list</span><span class="p">(</span>
                            <span class="n">chidf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                                <span class="p">(</span><span class="n">chidf</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span>
                                <span class="o">&amp;</span> <span class="p">(</span><span class="n">chidf</span><span class="p">[</span><span class="s1">&#39;n_tracks&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">9</span><span class="p">)</span>
                                <span class="o">&amp;</span> <span class="p">(</span><span class="n">chidf</span><span class="p">[</span><span class="s1">&#39;n_tracks&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">999</span><span class="p">)</span>
                            <span class="p">][</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">),</span>
                        <span class="n">k</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
            <span class="n">boot2</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
                        <span class="nb">list</span><span class="p">(</span>
                            <span class="n">chidf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                                <span class="p">(</span><span class="n">chidf</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span>
                                <span class="o">&amp;</span> <span class="p">(</span><span class="n">chidf</span><span class="p">[</span><span class="s1">&#39;n_tracks&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">9</span><span class="p">)</span>
                                <span class="o">&amp;</span> <span class="p">(</span><span class="n">chidf</span><span class="p">[</span><span class="s1">&#39;n_tracks&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">999</span><span class="p">)</span>
                            <span class="p">][</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">),</span>
                        <span class="n">k</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
            <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">boot1</span><span class="p">))</span>
            <span class="n">b</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">boot2</span><span class="p">))</span>
        <span class="n">testt</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">ttest_ind</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">equal_var</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">a_avg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="n">b_avg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="n">welchsum</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">welchsum</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="n">target</span><span class="p">,</span> <span class="n">ind</span><span class="p">,</span> <span class="n">testt</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">a_avg</span><span class="p">,</span> <span class="n">b_avg</span><span class="p">,</span> <span class="n">p</span><span class="o">&lt;</span><span class="n">cutoff</span><span class="p">]])])</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:orange&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">target</span><span class="si">}</span><span class="s2"> &gt;= </span><span class="si">{</span><span class="n">tar_value</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">target</span><span class="si">}</span><span class="s2"> &lt; </span><span class="si">{</span><span class="n">tar_value</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">target</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">ind</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="c1"># except:</span>
        <span class="c1">#     pass</span>

    <span class="n">welchsum</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">,</span> <span class="s1">&#39;feature&#39;</span><span class="p">,</span> <span class="s1">&#39;test stat&#39;</span><span class="p">,</span> <span class="s1">&#39;p-value&#39;</span><span class="p">,</span> <span class="s1">&#39;upper q avg&#39;</span><span class="p">,</span> <span class="s1">&#39;lower q avg&#39;</span><span class="p">,</span> <span class="s1">&#39;reject null&#39;</span><span class="p">]</span>
    <span class="n">welchsum</span> <span class="o">=</span> <span class="n">welchsum</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;p-value&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">new_master</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">new_master</span><span class="p">,</span> <span class="n">welchsum</span><span class="p">))</span>
<span class="n">new_master</span>
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_162_0.png" /></p>
<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_162_1.png" /></p>
<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_162_2.png" /></p>
<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_162_3.png" /></p>
<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_162_4.png" /></p>
<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_162_5.png" /></p>
<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_162_6.png" /></p>
<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_162_7.png" /></p>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>target</th>
      <th>feature</th>
      <th>test stat</th>
      <th>p-value</th>
      <th>upper q avg</th>
      <th>lower q avg</th>
      <th>reject null</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>listen_conversions</td>
      <td>n_tracks</td>
      <td>10.791139</td>
      <td>1.289400e-21</td>
      <td>151.33751</td>
      <td>143.74398</td>
      <td>True</td>
    </tr>
    <tr>
      <th>1</th>
      <td>listen_conversions</td>
      <td>n_albums</td>
      <td>2.441572</td>
      <td>1.550563e-02</td>
      <td>78.52885</td>
      <td>77.60380</td>
      <td>False</td>
    </tr>
    <tr>
      <th>2</th>
      <td>listen_conversions</td>
      <td>n_local_tracks</td>
      <td>-1.514198</td>
      <td>1.315704e-01</td>
      <td>2.04345</td>
      <td>2.13447</td>
      <td>False</td>
    </tr>
    <tr>
      <th>3</th>
      <td>listen_conversions</td>
      <td>n_artists</td>
      <td>1.186743</td>
      <td>2.367580e-01</td>
      <td>73.94089</td>
      <td>73.48707</td>
      <td>False</td>
    </tr>
    <tr>
      <th>0</th>
      <td>user_conversions</td>
      <td>n_artists</td>
      <td>29.009043</td>
      <td>3.528897e-73</td>
      <td>80.09057</td>
      <td>69.51769</td>
      <td>True</td>
    </tr>
    <tr>
      <th>1</th>
      <td>user_conversions</td>
      <td>n_albums</td>
      <td>27.865311</td>
      <td>5.520382e-70</td>
      <td>84.69724</td>
      <td>73.45058</td>
      <td>True</td>
    </tr>
    <tr>
      <th>2</th>
      <td>user_conversions</td>
      <td>n_tracks</td>
      <td>12.465380</td>
      <td>1.108146e-26</td>
      <td>150.70376</td>
      <td>140.85719</td>
      <td>True</td>
    </tr>
    <tr>
      <th>3</th>
      <td>user_conversions</td>
      <td>n_local_tracks</td>
      <td>3.208929</td>
      <td>1.563093e-03</td>
      <td>2.20957</td>
      <td>2.02793</td>
      <td>False</td>
    </tr>
  </tbody>
</table>
</div>

<h2 id="conclusions">Conclusions<a class="headerlink" href="#conclusions" title="Permanent link">&para;</a></h2>
<h3 id="discrete-independent-variables">Discrete, Independent Variables<a class="headerlink" href="#discrete-independent-variables" title="Permanent link">&para;</a></h3>
<p>We note that there is class imbalance in the discrete independent variables:</p>
<div class="codehilite"><pre><span></span><code><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>

<span class="n">dff</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">des_features</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">des_features</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()))</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">des_features</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()))</span>
<span class="n">dff</span> <span class="o">=</span> <span class="n">dff</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
<span class="n">dff</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;mood&#39;</span><span class="p">,</span> <span class="s1">&#39;order&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">]</span>
<span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">dff</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;order&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;mood&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="n">dff</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">des_features</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">des_features</span><span class="p">[</span><span class="mi">4</span><span class="p">]]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()))</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">des_features</span><span class="p">[</span><span class="mi">5</span><span class="p">]]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()))</span>
<span class="n">dff</span> <span class="o">=</span> <span class="n">dff</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
<span class="n">dff</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;genre&#39;</span><span class="p">,</span> <span class="s1">&#39;order&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">]</span>
<span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">dff</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;order&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;genre&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_165_0.png" /></p>
<p>This class imbalance can have a variety of effects (and might be derived from a variety of sources).</p>
<p>For example, users will have more choice when listening to popular genres likeIndie Rock and Rap, and less choice with genres like Blues and Easy listening. As it so happens, when we look to the relationship between genre/mood and the dependent variables, many of the genre/moods with smaller class sizes will have a positive multiplier effect on the dependent variable</p>
<h3 id="continuous-independent-variables">Continuous, Independent Variables<a class="headerlink" href="#continuous-independent-variables" title="Permanent link">&para;</a></h3>
<p>The four continuous variables of focus in this dataset are highly tailed. Due to this, our statistical tests will require bootstrapping.</p>
<div class="codehilite"><pre><span></span><code><span class="n">quant</span> <span class="o">=</span> <span class="mf">0.999</span>
<span class="n">con_features</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;n_albums&#39;</span><span class="p">,</span> <span class="s1">&#39;n_artists&#39;</span><span class="p">,</span> <span class="s1">&#39;n_tracks&#39;</span><span class="p">,</span> <span class="s1">&#39;n_local_tracks&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">con_features</span><span class="p">:</span>
    <span class="n">cutoff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">target</span><span class="p">],</span> <span class="n">quant</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">cutoff</span><span class="p">]</span>
    <span class="n">removed</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">cutoff</span><span class="p">)]</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;removed items: </span><span class="si">{</span><span class="n">removed</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">y</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;hist&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>removed items: 404
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_168_1.png" /></p>
<div class="codehilite"><pre><span></span><code>removed items: 405
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_168_3.png" /></p>
<div class="codehilite"><pre><span></span><code>removed items: 404
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_168_5.png" /></p>
<div class="codehilite"><pre><span></span><code>removed items: 406
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_168_7.png" /></p>
<p>an example of bootstrapping <code>n_albums</code></p>
<div class="codehilite"><pre><span></span><code><span class="n">means</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">ind</span> <span class="o">=</span> <span class="n">con_features</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
    <span class="n">boot</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
                <span class="nb">list</span><span class="p">(</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                        <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">9</span><span class="p">)</span> 
                        <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">999</span><span class="p">)</span>
                    <span class="p">][</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">),</span>
                <span class="n">k</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
    <span class="n">means</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">boot</span><span class="p">))</span>
<span class="n">stuff</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">means</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>

<p><img alt="png" src="../X3_Spotify_Appendix_files/X3_Spotify_Appendix_170_0.png" /></p>
<h3 id="discrete-dependent-variables">Discrete, Dependent Variables<a class="headerlink" href="#discrete-dependent-variables" title="Permanent link">&para;</a></h3>
<p>For the purposes of investigating a "successful" playlist, there are 5 primary metrics:</p>
<div class="codehilite"><pre><span></span><code><span class="n">targets</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>[&#39;streams&#39;,
 &#39;stream30s&#39;,
 &#39;dau&#39;,
 &#39;wau&#39;,
 &#39;mau&#39;,
 &#39;mau_previous_month&#39;,
 &#39;mau_both_months&#39;,
 &#39;users&#39;,
 &#39;skippers&#39;,
 &#39;monthly_stream30s&#39;,
 &#39;monthly_owner_stream30s&#39;]
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">df</span><span class="p">[</span><span class="n">sub_targets</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s2">&quot;file.xlsx&quot;</span><span class="p">)</span>
</code></pre></div>

<p>and "top" performers in each of these metrics were based on top 10% and top 1% quantiles:</p>
<div class="codehilite"><pre><span></span><code><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;p99 targets&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">sub_targets</span><span class="p">:</span>
    <span class="n">space</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">*</span> <span class="p">(</span><span class="mi">20</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">target</span><span class="p">)))</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">target</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">space</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">target</span><span class="p">],</span> <span class="mf">0.99</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;p90 targets&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">sub_targets</span><span class="p">:</span>
    <span class="n">space</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">*</span> <span class="p">(</span><span class="mi">20</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">target</span><span class="p">)))</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">target</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">space</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">target</span><span class="p">],</span> <span class="mf">0.90</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>p99 targets
mau_previous_month:    130.0
mau_both_months:       19.0
mau:                   143.0
monthly_stream30s:     2843.0
stream30s:             113.0

p90 targets
mau_previous_month:    9.0
mau_both_months:       2.0
mau:                   9.0
monthly_stream30s:     432.0
stream30s:             17.0
</code></pre></div>

<p>You can imagine with these metrics, some concerns are:</p>
<ul>
<li>what if a playlist was made in the current month, or even current day?<ul>
<li>playlist is not properly represented by the data</li>
</ul>
</li>
<li>how do we normalize by playlists that already have a high visibility? i.e. what if a playlist is "good" but just isn't getting noticed?<ul>
<li>can compute conversion metrics:<ul>
<li>30 second listens / total listens</li>
<li>mau both months / mau previous month</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>While noting these shortcomings, to keep the analysis focused I singled out the previously mentioned targets, with a focus on <code>monthly_stream30s</code> as the north star metric. <code>monthly_stream30s</code> is advantageous as a nort star metric since it contains data from the entire month (reducing variance) only contains relevant listens (greater than 30 seconds long). Some disadvantages of this metric are that it doesn't account for just a few listeners who may be providing the majority of listens, and playlists that were made in the current month will be undervalued.</p>
<h3 id="dependency_2">Dependency<a class="headerlink" href="#dependency_2" title="Permanent link">&para;</a></h3>
<h4 id="chi-square_1">Chi Square<a class="headerlink" href="#chi-square_1" title="Permanent link">&para;</a></h4>
<p>In the chi-square test, the contigency table was used to calculate a <code>multiplier</code> effect. This is a ratio of ratios: the count of upper quantile over bottom quantile for the given group over the count of upper quantile over bottom quantile for non-group. In other words, it articulates how much more likely a sample in the given group is likely to be in the upper quantile vs a sample not in the given group</p>
<div class="codehilite"><pre><span></span><code><span class="n">chisq_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;chi_square_results.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">chisq_results</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>target</th>
      <th>upper q</th>
      <th>upper q value</th>
      <th>feature</th>
      <th>group</th>
      <th>chi</th>
      <th>p-value</th>
      <th>cTable</th>
      <th>multiplier</th>
      <th>reject null</th>
      <th>rank</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>12</th>
      <td>stream30s</td>
      <td>0.99</td>
      <td>113.0</td>
      <td>mood_3</td>
      <td>-</td>
      <td>125.854082</td>
      <td>3.309444e-29</td>
      <td>[[397434   1935]\n [  3927     70]]</td>
      <td>3.661181</td>
      <td>True</td>
      <td>0</td>
    </tr>
    <tr>
      <th>11</th>
      <td>monthly_stream30s</td>
      <td>0.99</td>
      <td>2843.0</td>
      <td>mood_2</td>
      <td>-</td>
      <td>109.163417</td>
      <td>1.494430e-25</td>
      <td>[[397529   1804]\n [  3969     64]]</td>
      <td>3.553294</td>
      <td>True</td>
      <td>0</td>
    </tr>
    <tr>
      <th>67</th>
      <td>mau_previous_month</td>
      <td>0.90</td>
      <td>9.0</td>
      <td>genre_1</td>
      <td>-</td>
      <td>95.863487</td>
      <td>1.230846e-22</td>
      <td>[[365249    769]\n [ 37173    175]]</td>
      <td>2.236007</td>
      <td>True</td>
      <td>0</td>
    </tr>
    <tr>
      <th>10</th>
      <td>monthly_stream30s</td>
      <td>0.99</td>
      <td>2843.0</td>
      <td>mood_1</td>
      <td>-</td>
      <td>112.668942</td>
      <td>2.549855e-26</td>
      <td>[[397605   1728]\n [  3970     63]]</td>
      <td>3.651389</td>
      <td>True</td>
      <td>0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>stream30s</td>
      <td>0.99</td>
      <td>113.0</td>
      <td>mood_1</td>
      <td>-</td>
      <td>141.501726</td>
      <td>1.249779e-32</td>
      <td>[[397646   1723]\n [  3929     68]]</td>
      <td>3.994277</td>
      <td>True</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>

<div class="codehilite"><pre><span></span><code><span class="n">chisq_results</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>array([&#39;stream30s&#39;, &#39;monthly_stream30s&#39;, &#39;mau_previous_month&#39;, &#39;mau&#39;,
       &#39;mau_both_months&#39;], dtype=object)
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">chisq_results</span><span class="p">[</span><span class="s1">&#39;upper q&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>array([0.99, 0.9 ])
</code></pre></div>

<p>Taking together the five targets, the two upper quantiles, and the six categorical independent variables, we can identify which group occured the most frequently as a variable of influence:</p>
<div class="codehilite"><pre><span></span><code><span class="n">chisq_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">chisq_results</span><span class="p">[</span><span class="s1">&#39;feature&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;genre&#39;</span><span class="p">))</span>
                <span class="o">&amp;</span> <span class="p">(</span><span class="n">chisq_results</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;-&#39;</span><span class="p">)][</span><span class="s1">&#39;group&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>Traditional       16
Children&#39;s        16
Jazz              14
Latin             12
Easy Listening     8
Soundtrack         8
New Age            7
Holiday            6
Spoken &amp; Audio     4
Other              2
Name: group, dtype: int64
</code></pre></div>

<p>Using these value counts as a "rank" we can then groupby this rank and see how each group is influencing the propensity to be in the upper quadrant</p>
<p>Taking "Romantic" as an example, we see that it's multiplier effect is relatively consistent across the five targets and two quantiles:</p>
<div class="codehilite"><pre><span></span><code><span class="n">sort_key</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="n">j</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">chisq_results</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="n">chisq_results</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()))}</span>
<span class="n">chisq_results</span><span class="p">[</span><span class="s1">&#39;rank&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">chisq_results</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">sort_key</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
<span class="n">chisq_results</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;rank&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># chisq_results.drop(&#39;rank&#39;, axis=1, inplace=True)</span>
<span class="n">chisq_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">chisq_results</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;-&#39;</span><span class="p">][:</span><span class="mi">20</span><span class="p">]</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>target</th>
      <th>upper q</th>
      <th>upper q value</th>
      <th>feature</th>
      <th>group</th>
      <th>chi</th>
      <th>p-value</th>
      <th>cTable</th>
      <th>multiplier</th>
      <th>reject null</th>
      <th>rank</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3</th>
      <td>mau_both_months</td>
      <td>0.99</td>
      <td>19.0</td>
      <td>mood_1</td>
      <td>Romantic</td>
      <td>109.693770</td>
      <td>1.143607e-25</td>
      <td>[[390177   9231]\n [  3766    192]]</td>
      <td>2.154933</td>
      <td>True</td>
      <td>1</td>
    </tr>
    <tr>
      <th>5</th>
      <td>mau_previous_month</td>
      <td>0.90</td>
      <td>9.0</td>
      <td>mood_2</td>
      <td>Romantic</td>
      <td>1379.938658</td>
      <td>4.806442e-302</td>
      <td>[[357822   8196]\n [ 35327   2021]]</td>
      <td>2.497610</td>
      <td>True</td>
      <td>1</td>
    </tr>
    <tr>
      <th>8</th>
      <td>stream30s</td>
      <td>0.99</td>
      <td>113.0</td>
      <td>mood_1</td>
      <td>Romantic</td>
      <td>139.245969</td>
      <td>3.891401e-32</td>
      <td>[[390152   9217]\n [  3791    206]]</td>
      <td>2.300158</td>
      <td>True</td>
      <td>1</td>
    </tr>
    <tr>
      <th>6</th>
      <td>mau_previous_month</td>
      <td>0.99</td>
      <td>130.0</td>
      <td>mood_2</td>
      <td>Romantic</td>
      <td>104.434543</td>
      <td>1.624732e-24</td>
      <td>[[389323  10013]\n [  3826    204]]</td>
      <td>2.073152</td>
      <td>True</td>
      <td>1</td>
    </tr>
    <tr>
      <th>6</th>
      <td>mau</td>
      <td>0.90</td>
      <td>9.0</td>
      <td>mood_1</td>
      <td>Romantic</td>
      <td>1328.179994</td>
      <td>8.498925e-291</td>
      <td>[[355892   7442]\n [ 38051   1981]]</td>
      <td>2.489700</td>
      <td>True</td>
      <td>1</td>
    </tr>
    <tr>
      <th>5</th>
      <td>mau</td>
      <td>0.99</td>
      <td>143.0</td>
      <td>mood_3</td>
      <td>Romantic</td>
      <td>122.574129</td>
      <td>1.728356e-28</td>
      <td>[[389664   9685]\n [  3810    207]]</td>
      <td>2.185929</td>
      <td>True</td>
      <td>1</td>
    </tr>
    <tr>
      <th>10</th>
      <td>stream30s</td>
      <td>0.99</td>
      <td>113.0</td>
      <td>mood_3</td>
      <td>Romantic</td>
      <td>136.025552</td>
      <td>1.969792e-31</td>
      <td>[[389689   9680]\n [  3785    212]]</td>
      <td>2.254825</td>
      <td>True</td>
      <td>1</td>
    </tr>
    <tr>
      <th>6</th>
      <td>mau_previous_month</td>
      <td>0.90</td>
      <td>9.0</td>
      <td>mood_1</td>
      <td>Romantic</td>
      <td>1142.816205</td>
      <td>1.633755e-250</td>
      <td>[[358408   7610]\n [ 35535   1813]]</td>
      <td>2.402893</td>
      <td>True</td>
      <td>1</td>
    </tr>
    <tr>
      <th>6</th>
      <td>monthly_stream30s</td>
      <td>0.99</td>
      <td>2843.0</td>
      <td>mood_3</td>
      <td>Romantic</td>
      <td>149.750731</td>
      <td>1.965370e-34</td>
      <td>[[389660   9673]\n [  3814    219]]</td>
      <td>2.313066</td>
      <td>True</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>monthly_stream30s</td>
      <td>0.99</td>
      <td>2843.0</td>
      <td>mood_1</td>
      <td>Romantic</td>
      <td>175.072639</td>
      <td>5.772239e-40</td>
      <td>[[390131   9202]\n [  3812    221]]</td>
      <td>2.457919</td>
      <td>True</td>
      <td>1</td>
    </tr>
    <tr>
      <th>6</th>
      <td>mau</td>
      <td>0.99</td>
      <td>143.0</td>
      <td>mood_2</td>
      <td>Romantic</td>
      <td>105.450504</td>
      <td>9.729814e-25</td>
      <td>[[389336  10013]\n [  3813    204]]</td>
      <td>2.080289</td>
      <td>True</td>
      <td>1</td>
    </tr>
    <tr>
      <th>5</th>
      <td>mau_previous_month</td>
      <td>0.99</td>
      <td>130.0</td>
      <td>mood_3</td>
      <td>Romantic</td>
      <td>112.605179</td>
      <td>2.633191e-26</td>
      <td>[[389647   9689]\n [  3827    203]]</td>
      <td>2.133192</td>
      <td>True</td>
      <td>1</td>
    </tr>
    <tr>
      <th>6</th>
      <td>stream30s</td>
      <td>0.99</td>
      <td>113.0</td>
      <td>mood_2</td>
      <td>Romantic</td>
      <td>148.026986</td>
      <td>4.679851e-34</td>
      <td>[[389374   9995]\n [  3775    222]]</td>
      <td>2.290974</td>
      <td>True</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>mau</td>
      <td>0.99</td>
      <td>143.0</td>
      <td>mood_1</td>
      <td>Romantic</td>
      <td>202.823985</td>
      <td>5.053546e-46</td>
      <td>[[390156   9193]\n [  3787    230]]</td>
      <td>2.577588</td>
      <td>True</td>
      <td>1</td>
    </tr>
    <tr>
      <th>7</th>
      <td>monthly_stream30s</td>
      <td>0.99</td>
      <td>2843.0</td>
      <td>mood_2</td>
      <td>Romantic</td>
      <td>146.934024</td>
      <td>8.112487e-34</td>
      <td>[[389339   9994]\n [  3810    223]]</td>
      <td>2.280176</td>
      <td>True</td>
      <td>1</td>
    </tr>
    <tr>
      <th>8</th>
      <td>mau_previous_month</td>
      <td>0.90</td>
      <td>9.0</td>
      <td>mood_3</td>
      <td>Romantic</td>
      <td>1013.797108</td>
      <td>1.800082e-222</td>
      <td>[[357949   8069]\n [ 35525   1823]]</td>
      <td>2.276429</td>
      <td>True</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>mau_previous_month</td>
      <td>0.99</td>
      <td>130.0</td>
      <td>mood_1</td>
      <td>Romantic</td>
      <td>156.500834</td>
      <td>6.579992e-36</td>
      <td>[[390127   9209]\n [  3816    214]]</td>
      <td>2.375740</td>
      <td>True</td>
      <td>1</td>
    </tr>
    <tr>
      <th>8</th>
      <td>mau</td>
      <td>0.90</td>
      <td>9.0</td>
      <td>mood_3</td>
      <td>Romantic</td>
      <td>1170.355016</td>
      <td>1.690629e-256</td>
      <td>[[355429   7905]\n [ 38045   1987]]</td>
      <td>2.348287</td>
      <td>True</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>mau</td>
      <td>0.90</td>
      <td>9.0</td>
      <td>mood_2</td>
      <td>Romantic</td>
      <td>1531.190216</td>
      <td>0.000000e+00</td>
      <td>[[355299   8035]\n [ 37850   2182]]</td>
      <td>2.549159</td>
      <td>True</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>mau</td>
      <td>0.90</td>
      <td>9.0</td>
      <td>mood_1</td>
      <td>Lively</td>
      <td>2423.134070</td>
      <td>0.000000e+00</td>
      <td>[[355493   7841]\n [ 37527   2505]]</td>
      <td>3.026380</td>
      <td>True</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div>

<div class="codehilite"><pre><span></span><code><span class="n">chisq_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">chisq_results</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Traditional&#39;</span><span class="p">)</span>
                 <span class="o">&amp;</span> <span class="p">(</span><span class="n">chisq_results</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;monthly_stream30s&#39;</span><span class="p">)]</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>target</th>
      <th>upper q</th>
      <th>upper q value</th>
      <th>feature</th>
      <th>group</th>
      <th>chi</th>
      <th>p-value</th>
      <th>cTable</th>
      <th>multiplier</th>
      <th>reject null</th>
      <th>rank</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>36</th>
      <td>monthly_stream30s</td>
      <td>0.99</td>
      <td>2843.0</td>
      <td>genre_3</td>
      <td>Traditional</td>
      <td>29.032918</td>
      <td>7.115879e-08</td>
      <td>[[396376   2957]\n [  3973     60]]</td>
      <td>2.024364</td>
      <td>True</td>
      <td>3</td>
    </tr>
    <tr>
      <th>27</th>
      <td>monthly_stream30s</td>
      <td>0.99</td>
      <td>2843.0</td>
      <td>genre_2</td>
      <td>Traditional</td>
      <td>47.457479</td>
      <td>5.621008e-12</td>
      <td>[[396211   3122]\n [  3962     71]]</td>
      <td>2.274246</td>
      <td>True</td>
      <td>3</td>
    </tr>
  </tbody>
</table>
</div>

<p>Let's use this idea of average multiplier effect, and average chi-square statistic to summarize by group.</p>
<p>Sorting by the test statistic, we see the top 5 most influential groups:</p>
<div class="codehilite"><pre><span></span><code><span class="n">chisq_results</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;group&#39;</span><span class="p">)[[</span><span class="s1">&#39;chi&#39;</span><span class="p">,</span> <span class="s1">&#39;multiplier&#39;</span><span class="p">,</span> <span class="s1">&#39;rank&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;chi&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)[:</span><span class="mi">10</span><span class="p">]</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>chi</th>
      <th>multiplier</th>
      <th>rank</th>
    </tr>
    <tr>
      <th>group</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Latin</th>
      <td>1686.610898</td>
      <td>3.001282</td>
      <td>6.0</td>
    </tr>
    <tr>
      <th>-</th>
      <td>766.884882</td>
      <td>3.049100</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>Sophisticated</th>
      <td>581.181538</td>
      <td>2.055203</td>
      <td>18.0</td>
    </tr>
    <tr>
      <th>Lively</th>
      <td>523.373076</td>
      <td>2.364492</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>Romantic</th>
      <td>493.442950</td>
      <td>2.318001</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>Soundtrack</th>
      <td>345.506268</td>
      <td>2.209295</td>
      <td>9.0</td>
    </tr>
    <tr>
      <th>Jazz</th>
      <td>323.657066</td>
      <td>2.342954</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Fiery</th>
      <td>261.957158</td>
      <td>2.244027</td>
      <td>15.0</td>
    </tr>
    <tr>
      <th>Tender</th>
      <td>212.399270</td>
      <td>3.033890</td>
      <td>16.0</td>
    </tr>
    <tr>
      <th>Traditional</th>
      <td>176.194741</td>
      <td>2.361342</td>
      <td>3.0</td>
    </tr>
  </tbody>
</table>
</div>

<p>Sorting instead by the multiplier, we can see which group has the <em>heaviest</em> influence</p>
<div class="codehilite"><pre><span></span><code><span class="n">chisq_results</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;group&#39;</span><span class="p">)[[</span><span class="s1">&#39;chi&#39;</span><span class="p">,</span> <span class="s1">&#39;multiplier&#39;</span><span class="p">,</span> <span class="s1">&#39;rank&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;multiplier&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)[:</span><span class="mi">10</span><span class="p">]</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>chi</th>
      <th>multiplier</th>
      <th>rank</th>
    </tr>
    <tr>
      <th>group</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>-</th>
      <td>766.884882</td>
      <td>3.049100</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>Tender</th>
      <td>212.399270</td>
      <td>3.033890</td>
      <td>16.0</td>
    </tr>
    <tr>
      <th>Latin</th>
      <td>1686.610898</td>
      <td>3.001282</td>
      <td>6.0</td>
    </tr>
    <tr>
      <th>Children's</th>
      <td>165.058604</td>
      <td>2.871261</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>Holiday</th>
      <td>41.741338</td>
      <td>2.836528</td>
      <td>12.0</td>
    </tr>
    <tr>
      <th>New Age</th>
      <td>75.783147</td>
      <td>2.754796</td>
      <td>10.0</td>
    </tr>
    <tr>
      <th>Spoken &amp; Audio</th>
      <td>163.859264</td>
      <td>2.610393</td>
      <td>14.0</td>
    </tr>
    <tr>
      <th>Peaceful</th>
      <td>61.046237</td>
      <td>2.564297</td>
      <td>13.0</td>
    </tr>
    <tr>
      <th>Other</th>
      <td>166.299708</td>
      <td>2.425104</td>
      <td>11.0</td>
    </tr>
    <tr>
      <th>Easy Listening</th>
      <td>99.533804</td>
      <td>2.407295</td>
      <td>8.0</td>
    </tr>
  </tbody>
</table>
</div>

<p>Sorting instead by rank, we see which groups show up most frequently</p>
<div class="codehilite"><pre><span></span><code><span class="n">chisq_results</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;group&#39;</span><span class="p">)[[</span><span class="s1">&#39;chi&#39;</span><span class="p">,</span> <span class="s1">&#39;multiplier&#39;</span><span class="p">,</span> <span class="s1">&#39;rank&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;rank&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)[:</span><span class="mi">10</span><span class="p">]</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>chi</th>
      <th>multiplier</th>
      <th>rank</th>
    </tr>
    <tr>
      <th>group</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>-</th>
      <td>766.884882</td>
      <td>3.049100</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>Romantic</th>
      <td>493.442950</td>
      <td>2.318001</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>Lively</th>
      <td>523.373076</td>
      <td>2.364492</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>Traditional</th>
      <td>176.194741</td>
      <td>2.361342</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>Children's</th>
      <td>165.058604</td>
      <td>2.871261</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>Jazz</th>
      <td>323.657066</td>
      <td>2.342954</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Latin</th>
      <td>1686.610898</td>
      <td>3.001282</td>
      <td>6.0</td>
    </tr>
    <tr>
      <th>Serious</th>
      <td>103.700606</td>
      <td>2.190306</td>
      <td>7.0</td>
    </tr>
    <tr>
      <th>Easy Listening</th>
      <td>99.533804</td>
      <td>2.407295</td>
      <td>8.0</td>
    </tr>
    <tr>
      <th>Soundtrack</th>
      <td>345.506268</td>
      <td>2.209295</td>
      <td>9.0</td>
    </tr>
  </tbody>
</table>
</div>

<div class="codehilite"><pre><span></span><code><span class="n">chisq_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">chisq_results</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;monthly_stream30s&#39;</span><span class="p">]</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>target</th>
      <th>upper q</th>
      <th>upper q value</th>
      <th>feature</th>
      <th>group</th>
      <th>chi</th>
      <th>p-value</th>
      <th>cTable</th>
      <th>multiplier</th>
      <th>reject null</th>
      <th>rank</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>14</th>
      <td>monthly_stream30s</td>
      <td>0.99</td>
      <td>2843.0</td>
      <td>mood_3</td>
      <td>-</td>
      <td>95.615882</td>
      <td>1.394829e-22</td>
      <td>[[397392   1941]\n [  3969     64]]</td>
      <td>3.301357</td>
      <td>True</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>monthly_stream30s</td>
      <td>0.99</td>
      <td>2843.0</td>
      <td>genre_1</td>
      <td>-</td>
      <td>198.911522</td>
      <td>3.608821e-45</td>
      <td>[[398442    891]\n [  3980     53]]</td>
      <td>5.954979</td>
      <td>True</td>
      <td>0</td>
    </tr>
    <tr>
      <th>10</th>
      <td>monthly_stream30s</td>
      <td>0.99</td>
      <td>2843.0</td>
      <td>mood_1</td>
      <td>-</td>
      <td>112.668942</td>
      <td>2.549855e-26</td>
      <td>[[397605   1728]\n [  3970     63]]</td>
      <td>3.651389</td>
      <td>True</td>
      <td>0</td>
    </tr>
    <tr>
      <th>11</th>
      <td>monthly_stream30s</td>
      <td>0.99</td>
      <td>2843.0</td>
      <td>mood_2</td>
      <td>-</td>
      <td>109.163417</td>
      <td>1.494430e-25</td>
      <td>[[397529   1804]\n [  3969     64]]</td>
      <td>3.553294</td>
      <td>True</td>
      <td>0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>monthly_stream30s</td>
      <td>0.99</td>
      <td>2843.0</td>
      <td>mood_3</td>
      <td>Romantic</td>
      <td>149.750731</td>
      <td>1.965370e-34</td>
      <td>[[389660   9673]\n [  3814    219]]</td>
      <td>2.313066</td>
      <td>True</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>monthly_stream30s</td>
      <td>0.99</td>
      <td>2843.0</td>
      <td>mood_1</td>
      <td>Romantic</td>
      <td>175.072639</td>
      <td>5.772239e-40</td>
      <td>[[390131   9202]\n [  3812    221]]</td>
      <td>2.457919</td>
      <td>True</td>
      <td>1</td>
    </tr>
    <tr>
      <th>7</th>
      <td>monthly_stream30s</td>
      <td>0.99</td>
      <td>2843.0</td>
      <td>mood_2</td>
      <td>Romantic</td>
      <td>146.934024</td>
      <td>8.112487e-34</td>
      <td>[[389339   9994]\n [  3810    223]]</td>
      <td>2.280176</td>
      <td>True</td>
      <td>1</td>
    </tr>
    <tr>
      <th>22</th>
      <td>monthly_stream30s</td>
      <td>0.99</td>
      <td>2843.0</td>
      <td>mood_2</td>
      <td>Lively</td>
      <td>62.570224</td>
      <td>2.571115e-15</td>
      <td>[[393976   5357]\n [  3920    113]]</td>
      <td>2.120023</td>
      <td>True</td>
      <td>2</td>
    </tr>
    <tr>
      <th>5</th>
      <td>monthly_stream30s</td>
      <td>0.99</td>
      <td>2843.0</td>
      <td>mood_1</td>
      <td>Lively</td>
      <td>172.134248</td>
      <td>2.529542e-39</td>
      <td>[[389222  10111]\n [  3798    235]]</td>
      <td>2.381860</td>
      <td>True</td>
      <td>2</td>
    </tr>
    <tr>
      <th>36</th>
      <td>monthly_stream30s</td>
      <td>0.99</td>
      <td>2843.0</td>
      <td>genre_3</td>
      <td>Traditional</td>
      <td>29.032918</td>
      <td>7.115879e-08</td>
      <td>[[396376   2957]\n [  3973     60]]</td>
      <td>2.024364</td>
      <td>True</td>
      <td>3</td>
    </tr>
    <tr>
      <th>27</th>
      <td>monthly_stream30s</td>
      <td>0.99</td>
      <td>2843.0</td>
      <td>genre_2</td>
      <td>Traditional</td>
      <td>47.457479</td>
      <td>5.621008e-12</td>
      <td>[[396211   3122]\n [  3962     71]]</td>
      <td>2.274246</td>
      <td>True</td>
      <td>3</td>
    </tr>
    <tr>
      <th>37</th>
      <td>monthly_stream30s</td>
      <td>0.99</td>
      <td>2843.0</td>
      <td>genre_2</td>
      <td>Children's</td>
      <td>28.313598</td>
      <td>1.031687e-07</td>
      <td>[[397689   1644]\n [  3994     39]]</td>
      <td>2.362100</td>
      <td>True</td>
      <td>4</td>
    </tr>
    <tr>
      <th>2</th>
      <td>monthly_stream30s</td>
      <td>0.99</td>
      <td>2843.0</td>
      <td>genre_1</td>
      <td>Children's</td>
      <td>207.229586</td>
      <td>5.524721e-47</td>
      <td>[[397760   1573]\n [  3958     75]]</td>
      <td>4.791570</td>
      <td>True</td>
      <td>4</td>
    </tr>
    <tr>
      <th>6</th>
      <td>monthly_stream30s</td>
      <td>0.90</td>
      <td>432.0</td>
      <td>genre_1</td>
      <td>Children's</td>
      <td>262.624693</td>
      <td>4.596280e-59</td>
      <td>[[361785   1286]\n [ 39933    362]]</td>
      <td>2.550270</td>
      <td>True</td>
      <td>4</td>
    </tr>
    <tr>
      <th>16</th>
      <td>monthly_stream30s</td>
      <td>0.99</td>
      <td>2843.0</td>
      <td>genre_2</td>
      <td>Jazz</td>
      <td>79.207991</td>
      <td>5.590349e-19</td>
      <td>[[394671   4662]\n [  3924    109]]</td>
      <td>2.351584</td>
      <td>True</td>
      <td>5</td>
    </tr>
    <tr>
      <th>30</th>
      <td>monthly_stream30s</td>
      <td>0.99</td>
      <td>2843.0</td>
      <td>genre_3</td>
      <td>Jazz</td>
      <td>39.188768</td>
      <td>3.847472e-10</td>
      <td>[[395392   3941]\n [  3953     80]]</td>
      <td>2.030414</td>
      <td>True</td>
      <td>5</td>
    </tr>
    <tr>
      <th>0</th>
      <td>monthly_stream30s</td>
      <td>0.99</td>
      <td>2843.0</td>
      <td>genre_1</td>
      <td>Latin</td>
      <td>537.892273</td>
      <td>5.419582e-119</td>
      <td>[[384749  14584]\n [  3605    428]]</td>
      <td>3.132127</td>
      <td>True</td>
      <td>6</td>
    </tr>
    <tr>
      <th>0</th>
      <td>monthly_stream30s</td>
      <td>0.90</td>
      <td>432.0</td>
      <td>genre_1</td>
      <td>Latin</td>
      <td>1150.625294</td>
      <td>3.280867e-252</td>
      <td>[[350782  12289]\n [ 37572   2723]]</td>
      <td>2.068731</td>
      <td>True</td>
      <td>6</td>
    </tr>
    <tr>
      <th>50</th>
      <td>monthly_stream30s</td>
      <td>0.99</td>
      <td>2843.0</td>
      <td>mood_2</td>
      <td>Serious</td>
      <td>20.339173</td>
      <td>6.485903e-06</td>
      <td>[[397730   1603]\n [  3998     35]]</td>
      <td>2.172101</td>
      <td>True</td>
      <td>7</td>
    </tr>
    <tr>
      <th>38</th>
      <td>monthly_stream30s</td>
      <td>0.99</td>
      <td>2843.0</td>
      <td>genre_2</td>
      <td>Easy Listening</td>
      <td>28.186480</td>
      <td>1.101715e-07</td>
      <td>[[397256   2077]\n [  3987     46]]</td>
      <td>2.206712</td>
      <td>True</td>
      <td>8</td>
    </tr>
    <tr>
      <th>29</th>
      <td>monthly_stream30s</td>
      <td>0.99</td>
      <td>2843.0</td>
      <td>genre_1</td>
      <td>Easy Listening</td>
      <td>40.400033</td>
      <td>2.069376e-10</td>
      <td>[[398435    898]\n [  4004     29]]</td>
      <td>3.213550</td>
      <td>True</td>
      <td>8</td>
    </tr>
    <tr>
      <th>20</th>
      <td>monthly_stream30s</td>
      <td>0.99</td>
      <td>2843.0</td>
      <td>genre_1</td>
      <td>Soundtrack</td>
      <td>66.073066</td>
      <td>4.345131e-16</td>
      <td>[[392575   6758]\n [  3897    136]]</td>
      <td>2.027276</td>
      <td>True</td>
      <td>9</td>
    </tr>
    <tr>
      <th>28</th>
      <td>monthly_stream30s</td>
      <td>0.99</td>
      <td>2843.0</td>
      <td>genre_1</td>
      <td>New Age</td>
      <td>43.730647</td>
      <td>3.768245e-11</td>
      <td>[[397202   2131]\n [  3980     53]]</td>
      <td>2.482109</td>
      <td>True</td>
      <td>10</td>
    </tr>
    <tr>
      <th>12</th>
      <td>monthly_stream30s</td>
      <td>0.90</td>
      <td>432.0</td>
      <td>genre_1</td>
      <td>New Age</td>
      <td>166.484617</td>
      <td>4.335181e-38</td>
      <td>[[361286   1785]\n [ 39896    399]]</td>
      <td>2.024214</td>
      <td>True</td>
      <td>10</td>
    </tr>
    <tr>
      <th>21</th>
      <td>monthly_stream30s</td>
      <td>0.99</td>
      <td>2843.0</td>
      <td>genre_3</td>
      <td>New Age</td>
      <td>63.004025</td>
      <td>2.062846e-15</td>
      <td>[[397632   1701]\n [  3982     51]]</td>
      <td>2.993960</td>
      <td>True</td>
      <td>10</td>
    </tr>
    <tr>
      <th>15</th>
      <td>monthly_stream30s</td>
      <td>0.99</td>
      <td>2843.0</td>
      <td>genre_2</td>
      <td>New Age</td>
      <td>85.761620</td>
      <td>2.029879e-20</td>
      <td>[[397614   1719]\n [  3976     57]]</td>
      <td>3.315998</td>
      <td>True</td>
      <td>10</td>
    </tr>
    <tr>
      <th>33</th>
      <td>monthly_stream30s</td>
      <td>0.99</td>
      <td>2843.0</td>
      <td>mood_1</td>
      <td>Other</td>
      <td>30.443472</td>
      <td>3.437382e-08</td>
      <td>[[397678   1655]\n [  3993     40]]</td>
      <td>2.407101</td>
      <td>True</td>
      <td>11</td>
    </tr>
    <tr>
      <th>11</th>
      <td>monthly_stream30s</td>
      <td>0.90</td>
      <td>432.0</td>
      <td>mood_1</td>
      <td>Other</td>
      <td>197.598843</td>
      <td>6.979647e-45</td>
      <td>[[361719   1352]\n [ 39952    343]]</td>
      <td>2.296943</td>
      <td>True</td>
      <td>11</td>
    </tr>
    <tr>
      <th>26</th>
      <td>monthly_stream30s</td>
      <td>0.99</td>
      <td>2843.0</td>
      <td>mood_1</td>
      <td>Peaceful</td>
      <td>47.834009</td>
      <td>4.638752e-12</td>
      <td>[[397055   2278]\n [  3976     57]]</td>
      <td>2.498765</td>
      <td>True</td>
      <td>13</td>
    </tr>
    <tr>
      <th>17</th>
      <td>monthly_stream30s</td>
      <td>0.99</td>
      <td>2843.0</td>
      <td>mood_3</td>
      <td>Peaceful</td>
      <td>69.964512</td>
      <td>6.038104e-17</td>
      <td>[[396736   2597]\n [  3963     70]]</td>
      <td>2.698383</td>
      <td>True</td>
      <td>13</td>
    </tr>
    <tr>
      <th>12</th>
      <td>monthly_stream30s</td>
      <td>0.99</td>
      <td>2843.0</td>
      <td>mood_2</td>
      <td>Peaceful</td>
      <td>99.188851</td>
      <td>2.295356e-23</td>
      <td>[[396395   2938]\n [  3948     85]]</td>
      <td>2.904813</td>
      <td>True</td>
      <td>13</td>
    </tr>
    <tr>
      <th>52</th>
      <td>monthly_stream30s</td>
      <td>0.99</td>
      <td>2843.0</td>
      <td>genre_1</td>
      <td>Spoken &amp; Audio</td>
      <td>19.783961</td>
      <td>8.670724e-06</td>
      <td>[[398209   1124]\n [  4006     27]]</td>
      <td>2.387798</td>
      <td>True</td>
      <td>14</td>
    </tr>
    <tr>
      <th>19</th>
      <td>monthly_stream30s</td>
      <td>0.90</td>
      <td>432.0</td>
      <td>genre_1</td>
      <td>Spoken &amp; Audio</td>
      <td>120.508309</td>
      <td>4.896128e-28</td>
      <td>[[362147    924]\n [ 40068    227]]</td>
      <td>2.220451</td>
      <td>True</td>
      <td>14</td>
    </tr>
    <tr>
      <th>1</th>
      <td>monthly_stream30s</td>
      <td>0.99</td>
      <td>2843.0</td>
      <td>mood_1</td>
      <td>Tender</td>
      <td>218.759022</td>
      <td>1.686848e-49</td>
      <td>[[396180   3153]\n [  3916    117]]</td>
      <td>3.754151</td>
      <td>True</td>
      <td>16</td>
    </tr>
    <tr>
      <th>23</th>
      <td>monthly_stream30s</td>
      <td>0.99</td>
      <td>2843.0</td>
      <td>mood_2</td>
      <td>Easygoing</td>
      <td>61.911050</td>
      <td>3.593275e-15</td>
      <td>[[394661   4672]\n [  3931    102]]</td>
      <td>2.191889</td>
      <td>True</td>
      <td>17</td>
    </tr>
    <tr>
      <th>25</th>
      <td>monthly_stream30s</td>
      <td>0.99</td>
      <td>2843.0</td>
      <td>mood_3</td>
      <td>Easygoing</td>
      <td>49.108110</td>
      <td>2.422366e-12</td>
      <td>[[394265   5068]\n [  3931    102]]</td>
      <td>2.018593</td>
      <td>True</td>
      <td>17</td>
    </tr>
    <tr>
      <th>34</th>
      <td>monthly_stream30s</td>
      <td>0.99</td>
      <td>2843.0</td>
      <td>mood_3</td>
      <td>Somber</td>
      <td>29.620347</td>
      <td>5.255040e-08</td>
      <td>[[397107   2226]\n [  3984     49]]</td>
      <td>2.194114</td>
      <td>True</td>
      <td>19</td>
    </tr>
  </tbody>
</table>
</div>

<p>It creates some fog to jumble together mood/genres this way. We can instead separate them and ask questions like:</p>
<h5 id="what-is-the-most-influential-primary-genre-on-monthly-streams-over-30-seconds">What is the most influential primary genre on monthly streams over 30 seconds?<a class="headerlink" href="#what-is-the-most-influential-primary-genre-on-monthly-streams-over-30-seconds" title="Permanent link">&para;</a></h5>
<p>Answer: Children's followed by Latin</p>
<p>Reason: both genre's appear as influential in other guardrail metrics (high rank), have high test statistics, and are influential in both p99 and p90 with multiplier effects of [4.8, 2.6] and [3.1, 2.1], respectively.</p>
<div class="codehilite"><pre><span></span><code><span class="n">chisq_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">chisq_results</span><span class="p">[</span><span class="s1">&#39;feature&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;genre_1&#39;</span><span class="p">)</span>
                 <span class="o">&amp;</span> <span class="p">(</span><span class="n">chisq_results</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;monthly_stream30s&#39;</span><span class="p">)]</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>target</th>
      <th>upper q</th>
      <th>upper q value</th>
      <th>feature</th>
      <th>group</th>
      <th>chi</th>
      <th>p-value</th>
      <th>cTable</th>
      <th>multiplier</th>
      <th>reject null</th>
      <th>rank</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3</th>
      <td>monthly_stream30s</td>
      <td>0.99</td>
      <td>2843.0</td>
      <td>genre_1</td>
      <td>-</td>
      <td>198.911522</td>
      <td>3.608821e-45</td>
      <td>[[398442    891]\n [  3980     53]]</td>
      <td>5.954979</td>
      <td>True</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>monthly_stream30s</td>
      <td>0.99</td>
      <td>2843.0</td>
      <td>genre_1</td>
      <td>Children's</td>
      <td>207.229586</td>
      <td>5.524721e-47</td>
      <td>[[397760   1573]\n [  3958     75]]</td>
      <td>4.791570</td>
      <td>True</td>
      <td>4</td>
    </tr>
    <tr>
      <th>6</th>
      <td>monthly_stream30s</td>
      <td>0.90</td>
      <td>432.0</td>
      <td>genre_1</td>
      <td>Children's</td>
      <td>262.624693</td>
      <td>4.596280e-59</td>
      <td>[[361785   1286]\n [ 39933    362]]</td>
      <td>2.550270</td>
      <td>True</td>
      <td>4</td>
    </tr>
    <tr>
      <th>0</th>
      <td>monthly_stream30s</td>
      <td>0.99</td>
      <td>2843.0</td>
      <td>genre_1</td>
      <td>Latin</td>
      <td>537.892273</td>
      <td>5.419582e-119</td>
      <td>[[384749  14584]\n [  3605    428]]</td>
      <td>3.132127</td>
      <td>True</td>
      <td>6</td>
    </tr>
    <tr>
      <th>0</th>
      <td>monthly_stream30s</td>
      <td>0.90</td>
      <td>432.0</td>
      <td>genre_1</td>
      <td>Latin</td>
      <td>1150.625294</td>
      <td>3.280867e-252</td>
      <td>[[350782  12289]\n [ 37572   2723]]</td>
      <td>2.068731</td>
      <td>True</td>
      <td>6</td>
    </tr>
    <tr>
      <th>29</th>
      <td>monthly_stream30s</td>
      <td>0.99</td>
      <td>2843.0</td>
      <td>genre_1</td>
      <td>Easy Listening</td>
      <td>40.400033</td>
      <td>2.069376e-10</td>
      <td>[[398435    898]\n [  4004     29]]</td>
      <td>3.213550</td>
      <td>True</td>
      <td>8</td>
    </tr>
    <tr>
      <th>20</th>
      <td>monthly_stream30s</td>
      <td>0.99</td>
      <td>2843.0</td>
      <td>genre_1</td>
      <td>Soundtrack</td>
      <td>66.073066</td>
      <td>4.345131e-16</td>
      <td>[[392575   6758]\n [  3897    136]]</td>
      <td>2.027276</td>
      <td>True</td>
      <td>9</td>
    </tr>
    <tr>
      <th>28</th>
      <td>monthly_stream30s</td>
      <td>0.99</td>
      <td>2843.0</td>
      <td>genre_1</td>
      <td>New Age</td>
      <td>43.730647</td>
      <td>3.768245e-11</td>
      <td>[[397202   2131]\n [  3980     53]]</td>
      <td>2.482109</td>
      <td>True</td>
      <td>10</td>
    </tr>
    <tr>
      <th>12</th>
      <td>monthly_stream30s</td>
      <td>0.90</td>
      <td>432.0</td>
      <td>genre_1</td>
      <td>New Age</td>
      <td>166.484617</td>
      <td>4.335181e-38</td>
      <td>[[361286   1785]\n [ 39896    399]]</td>
      <td>2.024214</td>
      <td>True</td>
      <td>10</td>
    </tr>
    <tr>
      <th>52</th>
      <td>monthly_stream30s</td>
      <td>0.99</td>
      <td>2843.0</td>
      <td>genre_1</td>
      <td>Spoken &amp; Audio</td>
      <td>19.783961</td>
      <td>8.670724e-06</td>
      <td>[[398209   1124]\n [  4006     27]]</td>
      <td>2.387798</td>
      <td>True</td>
      <td>14</td>
    </tr>
    <tr>
      <th>19</th>
      <td>monthly_stream30s</td>
      <td>0.90</td>
      <td>432.0</td>
      <td>genre_1</td>
      <td>Spoken &amp; Audio</td>
      <td>120.508309</td>
      <td>4.896128e-28</td>
      <td>[[362147    924]\n [ 40068    227]]</td>
      <td>2.220451</td>
      <td>True</td>
      <td>14</td>
    </tr>
  </tbody>
</table>
</div>

<h5 id="what-is-the-most-influential-primary-mood-on-monthly-streams-over-30-seconds">What is the most influential primary mood on monthly streams over 30 seconds?<a class="headerlink" href="#what-is-the-most-influential-primary-mood-on-monthly-streams-over-30-seconds" title="Permanent link">&para;</a></h5>
<p>Answer: Romantic and Lively</p>
<p>Reason: Romantic and Lively moods appear multiple times as highly influential (high rank) they have high multipliers. A contendent may be Tender, as it has a high multiplier effect as well at 3.75</p>
<div class="codehilite"><pre><span></span><code><span class="n">chisq_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">chisq_results</span><span class="p">[</span><span class="s1">&#39;feature&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;mood_1&#39;</span><span class="p">)</span>
                 <span class="o">&amp;</span> <span class="p">(</span><span class="n">chisq_results</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;monthly_stream30s&#39;</span><span class="p">)]</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>target</th>
      <th>upper q</th>
      <th>upper q value</th>
      <th>feature</th>
      <th>group</th>
      <th>chi</th>
      <th>p-value</th>
      <th>cTable</th>
      <th>multiplier</th>
      <th>reject null</th>
      <th>rank</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>10</th>
      <td>monthly_stream30s</td>
      <td>0.99</td>
      <td>2843.0</td>
      <td>mood_1</td>
      <td>-</td>
      <td>112.668942</td>
      <td>2.549855e-26</td>
      <td>[[397605   1728]\n [  3970     63]]</td>
      <td>3.651389</td>
      <td>True</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>monthly_stream30s</td>
      <td>0.99</td>
      <td>2843.0</td>
      <td>mood_1</td>
      <td>Romantic</td>
      <td>175.072639</td>
      <td>5.772239e-40</td>
      <td>[[390131   9202]\n [  3812    221]]</td>
      <td>2.457919</td>
      <td>True</td>
      <td>1</td>
    </tr>
    <tr>
      <th>5</th>
      <td>monthly_stream30s</td>
      <td>0.99</td>
      <td>2843.0</td>
      <td>mood_1</td>
      <td>Lively</td>
      <td>172.134248</td>
      <td>2.529542e-39</td>
      <td>[[389222  10111]\n [  3798    235]]</td>
      <td>2.381860</td>
      <td>True</td>
      <td>2</td>
    </tr>
    <tr>
      <th>33</th>
      <td>monthly_stream30s</td>
      <td>0.99</td>
      <td>2843.0</td>
      <td>mood_1</td>
      <td>Other</td>
      <td>30.443472</td>
      <td>3.437382e-08</td>
      <td>[[397678   1655]\n [  3993     40]]</td>
      <td>2.407101</td>
      <td>True</td>
      <td>11</td>
    </tr>
    <tr>
      <th>11</th>
      <td>monthly_stream30s</td>
      <td>0.90</td>
      <td>432.0</td>
      <td>mood_1</td>
      <td>Other</td>
      <td>197.598843</td>
      <td>6.979647e-45</td>
      <td>[[361719   1352]\n [ 39952    343]]</td>
      <td>2.296943</td>
      <td>True</td>
      <td>11</td>
    </tr>
    <tr>
      <th>26</th>
      <td>monthly_stream30s</td>
      <td>0.99</td>
      <td>2843.0</td>
      <td>mood_1</td>
      <td>Peaceful</td>
      <td>47.834009</td>
      <td>4.638752e-12</td>
      <td>[[397055   2278]\n [  3976     57]]</td>
      <td>2.498765</td>
      <td>True</td>
      <td>13</td>
    </tr>
    <tr>
      <th>1</th>
      <td>monthly_stream30s</td>
      <td>0.99</td>
      <td>2843.0</td>
      <td>mood_1</td>
      <td>Tender</td>
      <td>218.759022</td>
      <td>1.686848e-49</td>
      <td>[[396180   3153]\n [  3916    117]]</td>
      <td>3.754151</td>
      <td>True</td>
      <td>16</td>
    </tr>
  </tbody>
</table>
</div>

<h5 id="which-categorical-feature-is-most-influential-overall">Which Categorical Feature is most influential overall?<a class="headerlink" href="#which-categorical-feature-is-most-influential-overall" title="Permanent link">&para;</a></h5>
<p>Answer: genre_1, followed by genre_2 and mood_1</p>
<p>Reason: we see that these features appear multiple times across the 5 different targets and 2 different quantiles</p>
<div class="codehilite"><pre><span></span><code><span class="n">chisq_results</span><span class="p">[</span><span class="s1">&#39;feature&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>genre_1    48
genre_2    39
mood_1     34
mood_2     28
mood_3     17
genre_3    16
Name: feature, dtype: int64
</code></pre></div>

<h5 id="what-are-the-shortcomings-of-this-analysis">What are the shortcomings of this analysis?<a class="headerlink" href="#what-are-the-shortcomings-of-this-analysis" title="Permanent link">&para;</a></h5>
<p>We haven't taken into account confounding variables. For example, perhaps Latin genre is typically associated with Lively mood. Then which variable is it that actually contributes to a highly performing playlist? We have strategies for dealing with this. We can stratify the confounding variables by over or under sampling. We can also consider them together in a forward selection logistic model. We will take the latter approach later on in the analysis.</p>
<p>We haven't considered the categorical variables alongside the continuous variables, so we don't know how they fit overall in terms of relative improtance. We will approach this the same way as the confounding variables issue, and incorporate all variables in a logistic regression.</p>
<h4 id="t-test_1">t-Test<a class="headerlink" href="#t-test_1" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="n">ttest_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;t_test_results.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ttest_results</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>target</th>
      <th>feature</th>
      <th>test stat</th>
      <th>p-value</th>
      <th>upper q avg</th>
      <th>lower q avg</th>
      <th>reject null</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>mau_previous_month</td>
      <td>n_albums</td>
      <td>-25.318099</td>
      <td>4.772854e-63</td>
      <td>69.77939</td>
      <td>78.70629</td>
      <td>True</td>
    </tr>
    <tr>
      <th>1</th>
      <td>mau_previous_month</td>
      <td>n_artists</td>
      <td>-15.418330</td>
      <td>9.408966e-36</td>
      <td>68.08641</td>
      <td>73.90254</td>
      <td>True</td>
    </tr>
    <tr>
      <th>2</th>
      <td>mau_previous_month</td>
      <td>n_local_tracks</td>
      <td>-9.550137</td>
      <td>7.728853e-18</td>
      <td>1.60489</td>
      <td>2.07692</td>
      <td>True</td>
    </tr>
    <tr>
      <th>3</th>
      <td>mau_previous_month</td>
      <td>n_tracks</td>
      <td>6.086774</td>
      <td>5.913654e-09</td>
      <td>149.50371</td>
      <td>145.10534</td>
      <td>True</td>
    </tr>
    <tr>
      <th>0</th>
      <td>mau_both_months</td>
      <td>n_artists</td>
      <td>52.402365</td>
      <td>2.845239e-114</td>
      <td>91.41907</td>
      <td>71.97618</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
</div>

<h4 id="models">Models<a class="headerlink" href="#models" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="n">log_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../../scripts/fwd_selection_results.txt&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">log_results</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;feature&#39;</span><span class="p">,</span> <span class="s1">&#39;pseudo r2&#39;</span><span class="p">]</span>
<span class="n">log_results</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">log_results</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">log_results</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>feature</th>
      <th>pseudo r2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>intercept</td>
      <td>2.197000e-12</td>
    </tr>
    <tr>
      <th>2</th>
      <td>n_albums</td>
      <td>2.614000e-02</td>
    </tr>
    <tr>
      <th>3</th>
      <td>genre_1_Latin</td>
      <td>3.093000e-02</td>
    </tr>
    <tr>
      <th>4</th>
      <td>genre_1_Indie Rock</td>
      <td>3.274000e-02</td>
    </tr>
    <tr>
      <th>5</th>
      <td>genre_1_Rap</td>
      <td>3.431000e-02</td>
    </tr>
    <tr>
      <th>6</th>
      <td>genre_1_Dance &amp; House</td>
      <td>3.568000e-02</td>
    </tr>
    <tr>
      <th>7</th>
      <td>genre_1_Rock</td>
      <td>3.674000e-02</td>
    </tr>
    <tr>
      <th>8</th>
      <td>mood_1_Energizing</td>
      <td>3.772000e-02</td>
    </tr>
    <tr>
      <th>9</th>
      <td>genre_1_Children's</td>
      <td>3.863000e-02</td>
    </tr>
    <tr>
      <th>10</th>
      <td>mood_1_Tender</td>
      <td>3.931000e-02</td>
    </tr>
    <tr>
      <th>11</th>
      <td>mood_1_Other</td>
      <td>3.995000e-02</td>
    </tr>
    <tr>
      <th>12</th>
      <td>n_tracks</td>
      <td>4.052000e-02</td>
    </tr>
    <tr>
      <th>13</th>
      <td>mood_1_Peaceful</td>
      <td>4.106000e-02</td>
    </tr>
    <tr>
      <th>14</th>
      <td>mood_1_Romantic</td>
      <td>4.161000e-02</td>
    </tr>
    <tr>
      <th>15</th>
      <td>genre_1_Electronica</td>
      <td>4.208000e-02</td>
    </tr>
    <tr>
      <th>16</th>
      <td>genre_2_Indie Rock</td>
      <td>4.248000e-02</td>
    </tr>
    <tr>
      <th>17</th>
      <td>mood_2_Energizing</td>
      <td>4.287000e-02</td>
    </tr>
    <tr>
      <th>18</th>
      <td>genre_1_R&amp;B</td>
      <td>4.319000e-02</td>
    </tr>
    <tr>
      <th>19</th>
      <td>genre_3_Indie Rock</td>
      <td>4.353000e-02</td>
    </tr>
    <tr>
      <th>20</th>
      <td>genre_1_Classical</td>
      <td>4.379000e-02</td>
    </tr>
    <tr>
      <th>21</th>
      <td>genre_2_Alternative</td>
      <td>4.403000e-02</td>
    </tr>
    <tr>
      <th>22</th>
      <td>genre_2_Metal</td>
      <td>4.427000e-02</td>
    </tr>
    <tr>
      <th>23</th>
      <td>mood_2_Peaceful</td>
      <td>4.449000e-02</td>
    </tr>
    <tr>
      <th>24</th>
      <td>mood_2_Romantic</td>
      <td>4.472000e-02</td>
    </tr>
    <tr>
      <th>25</th>
      <td>mood_3_Romantic</td>
      <td>4.498000e-02</td>
    </tr>
    <tr>
      <th>26</th>
      <td>genre_3_Alternative</td>
      <td>4.522000e-02</td>
    </tr>
  </tbody>
</table>
</div>

<div class="codehilite"><pre><span></span><code><span class="n">target</span> <span class="o">=</span> <span class="s2">&quot;monthly_stream30s&quot;</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">labels</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">weights</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">weights</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;float&#39;</span>
<span class="n">lim</span> <span class="o">=</span> <span class="mi">11</span>
<span class="n">dom_class_weight</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">lim</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">quant</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">lim</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">lim</span><span class="p">)):</span>
    <span class="k">if</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="n">lim</span> <span class="o">-</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">prev</span> <span class="o">=</span> <span class="n">quant</span>
        <span class="k">continue</span>
    <span class="k">elif</span> <span class="n">idx</span> <span class="o">==</span> <span class="n">lim</span> <span class="o">-</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">weights</span><span class="p">[</span><span class="n">y</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">quant</span><span class="p">)]</span> <span class="o">=</span> <span class="n">dom_class_weight</span>
        <span class="n">labels</span><span class="p">[</span><span class="n">labels</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">quant</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">names</span> <span class="o">+=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;less than </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">quant</span><span class="p">)</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2"> listens&quot;</span><span class="p">]</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">labels</span><span class="p">[(</span><span class="n">labels</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">prev</span><span class="p">))</span>
              <span class="o">&amp;</span> <span class="p">(</span><span class="n">labels</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">quant</span><span class="p">))]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">weights</span><span class="p">[(</span><span class="n">y</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">prev</span><span class="p">))</span>
              <span class="o">&amp;</span> <span class="p">(</span><span class="n">y</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">quant</span><span class="p">))]</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="n">names</span> <span class="o">+=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">prev</span><span class="p">)</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2"> &lt; listens &lt;= </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">quant</span><span class="p">)</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
    <span class="n">prev</span> <span class="o">=</span> <span class="n">quant</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">labels</span>

<span class="n">basemodel</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../../scripts/basemodel.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">X2</span> <span class="o">=</span> <span class="n">basemodel</span><span class="o">.</span><span class="n">values</span>
<span class="n">est</span> <span class="o">=</span> <span class="n">Logit</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">X2</span><span class="p">)</span>
<span class="n">est2</span> <span class="o">=</span> <span class="n">est</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">disp</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">summ</span> <span class="o">=</span> <span class="n">est2</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>

<span class="n">res_table</span> <span class="o">=</span> <span class="n">summ</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">res_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">res_table</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="n">cols</span> <span class="o">=</span> <span class="n">res_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">]</span>
<span class="n">res_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">res_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">res_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">cols</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
<span class="n">res_df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">basemodel</span><span class="o">.</span><span class="n">columns</span>
<span class="n">res_df</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>coef</th>
      <th>std err</th>
      <th>z</th>
      <th>P&gt;|z|</th>
      <th>[0.025</th>
      <th>0.975]</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>intercept</th>
      <td>-2.0919</td>
      <td>0.012</td>
      <td>-180.211</td>
      <td>0.000</td>
      <td>-2.115</td>
      <td>-2.069</td>
    </tr>
    <tr>
      <th>n_albums</th>
      <td>0.2659</td>
      <td>0.012</td>
      <td>21.370</td>
      <td>0.000</td>
      <td>0.241</td>
      <td>0.290</td>
    </tr>
    <tr>
      <th>genre_1_Latin</th>
      <td>0.5389</td>
      <td>0.025</td>
      <td>21.354</td>
      <td>0.000</td>
      <td>0.489</td>
      <td>0.588</td>
    </tr>
    <tr>
      <th>genre_1_Indie Rock</th>
      <td>-0.5919</td>
      <td>0.020</td>
      <td>-30.130</td>
      <td>0.000</td>
      <td>-0.630</td>
      <td>-0.553</td>
    </tr>
    <tr>
      <th>genre_1_Rap</th>
      <td>-0.3552</td>
      <td>0.018</td>
      <td>-19.651</td>
      <td>0.000</td>
      <td>-0.391</td>
      <td>-0.320</td>
    </tr>
    <tr>
      <th>genre_1_Dance &amp; House</th>
      <td>-0.3364</td>
      <td>0.023</td>
      <td>-14.444</td>
      <td>0.000</td>
      <td>-0.382</td>
      <td>-0.291</td>
    </tr>
    <tr>
      <th>genre_1_Rock</th>
      <td>-0.4325</td>
      <td>0.024</td>
      <td>-18.072</td>
      <td>0.000</td>
      <td>-0.479</td>
      <td>-0.386</td>
    </tr>
    <tr>
      <th>mood_1_Energizing</th>
      <td>-0.3012</td>
      <td>0.026</td>
      <td>-11.592</td>
      <td>0.000</td>
      <td>-0.352</td>
      <td>-0.250</td>
    </tr>
    <tr>
      <th>genre_1_Children's</th>
      <td>0.7694</td>
      <td>0.061</td>
      <td>12.545</td>
      <td>0.000</td>
      <td>0.649</td>
      <td>0.890</td>
    </tr>
    <tr>
      <th>mood_1_Tender</th>
      <td>0.6086</td>
      <td>0.053</td>
      <td>11.496</td>
      <td>0.000</td>
      <td>0.505</td>
      <td>0.712</td>
    </tr>
    <tr>
      <th>mood_1_Other</th>
      <td>0.8435</td>
      <td>0.062</td>
      <td>13.497</td>
      <td>0.000</td>
      <td>0.721</td>
      <td>0.966</td>
    </tr>
    <tr>
      <th>n_tracks</th>
      <td>0.0465</td>
      <td>0.006</td>
      <td>7.665</td>
      <td>0.000</td>
      <td>0.035</td>
      <td>0.058</td>
    </tr>
    <tr>
      <th>mood_1_Peaceful</th>
      <td>0.7355</td>
      <td>0.057</td>
      <td>12.849</td>
      <td>0.000</td>
      <td>0.623</td>
      <td>0.848</td>
    </tr>
    <tr>
      <th>mood_1_Romantic</th>
      <td>0.3608</td>
      <td>0.032</td>
      <td>11.187</td>
      <td>0.000</td>
      <td>0.298</td>
      <td>0.424</td>
    </tr>
    <tr>
      <th>genre_1_Electronica</th>
      <td>-0.2585</td>
      <td>0.033</td>
      <td>-7.726</td>
      <td>0.000</td>
      <td>-0.324</td>
      <td>-0.193</td>
    </tr>
    <tr>
      <th>genre_2_Indie Rock</th>
      <td>-0.2338</td>
      <td>0.022</td>
      <td>-10.617</td>
      <td>0.000</td>
      <td>-0.277</td>
      <td>-0.191</td>
    </tr>
    <tr>
      <th>mood_2_Energizing</th>
      <td>-0.1235</td>
      <td>0.018</td>
      <td>-6.837</td>
      <td>0.000</td>
      <td>-0.159</td>
      <td>-0.088</td>
    </tr>
    <tr>
      <th>genre_1_R&amp;B</th>
      <td>-0.2373</td>
      <td>0.030</td>
      <td>-7.999</td>
      <td>0.000</td>
      <td>-0.295</td>
      <td>-0.179</td>
    </tr>
    <tr>
      <th>genre_3_Indie Rock</th>
      <td>-0.1994</td>
      <td>0.022</td>
      <td>-8.880</td>
      <td>0.000</td>
      <td>-0.243</td>
      <td>-0.155</td>
    </tr>
    <tr>
      <th>genre_1_Classical</th>
      <td>-0.5369</td>
      <td>0.059</td>
      <td>-9.114</td>
      <td>0.000</td>
      <td>-0.652</td>
      <td>-0.421</td>
    </tr>
    <tr>
      <th>genre_2_Alternative</th>
      <td>0.1578</td>
      <td>0.018</td>
      <td>8.915</td>
      <td>0.000</td>
      <td>0.123</td>
      <td>0.192</td>
    </tr>
    <tr>
      <th>genre_2_Metal</th>
      <td>0.3654</td>
      <td>0.039</td>
      <td>9.356</td>
      <td>0.000</td>
      <td>0.289</td>
      <td>0.442</td>
    </tr>
    <tr>
      <th>mood_2_Peaceful</th>
      <td>0.4354</td>
      <td>0.053</td>
      <td>8.150</td>
      <td>0.000</td>
      <td>0.331</td>
      <td>0.540</td>
    </tr>
    <tr>
      <th>mood_2_Romantic</th>
      <td>0.2643</td>
      <td>0.031</td>
      <td>8.628</td>
      <td>0.000</td>
      <td>0.204</td>
      <td>0.324</td>
    </tr>
    <tr>
      <th>mood_3_Romantic</th>
      <td>0.2600</td>
      <td>0.031</td>
      <td>8.363</td>
      <td>0.000</td>
      <td>0.199</td>
      <td>0.321</td>
    </tr>
    <tr>
      <th>genre_3_Alternative</th>
      <td>0.1152</td>
      <td>0.018</td>
      <td>6.548</td>
      <td>0.000</td>
      <td>0.081</td>
      <td>0.150</td>
    </tr>
    <tr>
      <th>n_artists</th>
      <td>0.0968</td>
      <td>0.013</td>
      <td>7.587</td>
      <td>0.000</td>
      <td>0.072</td>
      <td>0.122</td>
    </tr>
    <tr>
      <th>genre_1_Metal</th>
      <td>0.3371</td>
      <td>0.041</td>
      <td>8.282</td>
      <td>0.000</td>
      <td>0.257</td>
      <td>0.417</td>
    </tr>
    <tr>
      <th>mood_1_Aggressive</th>
      <td>-0.2743</td>
      <td>0.041</td>
      <td>-6.671</td>
      <td>0.000</td>
      <td>-0.355</td>
      <td>-0.194</td>
    </tr>
    <tr>
      <th>mood_3_Peaceful</th>
      <td>0.3313</td>
      <td>0.057</td>
      <td>5.778</td>
      <td>0.000</td>
      <td>0.219</td>
      <td>0.444</td>
    </tr>
    <tr>
      <th>mood_1_Empowering</th>
      <td>0.1344</td>
      <td>0.020</td>
      <td>6.801</td>
      <td>0.000</td>
      <td>0.096</td>
      <td>0.173</td>
    </tr>
    <tr>
      <th>genre_1_Religious</th>
      <td>-0.1832</td>
      <td>0.032</td>
      <td>-5.799</td>
      <td>0.000</td>
      <td>-0.245</td>
      <td>-0.121</td>
    </tr>
    <tr>
      <th>genre_3_Metal</th>
      <td>0.2308</td>
      <td>0.043</td>
      <td>5.361</td>
      <td>0.000</td>
      <td>0.146</td>
      <td>0.315</td>
    </tr>
    <tr>
      <th>genre_3_R&amp;B</th>
      <td>-0.1163</td>
      <td>0.022</td>
      <td>-5.238</td>
      <td>0.000</td>
      <td>-0.160</td>
      <td>-0.073</td>
    </tr>
  </tbody>
</table>
</div>

<h2 id="the-simplified-final-approach">The simplified, final approach<a class="headerlink" href="#the-simplified-final-approach" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><code>
</code></pre></div>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2022 Wesley Beckner
    </div>
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.361d90f1.min.js"}</script>
    
    
      <script src="../../assets/javascripts/bundle.289a2a4b.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      
    
  </body>
</html>